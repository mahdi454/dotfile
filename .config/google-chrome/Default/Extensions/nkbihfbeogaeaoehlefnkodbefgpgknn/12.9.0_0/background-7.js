LavaPack.loadBundle([[90,{"../../../../shared/constants/offscreen-communication":5141},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.LedgerOffscreenBridge=void 0;var n=e("../../../../shared/constants/offscreen-communication");function o(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.LedgerOffscreenBridge=class{constructor(){o(this,"isDeviceConnected",!1)}init(){return chrome.runtime.onMessage.addListener((e=>{e.target===n.OffscreenCommunicationTarget.extension&&e.event===n.OffscreenCommunicationEvents.ledgerDeviceConnect&&(this.isDeviceConnected=!0)})),Promise.resolve()}destroy(){return Promise.resolve()}getOptions(){return Promise.resolve({})}setOptions(){return Promise.resolve()}attemptMakeApp(){return new Promise(((e,t)=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.ledgerOffscreen,action:n.LedgerAction.makeApp},(r=>{r.success?e(!0):r.error?t(r.error):t(new Error("Unknown error occurred"))}))}))}updateTransportMethod(e){return new Promise(((t,r)=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.ledgerOffscreen,action:n.LedgerAction.updateTransport,params:{transportType:e}},(e=>{e.success?t(!0):r(new Error("Ledger transport could not be updated"))}))}))}getPublicKey(e){return new Promise(((t,r)=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.ledgerOffscreen,action:n.LedgerAction.getPublicKey,params:e},(e=>{e.success?t(e.payload):r(e.payload.error)}))}))}deviceSignTransaction(e){return new Promise(((t,r)=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.ledgerOffscreen,action:n.LedgerAction.signTransaction,params:e},(e=>{e.success?t(e.payload):r(e.payload.error)}))}))}deviceSignMessage(e){return new Promise(((t,r)=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.ledgerOffscreen,action:n.LedgerAction.signPersonalMessage,params:e},(e=>{e.success?t(e.payload):r(e.payload.error)}))}))}deviceSignTypedData(e){return new Promise(((t,r)=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.ledgerOffscreen,action:n.LedgerAction.signTypedData,params:e},(e=>{e.success?t(e.payload):r(e.payload.error)}))}))}}}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/ledger-offscreen-bridge.ts"}],[91,{"../../../../shared/constants/offscreen-communication":5141},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.TrezorOffscreenBridge=void 0;var n=e("../../../../shared/constants/offscreen-communication");function o(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.TrezorOffscreenBridge=class{constructor(){o(this,"model",void 0),o(this,"minorVersion",void 0)}init(e){return chrome.runtime.onMessage.addListener((e=>{e.target===n.OffscreenCommunicationTarget.extension&&e.event===n.OffscreenCommunicationEvents.trezorDeviceConnect&&(this.model=e.payload.model,this.minorVersion=e.payload.minorVersion)})),new Promise((t=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.trezorOffscreen,action:n.TrezorAction.init,params:e},(()=>{t()}))}))}dispose(){return new Promise((e=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.trezorOffscreen,action:n.TrezorAction.dispose},(()=>{e()}))}))}getPublicKey(e){return new Promise((t=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.trezorOffscreen,action:n.TrezorAction.getPublicKey,params:e},(e=>{t(e)}))}))}ethereumSignTransaction(e){return new Promise((t=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.trezorOffscreen,action:n.TrezorAction.signTransaction,params:e},(e=>{t(e)}))}))}ethereumSignMessage(e){return new Promise((t=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.trezorOffscreen,action:n.TrezorAction.signMessage,params:e},(e=>{t(e)}))}))}ethereumSignTypedData(e){return new Promise((t=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.trezorOffscreen,action:n.TrezorAction.signTypedData,params:e},(e=>{t(e)}))}))}}}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/trezor-offscreen-bridge.ts"}],[92,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){function n(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function o(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(r,"__esModule",{value:!0}),r.IndexedDBPPOMStorage=void 0;const a=async(e,t,r)=>{const n=await crypto.subtle.digest("SHA-256",t);if(Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")!==r)throw new Error(`Checksum mismatch for key ${e}`)};var i=new WeakSet;function s(e){return new Promise(((t,r)=>{const n=indexedDB.open(this.storeName,this.dbVersion);n.onerror=e=>{var t;r(new Error(`Failed to open database ${this.storeName}: ${null===(t=e.target)||void 0===t?void 0:t.error}`))},n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName,{keyPath:["name","chainId"]})},n.onsuccess=r=>{const n=r.target.result.transaction([this.storeName],e).objectStore(this.storeName);t(n)}}))}r.IndexedDBPPOMStorage=class{constructor(e,t){n(this,i),o(this,"storeName",void 0),o(this,"dbVersion",void 0),this.storeName=e,this.dbVersion=t}async objectStoreAction(e,t,r="readonly"){return new Promise(((n,o)=>{(function(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")})(i,this,s).call(this,r).then((r=>{const a=r[e](t);a.onsuccess=async e=>{n(e)},a.onerror=t=>{var r;o(new Error(`Error in indexDB operation ${e}: ${null===(r=t.target)||void 0===r?void 0:r.error}`))}})).catch((e=>{o(e)}))}))}async read(e,t){var r;const n=null===(r=(await this.objectStoreAction("get",[e.name,e.chainId])).target)||void 0===r||null===(r=r.result)||void 0===r?void 0:r.data;return await a(e,n,t),n}async write(e,t,r){await a(e,t,r),await this.objectStoreAction("put",{...e,data:t},"readwrite")}async delete(e){await this.objectStoreAction("delete",[e.name,e.chainId],"readwrite")}async dir(){var e;return null===(e=(await this.objectStoreAction("getAllKeys")).target)||void 0===e?void 0:e.result.map((([e,t])=>({name:e,chainId:t})))}}}}},{package:"$root$",file:"app/scripts/lib/ppom/indexed-db-backend.ts"}],[93,{"../../../../shared/constants/app":5123,"../../../../shared/constants/security-provider":5145,"../../../../shared/constants/transaction":5153,"../../../../shared/lib/trace":5166,"../../../../shared/modules/selectors/networks":5195,"./ppom-util":94,"@metamask/controller-utils":1379},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.createPPOMMiddleware=function(e,t,r,d,f,p){return async(m,g,h)=>{try{const{securityAlertsEnabled:g}=t.state,{chainId:h}=(0,s.getProviderConfig)({metamask:r.state})??{};if(!h)return;if(!g||!u.includes(m.method))return;const _=m.params[0];if("string"==typeof _){const{isSIWEMessage:e}=(0,n.detectSIWE)({data:_});if(e)return}else if(m.method===o.MESSAGE_TYPE.ETH_SEND_TRANSACTION){const{to:e}=_??{},t=f.listAccounts();if(t.some((({address:t})=>(null==t?void 0:t.toLowerCase())===(null==e?void 0:e.toLowerCase()))))return}const b=(0,l.generateSecurityAlertId)();(0,c.trace)({name:c.TraceName.PPOMValidation,parentContext:m.traceContext},(()=>(0,l.validateRequestWithPPOM)({ppomController:e,request:m,securityAlertId:b,chainId:h,updateSecurityAlertResponse:p})));const w={...i.SECURITY_ALERT_RESPONSE_CHECKING_CHAIN,securityAlertId:b};a.SIGNING_METHODS.includes(m.method)&&d.addSignatureSecurityAlertResponse(w),m.securityAlertResponse=w}catch(e){m.securityAlertResponse=(0,l.handlePPOMError)(e,"Error createPPOMMiddleware: ")}finally{h()}}};var n=e("@metamask/controller-utils"),o=e("../../../../shared/constants/app"),a=e("../../../../shared/constants/transaction"),i=e("../../../../shared/constants/security-provider"),s=e("../../../../shared/modules/selectors/networks"),c=e("../../../../shared/lib/trace"),l=e("./ppom-util");const u=Object.freeze(["eth_sendRawTransaction","eth_sendTransaction",...a.SIGNING_METHODS])}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom-middleware.ts"}],[94,{"../../../../shared/constants/security-provider":5145,"../../../../shared/constants/transaction":5153,"./security-alerts-api":96,"@metamask/transaction-controller":2647,uuid:5050},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.generateSecurityAlertId=function(){return(0,o.v4)()},r.handlePPOMError=d,r.isChainSupported=f,r.updateSecurityAlertResponse=async function({appStateController:e,method:t,securityAlertId:r,securityAlertResponse:n,signatureController:o,transactionController:a}){const s=i.SIGNING_METHODS.includes(t),c=await async function(e,t,r,n){const o=i.SIGNING_METHODS.includes(t);for(;;){let t;if(t=o?Object.values(r.messages).find((t=>{var r;return(null===(r=t.securityAlertResponse)||void 0===r?void 0:r.securityAlertId)===e})):n.state.transactions.find((t=>{var r;return(null===(r=t.securityAlertResponse)||void 0===r?void 0:r.securityAlertId)===e})),t)return t;await new Promise((e=>setTimeout(e,100)))}}(r,t,o,a);s?e.addSignatureSecurityAlertResponse({...n,securityAlertId:r}):a.updateSecurityAlertResponse(c.id,{...n,securityAlertId:r})},r.validateRequestWithPPOM=async function({ppomController:e,request:t,securityAlertId:r,chainId:o,updateSecurityAlertResponse:i}){try{if(!await f(o))return void await i(t.method,r,a.SECURITY_ALERT_RESPONSE_CHAIN_NOT_SUPPORTED);await i(t.method,r,a.LOADING_SECURITY_ALERT_RESPONSE);const c=function(e){if(t=e,t.method!==l)return e;var t;const r=e.params[0],o=(0,n.normalizeTransactionParams)(r);return{...e,params:[o]}}(t),u=(0,s.isSecurityAlertsAPIEnabled)()?await async function(e,t,r){try{return{...await(0,s.validateWithSecurityAlertsAPI)(t,r),source:a.SecurityAlertSource.API}}catch(n){return d(n,"Error validating request with security alerts API"),await p(e,r,t)}}(e,o,c):await p(e,c,o);await i(t.method,r,u)}catch(e){await i(t.method,r,d(e,"Error validating JSON RPC using PPOM: "))}};var n=e("@metamask/transaction-controller"),o=e("uuid"),a=e("../../../../shared/constants/security-provider"),i=e("../../../../shared/constants/transaction"),s=e("./security-alerts-api");const{sentry:c}=global,l="eth_sendTransaction",u={result_type:a.BlockaidResultType.Errored,reason:a.BlockaidReason.errored};function d(e,t){const r=function(e){if("object"==typeof e||"string"==typeof e)return e;return JSON.stringify(e)}(e),n=function(e){if(e instanceof Error)return`${e.name}: ${e.message}`;return JSON.stringify(e)}(e);return null==c||c.captureException(e),console.error(t,r),{...u,description:n}}async function f(e){let t=a.SECURITY_PROVIDER_SUPPORTED_CHAIN_IDS_FALLBACK_LIST;try{(0,s.isSecurityAlertsAPIEnabled)()&&(t=await(0,s.getSecurityAlertsAPISupportedChainIds)())}catch(e){d(e,"Error fetching supported chains from security alerts API")}return t.includes(e)}async function p(e,t,r){return{...await e.usePPOM((e=>e.validateJsonRpc(t)),r),source:a.SecurityAlertSource.Local}}}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom-util.ts"}],[95,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){let n;Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.PPOM=void 0,r.initSync=function(e){if(n!==undefined)return n;const t=C();e instanceof WebAssembly.Module||(e=new WebAssembly.Module(e));const r=new WebAssembly.Instance(e,t);return P(r,e)},r.main=function(){n.main()};const o="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&o.decode();let a=null;function i(){return null!==a&&0!==a.byteLength||(a=new Uint8Array(n.memory.buffer)),a}function s(e,t){return e>>>=0,o.decode(i().subarray(e,e+t))}const c=new Array(128).fill(undefined);c.push(undefined,null,!0,!1);let l=c.length;function u(e){l===c.length&&c.push(c.length+1);const t=l;return l=c[t],c[t]=e,t}function d(e){return c[e]}function f(e){const t=d(e);return function(e){e<132||(c[e]=l,l=e)}(e),t}let p=0;const m="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},g="function"==typeof m.encodeInto?function(e,t){return m.encodeInto(e,t)}:function(e,t){const r=m.encode(e);return t.set(r),{read:e.length,written:r.length}};function h(e,t,r){if(r===undefined){const r=m.encode(e),n=t(r.length,1)>>>0;return i().subarray(n,n+r.length).set(r),p=r.length,n}let n=e.length,o=t(n,1)>>>0;const a=i();let s=0;for(;s<n;s++){const t=e.charCodeAt(s);if(t>127)break;a[o+s]=t}if(s!==n){0!==s&&(e=e.slice(s)),o=r(o,n,n=s+3*e.length,1)>>>0;const t=i().subarray(o+s,o+n);s+=g(e,t).written}return p=s,o}let _=null;function b(){return null!==_&&0!==_.byteLength||(_=new Int32Array(n.memory.buffer)),_}function w(e){const t=typeof e;if("number"==t||"boolean"==t||null==e)return`${e}`;if("string"==t)return`"${e}"`;if("symbol"==t){const t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){const t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){const t=e.length;let r="[";t>0&&(r+=w(e[0]));for(let n=1;n<t;n++)r+=", "+w(e[n]);return r+="]",r}const r=/\[object ([^\]]+)\]/.exec(toString.call(e));let n;if(!(r.length>1))return toString.call(e);if(n=r[1],"Object"==n)try{return"Object("+JSON.stringify(e)+")"}catch(e){return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:n}function y(e,t,r){n.wasm_bindgen__convert__closures__invoke1_mut(e,t,u(r))}function E(e,t){n._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__destroy(e,t)}let v=null;function T(e,t){const r=t(4*e.length,4)>>>0,o=(null!==v&&0!==v.byteLength||(v=new Uint32Array(n.memory.buffer)),v);for(let t=0;t<e.length;t++)o[r/4+t]=u(e[t]);return p=e.length,r}function S(e,t){try{return e.apply(this,t)}catch(e){n.__wbindgen_exn_store(u(e))}}class A{static __wrap(e){e>>>=0;const t=Object.create(A.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();n.__wbg_ppom_free(e)}static new(e,t){const r=T(t,n.__wbindgen_malloc),o=p;return f(n.ppom_new(u(e),r,o))}validateJsonRpc(e){return f(n.ppom_validateJsonRpc(this.__wbg_ptr,u(e)))}static version(){return f(n.ppom_version())}}function C(){const e={wbg:{}};return e.wbg.__wbg_buffer_085ec1f694018c4f=function(e){return u(d(e).buffer)},e.wbg.__wbg_call_01734de55d61e11d=function(){return S((function(e,t,r){return u(d(e).call(d(t),d(r)))}),arguments)},e.wbg.__wbg_call_4c92f6aec1e1d6e6=function(){return S((function(e,t,r,n){return u(d(e).call(d(t),d(r),d(n)))}),arguments)},e.wbg.__wbg_from_d7c216d4616bb368=function(e){return u(Array.from(d(e)))},e.wbg.__wbg_get_44be0491f933a435=function(e,t){return u(d(e)[t>>>0])},e.wbg.__wbg_length_72e2208bbc0efc61=function(e){return d(e).length},e.wbg.__wbg_length_d813e535247d427e=function(e){return d(e).length},e.wbg.__wbg_length_fff51ee6522a1a18=function(e){return d(e).length},e.wbg.__wbg_new_43f1b47c28813cbd=function(e,t){try{var r={a:e,b:t};const o=new Promise(((e,t)=>{const o=r.a;r.a=0;try{return function(e,t,r,o){n.wasm_bindgen__convert__closures__invoke2_mut(e,t,u(r),u(o))}(o,r.b,e,t)}finally{r.a=o}}));return u(o)}finally{r.a=r.b=0}},e.wbg.__wbg_new_8125e318e6245eed=function(e){return u(new Uint8Array(d(e)))},e.wbg.__wbg_parse_670c19d4e984792e=function(){return S((function(e,t){return u(JSON.parse(s(e,t)))}),arguments)},e.wbg.__wbg_ppom_new=function(e){return u(A.__wrap(e))},e.wbg.__wbg_resolve_53698b95aaf7fcf8=function(e){return u(Promise.resolve(d(e)))},e.wbg.__wbg_set_5cf90238115182c3=function(e,t,r){d(e).set(d(t),r>>>0)},e.wbg.__wbg_stringify_e25465938f3f611f=function(){return S((function(e){return u(JSON.stringify(d(e)))}),arguments)},e.wbg.__wbg_then_b2267541e2a73865=function(e,t,r){return u(d(e).then(d(t),d(r)))},e.wbg.__wbg_then_f7e06ee3c11698eb=function(e,t){return u(d(e).then(d(t)))},e.wbg.__wbindgen_cb_drop=function(e){const t=f(e).original;if(1==t.cnt--)return t.a=0,!0;return!1},e.wbg.__wbindgen_closure_wrapper_wasm_bindgen__closure__Closure_T___wrap__breaks_if_inlined=function(e,t,r){const n=function(e,t,r,n){const o={a:e,b:t,cnt:1},a=(...e)=>{o.cnt++;const t=o.a;o.a=0;try{return n(t,o.b,...e)}finally{0==--o.cnt?r(t,o.b):o.a=t}};return a.original=o,a}(e,t,E,y);return u(n)},e.wbg.__wbindgen_debug_string=function(e,t){const r=h(w(d(t)),n.__wbindgen_malloc,n.__wbindgen_realloc),o=p;b()[e/4+1]=o,b()[e/4+0]=r},e.wbg.__wbindgen_error_new=function(e,t){return u(new Error(s(e,t)))},e.wbg.__wbindgen_is_undefined=function(e){return d(e)===undefined},e.wbg.__wbindgen_memory=function(){return u(n.memory)},e.wbg.__wbindgen_object_drop_ref=function(e){f(e)},e.wbg.__wbindgen_string_get=function(e,t){const r=d(t),o="string"==typeof r?r:undefined;var a,i=(a=o)===undefined||null===a?0:h(o,n.__wbindgen_malloc,n.__wbindgen_realloc),s=p;b()[e/4+1]=s,b()[e/4+0]=i},e.wbg.__wbindgen_string_new=function(e,t){return u(s(e,t))},e.wbg.__wbindgen_throw=function(e,t){throw new Error(s(e,t))},e}function P(e,t){return n=e.exports,O.__wbindgen_wasm_module=t,_=null,v=null,a=null,n.__wbindgen_start(),n}async function O(e){if(n!==undefined)return n;const t=C();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));const{instance:r,module:o}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const r=await e.arrayBuffer();return await WebAssembly.instantiate(r,t)}{const r=await WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}}(await e,t);return P(r,o)}r.PPOM=A;r.default=O}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom.js"}],[96,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getSecurityAlertsAPISupportedChainIds=async function(){return a(o)},r.isSecurityAlertsAPIEnabled=function(){const e="true";return"true"===e.toString()},r.validateWithSecurityAlertsAPI=async function(e,t){return a(`${n}/${e}`,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})};const n="validate",o="supportedChains";async function a(e,t){const r=function(e){const t="https://security-alerts.api.cx.metamask.io";if(!t)throw new Error("Security alerts API URL is not set");return`${t}/${e}`}(e),n=await fetch(r,t);if(!n.ok)throw new Error(`Security alerts API request failed with status: ${n.status}`);return await n.json()}}}},{package:"$root$",file:"app/scripts/lib/ppom/security-alerts-api.ts"}],[97,{"./handlers":103,"@metamask/permission-controller":2089,"@metamask/rpc-errors":2262,"@metamask/snaps-rpc-methods":2428,"@metamask/utils":2765},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.createMethodMiddleware=r.createLegacyMethodMiddleware=void 0;var n=e("@metamask/permission-controller"),o=e("@metamask/rpc-errors"),a=e("@metamask/snaps-rpc-methods"),i=e("@metamask/utils"),s=e("./handlers");const c=[...s.handlers,...n.permissionRpcMethods.handlers];r.createMethodMiddleware=l(c),r.createLegacyMethodMiddleware=l(s.legacyHandlers);function l(e){const t=e.reduce(((e,t)=>{for(const r of t.methodNames)e[r]=t;return e}),{}),r=new Set(e.flatMap((({hookNames:e})=>Object.getOwnPropertyNames(e))));return e=>{!function(e,t){const r=[];if(t.forEach((t=>{(0,i.hasProperty)(e,t)||r.push(t)})),r.length>0)throw new Error(`Missing expected hooks:\n\n${r.join("\n")}\n`);const n=Object.getOwnPropertyNames(e).filter((e=>!t.has(e)));if(n.length>0)throw new Error(`Received unexpected hooks:\n\n${n.join("\n")}\n`)}(e,r);return async(r,n,i,s)=>{const c=t[r.method];if(c){const{implementation:t,hookNames:l}=c;try{return await t(r,n,i,s,(0,a.selectHooks)(e,l))}catch(e){return s(e instanceof Error?e:o.rpcErrors.internal({data:e}))}}return i()}}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/createMethodMiddleware.js"}],[98,{"../../../../shared/constants/network":5139,"@metamask/rpc-errors":2262},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.createUnsupportedMethodMiddleware=function(){return async function(e,t,r,a){return o.UNSUPPORTED_RPC_METHODS.has(e.method)?a(n.rpcErrors.methodNotSupported()):r()}};var n=e("@metamask/rpc-errors"),o=e("../../../../shared/constants/network")}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/createUnsupportedMethodMiddleware.ts"}],[99,{"../../../../../shared/constants/app":5123,"./ethereum-chain-utils":101,"@metamask/controller-utils":1379,"@metamask/network-controller":1946,"@metamask/rpc-errors":2262,lodash:4256,"uri-js":5025},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(e("uri-js")),o=e("@metamask/controller-utils"),a=e("@metamask/network-controller"),i=e("@metamask/rpc-errors"),s=e("lodash"),c=e("../../../../../shared/constants/app"),l=e("./ethereum-chain-utils");function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}const d={methodNames:[c.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN],implementation:async function(e,t,r,c,{addNetwork:u,updateNetwork:d,getNetworkConfigurationByChainId:f,setActiveNetwork:p,requestUserApproval:m,startApprovalFlow:g,endApprovalFlow:h,getCurrentChainIdForDomain:_,getCaveat:b,requestPermittedChainsPermission:w,grantPermittedChainsPermissionIncremental:y}){let E;try{E=(0,l.validateAddEthereumChainParams)(e.params[0],c)}catch(e){return c(e)}const{chainId:v,chainName:T,firstValidBlockExplorerUrl:S,firstValidRPCUrl:A,ticker:C}=E,{origin:P}=e,O=_(P),M=f(v);if(M&&M.chainId===v&&M.nativeCurrency!==C)return c(i.rpcErrors.invalidParams({message:`nativeCurrency.symbol does not match currency symbol for a network the user already has added with the same chainId. Received:\n${C}`}));let N,I=M,k=null==M?void 0:M.rpcEndpoints.findIndex((({url:e})=>n.equal(e,A))),R=S?null==M?void 0:M.blockExplorerUrls.findIndex((e=>n.equal(e,S))):undefined;if(!M||k!==M.defaultRpcEndpointIndex||S&&R!==M.defaultBlockExplorerUrlIndex){({id:N}=await g());try{if(await m({origin:P,type:o.ApprovalType.AddEthereumChain,requestData:{chainId:v,rpcPrefs:{blockExplorerUrl:S},chainName:T,rpcUrl:A,ticker:C}}),M){const e=(0,s.cloneDeep)(M);-1===k&&(e.rpcEndpoints=[...e.rpcEndpoints,{url:A,type:a.RpcEndpointType.Custom,name:T}],k=e.rpcEndpoints.length-1),e.defaultRpcEndpointIndex=k,S&&(-1===R&&(e.blockExplorerUrls=[...e.blockExplorerUrls,S],R=e.blockExplorerUrls.length-1),e.defaultBlockExplorerUrlIndex=R),I=await d(e.chainId,e,O===v?{replacementSelectedRpcEndpointIndex:e.defaultRpcEndpointIndex}:undefined)}else I=await u({blockExplorerUrls:S?[S]:[],defaultBlockExplorerUrlIndex:S?0:undefined,chainId:v,defaultRpcEndpointIndex:0,name:T,nativeCurrency:C,rpcEndpoints:[{url:A,name:T,type:a.RpcEndpointType.Custom}]})}catch(e){return h({id:N}),c(e)}}if(v!==O){const{networkClientId:e}=I.rpcEndpoints[I.defaultRpcEndpointIndex];return(0,l.switchChain)(t,c,v,e,N,{isAddFlow:!0,setActiveNetwork:p,endApprovalFlow:h,getCaveat:b,requestPermittedChainsPermission:w,grantPermittedChainsPermissionIncremental:y})}N&&h({id:N});return t.result=null,c()},hookNames:{addNetwork:!0,updateNetwork:!0,getNetworkConfigurationByChainId:!0,setActiveNetwork:!0,requestUserApproval:!0,startApprovalFlow:!0,endApprovalFlow:!0,getCurrentChainIdForDomain:!0,getCaveat:!0,requestPermittedChainsPermission:!0,grantPermittedChainsPermissionIncremental:!0}};r.default=d}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/add-ethereum-chain.js"}],[4,{"../../shared/constants/app":5123,"../../shared/constants/metametrics":5135,"../../shared/constants/offscreen-communication":5141,"../../shared/modules/add-nonce-to-csp":5170,"../../shared/modules/browser-runtime.utils":5172,"../../shared/modules/mv3.utils":5185,"../../shared/modules/object.utils":5187,"../../shared/modules/provider-injection":5188,"../../shared/modules/selectors/networks":5195,"../../test/e2e/background-socket/socket-background-to-mocha":5206,"../../test/e2e/default-fixture":5208,"../../test/stub/keyring-bridge":5214,"./constants/marketing-site-whitelist":6,"./constants/sentry-state":7,"./first-time-state":41,"./fixtures/generate-wallet-state":42,"./lib/createStreamSink":69,"./lib/ens-ipfs/setup":76,"./lib/get-first-preferred-lang-code":78,"./lib/getObjStructure":79,"./lib/local-store":81,"./lib/migrator":85,"./lib/network-store":87,"./lib/notification-manager":88,"./lib/setup-initial-state-hooks":113,"./lib/util":134,"./metamask-controller":135,"./migrations":286,"./offscreen":287,"./platforms/extension":288,"@metamask/controller-utils":1379,"@metamask/notification-services-controller":2071,"@metamask/obs-store":2082,"@metamask/rpc-errors":2262,"@metamask/snaps-rpc-methods":2428,"@metamask/utils":2765,"debounce-stream":3677,events:3823,"extension-port-stream":3826,loglevel:4262,"readable-stream":4666,"webextension-polyfill":5100},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.loadStateFromPersistence=ve,r.setupController=Ae,r.statePersistenceEvents=void 0,e("./lib/setup-initial-state-hooks");var n=G(e("events")),o=e("readable-stream"),a=G(e("debounce-stream")),i=G(e("loglevel")),s=G(e("webextension-polyfill")),c=e("@metamask/obs-store"),l=e("@metamask/utils"),u=e("@metamask/controller-utils"),d=G(e("extension-port-stream")),f=e("@metamask/rpc-errors"),p=e("@metamask/snaps-rpc-methods"),m=e("@metamask/notification-services-controller"),g=e("../../shared/constants/app"),h=e("../../shared/constants/metametrics"),_=e("../../shared/modules/browser-runtime.utils"),b=e("../../shared/modules/mv3.utils"),w=e("../../shared/modules/object.utils"),y=(e("../../test/e2e/default-fixture"),e("../../test/e2e/background-socket/socket-background-to-mocha"),e("../../shared/constants/offscreen-communication"),e("../../test/stub/keyring-bridge")),E=e("../../shared/modules/selectors/networks"),v=e("../../shared/modules/add-nonce-to-csp"),T=e("../../shared/modules/provider-injection"),S=G(e("./migrations")),A=G(e("./lib/migrator")),C=G(e("./platforms/extension")),P=G(e("./lib/local-store")),O=G(e("./lib/network-store")),M=e("./constants/sentry-state"),N=G(e("./lib/createStreamSink")),I=B(e("./lib/notification-manager")),k=B(e("./metamask-controller")),R=G(e("./first-time-state")),L=G(e("./lib/get-first-preferred-lang-code")),j=G(e("./lib/getObjStructure")),U=G(e("./lib/ens-ipfs/setup")),D=e("./lib/util"),x=(e("./fixtures/generate-wallet-state"),e("./offscreen")),F=e("./constants/marketing-site-whitelist");function $(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return($=function(e){return e?r:t})(e)}function B(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=$(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}function G(e){return e&&e.__esModule?e:{default:e}}const V="#0376C9",H="#D73847",q=9,Y=!1,W=Y?new O.default:new P.default;global.stateHooks.getMostRecentPersistedState=()=>W.mostRecentRetrievedState;const{sentry:z}=global;let K={...R.default};const J={[g.ENVIRONMENT_TYPE_POPUP]:!0,[g.ENVIRONMENT_TYPE_NOTIFICATION]:!0,[g.ENVIRONMENT_TYPE_FULLSCREEN]:!0},Q=["trezor-connect"];i.default.setLevel("info",!1);const X=new C.default,Z=new I.default;let ee=0,te=!1,re=!1;const ne={},oe={};let ae,ie;const se={};Y&&(global.stateHooks.metamaskGetState=W.get.bind(W));const ce=new URL("https://metamask.github.io/phishing-warning/v4.1.0/"),le=ce.toString(),ue=1e3,de=r.statePersistenceEvents=new n.default,{promise:fe,resolve:pe,reject:me}=(0,D.deferredPromise)(),ge=async()=>{const e=await s.default.tabs.query({url:"<all_urls>",windowType:"normal"}).then((e=>((0,_.checkForLastErrorAndLog)(),e))).catch((()=>{(0,_.checkForLastErrorAndLog)()}));for(const t of e)s.default.tabs.sendMessage(t.id,{name:g.EXTENSION_MESSAGES.READY}).then((()=>{(0,_.checkForLastErrorAndLog)()})).catch((()=>{(0,_.checkForLastErrorAndLog)()}))};let he,_e,be;function we(){const e=(new Date).toISOString();s.default.storage.session.set({timestamp:e})}async function ye(){try{const t=b.isManifestV3?(0,x.createOffscreen)():null,r=await ve(),n=r.data,o=await(0,L.default)();let a;if(b.isManifestV3){var e;if(!1!==(null===(e=n.PreferencesController)||void 0===e?void 0:e.enableMV3TimestampSave)){const e=2e3;we(),setInterval(we,e)}const t=await s.default.storage.session.get(["isFirstMetaMaskControllerSetup"]);a=(null==t?void 0:t.isFirstMetaMaskControllerSetup)===undefined,await s.default.storage.session.set({isFirstMetaMaskControllerSetup:a})}Ae(n,o,Y?{keyrings:{trezorBridge:y.FakeTrezorBridge,ledgerBridge:y.FakeLedgerBridge}}:{},a,r.meta,t),function(e){async function t(e,t){try{return await s.default.tabs.update(e,{url:t})}catch(e){return null==z?void 0:z.captureException(e)}}const r=!b.isManifestV3;s.default.webRequest.onBeforeRequest.addListener((n=>{var o,a,i;if(n.tabId===s.default.tabs.TAB_ID_NONE)return{};const{completedOnboarding:c}=e.onboardingController.state;if(!c)return{};if(!e.preferencesController.state.usePhishDetect)return{};if(n.initiator&&new URL(n.initiator).host===ce.host)return{};const{hostname:l,href:u,searchParams:d}=new URL(n.url);if(Y&&d.has("IN_TEST_BYPASS_EARLY_PHISHING_DETECTION"))return{};e.phishingController.maybeUpdateState();const f=e.phishingController.isBlockedRequest(n.url);let p,m;if("main_frame"!==n.type&&"sub_frame"!==n.type||(p=e.phishingController.test(n.url)),!(null!==(o=p)&&void 0!==o&&o.result||f.result))return{};let g=l;null!==(a=p)&&void 0!==a&&a.result&&f.result?m=`${p.type} and ${f.type}`:null!==(i=p)&&void 0!==i&&i.result?m=p.type:(m=f.type,g=n.initiator),e.metaMetricsController.trackEvent({event:h.MetaMetricsEventName.PhishingPageDisplayed,category:h.MetaMetricsEventCategory.Phishing,properties:{url:g,referrer:{url:g},reason:m,requestDomain:f.result?l:undefined}});const _=new URLSearchParams({hostname:l,href:u}),b=new URL(le);b.hash=_.toString();const w=b.toString();return r?"sub_frame"===n.type?(t(n.tabId,w),{cancel:!0}):{redirectUrl:w}:(t(n.tabId,w),{})}),{urls:["http://*/*","https://*/*"]},r?["blocking"]:[])}(ae),b.isManifestV3||(await async function(){let e;try{const t=new URL(le);let r,n;t.hash="#extensionStartup",e=window.document.createElement("iframe"),e.setAttribute("src",t.href),e.setAttribute("sandbox","allow-scripts allow-same-origin");const o=new Promise(((e,t)=>{r=e,n=t}));e.addEventListener("load",r),window.document.body.appendChild(e),setTimeout((()=>n(new Ee)),ue),await o}catch(e){e instanceof Ee?console.warn("Phishing warning page timeout; page not guaranteed to work offline."):console.error("Failed to initialize phishing warning page",e)}finally{e&&e.remove()}}(),(0,D.getPlatform)()===g.PLATFORM_FIREFOX&&function(){const e=btoa(s.default.runtime.getURL("/"));s.default.webRequest.onHeadersReceived.addListener((({responseHeaders:t,url:r})=>{const n=(0,T.checkURLForProviderInjection)(new URL(r)),o=ae.preferencesController.state.overrideContentSecurityPolicyHeader;if(n&&o)for(const r of t)"content-security-policy"===r.name.toLowerCase()&&(r.value=(0,v.addNonceToCsp)(r.value,e));return{responseHeaders:t}}),{types:["main_frame","sub_frame"],urls:["http://*/*","https://*/*"]},["blocking","responseHeaders"])}()),await ge(),i.default.info("MetaMask initialization complete."),pe()}catch(e){me(e)}}s.default.runtime.onConnect.addListener((async(...e)=>{await fe,he(...e)})),s.default.runtime.onConnectExternal.addListener((async(...e)=>{var t;await fe;null!==(t=e[0].sender.tab)&&void 0!==t&&t.id,_e(...e)}));class Ee extends Error{constructor(){super("Timeout failed")}}async function ve(){const e=new A.default({migrations:S.default,defaultVersion:null});if(e.on("error",console.warn),ie=await W.get()||e.generateInitialState(K),ie&&!ie.data&&(ie=e.generateInitialState(K),z.captureMessage("MetaMask - Empty vault found - unable to recover")),e.on("error",(e=>{const t=(0,j.default)(ie);z.captureException(e,{extra:{vaultStructure:t}})})),ie=await e.migrateData(ie),!ie)throw new Error("MetaMask - migrator returned undefined");if(!(0,l.isObject)(ie.meta))throw new Error(`MetaMask - migrator metadata has invalid type '${typeof ie.meta}'`);if("number"!=typeof ie.meta.version)throw new Error(`MetaMask - migrator metadata version has invalid type '${typeof ie.meta.version}'`);if(!(0,l.isObject)(ie.data))throw new Error(`MetaMask - migrator data has invalid type '${typeof ie.data}'`);return W.setMetadata(ie.meta),W.set(ie.data),ie}function Te(e){var t;const{metaMetricsId:r}=ae.metaMetricsController.state;if(!(0,D.shouldEmitDappViewedEvent)(r))return;const n=ae.controllerMessenger.call("PermissionController:getPermissions",e),o=null==n||null===(t=n.eth_accounts)||void 0===t||null===(t=t.caveats[0])||void 0===t?void 0:t.value.length;if(!o)return;const a=ae.controllerMessenger.call("PreferencesController:getState"),i=Object.keys(a.identities).length;ae.metaMetricsController.trackEvent({event:h.MetaMetricsEventName.DappViewed,category:h.MetaMetricsEventCategory.InpageProvider,referrer:{url:e},properties:{is_first_visit:!1,number_of_accounts:i,number_of_accounts_connected:o}})}function Se(e){if(!e.sender||!e.sender.tab||!e.sender.url)return;const t=e.sender.tab.id,r=new URL(e.sender.url),{origin:n}=r;Object.keys(se).includes(t)||(se[t]=n);const o=ae.controllerMessenger.call("PermissionController:hasPermissions",n),a="New Tab"!==e.sender.tab.title;o&&a&&Te(n)}function Ae(e,t,r,n,l,_){var y;ae=new k.default({infuraProjectId:"b6bf7d3508c941499b10025c0776eaf8",showUserConfirmation:Ce,initState:e,initLangCode:t,platform:X,notificationManager:Z,browser:s.default,getRequestAccountTabIds:()=>oe,getOpenMetamaskTabsIds:()=>ne,localStore:W,overrides:r,isFirstMetaMaskControllerSetup:n,currentMigrationVersion:l.version,featureFlags:{},offscreenPromise:_}),(0,U.default)({getCurrentChainId:()=>(0,E.getCurrentChainId)({metamask:ae.networkController.state}),getIpfsGateway:ae.preferencesController.getIpfsGateway.bind(ae.preferencesController),getUseAddressBarEnsResolution:()=>ae.preferencesController.state.useAddressBarEnsResolution,provider:ae.provider}),(0,o.pipeline)((0,c.storeAsStream)(ae.store),(0,a.default)(1e3),(0,N.default)((async e=>{await W.set(e),de.emit("state-persisted",e)})),(e=>{i.default.error("MetaMask - Persistence pipeline failed",e)})),y=ae,global.stateHooks.getSentryAppState=function(){const e=y.memStore.getState();return(0,w.maskObject)(e,M.SENTRY_BACKGROUND_STATE)};const v=()=>ee>0||Boolean(Object.keys(ne).length)||te,T=(e,t)=>{if(!1===e)ae.onClientClosed();else{if(t===g.ENVIRONMENT_TYPE_FULLSCREEN&&Boolean(Object.keys(ne).length))return;ae.onEnvironmentTypeClosed(t)}};function S(e,t){return e>t?`${t}+`:String(e)}function A(){const e=C(),t=function(){try{const{isNotificationServicesEnabled:e,isFeatureAnnouncementsEnabled:t}=ae.notificationServicesController.state,r=Object.values(ae.notificationServicesController.state.metamaskNotificationsList).filter((e=>e.type===m.NotificationServicesController.Constants.TRIGGER_TYPES.SNAP&&null===e.readDate)).length,n=t?ae.notificationServicesController.state.metamaskNotificationsList.filter((e=>!e.isRead&&e.type===m.NotificationServicesController.Constants.TRIGGER_TYPES.FEATURES_ANNOUNCEMENT)).length:0,o=e?ae.notificationServicesController.state.metamaskNotificationsList.filter((e=>!e.isRead&&e.type!==m.NotificationServicesController.Constants.TRIGGER_TYPES.FEATURES_ANNOUNCEMENT&&e.type!==m.NotificationServicesController.Constants.TRIGGER_TYPES.SNAP)).length:0;return r+n+o}catch(e){return console.error("Failed to get unread notifications count:",e),0}}();let r="",n=V;e?r=S(e,q):t>0&&(r=S(t,q),n=H);try{const e={text:r},t={color:n};b.isManifestV3?(s.default.action.setBadgeText(e),s.default.action.setBadgeBackgroundColor(t)):(s.default.browserAction.setBadgeText(e),s.default.browserAction.setBadgeBackgroundColor(t))}catch(e){console.error("Error updating browser badge:",e)}}function C(){try{let e=ae.appStateController.waitingForUnlock.length+ae.approvalController.getTotalApprovalCount();return ae.preferencesController.getUseRequestQueue()&&(e+=ae.queuedRequestController.state.queuedRequestCount),e}catch(e){return console.error("Failed to get pending approval count:",e),0}}he=async e=>{var t;const n=e.name;if(Q.includes(e.name))return;let a=!1;const i=(0,D.getPlatform)(),c=null!==(t=e.sender)&&void 0!==t&&t.url?new URL(e.sender.url):null;if(a=i===g.PLATFORM_FIREFOX?J[n]:(null==c?void 0:c.origin)===`chrome-extension://${s.default.runtime.id}`,a){var l;const t=(null==r||null===(l=r.getPortStream)||void 0===l?void 0:l.call(r,e))||new d.default(e);if(ae.isClientOpen=!0,ae.setupTrustedCommunication(t,e.sender),n===g.ENVIRONMENT_TYPE_POPUP&&(ee+=1,(0,o.finished)(t,(()=>{ee-=1;const e=v();ae.isClientOpen=e,T(e,g.ENVIRONMENT_TYPE_POPUP)}))),n===g.ENVIRONMENT_TYPE_NOTIFICATION&&(te=!0,(0,o.finished)(t,(()=>{te=!1;const e=v();ae.isClientOpen=e,T(e,g.ENVIRONMENT_TYPE_NOTIFICATION)}))),n===g.ENVIRONMENT_TYPE_FULLSCREEN){const r=e.sender.tab.id;ne[r]=!0,(0,o.finished)(t,(()=>{delete ne[r];const e=v();ae.isClientOpen=e,T(e,g.ENVIRONMENT_TYPE_FULLSCREEN)}))}}else if(c&&c.origin===ce.origin&&c.pathname===ce.pathname){var u;const t=(null==r||null===(u=r.getPortStream)||void 0===u?void 0:u.call(r,e))||new d.default(e);ae.setupPhishingCommunication({connectionStream:t})}else{if(e.sender&&e.sender.tab&&e.sender.url){const t=e.sender.tab.id,r=new URL(e.sender.url),{origin:n}=r;Se(e),e.onMessage.addListener((e=>{e.data&&e.data.method===g.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS&&(oe[n]=t)}))}if(c&&F.COOKIE_ID_MARKETING_WHITELIST_ORIGINS.some((e=>e===c.origin))){var f;const t=(null==r||null===(f=r.getPortStream)||void 0===f?void 0:f.call(r,e))||new d.default(e);ae.setUpCookieHandlerCommunication({connectionStream:t})}_e(e)}},_e=e=>{var t;const n=(null==r||null===(t=r.getPortStream)||void 0===t?void 0:t.call(r,e))||new d.default(e);ae.setupUntrustedCommunicationEip1193({connectionStream:n,sender:e.sender})},be=async e=>{var t;if(Q.includes(e.name))return;e.sender&&e.sender.tab&&e.sender.url&&Se(e);const n=(null==r||null===(t=r.getPortStream)||void 0===t?void 0:t.call(r,e))||new d.default(e);ae.setupUntrustedCommunicationCaip({connectionStream:n,sender:e.sender})},null!=r&&r.registerConnectListeners&&r.registerConnectListeners(he,_e),A(),ae.decryptMessageController.hub.on(k.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,A),ae.encryptionPublicKeyController.hub.on(k.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,A),ae.signatureController.hub.on(k.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,A),ae.appStateController.on(k.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,A),ae.controllerMessenger.subscribe(k.METAMASK_CONTROLLER_EVENTS.APPROVAL_STATE_CHANGE,A),ae.controllerMessenger.subscribe(k.METAMASK_CONTROLLER_EVENTS.QUEUED_REQUEST_STATE_CHANGE,A),ae.controllerMessenger.subscribe(k.METAMASK_CONTROLLER_EVENTS.METAMASK_NOTIFICATIONS_LIST_UPDATED,A),ae.controllerMessenger.subscribe(k.METAMASK_CONTROLLER_EVENTS.METAMASK_NOTIFICATIONS_MARK_AS_READ,A),Z.on(I.NOTIFICATION_MANAGER_EVENTS.POPUP_CLOSED,(({automaticallyClosed:e})=>{e?C()>0&&Ce():(ae.signatureController.rejectUnapproved(h.REJECT_NOTIFICATION_CLOSE_SIG),ae.decryptMessageController.rejectUnapproved(h.REJECT_NOTIFICATION_CLOSE),ae.encryptionPublicKeyController.rejectUnapproved(h.REJECT_NOTIFICATION_CLOSE),Object.values(ae.approvalController.state.pendingApprovals).forEach((({id:e,type:t})=>{switch(t){case u.ApprovalType.SnapDialogAlert:case u.ApprovalType.SnapDialogPrompt:case p.DIALOG_APPROVAL_TYPES.default:ae.approvalController.accept(e,null);break;case u.ApprovalType.SnapDialogConfirmation:case g.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountCreation:case g.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountRemoval:case g.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.showSnapAccountRedirect:ae.approvalController.accept(e,!1);break;default:ae.approvalController.reject(e,f.providerErrors.userRejectedRequest())}}))),A()})),Object.values(ae.snapController.state.snaps).some((e=>!e.preinstalled))&&ae.snapController.updateBlockedSnaps()}async function Ce(){const e=await X.getActiveTabs(),t=Boolean(e.find((e=>ne[e.id]))),r=e.length>0&&e[0].extData&&e[0].extData.indexOf("vivaldi_tab")>-1;if(!re&&(r||0===ee)&&!t){re=!0;try{const e=ae.appStateController.getCurrentPopupId();await Z.showPopup((e=>ae.appStateController.setCurrentPopupId(e)),e)}finally{re=!1}}}const Pe=()=>{if(ae)return ae.metaMetricsController.updateTraits({[h.MetaMetricsUserTrait.InstallDateExt]:(new Date).toISOString().split("T")[0]}),void ae.metaMetricsController.addEventBeforeMetricsOptIn({category:h.MetaMetricsEventCategory.App,event:h.MetaMetricsEventName.AppInstalled,properties:{}});setTimeout((()=>{Pe()}),500)};async function Oe(){Boolean(await W.get())||(Pe(),X.openExtensionInBrowser()),s.default.tabs.onActivated.addListener((e=>{if(ae){const{tabId:t}=e,r=se[t];r&&ae.permissionController.state.subjects[r]!==undefined&&Te(r)}}))}(async function(){await Oe();try{await ye(),W.cleanUpMostRecentRetrievedState()}catch(e){i.default.error(e)}})()}}},{package:"$root$",file:"app/scripts/background.js"}]],[4],{});