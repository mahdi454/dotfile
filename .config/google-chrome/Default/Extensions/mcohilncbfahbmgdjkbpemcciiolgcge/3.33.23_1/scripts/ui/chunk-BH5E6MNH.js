import{a as at}from"./chunk-OPDQBBGJ.js";import{a as st}from"./chunk-D7BWSP4O.js";import{a as et,b as ot,c as nt}from"./chunk-3BOIX6DD.js";import{a as Je}from"./chunk-4IDSMRQU.js";import{a as rt}from"./chunk-65VFWMII.js";import{a as Qe,e as $e}from"./chunk-ID2G3YUZ.js";import{a as tt}from"./chunk-SYQTAGUC.js";import{a as je}from"./chunk-KTRYKYE5.js";import{a as re}from"./chunk-V2A2AEVZ.js";import{a as it}from"./chunk-45NOBBNS.js";import{e as Ze}from"./chunk-TSGQQ5QA.js";import{a as Xe}from"./chunk-KU3DITYD.js";import{e as ve,g as Ke,h as He}from"./chunk-7CWLH6ZR.js";import{i as H,j as ge,k as X,l as We,m as Ye,n as qe,q as Z}from"./chunk-UTVBVZWC.js";import{d as G}from"./chunk-GQYTOJVD.js";import{b as ae}from"./chunk-DQQKPXHV.js";import{i as Le}from"./chunk-75OW6LUI.js";import{T as Te,V as Oe,_ as Be,aa as ye,t as Ce,u as ke,v as ne}from"./chunk-UXRYSOKP.js";import{h as Ue,i as Ve}from"./chunk-A3B5II6P.js";import{b as Ge,p as ze}from"./chunk-FPV6XIHQ.js";import{a as De}from"./chunk-G4OIO3Z6.js";import{i as be}from"./chunk-QHZHYX4V.js";import{e as Me}from"./chunk-YJ2NGJXA.js";import{w as te}from"./chunk-3TDWET6C.js";import{D as L,_ as V}from"./chunk-EBR3PGFZ.js";import{Na as oe,Ra as Ee}from"./chunk-W6Q44ZHW.js";import{d as Pe,f as Gt}from"./chunk-3HS6AHPS.js";import{$ as ee,A as K,Eb as we,Gb as Y,Kb as pe,Lb as fe,Nb as Fe,U as Ae,Vc as Re,Wc as zt,Ya as _e,dc as de}from"./chunk-O3CM75EN.js";import{b as xe}from"./chunk-J3CEQI22.js";import{K as $,a as he,f as Ie,pa as me}from"./chunk-VFHYER2K.js";import{L as le,l as Ne,w as U}from"./chunk-KJIO572I.js";import{a as b}from"./chunk-EAZTJZU7.js";import{b as Ut}from"./chunk-DIN2GK7B.js";import{f as w,m as c,o as u}from"./chunk-ZCHLW7CF.js";c();u();var Se=w(b());c();u();var mt=w(b());c();u();var ct=w(te());c();u();Gt();function se(t){return async()=>await Pe().handleTxBySigner(t)}_e();function Vt({walletId:t,method:r,message:n,onConfirm:o}){let e=(0,ct.useDispatch)();return async()=>{let i=await e(se({walletId:t,localType:ee,method:r,params:{message:n}})),{publicKey:m,signature:s}=i||{},l=Ye(We(m),s);return o(l)}}var ut=Vt;var lt=t=>{let{walletId:r,method:n,params:o,source:e,onConfirm:a,onCancel:i}=t,m=typeof o?.message=="string"?o?.message:new TextDecoder().decode(o?.message),s=at({unapproved:t}),l=ut({walletId:r,method:n,message:m,onConfirm:a}),g,f,d;return e!=="dapp"&&(g=l,f=!0,d=i),mt.default.createElement(rt,{message:m,unapproved:t,tipMessage:s,onConfirm:g,onConfirmReplace:f,onCancel:d})};c();u();var Lt=w(b());c();u();var W=w(b());me();le();Ae();c();u();var yt=w(b());me();c();u();var E=w(b());de();c();u();var pt=w(Ut());zt();de();async function ft(t){let{SolWallet:r}=await Le(),n=new r,o=[];try{let e=(t||[]).filter(Boolean);e.length>0&&(o=await n.deserializeMessages({data:e}))}catch{}return(o||[]).reduce(({totalPriorityFee:e,priorityFees:a},i,m)=>{let{deserialized:s,computeUnitLimit:l,computeUnitPrice:g}=i||{};if(s){let f=qe(l,g);e=Y(e,f),a[m]=f}else a[m]="0";return{totalPriorityFee:e,priorityFees:a}},{totalPriorityFee:"0",priorityFees:[]})}var Wt="SetComputeUnitLimit",Yt="SetComputeUnitPrice";function dt(t,r,n){if(pe(r||0,0)||pe(n||0,0)||t.some(m=>{try{let s=Be.decodeInstructionType(m);return s===Wt||s===Yt}catch{return!1}}))return t;let e=[...t],a=ye.setComputeUnitPrice({microLamports:r});e.unshift(a);let i=ye.setComputeUnitLimit({units:n});return e.unshift(i),e}async function qt(t,r,n){let o=new Oe(Re.requestSolanaMethodUrlToFullnode);o._rpcRequest=ze;let e=await Promise.all((t.message?.addressTableLookups||[]).map(s=>o.getAccountInfo(s.accountKey).then(l=>new Te({key:s.accountKey,state:Te.deserialize(l.data)})))),a=ke.decompile(t.message,{addressLookupTableAccounts:e});a.instructions=dt(a.instructions,r,n);let i=new ne(a.compileToV0Message(e)),m=X(i);return H(i,m)}async function Ct(t,r,n){return new Promise(o=>{try{let e=pt.base.fromBase58(t);try{e=Ce.from(e)}catch{e=ne.deserialize(e)}if(e.signatures&&e.signatures.length>1){o(t);return}if(e instanceof Ce){e.instructions=dt(e.instructions,r,n);let a=X(e);o(H(e,a))}else e instanceof ne?qt(e,r,n).then(o).catch(()=>{o(t)}):o(t)}catch{o(t)}})}function vt({coinId:t,transactions:r,address:n,replace:o,disabled:e,unitLimits:a,signInfo:i}){let[m,s]=(0,E.useState)(0),[l,g]=(0,E.useState)(null),[f,d]=(0,E.useState)([]),[T,p]=(0,E.useState)("0"),[S,h]=(0,E.useState)([]),[O,y]=(0,E.useState)(!1),I=l?.fee||"0",[F,A]=(0,E.useState)(r),B=it(),k=G(t),{disabledSignInfo:M=!1,disabledPreExecute:N=!1}=e||{},_=x=>{s(x?C=>C+1:C=>C-1)};return(0,E.useEffect)(()=>{a&&d(a)},[a]),(0,E.useEffect)(()=>{i&&g(i)},[i]),(0,E.useEffect)(()=>{(async function(){if(!(M||!t)){_(!0);try{let{data:C={}}=await Ge({coinId:t,address:n}),{info:P={}}=C;g(P),y(!1)}catch{y(!0)}finally{_(!1)}}})()},[n,t,M]),(0,E.useEffect)(()=>{(async function(){if(!(N||!t)&&!(!o||!k?.chainId)){_(!0);try{let C=await B({coinId:t,from:n,chainId:k.chainId,simulateTransactionParamList:r.map(({serializedMessage:P})=>({transaction:P,sigVerify:!1,replaceRecentBlockhash:!0}))});d(C.unitLimits),y(!1)}catch{y(!0)}finally{_(!1)}}})()},[...r,o,n,k?.chainId,N,t]),(0,E.useEffect)(()=>{(async function(){if(!(o&&(!l||!f?.length))){_(!0);try{let C=r;o&&(C=await Promise.all(C.map(async(z,J)=>{let{serializedMessage:ie,...Q}=z,ce=await Ct(ie,l.computeUnitPrice,f[J]);return{...Q,serializedMessage:ce}})));let{totalPriorityFee:P,priorityFees:q}=await ft(C.map(({serializedMessage:z})=>z));p(P),A(C),h(q)}finally{_(!1)}}})()},[...r,o,l,f]),{loading:m>0,baseFee:I,totalPriorityFee:T,priorityFees:S,totalFee:Y(we(I,r.length),T),signInfo:l,estimateFailed:O,replacedTransactions:F}}var Tt=vt;de();var Kt=({fromAddress:t,coinId:r,preExecuteResult:n,walletId:o,transactions:e,addPriorityFee:a})=>{let{loading:i,preExecuteRet:m}=n,s=m?.[V.TX_ANALYZE]||{},l=(s.simulateTransactionResultList||[]).find(N=>$(N?.unitGasLimit)||Fe(N?.unitGasLimit,"0")),g=(0,yt.useMemo)(()=>(s.simulateTransactionResultList||[]).map(N=>N?.unitGasLimit),[s.simulateTransactionResultList]),{loading:f,totalFee:d,baseFee:T,priorityFees:p,estimateFailed:S,signInfo:h,replacedTransactions:O}=Tt({coinId:r,transactions:e||[],address:t,replace:a,unitLimits:g,disabled:{disabledPreExecute:!0}}),y=h?.solRent||"0",I=S||!i&&!!l,F=je(r,o)||{},{coinAmountInt:A}=F,B=$(A)||fe(A,d)||i,k=$(A)||fe(A,Y(d,y))||i;return{loading:f,networkFeeProps:{loading:f,networkFee:d,estimateFailed:I,coinId:r},isSufficientGas:B,baseFee:T,priorityFees:p,networkFee:d,estimateFailed:I,estimateFailedMsg:l?.msg,isSufficientBalance:k,selfRent:y,replacedTransactions:O,coinWithBalance:F}},gt=Kt;c();u();var j=w(b());le();function Ht({txId:t,fromAddress:r,coinId:n,walletId:o,feeLoading:e,estimateFailed:a,preExecuteRet:i,chainConfirmDisabled:m=!1,isSufficientGas:s,isSufficientBalance:l,priorityFees:g,baseFee:f,networkFee:d,replacedTransactions:T,onConfirm:p,onCancel:S,transactions:h,coinWithBalance:O={}}){let y=Ze({walletId:o}),{isBalanceLoadError:I,isBalanceLoading:F,requestBalance:A}=O,{loading:B=!1,verifyGasLimitRet:k={}}=i,M=!s||!l||Ke(k),N=e||a||B||He(k)||m,_={onClick:S,actionType:Z.ACTION_TYPE.CANCEL,btnText:U("wallet_dapp_connection_btn_reject")},x=(0,j.useMemo)(()=>({disabled:N,loading:F,onClick:async()=>{p({serviceCharge:d,replacedTransactions:T,serializedTransactions:h})},actionType:Z.ACTION_TYPE.CONFIRM}),[N,p,T,f,g,n,r,d,y,F]),C=(0,j.useMemo)(()=>({actionType:Z.ACTION_TYPE.FILL_UP,txId:t,coinId:n,walletId:o,address:r}),[r,n,t,s,o]),P=(0,j.useMemo)(()=>({onClick:A,btnText:U("wallet_extension_transfer_error_text_reload"),actionType:Z.ACTION_TYPE.CONFIRM}),[A]),q=(0,j.useMemo)(()=>N?x:I&&!F?P:M?C:x,[N,x,C,M,I,P,F]);return{buttonGroup:[_,q],handleCancel:S}}var St=Ht;c();u();var D=w(b());me();le();function Xt({coinId:t,fromAddress:r,domain:n,transactions:o=[]}){let e=G(t)||{},a=Xe(),[i,m]=(0,D.useState)(!1),[s,l]=(0,D.useState)({}),g=(0,D.useCallback)(async T=>{try{m(!0);let p=await a({checkTypes:[V.TX_ANALYZE,V.KYS],from:r,chainId:T.chainId,domain:n,coinId:T.coinId,bizLine:6,simulateTransactionParamList:o.map(S=>({transaction:S.serializedMessage,sigVerify:!1,replaceRecentBlockhash:!0}))});l(p)}catch(p){console.log(p)}finally{m(!1)}},[r,n,o.length,a]),f=(0,D.useMemo)(()=>{let T=s?.[V.TX_ANALYZE]||{},p=T.simulateTransactionResultList,S=p?.length;if(he(p)&&S>0){if(S===1)return p[0];let h={};if(p.every(y=>!y.result)){h.result=!1,h.msg=U("wallet_extension_transaction_text_thirdparty_contract_failed");let y=p.some(I=>I.addFundsFlag);h.addFundsFlag=y,h.resultCode=y?ve:""}else h.result=!0,h.msg="",h.addFundsFlag=!1,h.resultCode="";return h}return T},[s]),d=(0,D.useMemo)(()=>({loading:i,...s?.[V.KYS]||{}}),[i,s]);return(0,D.useEffect)(()=>{e.coinId&&g(e)},[g,e.coinId]),{loading:i,kysRet:d,verifyGasLimitRet:f,preExecuteRet:s}}var ht=Xt;function Zt({txId:t,coinId:r,walletId:n,transactions:o=[],dappInfo:e={},showDappInfo:a=!0,addPriorityFee:i=!0,showSwitchNetwork:m=!0,onConfirm:s,onCancel:l,onAddressCopy:g=Ie,onNetworkChange:f,slot:d={}}){let T=ae(K),p=r||T?.coinId,S=G(p)||{},h=S.localType,O=be(n),y=De(h,n),I=(0,W.useMemo)(()=>o.map(v=>{try{if(v.serializedMessage)return v;let ue=X(v);return{instanceType:ue,serializedMessage:H(v,ue),needToReplaceRecentBlockhash:!v.recentBlockhash}}catch{return null}}).filter(Boolean),[o.length]),F=ht({coinId:p,fromAddress:y,domain:e?.host,transactions:I}),{verifyGasLimitRet:A,kysRet:B}=F,{baseFee:k,priorityFees:M,networkFee:N,isSufficientGas:_,networkFeeProps:x,estimateFailed:C,estimateFailedMsg:P,loading:q,isSufficientBalance:z,selfRent:J,replacedTransactions:ie,coinWithBalance:Q}=gt({fromAddress:y,coinId:p,preExecuteResult:F,walletId:n,transactions:I,addPriorityFee:i}),ce=(0,W.useCallback)(()=>!z&&_?{type:xe.TYPE.warn,message:U("walletextension_toast_text_reserve_rent_exempt",{number:Ne.div(J,10**S?.decimals)})}:null,[_,z,J,S?.decimals]),Ot=Qe({initialType:O.initialType}),Bt=$e({verifyGasLimitRet:A}),Mt=et({baseCoin:S,estimateFailed:C,isSufficientGas:_,verifyGasLimitRet:A,estimateFailedMsg:P,kysRet:B,coinWithBalance:Q},{pre:[Ot,Bt],post:[ce]}),{handleCancel:bt,buttonGroup:Dt}=St({txId:t,fromAddress:y,coinId:p,transactions:I,walletId:n,feeLoading:q,estimateFailed:C,preExecuteRet:F,chainConfirmDisabled:Me(O.initialType),isSufficientGas:_,isSufficientBalance:z,baseFee:k,priorityFees:M,networkFee:N,replacedTransactions:ie,onConfirm:s,onCancel:l,coinWithBalance:Q});return Je({kysRet:B,handleCancel:bt,coinId:p}),W.default.createElement(ot,{slot:{...d,top:d.top||m&&W.default.createElement(st,{providerType:K,chainName:S?.chainName,onNetworkChange:f})},kysRet:B,dappInfo:e,showDappInfo:a,walletId:n,fromAddress:y,tipMessage:Mt,buttonGroup:Dt,networkFee:x,onAddressCopy:g})}var It=Zt;c();u();var Nt=w(b()),At=w(te());Ee();function jt({walletId:t,localType:r,id:n,origin:o}){let e=(0,At.useDispatch)(),a=re(t);return(0,Nt.useCallback)(async()=>{a({trade:"contract_interaction",all_confirmation:"cancel",network:r,dapp_url:o}),await e(Ue(n)),await oe(e)},[a,n,r,o])}var _t=jt;c();u();var wt=w(b()),Ft=w(te());Ee();function Jt({coinId:t,id:r,walletId:n,localType:o,origin:e}){let a=(0,Ft.useDispatch)(),i=re(n);return(0,wt.useCallback)(async({replacedTransactions:m,serviceCharge:s})=>{let l={coinId:t,replacedTransactions:m,serviceCharge:s};i({page_type:"contract_interaction",all_confirmation:"confirm",network:o,dapp_url:e}),await a(Ve(r,l)),await oe(a)},[i,o,e])}var xt=Jt;c();u();Ae();function Qt(t){let n=ae(K)?.coinId,{coinId:o,showSwitchNetwork:e=!0}=t?.params?.extParams||{};return{coinId:o||n,showSwitchNetwork:e}}var Pt=Qt;c();u();var Rt=w(te());_e();function $t({coinId:t,walletId:r,method:n,okxArgs:o,onConfirm:e}){let a=(0,Rt.useDispatch)();return async({replacedTransactions:i,serviceCharge:m,serializedTransactions:s})=>{let f=await a(se({walletId:r,localType:ee,method:n,params:{message:s,okxArgs:o},extraParams:{coinId:t,replacedTransactions:i,serviceCharge:m}})),d;if(n===L.SIGN_ALL_TRANSACTIONS)d=(f.signedTransactionResults||[]).map(({serializedTransaction:T,type:p})=>ge(T,p));else if(n===L.SIGN_TRANSACTION){let{instanceType:T}=s[0]||{};d=ge(f.serializedTransaction,T)}else n===L.SIGN_AND_SEND_TRANSACTION&&(d=f);return e(d)}}var Et=$t;var kt=t=>{let{id:r,coinId:n,method:o,params:e,walletId:a,origin:i,source:m,dappInfo:s,showDappInfo:l=!0,addPriorityFee:g=!0,showSwitchNetwork:f,onConfirm:d,onCancel:T,onAddressCopy:p,okxArgs:S}=t,{coinId:h,showSwitchNetwork:O}=Pt(t),y=tt(t),I=n||h,A=(G(I)||{}).localType,B=e?.message||[],k=xt({coinId:I,id:r,walletId:a,localType:A,origin:i}),M=_t({walletId:a,localType:A,id:r,origin:i}),N=nt({walletId:a}),_=Et({coinId:I,walletId:a,method:o,okxArgs:S,onConfirm:d}),x,C,P;return m==="dapp"?(x=k,C=M,P=N):(x=_,C=T,P=p),Lt.default.createElement(It,{coinId:I,showSwitchNetwork:typeof f=="boolean"?f:O,txId:r,walletId:a,transactions:B,dappInfo:s||y,showDappInfo:l,addPriorityFee:g,onConfirm:x,onCancel:C,onAddressCopy:P})};function eo(t){switch(t.method){case L.SIGN_TRANSACTION:case L.RPC_SIGN_TRANSACTION:case L.SIGN_AND_SEND_TRANSACTION:case L.RPC_SIGN_AND_SEND_TRANSACTION:case L.SIGN_ALL_TRANSACTIONS:case L.RPC_SIGN_ALL_TRANSACTIONS:return Se.default.createElement(kt,{...t});case L.SIGN_MESSAGE:case L.RPC_SIGN_MESSAGE:return Se.default.createElement(lt,{...t});default:return""}}var lr=eo;export{ft as a,lr as b};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-BH5E6MNH.js.map
