import{a as Ws}from"./chunk-V3VOM45E.js";import{a as xu,b as Mu}from"./chunk-FJKD7QEB.js";import{a as hu,b as fu}from"./chunk-U3EUXHVS.js";import{a as Pu,b as Ou}from"./chunk-BH5E6MNH.js";import"./chunk-OPDQBBGJ.js";import"./chunk-WK3H2LOM.js";import"./chunk-D7BWSP4O.js";import"./chunk-RPZZJKZJ.js";import{a as wu,b as vu}from"./chunk-LL3AYUCA.js";import"./chunk-ZCIPA4CD.js";import{a as Lu}from"./chunk-V2C2H4YP.js";import"./chunk-F4T6Q6QK.js";import"./chunk-ZRAG5WLF.js";import"./chunk-3BOIX6DD.js";import"./chunk-4IDSMRQU.js";import"./chunk-65VFWMII.js";import"./chunk-ID2G3YUZ.js";import"./chunk-7KXE5PFN.js";import"./chunk-F7YYSTTZ.js";import"./chunk-SYQTAGUC.js";import"./chunk-X6LGMUFV.js";import"./chunk-6M2GCKDH.js";import"./chunk-FDJ2AAAT.js";import{a as Fu}from"./chunk-3B32HYLW.js";import{k as Nu}from"./chunk-NHNDGUWA.js";import{a as Du}from"./chunk-AQPMJGF5.js";import{a as Eu,d as ku,e as Ru}from"./chunk-JWQGMLG5.js";import"./chunk-SUU55JAC.js";import"./chunk-4RVQOPYQ.js";import"./chunk-CCXOIJJY.js";import"./chunk-EU22H7NN.js";import"./chunk-KTRYKYE5.js";import"./chunk-V2A2AEVZ.js";import"./chunk-5NP5YBP7.js";import{b as bu}from"./chunk-ELKHXPPU.js";import"./chunk-45NOBBNS.js";import{a as nu,b as Vs,c as au,d as cu}from"./chunk-AFGI3MHV.js";import"./chunk-Z2M3JODD.js";import"./chunk-XVRO6N6T.js";import"./chunk-UTGDPJGB.js";import{i as lu,m as du,r as mu,t as pu}from"./chunk-D6NWGDM6.js";import"./chunk-NV3OX353.js";import"./chunk-3QYKNWJE.js";import"./chunk-NJJL64HF.js";import{a as iu}from"./chunk-CK5YETQI.js";import"./chunk-ZVUQCOMJ.js";import{c as ru,e as su}from"./chunk-TSGQQ5QA.js";import"./chunk-KU3DITYD.js";import"./chunk-7CWLH6ZR.js";import"./chunk-3YTH2U6Q.js";import"./chunk-Q5HW75TA.js";import{a as Hd}from"./chunk-MNMAC6TE.js";import"./chunk-TN557PDS.js";import"./chunk-SYF5MRVO.js";import{a as kc,b as Rc,c as Zt,f as qc,i as Io,j as Co,n as Ir,o as Cr,p as Ar,s as yr,t as ee}from"./chunk-CHFODOGS.js";import{a as Vc,b as _r,c as Wc,d as Gc,e as Qc,f as Er,g as Hc,h as jc}from"./chunk-LX6FOAVF.js";import{a as _u}from"./chunk-HLY4UFFA.js";import"./chunk-3LOYTCAL.js";import"./chunk-7FUA4GUN.js";import"./chunk-7JI4TIRJ.js";import"./chunk-RFD2FBBX.js";import{a as Cu}from"./chunk-UUX3UNZW.js";import{e as Jc}from"./chunk-QCTV4R7X.js";import{a as gu,b as Tu,d as Iu,e as Au,g as yu}from"./chunk-SIIB3XCZ.js";import"./chunk-GUGRL7WK.js";import"./chunk-6ZHQ2QLX.js";import"./chunk-S4NIXE4H.js";import{a as Zc,i as tu,k as eu,p as ou}from"./chunk-UTVBVZWC.js";import"./chunk-GL4YYTXQ.js";import{a as zc}from"./chunk-4MDR2IS2.js";import"./chunk-GZN3TPOZ.js";import"./chunk-ZN3567SM.js";import"./chunk-SJCGLHGC.js";import{d as $c,f as Xc}from"./chunk-GQYTOJVD.js";import"./chunk-7HZMPY3W.js";import"./chunk-QTEBOXIQ.js";import{a as Su}from"./chunk-AB2B4P3R.js";import"./chunk-DQQKPXHV.js";import"./chunk-K4WB5MMU.js";import"./chunk-FWZNHZQB.js";import"./chunk-FXQ35K27.js";import{a as uu}from"./chunk-FSQDFL3V.js";import"./chunk-YLJ56YQC.js";import"./chunk-YVC4CAU2.js";import"./chunk-K4MSA5MN.js";import"./chunk-4HBLPFAF.js";import"./chunk-TJW4EUGS.js";import"./chunk-SJRV5U24.js";import{H as Tr,a as N,b as _,d as Ms,e as te,f as wc,k as ge,l as vc,m as ct,o as Pc,p as Oc,q as Nc,s as Fc,t as Bs,u as gr,w as Us,y as xc}from"./chunk-Y6XBJCJU.js";import{A as Bc,B as Uc,a as pr,b as ft,c as St,d as ic,g as mc,i as pc,j as hc,k as bt,l as Jt,m as y,o as Ec,p as Xe,q as bc,r as Lc,v as W,x as ze,z as Mc}from"./chunk-E25EKGR7.js";import{a as Dc}from"./chunk-6WVNBGIY.js";import{D as Tc,E as Ic,F as $e,J as Sr,L as Cc,M as Ac,N as yc,O as _c,a as fc,g as hr,h as Sc,k as Ye,l as fr,m as gc,q as xs}from"./chunk-V3H7KJBT.js";import{A as Qd,a as sc,b as h,d as Vt,e as Ke,g as nc,h as Ft,k as ac,l as cc,n as j,o as uc,q as Fs,u as lc,y as dc}from"./chunk-23HVNSWR.js";import{a as Hn,b as jt,c as uo,d as jn,e as pt,f as _t,g as Kt,h as Kn,i as B,j as Et,k as U,l as Ot,m as M,n as Yn,o as rt}from"./chunk-HB7QCGGE.js";import{$ as Z,$a as $t,$b as Va,A as sr,Ab as Ta,B as ea,Bb as Ia,Cb as Ca,D as x,Db as Aa,Dc as T,E as qe,Ea as cr,Eb as lr,Ec as Ds,F as Ve,Fa as vs,Fb as ya,Fc as zt,G as oa,Ga as Ps,Gb as _a,Gc as at,H as We,Ha as ua,Hb as Ea,I as pe,Ia as It,Ib as ka,Ic as tt,J as Es,Ja as nt,Jb as Ra,Jc as Se,K as fo,Kb as ba,L as ra,Lb as La,M as he,Mb as wa,Ob as va,P as J,Pb as Pa,Q as Nt,Qb as Oa,R as qt,S as Yt,Sa as To,Sb as Na,T as Ge,Ta as V,Tb as Da,U as ir,Ua as A,Ub as Fa,V as kt,Vb as dr,W as nr,Wa as la,Wb as xa,X as sa,Xb as Ma,Yb as Ba,Za as Ct,Zb as Ua,_ as ks,_a as ht,_b as qa,a as Zo,aa as Rt,ab as Os,ac as Wa,b as tr,ba as ia,bb as da,bc as Ga,c as lo,cb as ma,cc as mr,d as mo,da as Rs,dc as Qa,e as er,ea as na,ec as Ha,f as po,fa as ar,fc as ja,g as _s,ga as So,gb as ur,gc as Ka,h as or,hb as E,hc as Ya,i as Ue,ic as $a,j as $n,jb as Xt,k as ho,kc as Xa,l as Xn,lc as za,o as lt,oa as ot,oc as Ja,p as st,pa as Lt,pc as Za,q as it,qa as Qe,qc as tc,rc as ec,s as zn,sa as bs,t as Jn,u as H,ub as Ns,uc as oc,v as rr,va as Ls,vb as pa,w as Zn,wa as ws,wb as ha,x as ta,xa as aa,xb as fa,xc as rc,ya as ca,yb as Sa,zb as ga}from"./chunk-PUMQ7BEU.js";import{a as fe,b as go,c as Dt,d as He,e as je,f as b}from"./chunk-4OKCKO5L.js";import"./chunk-WFAZ5WB6.js";import"./chunk-SKK4O3IC.js";import"./chunk-L4BR2EHM.js";import{c as Nn}from"./chunk-AQH6QKNE.js";import"./chunk-6IVHTBSR.js";import{a as Is,h as Pn}from"./chunk-75OW6LUI.js";import{a as Wd}from"./chunk-W4IULSMQ.js";import{W as Fn,t as Cs,v as Dn}from"./chunk-UXRYSOKP.js";import"./chunk-ABSI53HE.js";import"./chunk-JJIQEHOY.js";import{a as Vd}from"./chunk-HJM7ZNQ6.js";import"./chunk-ZOXV6Z7M.js";import"./chunk-L44D6USJ.js";import{a as tn,b as en,g as mn}from"./chunk-BY6OW6FD.js";import"./chunk-AE7B6XHD.js";import"./chunk-HC6T2TFK.js";import"./chunk-FAJ2Q5PZ.js";import"./chunk-5U7ZXBMP.js";import"./chunk-C77TCOTM.js";import{a as Mn,b as Bn}from"./chunk-EBBN5EW3.js";import"./chunk-KA5VAELR.js";import"./chunk-JOXGYPV7.js";import{a as As}from"./chunk-RUFGCIXT.js";import"./chunk-4BUFJ3ZT.js";import"./chunk-2IQIJXLO.js";import"./chunk-T37NLQBV.js";import"./chunk-U5WRMXFD.js";import"./chunk-JMTMYFWR.js";import"./chunk-RE5SSELD.js";import"./chunk-A3B5II6P.js";import"./chunk-XVPROSYE.js";import{j as Qn}from"./chunk-E2MXYP3A.js";import{b as qs,c as kr,d as Rr,h as Kc,l as Yc}from"./chunk-FPV6XIHQ.js";import"./chunk-MZXFJMVC.js";import"./chunk-46PSZUMN.js";import"./chunk-MYY7DCIN.js";import"./chunk-AHIMORZ4.js";import"./chunk-M2ZE7N7H.js";import"./chunk-XZ6AHFH2.js";import"./chunk-3DEZPDXQ.js";import"./chunk-6UFIPREK.js";import{a as Vn}from"./chunk-G4OIO3Z6.js";import"./chunk-JEIYTQ5E.js";import"./chunk-TOO5SEJU.js";import"./chunk-DUWPYFAS.js";import"./chunk-CA4PB6NG.js";import"./chunk-SCXRHDUG.js";import"./chunk-5STCPPZU.js";import"./chunk-ZVXDJZSD.js";import{a as Wn}from"./chunk-56SDY6L3.js";import{a as ys}from"./chunk-PXWV5LKL.js";import"./chunk-M5PVKGM6.js";import"./chunk-AK34CZMZ.js";import{i as qn}from"./chunk-QHZHYX4V.js";import"./chunk-FLFVNMKM.js";import{a as xn}from"./chunk-YJ2NGJXA.js";import"./chunk-DQ2UEFEE.js";import{a as Gn}from"./chunk-ZUBNNPBM.js";import"./chunk-2SHHGXPQ.js";import{a as Gd}from"./chunk-UK4SAM7E.js";import{a as Un}from"./chunk-LXIBKSOK.js";import"./chunk-C53RLQYB.js";import"./chunk-72NGWMH2.js";import"./chunk-VRXSSD45.js";import{a as Ln}from"./chunk-DUKP4BLI.js";import"./chunk-S3O4LR55.js";import"./chunk-FZCNSMLW.js";import{e as pn}from"./chunk-WANYNTD6.js";import"./chunk-QMGTBJAL.js";import{o as Ts}from"./chunk-KCWFMCND.js";import{Ia as bn,Z as An,ga as yn,ia as _n,la as En,na as kn,p as cn,ra as Rn,sa as zo,w as un}from"./chunk-3TDWET6C.js";import{L as gs,V as In,fa as Cn,p as gn,v as Ss,x as Tn}from"./chunk-EBR3PGFZ.js";import"./chunk-UDGUBKMO.js";import{a as Ht}from"./chunk-VPGNJAK6.js";import"./chunk-W6Q44ZHW.js";import{d as Tt,f as fs}from"./chunk-3HS6AHPS.js";import"./chunk-VGEPKX55.js";import{a as On,b as Jo}from"./chunk-JUXPONKW.js";import"./chunk-WSUAESF2.js";import"./chunk-O2FUKKO3.js";import"./chunk-GQJVAWGG.js";import"./chunk-WO5B666G.js";import{a as wn,u as vn}from"./chunk-GCXT25LW.js";import"./chunk-TW63K7CB.js";import{c as hn}from"./chunk-FDCWN4NG.js";import"./chunk-5YGMD6KK.js";import{$ as Me,Aa as Ko,Ba as $i,Cb as Zi,Db as xd,Eb as co,Fb as on,Gb as Yo,Ia as Xi,Ka as ps,Mc as Xo,Oc as fn,Tb as rn,Uc as Ud,V as ms,Vc as Sn,Wc as qd,X as Qi,Ya as ue,aa as Pt,bc as sn,d as Ri,da as Hi,dc as nn,e as Dd,ec as an,fc as Md,gc as hs,ia as ji,ja as Ki,la as jo,mc as Bd,nb as ao,o as ds,qa as Be,u as Wi,wb as zi,xc as me,y as Gi,ya as Yi,yb as Ji,yc as $o}from"./chunk-O3CM75EN.js";import"./chunk-ZGRAPBBU.js";import{G as de,H as D,j as dn}from"./chunk-J3CEQI22.js";import{A as vi,B as Ho,D as Pi,F as X,I as Oi,J as ae,K as no,N as Ni,S as Di,T as Fi,V as xi,Y as ce,aa as Mi,c as et,f as Wo,ga as Bt,h as yt,ha as as,i as Gt,ia as Bi,j as I,ka as Qt,la as cs,ma as us,o as bi,oa as Ui,p as Li,pa as O,r as xe,u as wi,v as io,x as Go,y as Qo}from"./chunk-VFHYER2K.js";import{A as Vi,D as R,L as F,a as qi,v,w as Ut,z as ls}from"./chunk-KJIO572I.js";import{b as Fd}from"./chunk-HJXNXGYU.js";import"./chunk-77ECUYXV.js";import"./chunk-4BZBCAHV.js";import{ca as le,e as ln}from"./chunk-KALFZBR5.js";import"./chunk-V55FEIYE.js";import{a as q}from"./chunk-EAZTJZU7.js";import"./chunk-RHCEX646.js";import"./chunk-6A5OK46Z.js";import"./chunk-YTRW5WTJ.js";import"./chunk-DIN2GK7B.js";import"./chunk-3AN5FAZD.js";import"./chunk-CJ3MW6GG.js";import"./chunk-AKCHCVUS.js";import"./chunk-VOT7VHG3.js";import"./chunk-SYQUJKIR.js";import"./chunk-UYGNKZ5P.js";import"./chunk-KZFZROAL.js";import"./chunk-WPMHLM7C.js";import"./chunk-3MRE2BAK.js";import"./chunk-CSLLQXN7.js";import"./chunk-P7DU4NJA.js";import"./chunk-3COZNTED.js";import"./chunk-AGPXVFMO.js";import"./chunk-FGSHVA46.js";import"./chunk-FMFDUPSA.js";import"./chunk-GAJPJAPC.js";import"./chunk-KW7JYBDS.js";import"./chunk-224G4QSH.js";import{f as L,h as s,l as process,m as u,o as l}from"./chunk-ZCHLW7CF.js";u();l();var ss=L(q()),Mt=L(un()),is=L(Ht()),Nd=L(Ts());O();F();u();l();var rs=L(q()),dd=L(Ht());u();l();var Uu=L(q());u();l();var br=L(q());var Bu=({children:a,rootStore:t})=>{let e=Yn(t),o=(0,br.useMemo)(()=>(t.commonStore.rootStore=t,t.accountStore.rootStore=t,t),[t]);return br.default.createElement(e.Provider,{value:o},a)};var qu=Ot(({swapRootStore:a,bridgeRootStore:t,children:e,initTab:o})=>{let{commonStore:{currentTab:r}}=a.getInstance(),i=o||r,n=a.getInstance();return i===E.BRIDGE&&(n=t.getInstance()),Uu.default.createElement(Bu,{rootStore:n},e)});u();l();var Vu=L(q());F();function Gs({children:a,...t}){return Vu.default.createElement(Vi,{fetchConfig:sc.fetchConfig,...t},a)}u();l();u();l();u();l();u();l();var Nr=L(q());u();l();var wr=L(q());u();l();var Lr=L(Gd());async function jd(a,t){let{devid:e}=await a.get("devid");return(o,r)=>{Lr.setDeviceId(e);let i=Lr.newInstance({site:"okex",product:o});return i.setApiEndpoint(`${t}/amplitude`),i.setCommonParams(hc()),r(i),i}}async function Qs(a,t){(await jd(a,t))("web3_trade",fc)}var Kd=()=>{let[a,t]=(0,wr.useState)(!1);return(0,wr.useEffect)(()=>{let{getApiHostname:e}=b.global;Qs(b.localStore,e()).then(()=>t(!0)).catch(()=>{})},[]),{initialized:a}},Wu=Kd;u();l();u();l();var Ao=L(q());var Gu=a=>{let{params:t,replace:e}=Xe(),{autoSwitch:o}=t,[r,i]=(0,Ao.useState)(""),[n,c]=(0,Ao.useState)(!0);return(0,Ao.useEffect)(()=>{a&&(async()=>{if(a===E.SWAP&&o===Rc.BRIDGE){let m=await Zt.judgeTabTypeByParams(t?.from,t?.to);m===E.BRIDGE&&e({pathname:St,params:{...t,autoSwitch:void 0}}),i(m),c(!1)}else i(a),c(!1)})().catch(()=>{})},[a]),{tabType:r,autoSwitching:n}};u();l();var vr=L(q()),Qu=L(Ht());var Hu=()=>{let{pathname:a}=(0,Qu.useLocation)(),[t,e]=(0,vr.useState)("");return(0,vr.useEffect)(()=>{switch(a){case pr:case ft:e(E.SWAP);break;case St:e(E.BRIDGE);break;default:break}},[a]),t};u();l();var Hs=L(q());var ju=(a,t)=>{let{accountStore:e}=rt(),{params:o}=Xe(),{btcAddressType:r}=o;(0,Hs.useEffect)(()=>{e.setBtcAddressType(r)},[]);let i=bc();(0,Hs.useEffect)(()=>{async function n(){let c=new Zt(a,o),{from:d,to:m,tab:p,inputAmount:f,error:g}=await c.initTokenPair(t);g||i(d,m,f,p)}a&&n().catch(()=>{})},[a])};u();l();var Ku=L(q()),Yu=L(Ht());var $u=a=>{let{fromToStore:t}=rt(),{from:e,to:o}=t,{params:r,replace:i}=Xe(),{pathname:n}=(0,Yu.useLocation)(),c=Lc();(0,Ku.useEffect)(()=>{let d=c(e,o);d&&a&&[ft,St].includes(n)&&(new Zt(a).writeTabInfoToLocalStorage(d),i({params:{...d,feeConfig:r.feeConfig}}))},[e?.chainId,e?.tokenContractAddress,o?.chainId,o?.tokenContractAddress,a,n])};var Yd=a=>{let t=Hu(),{tabType:e}=Gu(t);ju(e,a),$u(e)},Xu=Yd;u();l();var Ju=L(q());u();l();function $d(a){return new Promise(t=>setTimeout(t,a))}async function Je(a,t=3,e=0){let o;for(let r=0;r<t;r++)try{return await a()}catch(i){o=i,e&&r<t-1&&await $d(e)}throw o}function Xd(a,t,e){let o=bt();return{promise:a(t,{...e,signal:o.signal}),cancel:()=>o.abort()}}function zd(a,t,e){if(nt())return Xd(a,t,e);let o=new AbortController,r=o.signal;return{promise:a(t,{...e,signal:r}),cancel:()=>o.abort()}}function zu(a,t){return zd(y.get,a,t)}function Zu(){let{accountStore:a,receiveAddressStore:t}=rt(),{address:e,setUserForbiddenBridge:o}=a,{receiveAddrObj:r,computedSwapHighLight:i}=t,{specifiedAddress:n}=r||{};(0,Ju.useEffect)(()=>{let c=()=>{};if(e&&i){let{promise:d,cancel:m}=zu($a,{params:{userWalletAddress:e,receiveWalletAddress:n}});c=m,d.then(p=>{o(p?.data.blackListTypes||he)}).catch(()=>{o(he)})}else o(he);return c},[e,o,n,i])}u();l();var tl=L(q());function js(){let{accountStore:{address:a}}=rt();(0,tl.useEffect)(()=>{_.setTags({address:a})},[a])}u();l();var el=L(q());var Jd=()=>{let{accountStore:a,fromToStore:t,approveStore:e,recentTransactionStore:o,tokenModalStore:r}=rt();(0,el.useEffect)(()=>{let{computedAccountWalletAddresses:i}=a;return i&&(te.addListen("error",()=>{e.onSocketError(),o.onSocketError(),t.setNeedBalanceLoading(!1),t.getSwapTokenBalance(),r.reloadTokenList()}),te.addListen(Ms.DEX_PUSH_ENGINE,n=>{o.onSocket(n),e.onSocket(n)}),te.addListen(Ms.WALLET_ASSET,n=>{n&&(r.updateAllTokenList(n),t.updateFromBalancePush(n))}),te.init(i)),()=>{te.removeAll(),te.wsInstance&&i&&te.logout(i)}},[a.computedAccountWalletAddresses,o.onSocket,r.updateAllTokenList,t.updateFromBalancePush,a,o,r])},ol=Jd;u();l();var oe=L(q()),rl=L(Ht());var Zd=({currency:a,currentWallet:t,walletInfo:e,keyringIdentityTypeEnum:o,addressBookList:r,walletList:i,t:n,dispatch:c,currentTab:d,onBack:m})=>{let{commonStore:p,accountStore:f,recentTransactionStore:g,reset:C}=rt(),k=(0,rl.useHistory)();(0,oe.useEffect)(()=>{b.setRuntimeContext({history:k,toLocale:n,dispatch:c,walletInfo:e,onBack:m})},[n,k,c,e,m]),(0,oe.useEffect)(()=>{t&&f.setWalletConfig(t)},[t]),(0,oe.useEffect)(()=>(p.getUserUnit(a),p.fetchChainList({businessLine:1,currentTab:d}).catch(()=>{p.setChainListLoadError(!0)}),()=>{C()}),[]),(0,oe.useEffect)(()=>{f.setAddressBookList(r)},[r]),(0,oe.useEffect)(()=>{f.setWalletList(i)},[i]),(0,oe.useEffect)(()=>{f.setKeyringIdentityTypeEnum(o)},[o]),(0,oe.useEffect)(()=>{t.walletId?g.updatePendingOrders(t.walletId):g.setPendingOrders([])},[t.walletId,d]),wc()},sl=Zd;u();l();var dt=L(q()),re=L(Ht());u();l();var yo=L(q()),Or=L(Ht()),hl=L(Qd());u();l();var al=L(q());u();l();var il=L(q());var tm=({visible:a,onBack:t=()=>{},params:e})=>{let{useCoin:o}=b.hooks,{coinId:r,receiveOnly:i,chainId:n,tokenContractAddress:c}=e,d=o(n,c);return a&&il.default.createElement(b.components.SupplyGas,{visible:a,closeCallback:t,coinId:r||d.coinId,receiveOnly:i})},nl=tm;var em=()=>{let{fromToStore:a}=rt(),{visibleAddFunds:t,addFundsParams:e,closeAddFunds:o}=a;return al.default.createElement(nl,{visible:t,params:e,onBack:()=>{o()}})},cl=Ot(em);u();l();var ul=L(q());var ll=()=>{let{fromToStore:a}=rt(),{closeAddFunds:t}=a;(0,ul.useEffect)(()=>{t()},[])};u();l();var Ze={wrapper:"_wrapper_1jxhm_1","extension-container":"_extension-container_1jxhm_5",extensionContainer:"_extension-container_1jxhm_5","telegram-container":"_telegram-container_1jxhm_9",telegramContainer:"_telegram-container_1jxhm_9","right-icon":"_right-icon_1jxhm_13",rightIcon:"_right-icon_1jxhm_13"};u();l();var Pr=L(q()),ml=L(Ht());var dl={[ft]:"swaptrade_card_swap_title_swap",[St]:"swaptrade_card_swap_title_swap",[Dt]:"swaptrade_extension_cinteraction_contract_interaction",[go]:"swaptrade_recent_transaction_detail_dialog_title"},om=[He,je],rm=a=>a.startsWith(fe)?h(dl[go]):h(dl[a]),sm=()=>{let a=(0,ml.useLocation)(),t=Oc();return(0,Pr.useMemo)(()=>{let{isTelegramMiniApp:e}=b.global,o=a.pathname,r=!e&&o===ft&&t?Pr.default.createElement(Pc,{iconStyle:{fontSize:24},tooltipProps:{show:!1},iconClassName:Ze.rightIcon}):null,i=r?{children:r}:!1;return{showNavigator:!om.includes(a.pathname),title:rm(a.pathname),closeable:i}},[a,t])},pl=sm;var im=[ft,St],nm=({children:a,onBack:t})=>{let{showNavigator:e,title:o,closeable:r}=pl(),i=(0,Or.useLocation)(),n=(0,Or.useHistory)(),{isTelegramMiniApp:c}=b.global,{Navigator:d}=b.components,m=i.pathname.includes(Dt);ll();let p=()=>{m&&Ye({...ct(),button_name:"back"}),t?t(n.goBack,im.includes(i.pathname)):n.goBack()};return yo.default.createElement("div",{className:(0,hl.default)("universe-swap background-base-primary",Ze.wrapper)},e?yo.default.createElement(d,{title:o,onBack:p,closeable:r}):null,yo.default.createElement("div",{className:c?Ze.telegramContainer:Ze.extensionContainer},a),yo.default.createElement(cl,null))},fl=Ot(nm);var am=(0,dt.lazy)(()=>import("./Swap-TXKL3GGN.js")),cm=(0,dt.lazy)(()=>import("./Bridge-ZZ7ZA57U.js")),um=(0,dt.lazy)(()=>import("./OrderDetail-WIEXBDTI.js")),lm=(0,dt.lazy)(()=>import("./Contract-4XNXX5H4.js")),dm=(0,dt.lazy)(()=>import("./Approve-7RBZALXQ.js")),mm=(0,dt.lazy)(()=>import("./Solana-MQ2NN3RU.js")),pm=({onBack:a})=>{let t=(0,re.useLocation)();return dt.default.createElement(fl,{onBack:a},dt.default.createElement(dt.Suspense,null,dt.default.createElement(re.Switch,null,[{path:ft,component:am,exact:!0},{path:St,component:cm,exact:!0},{path:go,component:um,exact:!0},{path:Dt,component:lm,exact:!0},{path:He,component:dm,exact:!0},{path:je,component:mm,exact:!0}].map((o,r)=>dt.default.createElement(re.Route,{key:r,path:o.path,component:o.component,exact:o.exact})),dt.default.createElement(re.Redirect,{from:pr,to:{pathname:ft,search:t.search},strict:!0,exact:!0}))))},Sl=pm;var hm=({currency:a,currentWallet:t,keyringIdentityTypeEnum:e,addressBookList:o,walletList:r,walletInfo:i,onBack:n,t:c,dispatch:d,currentTab:m=E.SWAP})=>{Xu(i.chainId),sl({currency:a,currentWallet:t,walletInfo:i,keyringIdentityTypeEnum:e,addressBookList:o,walletList:r,t:c,dispatch:d,currentTab:m,onBack:n}),Zu(),ol(),js();let{initialized:p}=Wu();return p?Nr.default.createElement(Sl,{onBack:n}):null},gl=(0,Nr.memo)(Ot(hm));u();l();F();u();l();u();l();u();l();O();u();l();var Tl=(a,t)=>{let e=a.split(".").map(Number),o=t.split(".").map(Number),r=Math.max(e.length,o.length);for(let i=0;i<r;i++){let n=e[i]||0,c=o[i]||0;if(n>c)return 1;if(n<c)return-1}return 0};var _o=class{constructor(){s(this,"btcAddressType","");s(this,"setBtcAddressType",t=>{this.btcAddressType=t});s(this,"commonStore",null);s(this,"userForbiddenWithBridge",he);s(this,"setUserForbiddenBridge",t=>{this.userForbiddenWithBridge=t});s(this,"defaultWalletConfig",ma);s(this,"walletConfig",this.defaultWalletConfig);s(this,"hasInitWalletInfo",!1);s(this,"chainId",ee);s(this,"setChainId",t=>{this.chainId=t});s(this,"fromChainId",ee);s(this,"setFromChainId",t=>{this.fromChainId=t});s(this,"walletSupportMev",!1);s(this,"setWalletSupportMev",t=>{this.walletSupportMev=t});s(this,"checkOkxVersion",async()=>{let t="2.82.31",e=this.walletConfig.isOkxWallet;if(this.isConnectedWallet&&e&&window?.okxwallet?.getVersion){let o=await window.okxwallet.getVersion(),i=Tl(o,t)>=0;this.setWalletSupportMev(i)}else this.setWalletSupportMev(!1)})}getDeviceId(){}getChainId(){}get scanAppType(){throw new Error("scanAppType is not defined")}get walletType(){throw new Error("walletType is not defined")}get address(){return ee}get computedForbiddenBridge(){let{computedIsCrossChain:t}=this.rootStore.fromToStore;return t?this.userForbiddenWithBridge:he}get computedAccountId(){let{walletConfig:t}=this;return t.walletId}setWalletConfig(t={}){this.walletConfig=t}getAddressByChainId(){}get isConnectedWallet(){return!!this.walletConfig.walletId}get computedNonsupportChain(){return!this.isConnectedWallet||!j(this.fromChainId)?!1:!this.address}get computedAccountWalletAddresses(){return Qt(I(this,"walletConfig.address",[])).join(",")||this.address}get computedAccountWalletAddressesArray(){return Qt(I(this,"walletConfig.address",[]))||[this.address]}get computedSpecialWalletAddress(){return this.getAddressByChainId(V.BTC_MAINNET)}};u();l();u();l();function wt(a=[],t=[]){let e={};a.forEach(r=>{e[r]=uo});let o={};return t.forEach(r=>{o[r]=jn}),{...e,...o}}var Il=wt(["walletConfig","chainId","hasInitWalletInfo","fromChainId","btcAddressType"],["computedAccountId","isConnectedWallet","computedNonsupportChain","computedAccountWalletAddresses","computedAccountWalletAddressesArray","address","computedSpecialWalletAddress"]);var Ks=class extends _o{constructor(e){super();s(this,"formatWalletType",()=>{let{walletInfo:e}=b,{isHARDWARE:o,isMNEMONIC:r,isMPC:i,isPRIVATE:n}=e?.walletType||{};return o?Yt.HARDWARE:r?Yt.MNEMONIC:i?Yt.MPC:n?Yt.PRIVATE_KEY:null});s(this,"formatWalletAccount",e=>{let o=Object.values(e.account);return{...e,OKXWalletType:this.formatWalletType(),address:o}});s(this,"keyringIdentityTypeEnum",{});s(this,"walletList",[]);s(this,"addressBookList",[]);s(this,"hasInitWalletInfo",!1);s(this,"getAddressByChainId",e=>{if(!j(e))return ee;let o=this.getWalletChainName(e);return this.walletConfig.account?.[o]||ee});this.rootStore=e,this.commonStore=e.commonStore,Et(this,Il)}async getDeviceId(){let{devid:e}=await b.localStore.get("devid");return e}getCurrentChainAddress(e){let o=this.rootStore?.fromToStore.from.chainId;if(!j(o))return ee;let r=this.getWalletChainName(o);return e.account[r]}getWalletChainName(e){return b.getNetWorkName(e)}replaceBtcAddressByType(e){if(this.btcAddressType){let o=this.getWalletChainName(V.BTC_MAINNET);if(e.account?.[o]){let i=e.accountsMap?.bitcoin?.[this.btcAddressType]?.address;if(i)return{...e,account:{...e.account,[o]:i}}}}return e}setWalletConfig(e){this.walletConfig=this.formatWalletAccount(this.replaceBtcAddressByType(e)),this.hasInitWalletInfo=!0}webSwapHistoryDetailViewMore(){}setAddressBookList(e){this.addressBookList=e}setWalletList(e){this.walletList=e.map(o=>o.walletId===this.computedAccountId?this.replaceBtcAddressByType(o):o)}setKeyringIdentityTypeEnum(e){this.keyringIdentityTypeEnum=e}get address(){return this.getAddressByChainId(this.fromChainId)}},Cl=Ks;u();l();u();l();O();F();u();l();var Te={FROM:"FROM",TO:"TO"},Ys={COMMON:"COMMON",COLLECTION:"COLLECTION"},gt={COLLECT_LIST:"COLLECT_LIST",ALL_NETWORK:"ALL_NETWORK",CHAIN_LIST:"CHAIN_LIST",SEARCH:"SEARCH",ALL_TOKENS:"ALL_TOKENS"},fm={[gt.COLLECT_LIST]:{[E.SWAP]:Ma,[E.LIMIT_ORDER]:xa,[E.BRIDGE]:Ba},[gt.ALL_NETWORK]:{[E.SWAP]:Da,[E.LIMIT_ORDER]:Na,[E.BRIDGE]:Fa},[gt.SEARCH]:{[E.SWAP]:qa,[E.LIMIT_ORDER]:Ua,[E.BRIDGE]:Va},[gt.CHAIN_LIST]:{[E.SWAP]:Ea,[E.LIMIT_ORDER]:Ra,[E.BRIDGE]:ka},[gt.ALL_TOKENS]:{[E.SWAP]:Ns,[E.LIMIT_ORDER]:Ns,[E.BRIDGE]:pa}},Wt=(a,t)=>fm[a]?.[t]??"";var Eo=class{constructor(t){s(this,"rootStore",null);s(this,"userUniqueId",Ec());s(this,"chainListFreshCount",0);s(this,"chainList",[]);s(this,"setChainList",t=>{this.chainList=t,this.chainListFreshCount+=1});s(this,"transactionLoading",!1);s(this,"setTransactionLoading",t=>{this.transactionLoading=t});s(this,"nowCurrencyUnit",{});s(this,"tokenModalVisible",!1);s(this,"safemoonSlippage",0);s(this,"fetchChainList",async({businessLine:t=1,isLimit:e=!1,isHistory:o=!1,currentTab:r,chainIdConfig:i={}})=>{if(qi())return[];let n=Wt(gt.CHAIN_LIST,this.currentTab||r),c=await y.get(n,{params:{businessLine:e?Xt.LIMIT_ORDER:t,...i}});return!o&&this.setChainList(c?.data),this.setCurrentTabChainList({[e?E.LIMIT_ORDER:E.SWAP]:c?.data}),c?.data});s(this,"currentTabChainList",{});s(this,"setCurrentTabChainList",t=>{this.currentTabChainList={...this.currentTabChainList,...t}});s(this,"getTradeType",()=>this.rootStore?.fromToStore?.computedIsCrossChain?Os.MULTI:Os.SINGLE);s(this,"globalMessages",null);s(this,"setGlobalMessage",t=>{this.globalMessages=t});s(this,"cleanGlobalMessage",()=>{this.globalMessages=null});s(this,"socketStatus",!1);s(this,"balancePushSocketStatus",!1);s(this,"resetFromToByTabChange",!1);s(this,"setResetFromToByTabChange",t=>{this.resetFromToByTabChange=t});s(this,"portal",It.DEX);s(this,"setPortal",t=>{this.portal=t});s(this,"currencyConversion",t=>{let{usdToThisRate:e}=this.nowCurrencyUnit,o=T.BigNumber(t);return!e||o.isNaN()?"":o.multipliedBy(e)});s(this,"currencyReConversion",t=>{let{usdToThisRate:e}=this.nowCurrencyUnit,o=T.BigNumber(t);return!e||o.isNaN()?"":o.dividedBy(e).toString()});s(this,"isSensitiveChain",t=>this.computedSensitiveChainIds.some(e=>String(e)===String(t)));s(this,"getTokenAddress",t=>{let e=this.isSensitiveChain(t?.chainId),o=t?.tokenContractAddress||t?.tokenAddress;return e?o:Bt(o)});s(this,"equalsChainId",(t,e)=>t!==null&&String(t?.chainId)===String(e?.chainId));s(this,"equalsToken",(t,e)=>{let o=this.equalsChainId(t,e);return Bs(t)&&Bs(e)?o:o&&this.getTokenAddress(t)===this.getTokenAddress(e)});s(this,"fromFillToken",!1);s(this,"currentTab","");s(this,"setCurrentTab",(t,e)=>{this.currentTab!==t&&(this.setResetFromToByTabChange(!0),this.rootStore?.fromToStore?.clearFromTo()),this.currentTab=t,this.fromFillToken=!!e});s(this,"marketWsIsConnected",!1);s(this,"setMarketWsIsConnected",t=>{this.marketWsIsConnected=t});s(this,"forceUpdateFromToByHash",0);s(this,"forceUpdateFromTo",()=>{this.forceUpdateFromToByHash+=1});s(this,"isFirstInit",!0);this.rootStore=t,ze&&this.setPortal(It.LEDGER)}setChainType(){}get computedReserveGas(){let{chainList:t}=this,e=this.rootStore.fromToStore.from.chainId;return t.find(r=>Number(r.chainId)===Number(e))?.reserveGas||""}getChainByID(t){return this.chainList.find(e=>(this.computedCurrentTabIsLimit||e.chainUsed)&&e.chainId===Number(t))}getUserUnit(){}get computedRealSlippageValue(){return I(this,"rootStore.slippageStore",{}).computedRealSlippageValue||0}setSocketStatus(t){this.socketStatus=t}setBalanceSocketStatus(t){this.balancePushSocketStatus=t}get computedIsWalletEnv(){return this.portal===It.OKX_WALLET_EXTENSION}get computedIsWalletDashBoard(){return this.portal===It.WALLET_DASHBOARD}get computedIsMarket(){return this.portal===It.MARKET}get computedNotThirdBiz(){return this.portal===It.OKX_WALLET_EXTENSION||this.portal===It.DEX||this.portal===It.MARKET}get computedNowCurrencySymbol(){return this.nowCurrencyUnit.symbol||""}get computedSensitiveChainIds(){return this.chainList.map(t=>Number(t.isSensitive)===ea.YES?t.chainId:null).filter(Boolean)}get computedCurrentTabIsLimit(){return this.currentTab===E.LIMIT_ORDER}get computedIsUrlFillSwap(){return this.computedIsWalletDashBoard||this.computedIsWalletEnv}toBaseFormatUSD(t,e){let o=this.computedNowCurrencySymbol,r=this.nowCurrencyUnit?.usdToThisRate,i=T.BigNumber(t).multipliedBy(r).toString();return at(i,o,{needPlaceholder:!0,...e})}setIsFirstInit(t){this.isFirstInit=t}};u();l();var Al=wt(["userUniqueId","chainList","transactionLoading","nowCurrencyUnit","tokenModalVisible","safemoonSlippage","globalMessages","socketStatus","balancePushSocketStatus","portal","currentTab","currentTabChainList","forceUpdateFromToByHash","marketWsIsConnected","isFirstInit"],["computedReserveGas","computedNowCurrencySymbol","computedSensitiveChainIds","computedIsWalletEnv","computedCurrentTabIsLimit"]);var ko=class extends Eo{constructor(e){super(e);s(this,"swapCollapse",!1);s(this,"setSwapCollapse",e=>{this.swapCollapse=e});s(this,"chainListLoadError",!1);s(this,"setChainListLoadError",e=>{this.chainListLoadError=e});Et(this,{...Al,swapCollapse:uo,chainListLoadError:uo}),this.setPortal(ua)}getUserUnit(e){this.nowCurrencyUnit=e}};u();l();O();F();var Ro=class{constructor(t){s(this,"checkTokenValid",async t=>{if(!uc(t))return!1;let[e,o]=await R(y.get(oc,{params:ce(t,["chainId","tokenContractAddress"])}));return e?!1:o.data.supportMarket});this.rootStore=t,this.accountStore=t.accountStore,U(this,{},{autoBind:!0})}};u();l();O();F();var bo=class{constructor(t){s(this,"showLimitDialog",!1);s(this,"setShowLimitDialog",t=>{this.showLimitDialog=t});s(this,"cancelRef",null);s(this,"callbackList",[]);s(this,"addToCallbackList",t=>{this.callbackList.push(t)});s(this,"removeFromCallbackList",t=>{this.callbackList=this.callbackList.filter(e=>e!==t)});s(this,"updateTokenCollectStatus",async({tokenInfo:t,callBack:e})=>{let{isConnectedWallet:o}=this.accountStore;if(!o){this.walletWarnInterceptor();return}this.cancelRef&&this.cancelRef.abort(),this.cancelRef=bt();let r={tokenContractAddress:t?.tokenContractAddress,chainId:Number(t?.chainId),symbol:t?.tokenSymbol,decimal:t?.decimals,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,isCustomToken:t?.isCustomToken||t?.isSubscribe},[i,n]=await R(y.post(dr,r,{signal:this.cancelRef.signal}));if(!Jt(i)&&i)i?.code===10023?D.error(h("swaptrade_selecttoken_modal_favorite_limitreached")):D.error(h("swaptrade_pricechart_no_connection_desc"));else if(n){if(n?.data===0)D.success({title:h("swaptrade_selecttoken_toast_removed_from_favorite"),duration:Lt}),e({selected:!1,tokenInfo:t}),this.callbackList.forEach(c=>{c({selected:!1,tokenInfo:t})});else if(n?.data===1){let c=Cc(),{isMarketHomeUrl:d}=Ac();!d&&fr({business_type:c?bs.LIMIT_ORDER:bs.SWAP}),D.success({title:h("swaptrade_selecttoken_toast_added_to_favorite"),duration:Lt}),e({selected:!0,tokenInfo:t}),this.callbackList.forEach(m=>{m({selected:!0,tokenInfo:t})})}}});s(this,"debounceUpdateTokenCollectStatus",xe(this.updateTokenCollectStatus,500));s(this,"walletWarnInterceptor",()=>{D.error({title:h("swaptrade_selecttoken_toast_connect_wallet"),duration:Lt})});this.rootStore=t,this.commonStore=t.commonStore,this.accountStore=t.accountStore,U(this,{},{autoBind:!0})}};var se=class{constructor(){se.instance?(this.commonStore=se.instance.commonStore,this.accountStore=se.instance.accountStore,this.updateCollectionStore=se.instance.updateCollectionStore,this.checkTokenStore=se.instance.checkTokenStore):(this.commonStore=new ko(this),this.accountStore=new Cl(this),this.updateCollectionStore=new bo(this),this.checkTokenStore=new Ro(this),se.instance=this)}},Ie=se;s(Ie,"instance",null);u();l();u();l();O();F();u();l();function Lo(a){return[$t.USER_DENIED,$t.WC2Denied,$t.USER_DENIED_WC_RAINBOW,$t.WC_QR_DENIED].includes(a?.code)}var $s=class{constructor(t){this.approveTokenDefaultConfig={status:x.Unknown,approvedAmount:"0"};this.approveTokensConfig={};this.getApproveTokenMapKey=(t,e)=>{let o=this.commonStore.getTokenAddress(t);return`${t.chainId}_${o}_${e}`};this.registerApproveToken=(t,e)=>{let o=this.getApproveTokenMapKey(t,e),r=I(this.approveTokensConfig,o);X(r)&&(this.approveTokensConfig[o]={...this.approveTokenDefaultConfig})};this.registerCurrentApproveToken=()=>{let{token:t,tradeModeCode:e}=this.computedTokenAndTradeModeCode;this.registerApproveToken(t,e)};this.updateApproveTokenConfig=(t,e,o)=>{let r=this.getApproveTokenMapKey(t,e),i=I(this.approveTokensConfig,r),n=X(i),c=i||this.approveTokenDefaultConfig;this.approveTokensConfig[r]={...c,...o},n&&_.stuff("if you want to update approve token config, you should register it first.")};this.removeApproveTokenConfig=(t,e)=>{let o=this.getApproveTokenMapKey(t,e);delete this.approveTokensConfig[o]};this.updateCurrentApproveTokenConfig=t=>{let{token:e,tradeModeCode:o}=this.computedTokenAndTradeModeCode;this.updateApproveTokenConfig(e,o,t)};this.getApproveTokenConfig=(t,e)=>{let o=this.getApproveTokenMapKey(t,e);return I(this.approveTokensConfig,o,this.approveTokenDefaultConfig)};this.clearNonApprovingTokensConfig=()=>{let t=Fi(this.approveTokensConfig,e=>[x.Approving,x.CancelApproving].includes(e.status));this.approveTokensConfig={...t}};this.isApprovalCheckRequired=()=>{let{computedIsSolanaChain:t,computedIsAptosChain:e}=this.fromToStore,{quote:{bestRoute:o}}=this.rootStore.quoteStore,r=this.commonStore.computedCurrentTabIsLimit,{token:i}=this.computedTokenAndTradeModeCode,{isNativeToken:n}=i;return(r?!0:o?.needApprove==="1")&&!n&&!t&&!e};this.validApproveAmountLessSwapAmount=t=>{let{token:e}=this.computedTokenAndTradeModeCode;return T.BigNumber(t).isLessThan(e.amount||"0")};this.isValidApprovalStatus=(t,e)=>{let o=zt(t),r=this.validApproveAmountLessSwapAmount(t);return o?x.UnApproved:r&&e?x.CancelApprove:r?x.UnApproved:x.Approved};this.generateApproveRequestParams=t=>{let{address:e}=this.accountStore,{token:o}=this.computedTokenAndTradeModeCode,{tokenContractAddress:r,chainId:i}=o;return{userWalletAddress:e,tokenContractAddress:r,chainId:i,cancelApproveTag:t}};this.fetchApproveAllowance=()=>{let t=this.getDefiPlatformIds();return y.get(va,{params:{...this.generateApproveRequestParams(),defiPlatformIds:t}}).then(e=>e?.data)};this.fetchApproveData=t=>{let e=this.fromToStore.computedIsCrossChain?this.getBridgeDefiPlatformId():I(this,"rootStore.quoteStore.quote.bestRoute.defiPlatformId",Z),o={...this.generateApproveRequestParams(t),defiPlatformId:e};return y.get(Pa,{params:o}).then(r=>{let{id:i,data:n,from:c,to:d,unsignedTx:m}=r?.data||{},p={data:n,from:c,to:d};return _.info(N.APPROVE_DATA,{id:i,data:n,from:c,to:d,unsignedTx:m,cancelApproveTag:t}),_r(o.chainId)&&(p=JSON.parse(m)),{transactionPayload:p,id:i}})};this.getBridgeDefiPlatformId=()=>{let e=this.rootStore.quoteStore.quote?.bestRoute,o=Number(e?.bridge?.bridgeType),r=e?.bridge?.defiPlatformId;return o===ia?r:Z};this.approveStatusIsPending=()=>[x.Approving,x.CancelApproving].includes(this.computedApprovalStatus);this.isPendingNeedCheck=async()=>{this.approveStatusIsPending()&&this.checkApprove().catch(()=>{})};this.isPendingNotCheck=async()=>{this.approveStatusIsPending()||this.checkApprove().catch(()=>{})};this.getDefiPlatformIds=()=>{let{computedIsCrossChain:t}=this.fromToStore;if(t){let e=I(this,"rootStore.quoteStore.pathSelectionRouterList");return Array.isArray(e)?Qt(e.map(o=>o.bridge?.defiPlatformId).filter(o=>o!==void 0)):[Z]}return I(this,"rootStore.quoteStore.quote.bestRoute.defiPlatformInfoList",[{defiPlatformId:Z}]).map(e=>e.defiPlatformId)};this.checkApprove=async()=>{let{token:t,tradeModeCode:e}=this.computedTokenAndTradeModeCode;if(!this.isApprovalCheckRequired()){this.getDefiPlatformIds().forEach(n=>{this.registerApproveToken(t,n),this.updateApproveTokenConfig(t,n,{status:x.Approved,tagStatus:x.UnApproved})});return}let{tokenContractAddress:o}=t,{address:r}=this.accountStore;if(o&&r){let[,i]=await R(this.fetchApproveAllowance());if(!i){this.updateApproveTokenConfig(t,e,{status:x.Unknown});return}Object.keys(i).forEach(n=>{let c=i[n];this.calcApproveState({approveInfo:c,token:t,tradeModeCode:Number(n)})})}};this.calcApproveState=({approveInfo:t,token:e,tradeModeCode:o})=>{let{decimals:r}=e,i=Number(t.status)===x.Approved?t.amount:"0",n=Ke(i,r)||"0",c=t?.needCancelApproveToken,d=this.isValidApprovalStatus(n,c);this.registerApproveToken(e,o),this.updateApproveTokenConfig(e,o,{status:d,tagStatus:d,approvedAmount:n})};this.fetchApproveDataErrorTips=(t,e)=>{this.updateCurrentApproveTokenConfig({status:x.UnApproved});let o=W(t?.tokenSymbol);Cr({title:e?h("swaptrade_transfer_notification_title_ccy_unrevoked",{ccy:o}):h("swaptrade_toast_approve_fail",{tokenSymbol:o})})};this.approveErrorTips=({error:t,chainId:e,transactionPayload:o,token:r,tradeModeCode:i,cancelApproveTag:n})=>{_.error(N.APPROVE_TOKEN_ERROR,{chainId:e,transactionPayload:o,error:t,token:r,tradeModeCode:i}),Lo(t)||de.error({title:h("swaptrade_home_toast_broadcast_failed")}),this.updateApproveTokenConfig(r,i,{status:this.isCancelApprove(n)?x.CancelApprove:x.UnApproved})};this.isCancelApprove=t=>t===qe.CANCEL_APPROVE;this.setApprove=async t=>{let{token:e,tradeModeCode:o}=this.computedTokenAndTradeModeCode,{chainId:r}=e;this.updateApproveTokenConfig(e,o,{status:this.isCancelApprove(t)?x.CancelApproving:x.Approving});try{let{id:i,transactionPayload:n}=await this.fetchApproveData(t);await this.approveToken({chainId:r,transactionPayload:n}).then(({result:c})=>this.saveApprove({id:i,chainId:r,transactionHash:c,cancelApproveTag:t})).catch(c=>{this.approveErrorTips({error:c,chainId:r,transactionPayload:n,token:e,tradeModeCode:o,cancelApproveTag:t})})}catch{this.fetchApproveDataErrorTips(e,t)}};this.saveApprove=async({id:t,chainId:e,transactionHash:o,cancelApproveTag:r})=>{if(!o)return;let{address:i}=this.accountStore,n=I(this,"rootStore.quoteStore.quote.bestRoute.defiPlatformId",Z);_.info(N.SAVE_APPROVE,{id:t,transactionHash:o,chainId:e,userWalletAddress:i,cancelApproveTag:r,defiPlatformId:n});try{await y.post(Oa,{id:t,transactionHash:o,chainId:e,userWalletAddress:i,cancelApproveTag:r,defiPlatformId:n})}catch(c){_.info(N.SAVE_APPROVE_ERROR,{error:c?.message,id:t,transactionHash:o,chainId:e,userWalletAddress:i,cancelApproveTag:r,defiPlatformId:n})}};this.onSocket=async t=>{if(t?.type==="1"&&t?.dexData&&t.dexData.type==="approve"){let e=t.dexData,{status:o,transactionHash:r,fromTokenSymbol:i,fromTokenAddress:n,exploreUrl:c,solanaToast:d,platformId:m}=e,p=nt();if(d==="1"){if(p)return;let w=o===Ve.CANCEL_APPROVE_SUBMITTED?"swaptrade_transfer_toast_ccy_unrevoke_submit":"swaptrade_transfer_notification_approval_submit";Ir({title:h(w,{ccy:W(i)})});return}let{token:f,tradeModeCode:g}=this.computedTokenAndTradeModeCode,C={chainId:e.chainId,tokenContractAddress:n},k=this.commonStore.equalsToken(f,C),P=String(g)===String(m);if(k&&P&&await this.isPendingNeedCheck(),(!k||k&&!P)&&this.removeApproveTokenConfig(C,m),o===Ve.APPROVE_SUCCESS){let w=h("swaptrade_toast_approve_success",{tokenSymbol:W(i)});!p&&Ir({title:w,exploreUrl:c}),Co.emit(Io.APPROVE,{data:r,status:0,message:w})}else if(o===Ve.APPROVE_FAILED&&!p){let w=h("swaptrade_toast_approve_fail",{tokenSymbol:W(i)});Cr({title:w,exploreUrl:c})}else if(o===Ve.CANCEL_APPROVE_SUCCESS&&!p){let w=h("swaptrade_transfer_notification_title_ccy_revoked",{ccy:W(i)});Ir({title:w,exploreUrl:c})}else if(o===Ve.CANCEL_APPROVE_FAILED&&!p){let w=h("swaptrade_transfer_notification_title_ccy_unrevoked",{ccy:W(i)});Cr({title:w,exploreUrl:c})}}};this.onSocketError=()=>{this.isPendingNeedCheck().catch(()=>{})};this.rootStore=t,this.accountStore=t.accountStore,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore}get computedApprovalStatus(){let{token:t,tradeModeCode:e}=this.computedTokenAndTradeModeCode;return this.getApproveTokenConfig(t,e).status}get computedTokenAndTradeModeCode(){let{from:t,computedIsCrossChain:e}=this.fromToStore,o=this.rootStore.quoteStore,r=Z;if(e)r=this.getBridgeDefiPlatformId();else{let{aggregateSelectId:i}=o;r=i===Rt?Z:i}return{token:t,tradeModeCode:r}}get computedIsCancelApproveStatus(){return[x.CancelApprove,x.CancelApproving].includes(this.computedApprovalStatus)}approveToken(t){return Promise.resolve(t)}},yl=$s;u();l();var _l=Symbol(),El=Object.prototype,Sm=(a,t,e)=>{if(Kn(a))throw new Error("Target must not be observable");let o=a[_l];if(o){let r={};for(let i in a)o[i]&&(r[i]=o[i]);o=r}else{o={};let r=a;for(;r&&r!==El;)Reflect.ownKeys(r).forEach(n=>{n===Hn||n==="constructor"||(o[n]=t&&n in t?t[n]:!0)}),r=Object.getPrototypeOf(r);let i=Object.getPrototypeOf(a);i&&i!==El&&Object.defineProperty(i,_l,{value:o})}return Et(a,o,e)},ut=Sm;var Ce=class extends yl{constructor(e){super(e);s(this,"approveInfo",{});s(this,"setApproveInfo",e=>{this.approveInfo=e});s(this,"setApprove",async(e=qe.APPROVE)=>{let{token:o,tradeModeCode:r}=this.computedTokenAndTradeModeCode,{chainId:i}=o;this.updateApproveTokenConfig(o,r,{status:this.isCancelApprove(e)?x.CancelApproving:x.Approving});try{let{id:n,transactionPayload:c}=await this.fetchApproveData(e);this.setApproveInfo({chainId:i,id:n,transactionPayload:c,token:o,tradeModeCode:r,cancelApproveTag:e}),b.history?.push({pathname:He})}catch{this.fetchApproveDataErrorTips(o,e)}});s(this,"approveCancel",()=>{let e=this.approveInfo.cancelApproveTag;this.setApproveInfo({}),b.history?.goBack?.(),this.updateCurrentApproveTokenConfig({status:this.isCancelApprove(e)?x.CancelApprove:x.UnApproved})});s(this,"approveConfirm",async({txHash:e,error:o})=>{if(o){this.approveErrorTips({error:o,...this.approveInfo}),this.approveCancel();return}let{id:r,chainId:i,cancelApproveTag:n}=this.approveInfo;await this.saveApprove({id:r,chainId:i,transactionHash:e,cancelApproveTag:n}),b.history?.goBack?.(),this.setApproveInfo({})});ut(this)}};u();l();F();u();l();var vt=()=>{let{fromToStore:a,gasDropStore:t,receiveAddressStore:e,outerStore:o,quoteStore:r,accountStore:i,liquidityChooseStore:n}=M(),{from:c,to:d}=a,{receiveAddrObj:m}=e,{computedForbiddenBridge:p,address:f}=i,g=T.BigNumber(a.computedTypedValue).toString(10),k={...{chainId:c.chainId,toChainId:d.chainId,toTokenAddress:d.tokenContractAddress,fromTokenAddress:c.tokenContractAddress,amount:g,userWalletAddress:f},...r.computedSlippage,pmm:"1",gasDropType:t?.computedGasDropSelected?1:0,forbiddenBridgeTypes:Fs(p),dexIds:Fs(n?.computedIds),receiveWalletAddress:m?.specifiedAddress};return o.extendFeeConfig(k)},kl=()=>{let{quoteStore:a}=M();return{...vt(),sort:a.bridgeSortType}},Rl=()=>{let{quoteStore:a}=M(),{quote:t}=a,e=t?.bestRoute?.bridge?.bridgeId,{slippage:o,toChainId:r,receiveWalletAddress:i,userWalletAddress:n,chainId:c,fromTokenAddress:d,toTokenAddress:m,amount:p}=vt();return{slippage:o,toChainId:r,receiveWalletAddress:i,userWalletAddress:n,chainId:c,fromTokenAddress:d,toTokenAddress:m,amount:p,bridgeId:e}};u();l();u();l();u();l();var Y=class{constructor({orderData:t,extParams:e},o){s(this,"walletNoNeedExtParams",!1);s(this,"differentiatedEnvironment",t=>nt()&&t.length>1&&!this.walletNoNeedExtParams&&!t[0].params?[{...t[0],extParams:t[1]}]:t);this.orderData=t,this.calldataType=t.calldataType,this.extParams=e||{},this.swapStore=o}get isTransferType(){return this.calldataType===ra.TRANSFER}};var Ae=class extends Y{constructor(){super(...arguments);s(this,"formatContractPayload",()=>{let{orderData:e}=this;return{...JSON.parse(e?.callData?.data)}});s(this,"formatTransferPayload",()=>{});s(this,"getSendTransactionParams",async()=>{let e=this.formatContractPayload();return this.differentiatedEnvironment([{...e,extParams:this.extParams}])});s(this,"preExecution",async()=>({payload:this.formatContractPayload()}))}};s(Ae,"chainId",V.APTOS_MAINNET);u();l();var ye=class extends Y{constructor(e,o,r){super(e,o);s(this,"makeSendBtcCallParams",async e=>{let{preDataForSendBtc:o}=this.swapStore.rootStore.walletContractStore;if(!o)throw Error("preDataForSendBtc is not ready");let{satBytes:r,coinAmount:i,dustSize:n,fetchUtxoList:c,serviceCharge:d}=o,m=await c();return{...e,utxoList:m,satBytes:r,dustSize:n,coinAmount:i,serviceCharge:d}});s(this,"formatContractPayload",()=>{});s(this,"formatTransferPayload",async()=>{let{orderData:e}=this;return this.swapStore.transferBtcPayload(e.callData)});s(this,"extendExtParams",e=>({...e,extParams:this.extParams}));s(this,"getSendTransactionParams",async()=>{if(!this.token.isNativeToken)throw new Error("btc token is not native token");let e;if(this.isTransferType){let o=await this.formatTransferPayload();e=this.extendExtParams(o),nt()&&(e=await this.makeSendBtcCallParams(e))}else throw Error("Not support contract call");return this.differentiatedEnvironment([e])});s(this,"preExecution",async()=>{if(!this.token.isNativeToken)throw new Error("btc token is not native token");let e;if(this.isTransferType)e=await this.formatTransferPayload();else throw Error("Not support contract call");return{payload:e}});this.token=r}};s(ye,"chainId",V.BTC_MAINNET);u();l();var Dr=class extends Y{constructor(){super(...arguments);s(this,"valueToHex",e=>T.BigNumber(e).toString(16));s(this,"formatContractPayload",()=>{let{orderData:e}=this,{priorityFee:o,maxFeePerGas:r,maxPriorityFeePerGas:i,gasPrice:n,gas:c,...d}=e?.callData||{};return d});s(this,"formatTransferPayload",()=>{let{orderData:e}=this;return e.callData});s(this,"getSendTransactionParams",async()=>{let{payload:e}=await this.preExecution();return ze&&e.value&&(e.value=this.valueToHex(e.value)),this.differentiatedEnvironment([e])});s(this,"preExecution",async()=>{let e;this.isTransferType?e=this.formatTransferPayload():e=this.formatContractPayload();let{extendEvmParams:o,extendsGas:r}=this.swapStore;return e.extParams=this.extParams,r&&(e=r(e)),e=o(e),{payload:e}})}};s(Dr,"chainId",V.ETHEREUM_MAINNET);var Fr=Dr;u();l();O();var _e=class extends Y{constructor(){super(...arguments);s(this,"importSolana",async()=>{let e=await import("./index.browser.esm-A2U2QTD6.js"),{default:o}=await import("./bs58-YIXA3S7N.js");return{SolanaWeb3:e,bs58:o}});s(this,"deserialize",async e=>{let o,{SolanaWeb3:r,bs58:i}=await this.importSolana();try{o=r.Transaction.from(i.decode(e))}catch{o=r.VersionedTransaction.deserialize(i.decode(e))}return o});s(this,"rentReserve",e=>{if(!e)return"0";let{BigNumber:o}=T,r=o("365.25").div(2).multipliedBy(2);return o("19.055441478439427").multipliedBy(e).multipliedBy(r).div(10**9).toFixed(9)});s(this,"formatContractPayload",async()=>{let{orderData:e}=this;return this.txData(e.unsignedTx)});s(this,"txData",async e=>{let o;Ho(e)?o=JSON.parse(e):o=e;let{data:r,accountLength:i,bizType:n,bizId:c,from:d,to:m}=o,p=await this.deserialize(r),f=this.rentReserve(i);return{payload:{bizType:n,bizId:c,transaction:p},inputData:r,from:d,to:m,rent:f}});s(this,"formatTransferPayload",async()=>{let{orderData:e}=this,{unsignedTx:o}=e;return this.txData(o)});s(this,"getSendTransactionParams",async()=>{let{payload:e}=await this.preExecution();return this.differentiatedEnvironment([e,this.extParams])});s(this,"preExecution",async()=>{let e;return this.isTransferType?e=await this.formatTransferPayload():e=await this.formatContractPayload(),e});s(this,"getTxData",()=>{let{jitoData:e,jitoEnable:o=!1,unsignedTx:r}=this.orderData||{};try{if(o){let{jitoUnsignedTx:i}=e;return JSON.parse(i).array}return[JSON.parse(r)]}catch(i){throw new Error(i)}});s(this,"jitoTransaction",async()=>{let e=this.getTxData();try{return Promise.all(e.map(this.txData))}catch(o){throw new Error(o)}})}};s(_e,"chainId",V.SOLANA_MAINNET);u();l();var Ee=class extends Y{constructor(){super(...arguments);s(this,"formatContractPayload",()=>{let{orderData:e}=this,{data:o,from:r}=e.callData,i=JSON.parse(o);return{...i,functionArgs:i.functionArgsEncode,txType:"contract_call",stxAddress:r}});s(this,"formatTransferPayload",()=>{});s(this,"getSendTransactionParams",async()=>this.differentiatedEnvironment([this.formatContractPayload(),this.extParams]));s(this,"preExecution",async()=>({payload:this.formatContractPayload()}))}};s(Ee,"chainId",V.STACKS_MAINNET);u();l();var ke=class extends Y{constructor(){super(...arguments);s(this,"walletNoNeedExtParams",!0);s(this,"formatContractPayload",()=>{let{orderData:e}=this,o=JSON.parse(e.unsignedTx),{executionRequest:r}=JSON.parse(o.data);return r.calls});s(this,"formatTransferPayload",()=>{});s(this,"getSendTransactionParams",async()=>this.differentiatedEnvironment([this.formatContractPayload()]));s(this,"preExecution",()=>({payload:this.formatContractPayload()}))}};s(ke,"chainId",V.STARKNET_MAINNET);u();l();var xr=class extends Y{constructor(){super(...arguments);s(this,"formatContractPayload",()=>{let{orderData:e}=this,{txBytes:o}=JSON.parse(e.unsignedTx);return{transactionBlock:o}});s(this,"getSendTransactionParams",async()=>this.differentiatedEnvironment([this.formatContractPayload(),this.extParams]));s(this,"preExecution",async()=>({payload:this.formatContractPayload()}))}};s(xr,"chainId",V.SUI_MAINNET);var Xs=xr;u();l();var Mr=class extends Y{constructor(){super(...arguments);s(this,"walletNoNeedExtParams",!0);s(this,"formatContractPayload",()=>{let{orderData:e}=this,{params:o}=JSON.parse(e.unsignedTx);return o});s(this,"formatTransferPayload",()=>{let{orderData:e}=this,{params:o}=JSON.parse(e.unsignedTx);return o});s(this,"getSendTransactionParams",async()=>{let e=this.isTransferType?this.formatTransferPayload():this.formatContractPayload();return this.differentiatedEnvironment([e,this.extParams])});s(this,"preExecution",async()=>({payload:this.isTransferType?this.formatTransferPayload():this.formatContractPayload()}))}};s(Mr,"chainId",V.TON_MAINNET);var zs=Mr;u();l();var Re=class extends Y{constructor(){super(...arguments);s(this,"formatContractPayload",()=>{let{orderData:e}=this;return JSON.parse(e.unsignedTx)});s(this,"formatTransferPayload",()=>{});s(this,"getSendTransactionParams",async()=>{let e=this.formatContractPayload();return this.differentiatedEnvironment([{...e,extParams:this.extParams}])});s(this,"preExecution",async()=>({payload:this.formatContractPayload()}))}};s(Re,"chainId",V.TRON_MAINNET);var gm={[ye.chainId]:ye,[Fr.chainId]:Fr,[_e.chainId]:_e,[Ae.chainId]:Ae,[Xs.chainId]:Xs,[Re.chainId]:Re,[Ee.chainId]:Ee,[ke.chainId]:ke,[zs.chainId]:zs},Tm=a=>gm[a]||Fr,Im=(a,t,e)=>{let{chainId:o}=a,r=Tm(o);return new r(t,e,a)},wo=Im;u();l();var Js=a=>{let t=0;return a.forEach(e=>{t=T.add(t,e.rent,{returnString:!0})}),t},Cm=a=>{let t=a[0];return{fromAdr:t.from,toAdr:t.to,inputData:t.inputData}},Am=({walletId:a,walletTxDataList:t,swapParams:e,txArray:o,enableJito:r})=>{let i=o.length>1,n=[],c=[];t.forEach(C=>{n.push(C.signedTx),c.push(C.txHash)});let d="";i?d=JSON.stringify(n):d=n[0];let m=c[0],p=i?{mev:"Jito",jitoHash:c[1]}:{},f=Cm(o),g=Js(o);return{updateMultiOrderInfo:{transactionHash:m,walletTxData:{extJson:JSON.stringify({...p,rent:g,txSource:3,feeType:4,multiTag:0,isMainTx:!1,coinAmount:0,serviceCharge:0,signedTx:i?JSON.parse(d):d}),isMainTx:!1,serviceCharge:0,txHash:m,walletId:a,txSource:3,coinAmount:0,walletType:2,signedTx:d,...f}},dexMultiMetaSaveOrderParam:{...e,enableJito:r}}},bl=async({signedTransactions:a,swapParams:t,walletId:e,txArray:o,enableJito:r})=>{let{default:i}=await import("./bs58-YIXA3S7N.js"),n=a.map(d=>{let m=d?.signature||d?.signatures[0],p=i.encode(m),f=i.encode(d.serialize());return{txHash:p,signedTx:f}}),c=Am({walletId:e,walletTxDataList:n,swapParams:t,txArray:o,enableJito:r});return y.post(rc,c)};u();l();function ym({selector:a}){let t=document.querySelector(a);t&&t.scrollTo({top:0,behavior:"smooth"})}var Br=ym;var Ll=20,ie={CONFIRM:"confirm",UPDATE:"update",FILL_UP:"fill_up",SNAP_UPDATE:"snap_update"},Zs=class{constructor(t){s(this,"quoteData",null);s(this,"preDataForSendBtc",null);s(this,"setPreDataForSendBtc",t=>{this.preDataForSendBtc=t});s(this,"setQuoteData",t=>{this.quoteData=t});s(this,"quoteParams",()=>{let{accountStore:t,fromToStore:e,receiveAddressStore:o}=this.rootStore,i={...vt(),userWalletAddress:t.address};return e.computedDiffCrossChain&&(i.receiveWalletAddress=o.receiveAddrObj?.specifiedAddress),i});s(this,"updating",!1);s(this,"updateQuoteData",async()=>{let{quoteStore:{quote:t},swapStore:e}=this.rootStore,o=this.rootStore?.quoteStore?.quote?.bestRoute?.defiPlatformId;this.updating=!0;let i={...vt(),bridgeId:t?.bestRoute?.bridge?.bridgeId,...o&&{defiPlatformId:o}},n=await e.extendSignParams(i),[c,d]=await R(y.post(`${Qa}`,n));if(this.updating=!1,Br({selector:"#wallet_scroll"}),c){D.error({title:c?.data?.msg||h("swaptrade_top_notif_data_failed")});return}let{callDataResult:m,quoteResult:p}=d?.data||{};if(this.rootStore.quoteStore.handleUpdateQuote({data:p}),m){let f=await this.getPreExecutionPayload(m);pt(()=>{this.transactionPayload=f})}this.initCountDown(),this.startCountdown()});s(this,"updateBridgeGetIntentQuoteCallData",async()=>{let t=Rl();this.updating=!0;let[e,o]=await R(y.get(Ja,{params:{...t}}));if(this.updating=!1,Br({selector:"#wallet_scroll"}),e){D.error({title:e?.data?.msg||h("swaptrade_trading_mode_error_no_update")});return}let{quoteResult:r}=o?.data||{};r&&this.rootStore.quoteStore.handleUpdateQuote({data:r}),this.initCountDown(),this.startCountdown()});s(this,"updateSnapQuoteData",async()=>{let t=vt(),e=this.rootStore?.quoteStore?.quote?.bestRoute?.defiPlatformId;this.updating=!0;let[o,r]=await R(y.get(Xa,{params:{defiPlatformId:e,...t}}));if(this.updating=!1,Br({selector:"#wallet_scroll"}),o){D.error({title:o?.data?.msg||h("swaptrade_trading_mode_error_no_update")});return}let{quoteResult:i}=r?.data||{};i&&this.rootStore.quoteStore.handleUpdateQuote({data:i}),this.initCountDown(),this.startCountdown()});s(this,"timer",null);s(this,"countdown",Ll);s(this,"initCountDown",()=>{this.countdown=Ll});s(this,"startCountdown",()=>{this.timer=setTimeout(()=>{let t=this.countdown;if(t===0){this.clearTimer();return}this.countdown=t-1,this.startCountdown()},1e3)});s(this,"clearTimer",()=>{this.timer&&clearTimeout(this.timer)});s(this,"initGasInfo",()=>({gasType:"normal",gasLimit:"0",gasPrice:"0",maxFeePerGas:"0",maxPriorityFeePerGas:"0",supportEip1559:!1,isNetworkFeeLoading:!0,isGasLimitLoading:!0}));s(this,"gasInfo",this.initGasInfo());s(this,"setGasInfo",t=>{this.gasInfo=t});s(this,"gasFee",0);s(this,"setGasFee",t=>{this.gasFee=t});s(this,"orderInfo",{});s(this,"transactionPayload",null);s(this,"solonaRent","");s(this,"getPreExecutionPayload",async(t,e)=>{let{swapStore:o,quoteStore:r}=this.rootStore,i=r?.quote?.bestRoute||{},{fromToken:n}=i,c=wo(n,{orderData:t},o);if(e){let p=await c.jitoTransaction();return this.solonaRent=Js(p),p}let{payload:d,rent:m}=await c.preExecution();return n.chainId===V.SOLANA_MAINNET&&m&&(this.solonaRent=m),d});s(this,"setTransactionPayload",t=>{this.transactionPayload=t});s(this,"fetchCallData",async()=>{let{swapStore:t}=this.rootStore||{};t.setCalldataSign(null);let e=t.saveOrderParams(),o=await t.extendSignParams(e);if(!o)return!1;let r=t.isSwapSolana(o.chainId),i,n;if(r){let d=t.extendSolanaCalldata(o);[i,n]=await t.getSolanaCalldata(d)}else[i,n]=await R(y.post(mr,o));if(i){let d=[90002,10009,50028].includes(Number(i?.code))?i?.error_message:i?.data?.msg;return D.error({title:d||h("swaptrade_top_notif_data_failed")}),!0}let c=await this.getPreExecutionPayload(n?.data||{},r);return this.transactionPayload=c,!1});s(this,"nativeCoin",null);s(this,"setNativeCoin",t=>{this.nativeCoin={...t}});s(this,"calcNativeCoinAmount",()=>{let{coinAmountInt:t,decimals:e}=this.nativeCoin,{from:o,computedIsFromBtcCoin:r}=this.rootStore.fromToStore;return T.BigNumber(r?o.availableBalance:Ke(t,e))});s(this,"calcNativeCoinAmountChange",()=>{let t;if(this.type===kt.SWAP){let{fromToStore:o}=this.rootStore;t=o.from}else{let{fromToken:o,fromTokenAmount:r}=this.rootStore.facetStore.facetOrderDetail;t={...o,amount:r}}let e=T.BigNumber(this.gasFee).isNaN()?"0":this.gasFee;return t.isNativeToken?T.BigNumber(t.amount).plus(e):T.BigNumber(e)});s(this,"gasFeeLoading",!0);s(this,"setGasFeeLoading",t=>{this.gasFeeLoading=t});s(this,"gasLimitError",null);s(this,"setGasLimitError",t=>{this.gasLimitError=t});s(this,"activityId",null);s(this,"setActivityId",t=>{this.activityId=t});s(this,"type",kt.SWAP);s(this,"setSwapType",t=>{this.type=t});s(this,"reset",()=>{this.gasInfo=this.initGasInfo(),this.setGasFeeLoading(!1),this.nativeCoin=null,this.transactionPayload=null,this.gasFee=0,this.setGasLimitError(null),this.setStarknetRegisterStatus(""),this.setVisibleStarknetRegister(!1),this.setActivityId(null),this.setSwapType(kt.SWAP),this.clearTimer(),this.solonaRent=""});s(this,"starknetRegisterStatus","");s(this,"setStarknetRegisterStatus",t=>{this.starknetRegisterStatus=t});s(this,"visibleStarknetRegister",!1);s(this,"setVisibleStarknetRegister",t=>{this.visibleStarknetRegister=t});s(this,"onSwap",()=>{Ye({...ct(),button_name:"confirm"}),this.rootStore.swapStore.onSwap()});s(this,"onRedeem",()=>{this.rootStore.facetStore.walletSendRedeem()});s(this,"onIntentSwap",()=>{this.rootStore.intentSwapStore.onIntentSwap()});s(this,"confirmSwapMap",{[kt.SWAP]:this.onSwap,[kt.REDEEM]:this.onRedeem,[kt.INTENT_SWAP]:this.onIntentSwap});s(this,"onConfirm",t=>{this.confirmSwapMap[t]?.()});s(this,"getBtnProps",t=>{let{fromToStore:e,quoteStore:o}=this.rootStore,r=o?.computedIsOfflineType,{symbol:i,coinId:n,chainId:c}=this.nativeCoin||{};return{[ie.CONFIRM]:{disabled:this.computedConfirmBtnDisabled,onClick:m=>{this.onConfirm(m)},text:h("swaptrade_card_swap_btn_confirm_swap"),loading:this.computedIsConfirming},[ie.UPDATE]:{onClick:()=>{Ye({...ct(),button_name:"update"}),this.updateQuoteData().catch(()=>{})},loading:this.updating,text:h("swaptrade_confirmswap_btn_update_price")},[ie.SNAP_UPDATE]:{onClick:()=>{Ye({...ct(),button_name:"update"}),r?this.updateBridgeGetIntentQuoteCallData().catch(()=>{}):this.updateSnapQuoteData().catch(()=>{})},loading:this.updating,text:h("swaptrade_confirmswap_btn_update_price")},[ie.FILL_UP]:{onClick:()=>{Ic({wallet_address:this.rootStore.accountStore.address,button_name:"fill_up"}),e.baseAddFunds({coinId:n,chainId:c,receiveOnly:!1})},text:h("swaptrade_dialog_btn_supplement",{token:i})}}[t]});U(this),this.rootStore=t}get computedFormatTime(){return cc(this.countdown)}get computedPriceUpdate(){return this.countdown===0}get computedIsSufficientGas(){if(!this.nativeCoin)return!0;let t=this.calcNativeCoinAmount(),e=this.calcNativeCoinAmountChange();return t.gte(e)}get computedSolonaNativeTokenSufficientRent(){let{quoteStore:t}=this.rootStore,e=t?.quote?.bestRoute||{},{fromToken:o}=e||{};if(o?.chainId!==V.SOLANA_MAINNET||!this.nativeCoin||!this.solonaRent)return!0;let r=this.calcNativeCoinAmount(),i=this.calcNativeCoinAmountChange();return r.gte(i.plus(this.solonaRent))}get walletSendParams(){let{toLocale:t,dispatch:e}=b;return!t||!e?null:{t,dispatch:e}}get computedIsIntentSwap(){return this.rootStore?.quoteStore?.computedIsOfflineType}get computedConfirmBtnDisabled(){let{RegisterLocalStatusEnum:t}=b.global,{computedIsStarknetChain:e,computedIsFromBtcCoin:o,computedIsEvmChain:r}=this.rootStore.fromToStore;if(this.computedIsIntentSwap)return!1;if(e&&this.starknetRegisterStatus!==t?.COMPLETED)return!0;let i=this.computedPriceUpdate||!this.computedIsSufficientGas||!this.computedSolonaNativeTokenSufficientRent||this.gasFeeLoading||this.gasLimitError;return o||!r?i:i||this.gasInfo?.isGasLimitLoading||this.gasInfo?.gasLimitInfo?.queryGasLimitErrorUseDefault}get computedIsConfirming(){let{swapStore:t,intentSwapStore:e}=this.rootStore;return this.computedIsIntentSwap?!!e.isConfirmLoading:t.isConfirmLoading}get computedBtnProps(){let t=ie.CONFIRM;return!this.computedIsSufficientGas||!this.computedSolonaNativeTokenSufficientRent?t=ie.FILL_UP:this.computedPriceUpdate&&(t=this.computedIsIntentSwap?ie.SNAP_UPDATE:ie.UPDATE),this.getBtnProps(t)}get computedMonitorGasType(){return this.gasInfo?.gasType?{network_fee_details:{gas_level:this.gasInfo?.gasType}}:{}}},Ur=Zs;u();l();O();u();l();O();O();F();u();l();O();O();var vl=(a,t)=>a.filter(({networks:e})=>e.findIndex(r=>r.name===t)>-1),Pl=(a,t)=>a.filter(({account:e})=>e[t]),Ol=({recentAddrData:a,addressBookData:t,walletListData:e,chainName:o})=>{let r=[];if(a.length>0){let i=a.map(({specifiedAddress:n,...c})=>({specifiedAddress:n,...c}));r.push({group:h("swaptrade_extension_wallet_address_recent_address"),list:i})}if(t.length>0){let i=t.map(n=>({...n,specifiedAddress:n.address}));r.push({group:h("swaptrade_extension_wallet_address_connected_wallets"),list:i})}if(e.length){let i=e.map(c=>({specifiedAddress:c.account[o],group:c.keyringName,name:c.walletName,walletId:c.walletId}));Object.entries(vi(i,"group")).forEach(([c,d])=>{r.push({group:c,list:d})})}return r},wl=a=>String(I(a,"isLeveraged"))==="1",Nl=(a,t)=>{let e=[null,null];return wl(a)&&(e[0]=a),wl(t)&&(e[1]=t),e};var{BigNumber:$}=T,vo=class{constructor(t){s(this,"defaultToken",{amount:"",prevAmount:"",balance:"",logoURI:"",coinId:"",decimals:"",usdPrice:"",tokenName:"",baseCoinId:"",tokenSymbol:"",tokenLogoUrl:"",isNativeToken:0,tokenContractAddress:"",isSafeMoonToken:"",isHoneypot:"",buyTaxes:"0",sellTaxes:"0",reverseReceiveAmount:"",chainId:""});s(this,"from",{...this.defaultToken,amount:"1"});s(this,"to",this.defaultToken);s(this,"fromBalanceState",st.BALANCE_NOT_SHOW);s(this,"toBalanceState",st.BALANCE_NOT_SHOW);s(this,"fromBalanceRequestError",!1);s(this,"toBalanceRequestError",!1);s(this,"isBalanceLoading",!1);s(this,"visibleAddFunds",!1);s(this,"setFrom",t=>{this.from=t});s(this,"setTo",t=>{this.to=t});s(this,"maxDialogType",fo.enough);s(this,"setMaxDialogType",t=>{this.maxDialogType=t});s(this,"checkMaxDialogTypeIsEnough",t=>fo.enough===t);s(this,"typedValue","");s(this,"fromMax",!1);s(this,"independentField",A.FROM);s(this,"singleTypedValue","");s(this,"singleFromMax",!1);s(this,"advanceSetTypedValue",(t="",e=!1,o="")=>{(o||this.commonStore.currentTab)===E.SWAP?(this.singleTypedValue=t,this.singleFromMax=e):this.setTypeInput(t,e)});s(this,"needCrossChainDoubleConfirm",!1);s(this,"setNeedCrossChainDoubleConfirm",t=>{this.needCrossChainDoubleConfirm=t});s(this,"updateBtcFromBalance",async()=>this.computedIsFromBtcCoin?(await this.getTokenBalanceByAccount(A.FROM,B(this.from)),!this.fromBalanceRequestError):!this.fromBalanceRequestError);s(this,"onClickMax",async()=>{Sc({button_name:"max"});let{isNativeToken:t}=this.from;this.setField(A.FROM);let e="",o="";if(t===1){let[r,i]=await Promise.all([this.rootStore.quoteStore.fetchGasTokenFee(),this.updateBtcFromBalance()]);if(!i)return;let{balance:n,availableBalance:c}=this.from,d=(this.computedIsFromBtcCoin?c:n)||"0";if(r===-1)return;o=$(d).minus(r);let m=o.isNegative();this.setMaxDialogType(m?fo.insufficient:fo.enough),m&&this.setShowAddFund(!0),this.showMaxDialog(),this.setShowMaxIcon(!0),e=m?"":o.toString()}else e=this.from.balance;this.advanceSetTypedValue(e,!0)});s(this,"setTypeInput",(t,e)=>{this.typedValue=t,this.fromMax=!!e});s(this,"setField",t=>{this.independentField=t});s(this,"quoteUpdateFromTo",t=>{let{receiveAmount:e="",fromTokenPrice:o="",toTokenPrice:r="",payAmount:i="",inputToTokenPrice:n=""}=t||{};!this.computedIsExactIn&&e?(this.from.amount=i,this.to.amount=this.computedTypedValue,this.to.prevAmount=this.computedTypedValue,this.from.currentTime=new Date().getTime(),this.to.usdPrice=n):this.computedIsExactIn&&(this.from.amount=this.computedTypedValue,this.to.amount=e,this.from.prevAmount=this.computedTypedValue,this.to.currentTime=new Date().getTime(),this.to.usdPrice=r),this.to.reverseReceiveAmount=e,this.from.usdPrice=o});s(this,"checkAndGetTokenInfo",async({chainId:t,tokenContractAddress:e})=>{let[o,r]=await this.getTokenInfoAndBalance(t,e);return o?null:r.data});s(this,"getDexMultiDefaultTokenInfo",t=>{let{chainList:e}=this.commonStore,o=B(e).find(r=>Number(r.chainId)===Number(t??To))||{};return{fromDexMultiTokenInfoVO:{...o.dexDefaultFromToTokenShowVO?.fromDexMultiTokenInfoVO,reserveGas:o.reserveGas},toDexMultiTokenInfoVO:o.dexDefaultFromToTokenShowVO?.toDexMultiTokenInfoVO||{}}});s(this,"addressReplaceSymbol",t=>{let{fromDexMultiTokenInfoVO:e}=this.getDexMultiDefaultTokenInfo(t.chainId),{tokenSymbol:o,isNativeToken:r}=e;return r&&this.commonStore.getTokenAddress(t)===this.commonStore.getTokenAddress(e)?o:t?.tokenContractAddress});s(this,"symbolReplaceAddress",t=>this.tokenReplaceMainToken(t).tokenContractAddress);s(this,"validTokens",{});s(this,"fetchTokenInfo",async t=>{if(t.tokenContractAddress){let e=await this.checkAndGetTokenInfo(t);if(e?.tokenContractAddress){let r={...e,balance:e.amountNum,amount:t.amount||""},i=`${e.chainId}_${this.commonStore.getTokenAddress(e)}`;return this.validTokens[i]=!0,r}let o=`${t.chainId}_${this.commonStore.getTokenAddress(t)}`;return this.validTokens[o]=t.tokenContractAddress==la,null}return null});s(this,"checkQueryToken",async(t,e=!0)=>{if(!j(t.chainId))return null;let o=t;if(kc(this.commonStore.chainList,Number(t.chainId))){let{from:i}=this.getInitializedValue(t.chainId);if(this.commonStore.getTokenAddress(t)===this.commonStore.getTokenAddress(i)&&e){let c=`${i?.chainId}_${this.commonStore.getTokenAddress(i)}`;return this.validTokens[c]=!0,i}let n=await this.fetchTokenInfo({chainId:Number(t.chainId),tokenContractAddress:t.tokenContractAddress});e?o=n||i:o=n}else o=null;return o});s(this,"updateFrom",t=>{(!this.commonStore.equalsToken(t,this.from)||this.from.balance!==t.balance)&&(this.setShowMaxIcon(!1),this.setShowAddFund(!1)),this.from={...B(this.from),...t}});s(this,"updateFromAmount",t=>{this.from.amount=t,t||(this.from.usdPrice="0"),this.from.prevAmount||(this.from.prevAmount=t)});s(this,"updateTo",t=>{this.to={...B(this.to),...t}});s(this,"hideMaxDialog",!!v.get(vs));s(this,"hideMaxDialogLessGas",!!v.get(Ps));s(this,"setStorageShowMaxDialog",t=>{if(t){let e=this.checkMaxDialogTypeIsEnough(this.maxDialogType);v.set(e?vs:Ps,"1"),e?this.hideMaxDialog=!0:this.hideMaxDialogLessGas=!0}this.visibleMaxDialog=!1});s(this,"visibleMaxDialog",!1);s(this,"showMaxDialog",()=>{let t=this.checkMaxDialogTypeIsEnough(this.maxDialogType);t&&this.hideMaxDialog||!t&&this.hideMaxDialogLessGas||(this.visibleMaxDialog=!0)});s(this,"showMaxIcon",!1);s(this,"setShowMaxIcon",t=>{this.showMaxIcon=t});s(this,"showAddFund",!1);s(this,"setShowAddFund",t=>{this.showAddFund=t});s(this,"setFromBalanceRequestError",t=>{this.fromBalanceRequestError=t});s(this,"setToBalanceRequestError",t=>{this.toBalanceRequestError=t});s(this,"resetBalanceState",()=>{this.setShowMaxIcon(!1),this.setShowAddFund(!1),[this.fromBalanceRequestError,this.toBalanceRequestError]=[this.toBalanceRequestError,this.fromBalanceRequestError]});s(this,"onSwitchFromTo",async()=>{if(!this.isBalanceLoading){this.rootStore.quoteStore.quoteScope=null;let[t,e]=[B(this.from),B(this.to)];this.resetBalanceState();let o={amount:this.computedTypedValue??"",prevAmount:this.computedTypedValue??"",usdPrice:""},r={amount:"",prevAmount:"",usdPrice:""};this.setNeedCrossChainDoubleConfirm(!0),this.setField(A.FROM),this.computedIsSingleChain?this.setFrom({...e,...o}):(this.rootStore.quoteStore.setQuoteNumber(this.computedTypedValue?0:2),this.setFrom({...e,amount:e.amount||"",prevAmount:e.amount||"",usdPrice:""})),this.setTo({...t,...r}),this.advanceSetTypedValue(e.amount),this.rootStore.receiveAddressStore.clearReceiveAddressValue()}});s(this,"getChainInfo",t=>{let{chainList:e}=this.commonStore;return B(e).find(r=>Number(r.chainId)===Number(t))||{}});s(this,"getInitializedValue",(t=To)=>{let e=this.getChainInfo(t),{fromDexMultiTokenInfoVO:o,toDexMultiTokenInfoVO:r}=e?.dexDefaultFromToTokenShowVO||{fromDexMultiTokenInfoVO:{},toDexMultiTokenInfoVO:{}},i={...B(o),balance:"",reserveGas:e?.reserveGas},n={...B(r),balance:""};return{from:i,to:n}});s(this,"resetFromTo",async t=>{let{chainList:e,currentTab:o}=this.commonStore,r=o===E.BRIDGE;if(Number(t)!==Number(this.from.chainId)){let i=B(e).find(p=>Number(p.chainId)===Number(t)),{fromDexMultiTokenInfoVO:n,toDexMultiTokenInfoVO:c,toCrossDexMultiTokenInfoVO:d}=i?.dexDefaultFromToTokenShowVO||{fromDexMultiTokenInfoVO:{},toDexMultiTokenInfoVO:{}};this.from={...B(n),balance:"",reserveGas:i?.reserveGas};let m=r&&d||c;this.to={...B(m),balance:""}}});s(this,"clearFromTo",()=>{this.from={},this.to={}});s(this,"updateBalanceIfNativeToken",(t,e)=>{e.isNativeToken?this.getTokenBalanceByAccount(t,e,!1).catch(Wo):(this.setFromBalanceRequestError(!1),this.setBalance(t,e.amountNum))});s(this,"getSwapTokenBalance",(t=!1)=>{this.getTokenBalanceByAccount(A.FROM,B(this.from),t).catch(()=>{}),this.getTokenBalanceByAccount(A.TO,B(this.to),t).catch(()=>{})});s(this,"getTokenInfoAndBalance",async(t,e)=>{let o=this.accountStore.getAddressByChainId(t),r={chainId:t,tokenAddress:e,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,userWalletAddress:o,businessType:this.commonStore.computedCurrentTabIsLimit?ws.LIMIT_ORDER:ws.SWAP_ORDER};return R(y.get(wa,{params:r}))});s(this,"needBalanceLoading",!0);s(this,"setNeedBalanceLoading",t=>{this.needBalanceLoading=t});s(this,"getTokenBalanceByAccount",async(t,e,o=!1)=>{let r=t===A.FROM,{chainId:i,tokenContractAddress:n}=e;if(j(i)&&n&&this.accountStore.computedAccountId){this.needBalanceLoading&&(this.isBalanceLoading=!0);let c=await this.getTokenInfoAndBalance(i,n);if(this.isBalanceLoading=!1,this.setNeedBalanceLoading(!0),!this.commonStore.equalsToken(e,r?this.from:this.to))return;if(c[0]){if(o){this.fromBalanceRequestError=!1,this.toBalanceRequestError=!1;return}r?(this.fromBalanceRequestError=!0,this.fromBalanceState=st.BALANCE_REQUEST_FAILED):(this.toBalanceRequestError=!0,this.toBalanceState=st.BALANCE_REQUEST_FAILED),this.setBalance(t,"0","0","0");return}r?this.fromBalanceRequestError=!1:this.toBalanceRequestError=!1;let{amountNum:d,availableAmountNum:m,currencyAmount:p}=c[1]?.data||{};this.setBalance(t,d,m,p)}});s(this,"setBalance",(t,e="",o="",r="")=>{let i=t===A.TO,n={balance:e,availableBalance:o,currencyAmount:r};i?this.updateTo({...this.to,...n}):this.updateFrom({...this.from,...n})});s(this,"setBalanceState",t=>{let{amount:e,address:o,from:r,to:i}=t;Boolean(o)&&Boolean(r.tokenContractAddress)?this.fromBalanceRequestError===!0?this.fromBalanceState=st.BALANCE_REQUEST_FAILED:$(r.balance||"0").lt(e||"0")?this.fromBalanceState=st.BALANCE_INSUFFICIENT:this.fromBalanceState=st.COMMON:this.fromBalanceState=st.BALANCE_NOT_SHOW,!(Boolean(o)&&Boolean(i.tokenContractAddress))||!this.computedIsToAddressEqualsCurrentToAddress&&this.computedDiffCrossChain?this.toBalanceState=st.BALANCE_NOT_SHOW:this.toBalanceRequestError===!0?this.toBalanceState=st.BALANCE_REQUEST_FAILED:this.toBalanceState=st.COMMON});s(this,"updateFromBalancePush",t=>{let{coinAmountOriginalDec:e,availableAmountNum:o,currencyAmount:r}=t;this.commonStore.equalsToken(this.from,t)?this.setBalance(A.FROM,e,o,r):this.commonStore.equalsToken(this.to,t)&&this.setBalance(A.TO,e,o,r)});s(this,"tokenReplaceMainToken",t=>{let e=t,{fromDexMultiTokenInfoVO:o}=this.getDexMultiDefaultTokenInfo(t?.chainId),{tokenSymbol:r,chainId:i}=o;return j(t?.chainId)&&t?.tokenContractAddress&&(this.commonStore.getTokenAddress(t)===(this.commonStore.isSensitiveChain(i)?r:Bt(r))||this.commonStore.getTokenAddress(t)===this.commonStore.getTokenAddress(o))&&(e={...o,amount:t.amount}),e});s(this,"onClickAddFunds",()=>{let{tokenSymbol:t,chainName:e}=this.from,{address:o}=this.accountStore,r={currency:t,network:e,address:o};this.getDeposit(r)});s(this,"calOrderUpdateFromTo",t=>{let{fromTokenUsd:e,toTokenUsd:o,fromAmount:r,toAmount:i}=t||{};no(r)||(this.from.amount=r),no(e)||(this.from.usdPrice=e),no(i)||(this.to.amount=i),no(o)||(this.to.usdPrice=o)});s(this,"isEvmChain",t=>j(t)?this.commonStore.getChainByID(t)?.chainType!==zn.NO_EVM_CHAIN:!0);s(this,"isTronChain",t=>t===V.TRON_MAINNET);s(this,"getFormatFromToToken",async({from:t,to:e},o)=>{let[r,i]=await Promise.all([this.checkQueryToken(t,o),this.checkQueryToken(e,o)]),n=r,c=i,d=m=>`${m?.chainId}-${m?.tokenContractAddress}`;if(r){let m=this.getInitializedValue(r?.chainId),p=io(cs([r,i,m.from,m.to],d));n=p[0],c=p[1]}else if(i){let m=this.getInitializedValue(i.chainId),p=io(cs([i,m.from,m.to],d));n=p[1],c=p[0]}return{token1:n,token2:c}});s(this,"orderContinueStatus",ot.DEFAULT);s(this,"setOrderContinueStatus",t=>{this.orderContinueStatus=t});s(this,"fillSwapFromTo",async({apiRequestParams:t,locationParams:e})=>{let{closeModal:o}=this.rootStore.recentTransactionStore;!await this.beforeCheckAndGetTokenInfo(t,e)||(o(),this.setSwapAndLimitTypeValue(e.inputAmount))});s(this,"beforeCheckAndGetTokenInfo",async(t,e)=>{let{orderCheckContinue:o}=this.rootStore.oneMoreOrderStore;if(this.setOrderContinueStatus(ot.LOADING),t&&!await o(t))return this.setOrderContinueStatus(ot.ERROR),!1;let{token1:r,token2:i}=await this.getFormatFromToToken(e,!1);return!r||!i?(D.error({title:h("swaptrade_history_toast_setup_error"),duration:Lt}),this.setOrderContinueStatus(ot.ERROR),!1):(this.setOrderContinueStatus(ot.READY),this.updateFromAndToInfo(r,i),!0)});s(this,"beforeCheckUrl",async t=>{this.setOrderContinueStatus(ot.LOADING);let{orderCheckContinue:e}=this.rootStore.oneMoreOrderStore;return await e(t)?(this.setOrderContinueStatus(ot.READY),!0):(this.setOrderContinueStatus(ot.ERROR),!1)});s(this,"updateFromAndToInfo",(t,e)=>{this.updateFrom(t),this.updateTo(e)});this.rootStore=t,this.accountStore=t.accountStore,this.commonStore=t.commonStore}get computedTypedValue(){return this.commonStore.currentTab===E.SWAP?this.singleTypedValue:this.typedValue}get computedFromMax(){return this.commonStore.currentTab===E.SWAP?this.singleFromMax:this.fromMax}get computedNeedCrossChainDoubleConfirm(){return this.computedIsSingleChain?!1:!this.needCrossChainDoubleConfirm}get dependentField(){return this.independentField===A.FROM?A.TO:A.FROM}get computedIsExactIn(){return this.independentField===A.FROM}get computedIsSingleChain(){return j(this.from.chainId)&&j(this.to.chainId)&&Number(this.from.chainId)===Number(this.to?.chainId)}get computedSwapAmount(){return{[this.independentField]:this.computedFromMax?Se(this.computedTypedValue,{noNeedThousandth:!0}):this.computedTypedValue,[this.dependentField]:this.computedCalAmount[this.dependentField]}}get computedCalAmount(){return{[A.FROM]:Se(this.from?.amount,{noNeedThousandth:!0})??"",[A.TO]:Se(this.to?.amount,{noNeedThousandth:!0})??""}}get computedIfQuote(){return!!(this.computedTypedValueIsValid&&this.from&&this.to)}get computedTypedValueIsValid(){return!$(this.computedTypedValue).isZero()&&!$(this.computedTypedValue).isNaN()}get computedFromAmountIsValid(){let{amount:t}=this.from;return Vt(t)}get computedFromLocalCostByUsd(){let{usdPrice:t}=this.from;if(!this.computedFromAmountIsValid)return"";let{nowCurrencyUnit:e}=this.commonStore,{symbol:o,usdToThisRate:r}=e,i=$(t);if(o&&t&&r&&!i.isNaN()){let c=i.multipliedBy(r).toString();return at(c,o,{needBillionMillionUnit:!1})}return""}get computedToLocalCostByUsd(){let{usdPrice:t}=this.to,{nowCurrencyUnit:e}=this.commonStore,{symbol:o,usdToThisRate:r}=e,i=$(t);if(o&&t&&r&&this.to.amount&&!i.isNaN()&&Vt(this.from.amount)){let c=i.multipliedBy(r).toString();return at(c,o,{needBillionMillionUnit:!1})}return""}get computedRate(){let{from:t,to:e,computedIsExactIn:o}=this,{quoteStore:r,gasDropStore:i}=this.rootStore,n=I(r,"quote.bestRoute.gasDropFromAmount",""),c=n&&i?.gasDropConfig?.gasDrop?$(t?.amount).minus(n):$(t?.amount),d=e?.reverseReceiveAmount&&o||!o&&t?.amount;return c&&d?tt($(e?.reverseReceiveAmount).div(c).toString(10),{needBillionMillionUnit:!1}):""}get computedToFromRate(){let{from:t,to:e,computedIsExactIn:o}=this,{quoteStore:r,gasDropStore:i}=this.rootStore,n=I(r,"quote.bestRoute.gasDropFromAmount",""),c=n&&i?.gasDropConfig?.gasDrop?$(t?.amount).minus(n):$(t?.amount),d=e?.reverseReceiveAmount&&o||!o&&t?.amount;return c&&d?tt($(c).div(e?.reverseReceiveAmount).toString(10),{needBillionMillionUnit:!1}):""}get computedIsToAddressEqualsCurrentToAddress(){let t=this.accountStore.getAddressByChainId(this.to.chainId);return t&&this.rootStore.receiveAddressStore.computedReceiveAddr===t}get computedValueDifference(){let{quoteStore:t}=this.rootStore,{usdPrice:e}=this.from,{usdPrice:o,currentTime:r}=this.to,i=I(t,"quote.bestRoute.gasDropFromAmount",""),n=I(t,"quote.bestRoute.fromTokenAmount",""),c=zt(e),d=Ds(e),m=zt(o),p=Ds(o);if(c||d||m||p)return{isUp:!1,diff:"",isOver:!1,nowTime:new Date().getTime()};let f=i?$(e).div($(n))*$(i):"";e=i?e-f:e;let g=$(o).minus(e).div(e).multipliedBy(100),C=$(g.toFixed(2,1));if(C.gt(-.1)&&C.lt(.1))return null;let P=g.isNegative()?"":"+",w="";return g.gt(100)?w=`>${P}${Ft(100,{needZero:!1})}`:g.lt(-100)?w=`<${P}${Ft(100,{needZero:!1})}`:w=`${P}${Ft(C.toString(10),{needZero:!1})}`,{isUp:g.gte(0),diff:w,isOver:g.lte(-10),currentTime:r,specialValueRangePrompt:g.gt(-10)&&g.lt(10),value:`${$(g.toFixed(2,1)).toString(10).replace(/\+|-/,"")}`}}get computedIsCrossChain(){return j(this.from.chainId)&&j(this.to.chainId)&&Number(this.from.chainId)!==Number(this.to?.chainId)}get computedIsBridge(){let{from:t,to:e}=this;return this.computedIsCrossChain&&t.tokenSymbol===e.tokenSymbol}getDeposit(){}get computedDiffCrossChain(){let t=!!this.accountStore.address,e=this.commonStore.getChainByID(this.from.chainId),o=this.commonStore.getChainByID(this.to.chainId),r=String(this.from.isHoneypot),i=String(this.to.isHoneypot),{computedNonsupportChain:n}=this.accountStore,c=e?.crossChainType||"",d=o?.crossChainType||"";return t&&!n&&r!=="1"&&i!=="1"&&c&&d&&c!==d}get computedMaxTipsText(){let{from:t,maxDialogType:e}=this,{cacheNativeGasFee:o}=this.rootStore.quoteStore;if(!t.isNativeToken||!o||!t.tokenSymbol)return h("wallet_swap_toast_reserve_mainnet_token");let r={value:tt(o),tokenSymbol:t.tokenSymbol};if(this.checkMaxDialogTypeIsEnough(e)){if(this.computedIsFromBtcCoin&&T.gt(this.computedUnavailableBalance,0)){let i=tt(this.computedUnavailableBalance);return h("swaptrade_dialog_pay_card_reserved_from_wallet",{symbol:r.tokenSymbol,value:r.value,unablevalue:i})}return h("swaptrade_dialog_desc_reserved_netfee",r)}return h("swaptrade_dialog_desc_please_reserve",r)}get computedShowAddFund(){let{accountStore:t,swapBtnStore:e}=this.rootStore,{from:o}=this;return!t.computedNonsupportChain&&(this.independentField===A.FROM&&$(this.computedTypedValue||0).gt($(o.balance||0))||e.computedTooBalance)||this.showAddFund&&!this.checkMaxDialogTypeIsEnough(this.maxDialogType)}get computedIsEvmChain(){return this.isEvmChain(this.from.chainId)}get computedDefaultAutoSlippageInfo(){let t=this.commonStore.getChainByID(this.from.chainId);return{autoSlippage:t?.toleranceSlippage?.selectItem,autoTotalSlippage:t?.crossToleranceSlippage?.selectItem}}get computedIsSolanaChain(){return Er(this.from.chainId)}get computedIsAptosChain(){return Hc(this.from.chainId)}get computedIsTronChain(){return _r(this.from.chainId)}get computedIsSuiChain(){return Wc(this.from.chainId)}get computedIsStacksChain(){return Gc(this.from.chainId)}get computedIsStarknetChain(){return Qc(this.from.chainId)}get computedHasToSwap(){let t=I(this.rootStore.quoteStore,"quote.bestRoute.toSwapFeeUsd");return this.computedIsCrossChain&&t>0}setSwapAndLimitTypeValue(t){let{computedCurrentTabIsLimit:e}=this.commonStore,{clearSellAndReceive:o}=this.rootStore?.limitOrderControlStore||{};e?o?.():Vt(t)?(this.setField(A.FROM),this.advanceSetTypedValue(t)):this.advanceSetTypedValue("")}get computedLeverageTokenPair(){return Nl(this.from,this.to)}get computedFormToTokenIsLeverageToken(){let[t,e]=this.computedLeverageTokenPair;return!!t||!!e}get computedIsFromBtcChain(){return Vc(this.from.chainId)}get computedIsFromBtcCoin(){return this.computedIsFromBtcChain&&this.from.isNativeToken}get computedUnavailableBalance(){return $(this.from.balance).minus(this.from.availableBalance).toString()}get computedIsFacetToken(){let{from:t,to:e}=this;return Number(t.tokenType)===Ge.FACET||Number(e.tokenType)===Ge.FACET}get computedNonsupportFacetToken(){let{address:t,walletConfig:{OKXWalletType:e,walletType:o}}=this.accountStore;if(!t)return!1;let r=[Yt.MNEMONIC,Yt.PRIVATE_KEY].includes(e),i=o===ar.METAMASK;return this.computedIsFacetToken&&!(r||i)}};var be=class extends vo{constructor(e){super(e);s(this,"getDeposit",()=>()=>{});s(this,"addFundsParams",{});s(this,"closeAddFunds",()=>{this.visibleAddFunds=!1});s(this,"onClickAddFunds",()=>{let{tokenSymbol:e,chainName:o,tokenLogoUrl:r,chainId:i,isNativeToken:n,tokenContractAddress:c}=this.from;this.visibleAddFunds=!0;let d={currency:e,network:o,iconUrl:r,chainId:i,isNativeToken:n,tokenContractAddress:n?"":c,receiveOnly:!0};this.baseAddFunds(d)});s(this,"baseAddFunds",e=>{this.visibleAddFunds=!0,this.addFundsParams={...e}});s(this,"tokenReplaceMainToken",(e,o)=>{let r=e,i=!gr(e),{fromDexMultiTokenInfoVO:n}=this.getDexMultiDefaultTokenInfo(i?o:e.chainId),{tokenSymbol:c,chainId:d}=n;return!i&&(this.commonStore.getTokenAddress(e)===(this.commonStore.isSensitiveChain(d)?c:Bt(c))||this.commonStore.getTokenAddress(e)===this.commonStore.getTokenAddress(n))&&(r={...n,amount:e.amount}),r});ut(this),_t(()=>{let{computedDiffCrossChain:o,to:r}=this;return{computedDiffCrossChain:o,toChainId:r?.chainId}},({computedDiffCrossChain:o,toChainId:r})=>{this.cacheToChainId!==r&&this.rootStore.receiveAddressStore.saveReceiveAddressValue({}),this.rootStore.receiveAddressStore.setCacheToChainId(o&&r?r:-1)},{equals:jt.shallow})}};u();l();O();u();l();F();var ti=class{constructor(t){s(this,"signIntentSwap",async()=>[]);s(this,"createIntentOrder",async t=>{let e={intentCode:t.offlineType,signature:t.signature,quote:t?.quote,userWalletAddress:this.rootStore?.accountStore?.address,defiPlatformId:t.defiPlatformId},[o,r]=await R(y.post(za,{...e}));return o&&(_.error(N.INTENT_ORDER_CREATE_ERROR,{error:o}),D.error({title:o?.error_message||h("swaptrade_trading_mode_alert_order_fail")})),$e({...ct(),order_id:r?.data?.orderId,wallet_type:this.rootStore?.accountStore.walletConfig?.walletType}),[o,r]});s(this,"bridgeSumbitIntentOrder",async t=>{let{slippageStore:e,quoteStore:o,receiveAddressStore:r,fromToStore:i,accountStore:n}=this.rootStore,{quote:c,computedQuoteAmount:d}=o,{from:m,to:p}=i,{computedMinimumReceived:f,computedRealSlippageValue:g}=e,C=r?.receiveAddrObj?.specifiedAddress,k=g,P=c?.bestRoute?.bridge?.bridgeId,w=n?.address,G={signature:t.signature,quote:t?.quote,defiPlatformId:t.defiPlatformId,receiveWalletAddress:C,fromChainId:m?.chainId,fromTokenAddress:m?.tokenContractAddress,fromAmount:d,toChainId:p.chainId,toTokenAddress:p.tokenContractAddress,toAmount:p.reverseReceiveAmount,walletAddress:w,bridgeId:P,minimumReceived:f,slippage:k},[K,z]=await R(y.post(Za,{...G}));return K&&(_.error(N.INTENT_ORDER_CREATE_ERROR,{error:K}),D.error({title:K?.error_message||h("swaptrade_trading_mode_alert_order_fail")})),$e({...ct(),order_id:z?.data?.orderId,wallet_type:this.rootStore?.accountStore.walletConfig?.walletType}),[K,z]});this.rootStore=t}},Dl=ti;u();l();var Fl=wt(["isConfirmLoading"],[]);var ei=class extends Dl{constructor(e){super(e);s(this,"isConfirmLoading",!1);s(this,"setIsConfirmLoading",e=>{this.isConfirmLoading=e});s(this,"signIntentSwap",async(e,o)=>{let{signTransaction:r}=this.rootStore.sendTransactionStore,[i,n]=await r(o,e);return i&&(_.error(N.INTENT_SWAP_SIGN_ERROR,{error:i,msg:{chainId:e,unsignedTx:o}}),D.error({title:h("swaptrade_trading_mode_alert_order_fail")})),[i,n]});s(this,"onIntentSwap",async()=>{let{quoteStore:e}=this.rootStore;if(e?.computedIsOfflineType){await this.onIntentBridgeOrder();return}await this.onIntentSwapOrder()});s(this,"onIntentSwapOrder",async()=>{this.setIsConfirmLoading(!0),_.keepLive();let{swapStore:e,quoteStore:o}=this.rootStore,r=I(o,"quote.bestRoute.fromToken.chainId");try{let{offlineType:i,calldata:n,defiPlatformId:c}=o?.quote.bestRoute,{quote:d,unsignedTx:m}=n||{};if(!d||!m)return;let[p,f]=await this.signIntentSwap(r,m);if(p)return;let[g,C]=await this.createIntentOrder({quote:d,offlineType:i,signature:f,defiPlatformId:c});if(g)return;e.afterTransaction(C.data?.orderId)}catch(i){_.error(N.INTENT_SWAP_PROCESS_ERROR,{error:i})}finally{this.setIsConfirmLoading(!1),_.removeKeep()}});s(this,"onIntentBridgeOrder",async()=>{this.setIsConfirmLoading(!0),_.keepLive();let{swapStore:e,quoteStore:o}=this.rootStore,r=I(o,"quote.bestRoute.fromToken.chainId");try{let{bridge:i}=o?.quote.bestRoute,{calldata:n,defiPlatformId:c}=i,{quote:d,unsignedTx:m}=n||{};if(!d||!m)return;let[p,f]=await this.signIntentSwap(r,m);if(p)return;let[g,C]=await this.bridgeSumbitIntentOrder({quote:d,signature:f,defiPlatformId:c});if(g)return;e.afterTransaction(C.data?.orderId)}catch(i){_.error(N.INTENT_SWAP_PROCESS_ERROR,{error:i})}finally{this.setIsConfirmLoading(!1),_.removeKeep()}});Et(this,Fl)}},qr=ei;u();l();F();u();l();F();var oi=class{constructor(t){s(this,"receiveAddrStatus",We.NORMAL);s(this,"receiveAddrObj",{});s(this,"saveReceiveAddressValue",t=>{this.receiveAddrObj=this.filterReceiveWalletInfo(t),t?.specifiedAddress||this.initCheckAddrStatus()});s(this,"clearReceiveAddressValue",()=>{this.receiveAddrObj={},this.initCheckAddrStatus(),this.walletAddrInWeb3=[],this.getLinkedWalletAddrInWeb3().catch(()=>{})});s(this,"checkReceiveAddressLoading",!1);s(this,"filterReceiveAddress",(t,e,o=!0)=>{let r=e?.specifiedAddress||this.receiveAddrObj?.specifiedAddress||"";return r?t.filter(({specifiedAddress:i})=>o?i.includes(r):i===r):t});s(this,"filterReceiveWalletInfo",t=>{if(!t.specifiedAddress||t.walletId)return t;let e=this.filterReceiveAddress(this.initWalletAddrListFromChain,t,!1);return e.length?e[0]:t});s(this,"initCheckAddrStatus",()=>{this.checkReceiveAddressLoading=!1,this.receiveAddrStatus=We.NORMAL});s(this,"checkReceiveAddr",async t=>{if(t||this.receiveAddrObj.specifiedAddress){this.checkReceiveAddressLoading=!0;let{to:e}=this.rootStore.fromToStore;try{let o=await Nc(e?.chainId,t||this.computedReceiveAddr),r=Symbol("requestId");if(this.currentRequestId=r,o){let{data:i}=await y.get(Wa,{params:{address:t||this.receiveAddrObj.specifiedAddress,chainId:e?.chainId}});this.currentRequestId===r&&pt(()=>{this.receiveAddrStatus=i.status})}else pt(()=>{this.receiveAddrStatus=We.ILLEGALITY})}catch(o){_.stuff(o),this.receiveAddrStatus=We.ILLEGALITY}finally{this.checkReceiveAddressLoading=!1}}else this.initCheckAddrStatus()});s(this,"getSpecifiedChainWalletList",async t=>{let e=await this.getSpecifiedChainWalletListByWeb3(t),o={};return e?.forEach(r=>{let{specifiedAddress:i,walletType:n,createTime:c}=r,d=n===ar.OKEXCHAIN;o[i]&&o[i]?.has&&d?o[i].walletInfo.createTime<c&&(o[i].walletInfo=r):(!o[i]?.has||d)&&(o[i]={walletInfo:r,has:d})}),Object.keys(o).map(r=>o[r].walletInfo)});s(this,"walletAddrInWeb3",[]);s(this,"getLinkedWalletAddrInWeb3",async()=>{let{computedDiffCrossChain:t,to:e}=this.rootStore.fromToStore,{computedAccountId:o}=this.rootStore.accountStore;if(!t)return;let[r,i]=await R(this.getSpecifiedChainWalletList({chainId:e.chainId,walletIds:[o]}));r||pt(()=>{this.walletAddrInWeb3=i})});s(this,"initWalletAddrListFromChain",[]);s(this,"initWalletAddrListInStorage",[]);s(this,"filterWalletAddrListFromChain",[]);s(this,"filterWalletAddrListInStorage",[]);s(this,"getWalletList",async()=>{let{to:t}=this.rootStore.fromToStore,e=await this.getSpecifiedChainWalletList({chainId:t.chainId});pt(()=>{this.initWalletAddrListFromChain=e,this.filterWalletAddrListFromChain=e;let o=v.get(So);if(o){let r=o[t.chainId]||[];this.initWalletAddrListInStorage=r,this.filterWalletAddrListInStorage=r}})});s(this,"getFilteredAddrList",t=>{this.filterWalletAddrListFromChain=this.filterReceiveAddress(this.initWalletAddrListFromChain,t),this.filterWalletAddrListInStorage=this.filterReceiveAddress(this.initWalletAddrListInStorage,t)});s(this,"saveWalletAddressToStorage",t=>{this.receiveAddrObj?.specifiedAddress&&v.set(So,{[t.chainId]:[this.receiveAddrObj]})});s(this,"formatInputValue",t=>{let{specifiedAddress:e,deriveName:o,label:r}=t;if(e.length<=9)return e;let i=Sr(t.specifiedAddress);return o&&(i=`(${i})`,r?i=`${o} - ${r} ${i}`:i=`${o} ${i}`),i});this.rootStore=t}get computedSwapHighLight(){return this.receiveAddrStatus===We.NORMAL&&!!this.receiveAddrObj?.specifiedAddress}get computedFormatReceiveAddr(){return this.receiveAddrObj?.specifiedAddress?this.formatInputValue(this.receiveAddrObj):""}get computedReceiveAddr(){return this.receiveAddrObj?.specifiedAddress||""}setReceiveAddress(t){this.receiveAddress=t}getReceiveAddress(){return this.receiveAddress}getSpecifiedChainWalletListByWeb3(){}get computedWalletAddrInWeb3(){return this.walletAddrInWeb3.length?this.walletAddrInWeb3[0]:null}get isFromFilterAddress(){let t=this.filterReceiveAddress(this.initWalletAddrListFromChain,this.receiveAddrObj?.specifiedAddress,!1),e=this.filterReceiveAddress(this.initWalletAddrListInStorage,this.receiveAddrObj?.specifiedAddress,!1);return!!(t.length+e.length)&&!!this.receiveAddrObj?.specifiedAddress}},xl=oi;var ri=class extends xl{constructor(e){super(e);s(this,"formatInputValueEx",(e,o)=>{let{keyringName:r,walletName:i}=e;if(o.length<=9)return o;let n=Sr(o);return r&&(n=`(${n})`,i?n=`${r} - ${i} ${n}`:n=`${r} ${n}`),n});s(this,"cacheToChainId",-1);s(this,"setCacheToChainId",e=>{this.cacheToChainId=e});s(this,"addressListEx",[]);s(this,"getWalletListEx",()=>{let{accountStore:e,fromToStore:o}=this.rootStore,r=b.getNetWorkName(o.to.chainId),{walletList:i,addressBookList:n,keyringIdentityTypeEnum:c}=e,m=(v.get(So)||{})[o.to.chainId]||[],p=vl(n,r),f=Pl(i,r);this.addressListEx=Ol({recentAddrData:m,addressBookData:p,walletListData:f,chainName:r,keyringIdentityTypeEnum:c})});ut(this)}get computedFormatReceiveAddrEx(){let{accountStore:e,fromToStore:o}=this.rootStore,{walletConfig:r}=e;if(this.receiveAddrObj.specifiedAddress)return this.formatInputValueEx(this.receiveAddrObj,this.receiveAddrObj.specifiedAddress);let i=b.getNetWorkName(o.to.chainId),n=r?.account[i];return n?(this.receiveAddrObj={...r,specifiedAddress:n},this.formatInputValueEx(r,n)):""}},Vr=ri;u();l();F();u();l();var si=class{constructor(t){s(this,"updateTxHash",t=>(_.info(N.UPDATE_HASH,{...t,tags:{orderId:t.orderId,status:t?.status||1}}),y.post(_a,t).catch(e=>{_.info(N.UPDATE_HASH_ERROR,{...t,error:e,tags:{orderId:t.orderId}})})));s(this,"cancelOrder",t=>(_.info(N.CANCEL_ORDER,{tags:{orderId:t}}),y.get(ja,{params:{id:t}})));this.rootStore=t}},Ml=si;var ii=class extends Ml{constructor(){super(...arguments);s(this,"sendTransaction",async(...e)=>b.global?.signAndSubmitTransaction(...e));s(this,"sendTransactionEnhance",async(...e)=>this.sendTransaction(...e));s(this,"signTransaction",async(e,o)=>{let[r,i]=await R(b.global.signTypedDataV4(o,e));return[r,i]})}},Wr=ii;u();l();O();u();l();F();u();l();O();O();F();var ni=class{constructor(t){s(this,"rootStore");this.rootStore=t}checkZeroValue(){let t=null,o=this.rootStore.quoteStore.quote.bestRoute,{fromTokenPrice:r,toTokenPrice:i,fromToken:n,toToken:c}=o;return!Number(r)&&!Number(i)?t=n.tokenSymbol===c.tokenSymbol?H.ALIKE_TOKEN_SYMBOL_PRICE_UNKNOWN:H.ALL_TOKEN_PRICE_UNKNOWN:Number(r)?Number(i)||(t=H.TO_TOKEN_PRICE_UNKNOWN):t=H.FROM_TOKEN_PRICE_UNKNOWN,{errorType:t,continueToNextInterceptor:!1}}checkValueDifference(){let t=null,{fromToStore:e}=this.rootStore,{computedValueDifference:o,computedIsCrossChain:r}=e;return o?.isOver&&(t=r?H.VALUE_DIFFERENCE_TOO_MUCH_CROSS:H.VALUE_DIFFERENCE_TOO_MUCH),{errorType:t,continueToNextInterceptor:!1}}checkMinReceive(){let t=null,e=this.rootStore.quoteStore,o=this.rootStore.slippageStore;return e?null:(o?.computedMinimumReceivedIsOrange&&(t=H.MIN_RECEIVED_TOO_SMALL),{errorType:t,continueToNextInterceptor:!1})}checkRepeatOrderWithEnoughBalance(){let t=null,{swapCheckStore:e}=this.rootStore,{repeatOrder:o}=e;return o?.enoughFlag===Es.ENOUGH&&(t=H.REPEAT_ORDER),{errorType:t,continueToNextInterceptor:!1}}async checkBlockedRepeatOrder(){let t=null,{swapCheckStore:e}=this.rootStore;await e.checkRepeatOrder();let{repeatOrder:o}=e;return o&&(o.repeatFlag===pe.BTC_REPEAT?t=H.REPEAT_ORDER_BTC:o.repeatFlag===pe.FACET_REPEAT?t=H.REPEAT_ORDER_FACET:o.enoughFlag!==Es.ENOUGH&&(t=H.REPEAT_ORDER_NOT_ENOUGH)),{errorType:t,continueToNextInterceptor:!1}}checkFacetTokenCrossChainDetail(){let{fromToStore:t}=this.rootStore,{from:e,to:o,computedNonsupportFacetToken:r}=t;if(r||v.get(ca))return null;let i=null;return e.tokenType!==o.tokenType&&(Number(e.tokenType)===Ge.FACET||Number(o.tokenType)===Ge.FACET)&&(i=H.FACET_SWAP_TIPS),{errorType:i,continueToNextInterceptor:!1}}checkCrossChain(){let t=null;return this.rootStore.fromToStore.computedNeedCrossChainDoubleConfirm&&!v.get(ta)&&(t=H.CROSS_CHAIN_DOUBLE_CONFIRM),{errorType:t,continueToNextInterceptor:!1}}checkGasMoreThanReceive(){let t=null,{fromToStore:e,quoteStore:o}=this.rootStore,{computedIsCrossChain:r}=e,i=o.quote.bestRoute,{toTokenPrice:n,quoteNetWorkFeeOfMoney:c,fromSwapFeeUsd:d}=i,{BigNumber:m}=T;return(r?new m(d):new m(c)).gte(new m(n))&&(t=H.GAS_MORE_THAN_RECEIVE_VALUE),{errorType:t,continueToNextInterceptor:!1}}checkToSwapThanGasFee(){let t=null,{fromToStore:e,quoteStore:o}=this.rootStore,{computedHasToSwap:r}=e,i=Number(e.to.chainId)===1;if(r&&i){let n=I(o,"quote.bestRoute.toSwapFeeUsd"),c=I(o,"quote.bestRoute.bridge.bridgeAmountOutUsd"),d=I(o,"quote.bestRoute.bridge.toRiskLimit");T.BigNumber(n).dividedBy(c).gte(d)&&(t=H.TO_SWAP_THAN_GAS_FEE)}return{errorType:t,continueToNextInterceptor:!1}}checkVolatilitySlippage(){let t=null,o=this.rootStore.slippageStore.computedVolatilityTips?.swapInterceptorType;return o&&(t=o),{errorType:t,continueToNextInterceptor:!0}}async checkBtcBalance(){let{fromToStore:t,safeMoonStore:e}=this.rootStore,{computedIsFromBtcCoin:o,from:r,updateBtcFromBalance:i}=t;if(o){if(!await i())throw Error("btc balance update failed");let c=e.computedInputVal,d=r.availableBalance;if(T.BigNumber(c).gt(d))return{errorType:H.BTC_AVAILABLE_BALANCE_NOT_ENOUGH,continueToNextInterceptor:!1}}return null}async checkCrossChainSwap(){let{swapCheckStore:t}=this.rootStore;await t.checkCrossChainSwap();let e=t.checkSwapMoreInfo?.errorCode;return Oi(e)&&e!==0?e===4&&v.get(`${rr}_${t.checkSwapMoreInfo?.contentTip?.extra?.bridgeName}_${e}`)||v.get(`${rr}_${e}`)?null:{errorType:H.CHECK_CROSS_MORE,continueToNextInterceptor:!1}:null}async checkThirdPartyProvider(){let{quoteStore:t}=this.rootStore,{computedIsOkxProvider:e}=t,o=v.get(`${rr}_${Zn}`);return!e&&!o?{errorType:H.THIRD_PARTY_PROVIDER,continueToNextInterceptor:!0}:null}async checkBridgeThirdPartyProvider(){let{quoteStore:t}=this.rootStore,{computedBridgeIsOkxProvider:e,computedIsOfflineType:o}=t;return!e&&o?{errorType:H.THIRD_PARTY_PROVIDER,continueToNextInterceptor:!0}:null}makeCheckers(){let{fromToStore:{computedIsCrossChain:t}}=this.rootStore;return t?[this.checkBridgeThirdPartyProvider,this.checkVolatilitySlippage,this.checkCrossChainSwap,this.checkBtcBalance,this.checkZeroValue,this.checkToSwapThanGasFee,this.checkValueDifference,this.checkMinReceive,this.checkGasMoreThanReceive]:[this.checkThirdPartyProvider,this.checkVolatilitySlippage,this.checkBlockedRepeatOrder,this.checkFacetTokenCrossChainDetail,this.checkZeroValue,this.checkRepeatOrderWithEnoughBalance,this.checkValueDifference,this.checkMinReceive,this.checkGasMoreThanReceive]}async check(){let t=[],e=this.makeCheckers();for(let o=0;o<e.length;o++){let r=e[o],{errorType:i,continueToNextInterceptor:n}=await r.call(this)||{};if(i&&(t.push(i),!n))return t}return t}},Bl=ni;u();l();O();var ai=({disabled:a})=>{let{commonStore:t,fromToStore:e,buySellStore:o,quoteStore:r}=M();if(t.portal===It.MARKET)return o.tradeMode==="BUY"?h("swaptrade_market_placeorder_btn_buy_symbol",{symbol:e.to.tokenSymbol}):h("swaptrade_market_placeorder_btn_sell_symbol",{symbol:e.from.tokenSymbol});let i=r.enableQuoteAggregates?I(r,"quote.bestRoute"):null,c=i?$n:a?lt:Ue;return h(e.computedIsSingleChain?c:Xn,{provider:I(i,"name")})},Ul=()=>{let{commonStore:a,buySellStore:t}=M();return a.portal===It.MARKET?t.tradeMode==="BUY"?le.TYPE.green:le.TYPE.red:null},ql=()=>{let{commonStore:a,swapBtnStore:t,swapStore:e}=M();return a.portal===It.MARKET?e.isConfirmLoading:t.swapBtnLoading};var Po=class{constructor(t){s(this,"swapBtnErrorTipsDialog",null);s(this,"swapInterceptor");s(this,"isInterceptionProcessing",!1);s(this,"defaultTipsDialogInfo",()=>({type:"",visible:!1,confirmCallBack:()=>{}}));s(this,"notShowAgainCrossChainConfirm",!1);s(this,"setNotShowAgainCrossChainConfirm",t=>{this.notShowAgainCrossChainConfirm=t});s(this,"tipsDialogInfo",this.defaultTipsDialogInfo());s(this,"swapBtnLoading",!1);s(this,"showErrorTips",(t,e)=>{this.tipsDialogInfo={type:t,visible:!0,confirmCallBack:e},this.setNotShowAgainCrossChainConfirm(!1)});s(this,"closeErrorTipsDialog",()=>{this.swapBtnLoading=!1,this.tipsDialogInfo.visible=!1});s(this,"openConfirmSwapDialog",(t,e)=>{let{swapStore:o}=this,{receiveAddressStore:r}=this.rootStore;r.saveWalletAddressToStorage(e),o.setConfirmSwapVisible(!0)});s(this,"connectWallet",()=>{});s(this,"approve",()=>{});s(this,"cancelApprove",()=>{});s(this,"swap",()=>{});s(this,"clickSwapOnDapp",()=>{let{from:t,to:e,computedIsSingleChain:o}=this.fromToStore,{computedNotThirdBiz:r}=this.commonStore;hr({business_type:o?"swap":"bridge",trade_dialog:r?"no":"yes",from_token_address:t.tokenContractAddress,to_token_address:e.tokenContractAddress,swap_type:o?"discover_swap":"discover_cross_chain_swap",from_chain:t.chainName,to_chain:e.chainName}),this.rootStore.swapDappStore?.fetchDappList()});s(this,"checkDappTrade",()=>{let t=this.rootStore.swapDappStore?.checkShouldJumpToDapp;return typeof t=="function"&&t()?ho:null});s(this,"isQuoting",()=>{let{fromToStore:t,quoteStore:e,slippageStore:o}=this.rootStore,{isFetchQuoting:r,bestRoute:i,quoteError:n,quoteNull:c}=e.quote,{from:d,to:m,computedTypedValue:p}=t,{tokenContractAddress:f}=d,{computedRealSlippageValue:g}=o;return c||!i&&n&&!r||!p||!m.tokenContractAddress||!f||g>50||g<0?lt:null});s(this,"isHoneypot",()=>this.rootStore?.safeMoonStore?.computedHoneypot?lt:null);s(this,"noAmountOrOverLimit",()=>{let{fromToStore:t}=this,{overLimit:e}=this.rootStore?.safeMoonStore?.computedSlippageTips||{},{computedTypedValue:o}=t;return Number(o)===0||e?lt:null});s(this,"hasFeeConfigErrorTips",()=>this.outerStore.computedFeeConfigErrorTips?lt:null);s(this,"uninitializedWalletInfo",()=>{let{accountStore:{hasInitWalletInfo:t}}=this;return t?null:lt});s(this,"unConnectedWallet",()=>{let{accountStore:{isConnectedWallet:t}}=this;return t?null:lo});s(this,"nonsupportChain",()=>{let{accountStore:{computedNonsupportChain:t}}=this;return t?lt:null});s(this,"nonsupportFacetToken",()=>{let{fromToStore:{computedNonsupportFacetToken:t}}=this;return t?lt:null});s(this,"checkReceiveAddressStatus",()=>{let{fromToStore:{computedDiffCrossChain:t}}=this,{receiveAddressStore:{checkReceiveAddressLoading:e,computedSwapHighLight:o}}=this.rootStore;return t&&!o||e?lt:null});s(this,"interceptionProcessing",()=>{let{fromToStore:t}=this;return!this.isInterceptionProcessing&&t.isBalanceLoading||t.fromBalanceState===st.BALANCE_REQUEST_FAILED?lt:null});s(this,"balanceLessThenInputAmount",()=>this.computedTooBalance?mo:null);s(this,"approveStatus",()=>{let{approveStore:{computedApprovalStatus:t}}=this;return oa[t]||null});s(this,"isValidAmount",()=>{let{fromToStore:t}=this,{from:e,to:o}=t;return o.amount&&e.amount?Ue:null});s(this,"getBtnStatus",()=>{let t=[this.hasFeeConfigErrorTips,this.unConnectedWallet,this.nonsupportChain,this.nonsupportFacetToken,this.isHoneypot,this.checkDappTrade,this.checkReceiveAddressStatus,this.noAmountOrOverLimit,this.interceptionProcessing,this.balanceLessThenInputAmount,this.isQuoting,this.approveStatus,this.isValidAmount],e;for(let o of t){let r=o();if(r){e=r;break}}return e||(e=lt),e});s(this,"checkIsCurrentQuote",()=>(this.computedIsCurrentQuote||D.warn({title:h("swaptrade_mid_toast_tryagain_with_newquote")}),this.computedIsCurrentQuote));let{accountStore:e,fromToStore:o,swapStore:r,commonStore:i,quoteStore:n,approveStore:c}=t;this.rootStore=t,this.accountStore=e,this.fromToStore=o,this.swapStore=r,this.commonStore=i,this.quoteStore=n,this.approveStore=c,this.swapInterceptor=new Bl(t),Object.assign(this,t)}async runSwapInterceptor(t){this.isInterceptionProcessing=!0;let[e,o]=await R(this.swapInterceptor.check());if(this.isInterceptionProcessing=!1,e){_.error(N.UPDATE_BTC_BALANCE_ERROR_BEFORE_SWAP,{error:e});return}if(o.length===0){t();return}let r=-1,i=()=>{r++;let n=r===o.length-1;this.showErrorTips(o[r],n?t:i)};i()}getBtnAllStatus({from:t}){return{[lo]:{statusType:lo,disabled:!1,toLocaleText:()=>h(lo),onClick:this.connectWallet},[mo]:{statusType:mo,disabled:!0,toLocaleText:()=>h(mo,{tokenSymbol:W(t.tokenSymbol)}),symbol:t.tokenSymbol},[er]:{statusType:er,disabled:!1,toLocaleText:()=>h(er,{tokenSymbol:W(t.tokenSymbol)}),onClick:()=>{this.quoteStore.setAggregateSelectStatus(1),this.approve()},icon:"okx-defi-dex-authorization",iconType:le.ICON_POSITION.leading},[po]:{statusType:po,loading:!0,disabled:!0,toLocaleText:()=>h(po)},[_s]:{statusType:po,disabled:!1,toLocaleText:()=>h(_s,{ccy:t.tokenSymbol}),onClick:this.cancelApprove,icon:"okx-defi-dex-authorization",iconType:le.ICON_POSITION.leading},[or]:{statusType:or,loading:!0,disabled:!0,toLocaleText:()=>h(or)},[lt]:{statusType:lt,disabled:!0,toLocaleText:()=>ai({disabled:!0})},[Ue]:{statusType:Ue,disabled:!1,loading:ql(),toLocaleText:()=>ai({disabled:!1}),onClick:()=>{this.quoteStore.setAggregateSelectStatus(1),this.swap()},type:Ul()},[ho]:{statusType:ho,disabled:!1,loading:this.rootStore.swapDappStore?.swapOnDappBtnLoading,toLocaleText:()=>h(ho),icon:"okds-open-link",iconType:le.ICON_POSITION.leading,onClick:this.clickSwapOnDapp}}}get needToCrossChainDoubleCheck(){return!0}get computedTooBalance(){let{rootStore:t,fromToStore:e,accountStore:o}=this,{isConnectedWallet:r}=o,i=e.from.balance,n=t.safeMoonStore.computedInputVal;return r?T.BigNumber(i||0).isLessThan(n):!1}get computedBtnStatus(){let{fromToStore:t}=this,{from:e}=t,o=this.getBtnStatus();return this.getBtnAllStatus({from:e,swapLoading:this.swapBtnLoading})[o]}get computedIsCurrentQuote(){let{fromToStore:t,quoteStore:e}=this,{computedIsExactIn:o,computedTypedValue:r}=t,{quote:i,getGasTokenFeeLoading:n}=e,{fromTokenAmount:c="",inputToTokenAmount:d=""}=i?.bestRoute||{},m=!!r,p=m&&o&&T.BigNumber(r).isEqualTo(c),f=m&&!o&&T.BigNumber(r).isEqualTo(d);return!n&&(p||f)}};u();l();var Vl=wt(["tipsDialogInfo","notShowAgainCrossChainConfirm","isInterceptionProcessing","swapBtnLoading"],["computedTooBalance","computedBtnStatus","computedIsCurrentQuote"]);u();l();var ui=()=>{let{accountStore:a}=M();Tc({wallet_address:a.address,...vc()})};var Le=class extends Po{constructor(e){super(e);s(this,"handleSwap",async()=>{let{quote:e,computedIsOfflineType:o}=this.quoteStore,{receiveAddressStore:r,swapStore:i}=this.rootStore;if(this.swapBtnLoading=!0,this.walletContractStore.setQuoteData(e.bestRoute),!o){let d=await this.walletContractStore.fetchCallData();if(this.swapBtnLoading=!1,d)return}this.swapBtnLoading=!1;let n=o?kt.INTENT_SWAP:kt.SWAP;r.saveWalletAddressToStorage(this.fromToStore?.to);let{fromToken:c}=Ui.get(e,"bestRoute",{});if(i.isSwapSolana(c.chainId)){b.history?.push({pathname:je});return}b.history?.push({pathname:Dt,search:`needUpdate=${ir.on}&type=${n}`})});s(this,"swap",async()=>{let e=this.checkIsCurrentQuote();hr({wallet_address:this.accountStore.address,button_name:"confirm",...ct()}),e&&(this.swapBtnLoading=!0,this.runSwapInterceptor(this.handleSwap))});s(this,"approve",async()=>{this.approveStore.updateCurrentApproveTokenConfig({status:x.Approving});let e=await b.checkMpcAccountIfNecessary();if(ui(),!e){this.approveStore.updateCurrentApproveTokenConfig({status:x.UnApproved});return}this.approveStore.setApprove()});s(this,"cancelApprove",async()=>{this.approveStore.updateCurrentApproveTokenConfig({status:x.CancelApproving});let e=await b.checkMpcAccountIfNecessary();if(ui(),!e){this.approveStore.updateCurrentApproveTokenConfig({status:x.CancelApprove});return}this.approveStore.setApprove(qe.CANCEL_APPROVE)});this.walletContractStore=e.walletContractStore,Et(this,Vl)}};u();l();u();l();O();F();u();l();O();var _m=/\s/,Wl=a=>!(!Ho(a)||_m.test(a)||a.length<10);u();l();O();var bm=T.mul(.5,100),Lm=T.mul(.1,100),li=a=>{let t=I(a,"quoteStore.quote.bestRoute.autoSlippageInfo",{}),{computedDefaultAutoSlippageInfo:e}=a.fromToStore;return{...e,...t}},Oo=({isSingleChain:a,autoSlippageInfo:t})=>{let{autoSlippage:e,autoTotalSlippage:o}=t||{};return a?e||.01:o||.03},Qr=a=>{let t=a.fromToStore.computedIsSingleChain,e=li(a),o=Oo({isSingleChain:t,autoSlippageInfo:e});return T.mul(T.ceilTruncate(o,3,!1),100)},wm=a=>{let t=Gt(a);if(t.indexOf(".")>-1){let e=t.split("."),o=e[0],r=e[1];r&&r.length>1&&(r=r.slice(0,1)),t=`${o}.${r}`}return et(t)},Hr=({inputSlippageParams:a,computedSafeMoonTips:t,minSlippageShow:e,maxSlippageShow:o=bm,autoSlippageValue:r=0,isSingleChain:i=!0})=>{let{safeMoonSlippage:n=0,overLimit:c,equalLimit:d}=t||{};if(a===""&&!t)return{slippage:0,inputValue:"",notice:"",isError:!1};let m=wm(a),p="",f=!1,g=!1;return t?.safeMoonSlippage?c||d||T.BigNumber(m).isZero()?p="":e>m?(p=h("swaptrade_settings_errortip_minimum_slippage",{cross:Ft(e,{needZero:!1})}),f=!0,m=n):n>m?(p=h("swaptrade_settings_errortip_lowslippage_failed",{auto:Ft(n,{needZero:!1})}),g=!0):m>o&&(p=h("swaptrade_card_swap_advance_options_exceeding_desc",{num:Ft(o,{needZero:!1})}),f=!0,m=n):ae(m)?(m="",f=!0):m<e?(p=h(i?"swaptrade_dialog_modal_singlechain_limit":"swaptrade_dialog_modal_crosschain_limit",{value:T.thousandFormat(e)}),f=!0):m<r?(p=h("swaptrade_dialog_modal_transaction_failure"),f=!1):m>=Lm&&m<=o?(p=h("swaptrade_adjustslip_modalhint_actual_amount_less",{value:Ft(m,{needZero:!1})}),f=!1):m>o&&(m=o,p=h("swaptrade_card_swap_advance_options_exceeding_desc",{num:Ft(o,{needZero:!1})}),f=!0),{slippage:m,inputValue:a!==""?Gt(m):"",notice:p,isError:f,isWarning:g}},Gl=({slippageInfo:a,isSingleChain:t})=>{let{autoSlippageInfo:e,customSlippage:o}=a,r={};return t?o||(r=ce(e,["autoSlippage"])):r=ce(e,["autoFromSlippage","autoToSlippage","autoTotalSlippage"]),Object.keys(r).forEach(n=>{let c=r[n],d=T.ceilTruncate(c,3,!1);r[n]=T.toPlainString(Number(d))}),{customSlippage:o,autoSlippageInfo:r}};var No=class{constructor(t){s(this,"defaultGasFee","--");s(this,"isWalletConfirm",!1);s(this,"setWalletConfirm",t=>{this.isWalletConfirm=t});s(this,"isConfirmLoading",!1);s(this,"txInfo",{});s(this,"resetTxInfo",()=>{this.txInfo={}});s(this,"showRecentTransactionModal",t=>{this.confirmSwapVisible=!1,this.rootStore.recentTransactionStore.showModal(t)});s(this,"saveOrderParamsExtendSlippageAndGasPrice",t=>{let e={...t},{computedQuote:o,fromToStore:r}=this,{computedIsSingleChain:i,computedDefaultAutoSlippageInfo:n}=r,{autoSlippageInfo:c}=o.bestRoute||{},d=Oo({isSingleChain:i,autoSlippageInfo:n}),m={autoSlippageInfo:c||{}},p=I(this,"rootStore.slippageStore");return p&&(d=p.computedRealSlippageValue,m=p.getOrderSlippageInfo()),Object.assign(e,{slippage:String(d),...Gl({slippageInfo:m,isSingleChain:i})})});s(this,"baseSaveOrderParams",()=>{let{accountStore:t,computedQuote:e,fromToStore:o,quoteStore:r,gasDropStore:i}=this,{from:n,to:c}=o,{estimateGasFee:d,minimumReceived:m,gasDropAmount:p,defiPlatformId:f,traceData:g}=e.bestRoute||{},{computedIsMevOpen:C}=this.rootStore.mevStore,k={chainId:n.chainId,fromAmount:T.BigNumber(r?.computedQuoteAmount).toString(10),fromTokenAddress:n.tokenContractAddress,fromTokenDecimal:String(n.decimals),toAmount:c.reverseReceiveAmount,toTokenAddress:c.tokenContractAddress,toTokenDecimal:String(c.decimals),userWalletAddress:t.address,estimateGasFee:d,pmm:"1",gasDropType:i?.computedGasDropSelected?1:0,gasDropAmount:p,minimumReceived:m,openMev:C,toChainId:c.chainId,traceData:g};f&&(k.defiPlatformId=f);let P=this.rootStore.outerStore.extendFeeConfig(k);return this.saveOrderParamsExtendSlippageAndGasPrice(P)});s(this,"saveOrderSingleChainParams",t=>{let{computedQuote:e}=this,{originDexRouterList:o,dexRouterList:r}=e.bestRoute||{};return{...t,dexRouterList:r,originDexRouterList:o}});s(this,"saveOrderCrossChainParams",t=>{let{computedQuote:e,fromToStore:o}=this,{receiveAddressStore:r}=this.rootStore,{to:i,computedDiffCrossChain:n}=o,{receiveAddrObj:c}=r,{fromDexRouterList:d,bridge:m,toDexRouterToList:p,originFromDexRouterList:f}=e.bestRoute||{};return{...t,toChainId:i.chainId,crossChainDexRouter:{fromDexRouterList:d,toDexRouterToList:p,bridge:m,originFromDexRouterList:f},...n?{receiveWalletAddress:c?.specifiedAddress}:{}}});s(this,"saveOrderParams",()=>{let{fromToStore:t}=this,{computedIsSingleChain:e}=t,o=this.baseSaveOrderParams();return e?this.saveOrderSingleChainParams(o):this.saveOrderCrossChainParams(o)});s(this,"calldataSign",null);s(this,"setCalldataSign",t=>{this.calldataSign=t});s(this,"extendSignParams",async t=>{let e={...t},o=I(this.quoteStore,"quote.bestRoute.permit2Data");if(o&&!this.calldataSign){let[r,i]=await this.checkPermit2();if(r)return null;this.setCalldataSign(i),e={...e,unsignedTx:o?.unsignedTx,signature:i}}else o&&this.calldataSign&&(e={...e,unsignedTx:o?.unsignedTx,signature:this.calldataSign});return e});s(this,"checkPermit2",async()=>{let t=I(this.quoteStore,"quote.bestRoute.permit2Data"),e=I(this.quoteStore,"quote.bestRoute.fromToken.chainId"),{signTransaction:o}=this.rootStore.sendTransactionStore,r=t?.unsignedTx,[i,n]=await o(r,e);return i&&(_.error(N.SIGN_PERMIT2_DATA,{error:i,unsignedTx:r}),Lo(i)||de.error({title:h("swaptrade_trading_mode_alert_order_fail")})),[i,n]});s(this,"resetFromToAmount",()=>{this.fromToStore.updateFrom({amount:"",currentTime:"",prevAmount:"",usdPrice:""}),this.fromToStore.updateTo({amount:"",prevAmount:"",usdPrice:"",currentTime:""}),this.fromToStore.advanceSetTypedValue("")});s(this,"transferBtcPayload",t=>{let e={...t},{from:o}=this.fromToStore;return e.value=Ke(e.value,o.decimals),e});s(this,"getExtParams",t=>{let{computedIsSingleChain:e,to:o,from:r,computedDiffCrossChain:i}=this.fromToStore,{receiveAddrObj:n}=this.rootStore.receiveAddressStore,c=i?n?.specifiedAddress:o.tokenContractAddress;return{txSource:3,orderId:t,toTokenAddress:c,crossChain:e?0:1,chainId:r.chainId,tokenAddress:r.tokenContractAddress,amount:r.amount,toChainId:o.chainId}});s(this,"confirmSwapVisible",!1);s(this,"setConfirmSwapVisible",t=>{this.confirmSwapVisible=t});s(this,"isSwapSolana",t=>!!(Er(t)&&this.rootStore.solanaPriorityFeeStore?.jitoData));s(this,"extendSolanaCalldata",t=>{let{feeType:e,customFee:o,computedPriorityFeeList:r}=this.rootStore.solanaPriorityFeeStore||{},i=r.find(c=>c.type===e),n=o||i.fee;return{...t,tradeMode:2,priorityFee:n,customPriorityFee:!!o}});s(this,"solanaSwapParams",null);s(this,"setSolanaSwapParams",t=>{this.solanaSwapParams=t});s(this,"getSolanaCalldata",t=>(this.setSolanaSwapParams(t),R(y.post(mr,t))));s(this,"solanaTransaction",async(t,e)=>{let{from:o}=this.fromToStore,{computedAccountId:r}=this.accountStore,n=await wo(o,{orderData:t,extParams:{}},this).jitoTransaction(),c=n.map(p=>p.payload.transaction),[d,m]=await R(this.rootStore.sendTransactionStore.signAllTransactions(c));if(d){this.onWalletFail(d,t?.orderId),this.isConfirmLoading=!1,_.removeKeep();return}await this.sendSolanaTransaction({signedTransactions:m,txArray:n,swapParams:e,walletId:r,enableJito:t.jitoEnable})});s(this,"sendSolanaTransaction",async({signedTransactions:t,txArray:e,swapParams:o,walletId:r,enableJito:i})=>{let[n,c]=await R(bl({signedTransactions:t,txArray:e,swapParams:o,walletId:r,enableJito:i}));if(this.isConfirmLoading=!1,_.removeKeep(),!n){let d=I(c,"data.broadcastResult.data.orderId");this.afterTransaction(d)}});this.rootStore=t,this.commonStore=t.commonStore,this.accountStore=t.accountStore,this.fromToStore=t.fromToStore,this.tokenModalStore=t.tokenModalStore,this.quoteStore=t.quoteStore,this.gasDropStore=t.gasDropStore}get computedEstimateGasFee(){let t=this.defaultGasFee,e=this.commonStore.nowCurrencyUnit,o=I(this.computedQuote.bestRoute,"quoteNetWorkFeeOfMoney");if(this.isSwapSolana(this.fromToStore.from.chainId)&&this.quoteStore.enableQuoteAggregates){let i=I(this.rootStore.solanaPriorityFeeStore,"computedPriorityFeeOfUsd",0);o=T.add(i,o,{returnString:!0})}let r=T.BigNumber(o).multipliedBy(I(e,"usdToThisRate"));return!X(e)&&!r.isNaN()&&(t=at(r.toJSON(),e?.symbol)),t}get computedCrossChainFromFee(){let t=I(this.computedQuote.bestRoute,"fromSwapFeeUsd");if(!t||ae(Number(t)))return"--";let{computedNowCurrencySymbol:e,currencyConversion:o}=this.commonStore,r=o(t).toString();return`${at(r,e)}`}updateTxHash(t){this.rootStore.sendTransactionStore.updateTxHash(t)}cancelOrder(t){t&&this.rootStore.sendTransactionStore.cancelOrder(t)}saveOrderUrl(){return lr}onSaveOrder(t){return _.info(N.SAVE_ORDER_PARAMS,{data:t}),y.post(this.saveOrderUrl(),t)}saveOrderErr(t){let{error_code:e,error_message:o=""}=t,r=t?.data?.code||e||"";return _.error(N.SAVE_ORDER_ERROR,{error:t,tags:{errorCode:e||r,error_msg:`${N.SAVE_ORDER_ERROR}_${r}`}}),e==="10014"?de.error({title:h("swaptrade_toast_trade_not_available")}):de.error({title:o||h("swaptrade_toast_save_order_fail")})}saveOrderError(t){this.saveOrderErr(t),this.isConfirmLoading=!1,_.removeKeep()}async onSwap(t){this.isConfirmLoading=!0,_.keepLive(),this.setCalldataSign(null);let e=this.saveOrderParams(),o=await this.extendSignParams(e);if(!o){this.isConfirmLoading=!1;return}if(this.isSwapSolana(o.chainId)){await this.onSolanaSwap(o);return}let[r,i]=await R(this.onSaveOrder(o));if(r){this.saveOrderError(r);return}_.info(N.SAVE_ORDER,{data:i?.data,tags:{orderId:i?.data.orderId}}),$e({...ct(),order_id:i?.data.orderId,wallet_type:this.accountStore.walletConfig?.walletType});let[n]=await R(this.onChainTransaction({...i?.data,swapParams:o},t));n&&this.onWalletFail(n,i?.data?.orderId),this.isConfirmLoading=!1,_.removeKeep()}walletErrorMessage(t){let e=null;try{e=JSON.parse(t?.message)}catch{e={}}return e}walletErrToast(t,e){let o,r=this.walletErrorMessage(t);return _.error(N.SEND_ERROR,{error:t,tags:{orderId:e}}),r?.code===$t.SLIPPAGE_LOW?o=h("swaptrade_home_toast_slippage_too_low"):r?.code===$t.SEND_TX_ERROR_CODE&&(o=r?.message),de.error({title:o||h("swaptrade_home_toast_broadcast_failed")})}onWalletFail(t,e){Lo(t)?this.cancelOrder(e):t?.code!==da.RECEIPT_ERROR&&(Co.emit(Io.FAIL,{data:{orderId:e},status:-2,message:ls("transaction fail")}),this.walletErrToast(t,e)),_.error(N.ON_WALLET_FAIL,{error:t,tags:{orderId:e}})}extendEvmParams(t){return t}isOkxWallet(){}async getTransactionPayload({orderData:t,orderId:e}){let{from:o}=this.fromToStore;return wo(o,{orderData:t,extParams:this.getExtParams(e)},this).getSendTransactionParams()}sendTransactionEnhance(...t){return this.rootStore.sendTransactionStore.sendTransaction(...t)}getTransaction(){}logChainId(){}async doubleCheckChainId(){return!0}async onChainTransaction(t,e){let{callData:o,orderId:r,swapParams:i}=t,n=await this.getTransactionPayload({orderData:t,orderId:r}),{computedIsEvmChain:c,from:d}=this.fromToStore;if(_.info(N.PAYLOAD,{payload:n,tags:{orderId:r}}),e)try{await e(...n)}catch(p){return _.error(N.BEFORE_SEND_TRANSACTION_ERROR,{error:p}),!1}return this.logChainId({message:N.CHECK_CHAIN_ID_BEFORE_SEND_TRANSACTION,fromChainId:d.chainId,saveOrderChainId:i.chainId,orderId:r}),await this.doubleCheckChainId({saveOrderChainId:i.chainId,orderId:r})?this.sendTransactionEnhance(...n).then(({result:p,nonce:f})=>{if(!Wl(p))throw new Error(`hash format is invalid: ${p}`);return this.txInfo={...o,txHash:p},T.BigNumber(f).isNaN()?(this.updateTxHash({orderId:r,transactionHash:p}),c&&this.getTransaction(p,this.fromToStore.from.chainId).then(g=>{_.info(N.UPDATE_NONCE,{nonce:g.nonce,tags:{orderId:r}}),this.updateTxHash({orderId:r,transactionHash:p,nonce:g.nonce})}).catch(g=>{_.error(N.UPDATE_NONCE_FAIL,{error:g})})):this.updateTxHash({orderId:r,transactionHash:p,nonce:f}),this.afterTransaction(r),this.logChainId({message:N.CHECK_CHAIN_ID_AFTER_SEND_TRANSACTION,fromChainId:d.chainId,saveOrderChainId:i.chainId,orderId:r}),!0}):!1}afterTransaction(t){this.setWalletConfirm(!0),this.showRecentTransactionModal(t),Co.emit(Io.TXHASH,{status:0,data:B(this.txInfo),message:ls("Transaction hash has been generated")})}get computedQuote(){return this.quoteStore.quote}checkRepeatOrderDetail(t){t&&this.rootStore.recentTransactionStore.showModal(t)}async onSolanaSwap(t){let e=this.extendSolanaCalldata(t),[o,r]=await this.getSolanaCalldata(e);if(o){this.saveOrderError(o);return}_.info(N.SAVE_ORDER,{data:r?.data,tags:{orderId:r?.data.orderId}}),$e({...ct(),order_id:r?.data.orderId,wallet_type:this.accountStore.walletConfig?.walletType}),await this.solanaTransaction(r.data,e)}};u();l();var Ql=wt(["isWalletConfirm","isConfirmLoading","txInfo","confirmSwapVisible"],["computedEstimateGasFee","computedCrossChainFromFee","computedQuote"]);var we=class extends No{constructor(e){super(e);s(this,"sendTransactionEnhance",e=>{let{computedIsSolanaChain:o,computedIsTronChain:r,computedIsAptosChain:i,computedIsSuiChain:n,computedIsStacksChain:c,computedIsStarknetChain:d,computedIsFromBtcCoin:m}=this.rootStore?.fromToStore,{from:p}=this.rootStore?.fromToStore,{walletSendParams:f}=this.rootStore.walletContractStore;return this.rootStore.sendTransactionStore.sendTransaction(p.chainId,e,f).then(g=>{let C,k;if(o)C=g.signature;else if(r){let{transaction:P}=g;C=P?.txID}else if(i)C=g;else if(n)C=g;else if(c)C=g.txHash;else if(d)C=g.transaction_hash;else if(m)C=g;else if(jc(p.chainId))C=g.txHash;else{let{hash:P,nonce:w}=g;C=P,k=w}return{result:C,nonce:k}})});s(this,"showRecentTransactionModal",e=>{this.isConfirmLoading=!1,this.confirmSwapVisible=!1,b.history.replace(`${fe}/${e}`)});s(this,"extendsGas",e=>{let o={...e},{gasInfo:r}=this.rootStore.walletContractStore,{gasLimitInfo:i,isGasLimitLoading:n,gasType:c,...d}=r;return o.extParams.gasType=c,{...o,gasInfo:d}});s(this,"extendEvmParams",e=>{let o=super.extendEvmParams(e),{activityId:r}=this.rootStore.walletContractStore,i=this.rootStore.quoteStore.quote?.bestRoute?.isEnableMev;r&&(o.extParams.activityId=r);let{computedIsMevOpen:n,mevInfo:c}=this.rootStore.mevStore;return n&&(o.extParams.isMev=!0,o.extParams.mevInfo=c),!n&&Number(i)===sa.ON&&(o.extParams.isShowBlockSwapMevTooltip=!0),o});s(this,"onWalletFail",(e,o)=>{this.isConfirmLoading=!1,!e?.message?.includes(b.global?.HARDWALLETERROR)&&super.onWalletFail(e,o)});s(this,"checkRepeatOrderDetail",e=>{e&&b.history.push(`${fe}/${e}`)});s(this,"checkUtxoBeforePublish",async e=>{let{utxoList:o}=e,{preDataForSendBtc:r}=this.rootStore.walletContractStore,{checkUtxoBeforePublish:i}=r;await i(o)});s(this,"onSwap",async()=>{this.isConfirmLoading=!0;let e=await b.checkMpcAccountIfNecessary();if(this.isConfirmLoading=!1,!e)return;let{computedIsOfflineType:o}=this.rootStore.quoteStore,{computedIsFromBtcCoin:r}=this.rootStore?.fromToStore;o?await this.rootStore.intentSwapStore?.onIntentSwap():await super.onSwap(r?this.checkUtxoBeforePublish:null)});s(this,"getSaveOrderMonitorData",()=>({...ct(),...this.rootStore.walletContractStore.computedMonitorGasType}));Et(this,Ql)}isOkxWallet(){return!0}getTransaction(){}walletErrorMessage(e){return e}};u();l();O();O();u();l();O();O();F();u();l();u();l();var Hl=function(){return new Promise(function(t){setTimeout(t,1)})};u();l();var to=L(q());u();l();F();var vm={[E.SWAP]:"swap_used_chain_cache",[E.LIMIT_ORDER]:"limit_used_chain_cache",[E.BRIDGE]:"bridge_used_chain_cache"},jl=(a,t,e)=>{let o=vm[e],r=v.get(o)||[];if(r.length===0&&(r=t.slice(0,4).map(n=>n.chainId)),a.forEach(i=>{r.includes(i)||r.unshift(i)}),r=r.filter(i=>t.find(n=>n.chainId===i)),r.length<4)for(let i=0;i<t.length&&r.length<4;i++)r.includes(t[i].chainId)||r.push(t[i].chainId);return r.length>4&&(r=r.slice(0,4)),v.set(o,r),r};u();l();var Do=class{constructor(t){s(this,"id",1);s(this,"tokenSymbol","--");s(this,"tokenName","--");s(this,"decimals",6);s(this,"tokenContractAddress","");s(this,"tokenLogoUrl","");s(this,"type","");s(this,"amountNum",0);s(this,"currencyAmount",0);U(this),Object.assign(this,t),this.tokenModalStore=M().tokenModalStore}get computedPrice(){let{nowCurrencyUnit:t}=this.tokenModalStore.commonStore,{symbol:e,usdToThisRate:o}=t,r=T.BigNumber(this.currencyAmount);return r.isNaN()||r.isZero()?`${e||""}0.00`:e&&o&&!r.isNaN()&&!r.isZero()?at(r.multipliedBy(o).toJSON(),e):"0"}get computedIsSelect(){let{equalsToken:t}=this.tokenModalStore.commonStore,{from:e,to:o}=this.tokenModalStore.fromToStore;return this.tokenModalStore.tokenModalFromState===A.FROM?t(this,o):t(this,e)}get computedIsSelectOrigin(){let{from:t,to:e}=this.tokenModalStore.fromToStore,{equalsToken:o}=this.tokenModalStore.commonStore;return this.tokenModalStore.tokenModalFromState===A.FROM?o(this,t):o(this,e)}get computedAmountNum(){return this.amountNumBigDecimal!==""?this.amountNum:0}toJSON(){return B(this)}};u();l();var Fo=(a={})=>({...ht,logoUrl:ht.logoUrl(),chainName:h(ht.localKey),...a}),jr=(a={})=>{let t=dn();return{...Ct,get logoUrl(){return t===ln.dark?Ct.darkLogoUrl():Ct.logoUrl()},chainName:h(Ct.localKey),...a}};var Kl="hide_collect_cancel_dialog",Yl="hideTokenGuide",ve=class{constructor(t){s(this,"searchValue","");s(this,"setSearchValue",t=>{this.searchValue=t});s(this,"fromTokenList",new Map);s(this,"toTokenList",new Map);s(this,"searchTokenList",{});s(this,"error",!1);s(this,"tokenModalVisible",!1);s(this,"tokenModalFromState",A.FROM);s(this,"setTokenModalFromState",t=>{this.tokenModalFromState=t});s(this,"loading",{[A.FROM]:{},[A.TO]:{}});s(this,"initLoading",()=>{this.loading={[A.FROM]:{},[A.TO]:{}}});s(this,"importTokenInfo",{});s(this,"setImportTokenInfo",t=>{this.importTokenInfo={...t}});s(this,"toSelectedChainId","");s(this,"fromSelectedChainId","");s(this,"setToSelectedChainId",t=>{this.toSelectedChainId=t});s(this,"setFromSelectedChainId",t=>{this.fromSelectedChainId=t});s(this,"extendTokens",(t,e)=>t.filter(o=>this.commonStore.getChainByID(et(o.chainId))).map(o=>{let r=new Do(o,this);return{...o,balance:r.computedAmountNum,selected:r.computedIsSelect,selectedOrigin:e?r.computedIsSelectOrigin:!1,price:r.computedPrice}}));s(this,"extendTokenList",(t=[],e=!0)=>X(t)?t:this.extendTokens(t,e));s(this,"importUserToken",Kt(function*(e,o=!0){let r=e.map(c=>{let{chainId:d,tokenContractAddress:m,tokenSymbol:p,decimals:f}=c;return{chainId:d,contractAddress:m,tokenSymbol:p,precision:f}}),i={userUniqueId:this.commonStore.userUniqueId,tokenDetailList:r},n=[];try{n=(yield y.post(ha,i)).data}catch(c){throw D.error(h("swaptrade_pricechart_no_connection_desc")),c}return o&&(this.searchValue="",this.changeTokenModalVisible(!1)),n}));s(this,"sortTokens",t=>xi(t,[e=>Number(e.topPlacement),e=>Number(e.currencyAmount),e=>Number(e.amountNum),e=>Number(e.isCollectToken),e=>Number(e.collectTime)],["desc","desc","desc","desc","desc"]));s(this,"orderTokenList",t=>this.computedIsCollectChain?t:this.commonStore.currentTab===E.BRIDGE?t.map(e=>({...e,tokenList:this.sortTokens(e.tokenList)})):this.sortTokens(t));s(this,"formatTokenList",(t,e)=>{let o=t;t.length>100&&e!==ht.chainId&&(o=t.slice(0,100));let r=this.extendTokenList(o,!0);return this.orderTokenList(r)});s(this,"changeTokenModalVisible",t=>{this.tokenModalVisible=t});s(this,"clearCacheTokenList",()=>{});s(this,"getTokenListByChainId",async()=>{let t=this.tokenModalFromState===A.FROM,e={};if(this.clearCacheTokenList(),this.tokenModalFromState===A.FROM?e={fromChainId:this.fromSelectedChainId}:this.tokenModalFromState===A.TO&&(e={fromChainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainId}),this.tokenModalFromState===A.FROM&&Number(this.fromSelectedChainId)===Ct.chainId){this.getFromAllNetworksTokens();return}if(this.tokenModalFromState===A.TO&&Number(this.toSelectedChainId)===Ct.chainId){this.getToAllNetworksTokens(e.fromChainId);return}if(this.tokenModalFromState===A.FROM&&Number(this.fromSelectedChainId)===ht.chainId){this.getFromCollectedTokens();return}if(this.tokenModalFromState===A.TO&&Number(this.toSelectedChainId)===ht.chainId){this.getToCollectedTokens(e.fromChainId);return}t?this.getTokenList(A.FROM,e.fromChainId):this.getTokenList(A.TO,e.toChainId,e.fromChainId)});s(this,"setTokenList",(t,e,o)=>{let r=this.formatTokenList(e,t);this[`${o}TokenList`].set(t,r)});s(this,"cancelGetTokenListRef",null);s(this,"handleTokenList",Kt(function*(e,o,r,i){this.setError(!1),this.cancelGetTokenListRef&&this.cancelGetTokenListRef.abort(),this[`${e}TokenList`].get(o)||this.setLoading(e,o,!0),this.cancelGetTokenListRef=bt();try{let{data:n}=yield y.get(r,{params:i,signal:this.cancelGetTokenListRef?.signal}),c=this.toLowerCaseContractAddress(n);return this.setTokenList(o,c,e),this.setLoading(e,o,!1),{data:c}}catch(n){return this.isCancel(n)?null:(this.setTokenList(o,[],e),this.setLoading(e,o,!1),this.setError(!0),n)}}).bind(this));s(this,"getCrossChainParams",(t,e,o)=>{switch(t){case E.BRIDGE:return{fromChainId:e.fromChainId??e?.chainId,userUniqueId:e.userUniqueId,accountId:e.accountId,userWalletAddress:e.userWalletAddress,...o,toChainId:o.toChainId===-1?"":o?.toChainId};case E.SWAP:default:return e}});s(this,"getTokenList",Kt(function*(e,o,r){let i={fromChainId:r,chainId:o,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,userWalletAddress:this.accountStore.computedSpecialWalletAddress};this.commonStore?.computedCurrentTabIsLimit&&(i={...i,businessLine:Xt.LIMIT_ORDER});let n=this.getCrossChainParams(this.commonStore.currentTab,i,{selectChainType:this.getCrossChainSelectChainType(),toChainId:this.computedCurrentToChainId,fromTokenAddress:this.fromToStore.from.tokenContractAddress||""}),c=et(o);if(this.computedIsNotSupportToChain)return this.setTokenList(c,[],e),{data:[]};let d=Wt(gt.ALL_TOKENS,this.commonStore.currentTab);return yield this.handleTokenList(e,c,d,n)}));s(this,"getFromCollectedTokens",Kt(function*(){let e={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:"",userWalletAddress:this.accountStore.computedSpecialWalletAddress};this.commonStore?.computedCurrentTabIsLimit&&(e={...e,businessLine:Xt.LIMIT_ORDER});let o=this.getCrossChainParams(this.commonStore.currentTab,e,{selectChainType:Te.FROM,toChainId:this.computedCurrentToChainId,fromTokenAddress:""}),r=Wt(gt.COLLECT_LIST,this.commonStore.currentTab);return yield this.handleTokenList(A.FROM,ht.chainId,r,o)}));s(this,"getToCollectedTokens",Kt(function*(e){let o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:e,chainId:e,userWalletAddress:this.accountStore.computedSpecialWalletAddress};this.commonStore?.computedCurrentTabIsLimit&&(o={...o,businessLine:Xt.LIMIT_ORDER});let r=this.getCrossChainParams(this.commonStore.currentTab,o,{selectChainType:Te.TO,toChainId:"",fromTokenAddress:this.fromToStore.from.tokenContractAddress}),i=Wt(gt.COLLECT_LIST,this.commonStore.currentTab);return yield this.handleTokenList(A.TO,ht.chainId,i,r)}));s(this,"getFromAllNetworksTokens",Kt(function*(){let e={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:"",userWalletAddress:this.accountStore.computedSpecialWalletAddress};this.commonStore?.computedCurrentTabIsLimit&&(e={...e,businessLine:Xt.LIMIT_ORDER});let o=Wt(gt.ALL_NETWORK,this.commonStore.currentTab),r=this.getCrossChainParams(this.commonStore.currentTab,e,{selectChainType:Te.FROM,toChainId:this.computedCurrentToChainId,fromTokenAddress:""});return yield this.handleTokenList(A.FROM,Ct.chainId,o,r)}));s(this,"getToAllNetworksTokens",Kt(function*(e){let o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:e,userWalletAddress:this.accountStore.computedSpecialWalletAddress};this.commonStore?.computedCurrentTabIsLimit&&(o={...o,businessLine:Xt.LIMIT_ORDER});let r=Wt(gt.ALL_NETWORK,this.commonStore.currentTab),i=this.getCrossChainParams(this.commonStore.currentTab,o,{selectChainType:Te.TO,toChainId:"",fromTokenAddress:this.fromToStore.from.tokenContractAddress});return yield this.handleTokenList(A.TO,Ct.chainId,r,i)}));s(this,"cancelSearchRef",null);s(this,"needRemoveChainId",t=>[Ct.chainId,ht.chainId].includes(et(t)));s(this,"getSearchChainType",()=>{let t=sr.SINGLE;return this.computedCurrentChainId===Ct.chainId&&(t=sr.ALL_NETWORK),this.computedCurrentChainId===ht.chainId&&(t=sr.COLLECT),t});s(this,"getCrossChainSearchType",()=>this.computedCurrentChainId===ht.chainId?Ys.COLLECTION:Ys.COMMON);s(this,"getCrossChainSelectChainType",()=>this.tokenModalFromState===A.FROM?Te.FROM:Te.TO);s(this,"singleSearchParams",t=>{let e=this.getSearchChainType(),o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,chainType:e,searchType:e,userWalletAddress:this.accountStore.computedSpecialWalletAddress},r={},i={};return this.tokenModalFromState===A.FROM?(r={inputContent:t,fromChainId:this.fromSelectedChainId,chainId:this.fromSelectedChainId,toChainId:this.fromSelectedChainId},this.needRemoveChainId(this.fromSelectedChainId)&&(delete r.fromChainId,delete r.toChainId,delete r.chainId)):this.tokenModalFromState===A.TO&&(i={inputContent:t,fromChainId:this.fromToStore.from.chainId,chainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainId,fromTokenAddress:this.fromToStore.from.tokenContractAddress||""},this.needRemoveChainId(this.toSelectedChainId)&&(delete i.toChainId,delete r.chainId)),{...o,...r,...i}});s(this,"getSearchTokenList",async()=>{if(this.searchValue==="")return;if(this.cancelSearchRef&&this.cancelSearchRef.abort(),this.computedIsNotSupportToChain){this.setSearchTokenList({}),this.setLoading(this.tokenModalFromState,"search",!1);return}this.cancelSearchRef=bt(),this.setLoading(this.tokenModalFromState,"search",!0),this.setError(!1);let t=as(this.searchValue),e=this.getSearchParams(t);gc({keyword:t});let o=Wt(gt.SEARCH,this.commonStore.currentTab),r=this.getCrossChainParams(this.commonStore.currentTab,e,{inputContent:e?.inputContent,selectChainType:this.getCrossChainSelectChainType(),searchType:this.getCrossChainSearchType(),toChainId:this.computedCurrentToChainId,fromTokenAddress:this.fromToStore.from.tokenContractAddress||""}),[i,n]=await R(y.get(o,{params:{...r},signal:this.cancelSearchRef?.signal}));if(i&&!this.isCancel(i)){this.setError(!0),this.setSearchTokenList({}),this.setLoading(this.tokenModalFromState,"search",!1);return}if(n){let{data:c}=n;if(this.commonStore.currentTab===E.BRIDGE)this.setSearchTokenList({list:c});else{let{systemList:d,thirdPartyList:m}=n.data;this.setSearchTokenList({systemList:d,thirdPartyList:m})}this.setError(!1),this.setLoading(this.tokenModalFromState,"search",!1)}});s(this,"resetTokenModal",()=>{this.resetTokenData()});s(this,"resetTokenData",()=>{this.searchTokenList={},this.searchValue=""});s(this,"balancePushSort",(t,e)=>{let o=[...t],{currencyAmount:r,coinAmountOriginalDec:i}=e;for(let n=0;n<o.length;n++)if(this.commonStore.equalsToken(o[n],e)){o[n].amountNum=i,o[n].currencyAmount=r;break}return o});s(this,"updateAllTokenList",t=>{let{chainId:e}=t,o=et(e),r=this.fromTokenList.get(o);r&&this.setTokenList(o,this.balancePushSort(B(r),t),A.FROM);let i=this.toTokenList.get(o);i&&this.setTokenList(o,this.balancePushSort(B(i),t),A.TO)});s(this,"checkFromToLegal",(t,e)=>{let{currentTab:o}=this.commonStore,r={toToken:{...e,amount:""},isChanged:!1};if(Number(t.chainId)!==Number(e.chainId)){if(this.computedToChain?.some(f=>f.chainId===e.chainId&&!f.disabled))return r;let{dexDefaultFromToTokenShowVO:i}=this.commonStore.getChainByID(this.fromToStore.from.chainId),{fromDexMultiTokenInfoVO:n,toDexMultiTokenInfoVO:c,toCrossDexMultiTokenInfoVO:d}=i,m=o===E.BRIDGE,p;return m&&d?p=d:this.commonStore.equalsToken(t,c)?p=n:p=c,{toToken:p,isChanged:!0}}return r});s(this,"calcCurToChainIdIsInSupList",t=>{let e=!1;return B(this.computedToChain).forEach(o=>{Number(o.chainId)===Number(t)&&!o.disabled&&(e=!0)}),e});s(this,"updateTokenCollected",async(t,e=!1)=>{let{isConnectedWallet:o}=this.accountStore;if(!o){D.error(h("swaptrade_selecttoken_toast_connect_wallet"));return}let r=yt({},{tokenContractAddress:t?.tokenContractAddress||this.rootStore.klineStore.chooseTokenContractAddress,chainId:Number(t?.chainId),symbol:t?.tokenSymbol,decimal:t?.decimals,isCustomToken:t?.isCustomToken||t?.isSubscribe,walletAddress:this.accountStore.address||this.accountStore.computedAccountWalletAddressesArray[0],userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId}),[i,n]=await R(y.post(dr,r));this.updateTokenCollectedLocal(t),i?(D.error(h("swaptrade_pricechart_no_connection_desc")),this.updateTokenCollectedLocal(yt({},t,{isCollectToken:t?.tokenInfo?0:1}))):n?.data===-1?e?D.error({title:h("swaptrade_selecttoken_modal_favorite_limitreached"),duration:.5}):this.setShowCollectOverLimitDialog(!0):n?.data===0?(D.success({title:h("swaptrade_selecttoken_toast_removed_from_favorite"),duration:.5}),this.rootStore.marketInfoStore.setIsCollected(!1)):n?.data===1&&(fr(),D.success({title:h("swaptrade_selecttoken_toast_added_to_favorite"),duration:.5}),this.rootStore.marketInfoStore.setIsCollected(!0))});s(this,"hideCollectCancelConfirm",v.get(Kl));s(this,"showCollectOverLimitDialog",!1);s(this,"setShowCollectOverLimitDialog",t=>{this.showCollectOverLimitDialog=t});s(this,"setCommonlyUsedChain",t=>{let{from:e,to:o}=this.fromToStore,{chainList:r,currentTab:i}=this.commonStore,n=t&&t.length>0?t:[e.chainId,o.chainId];return jl(n,r,i)});s(this,"tokenPageChainList",[]);s(this,"setTokenPageChainList",t=>{this.tokenPageChainList=t});s(this,"getCurrentToChainInfo",()=>this.computedToChain.find(e=>et(e.chainId)===et(this.toSelectedChainId)));s(this,"changeTokenPageChainList",async t=>{if(this.tokenPageChainList.findIndex(o=>et(o.chainId)===et(t))===-1){let o=this.commonStore.chainList.find(i=>et(i.chainId)===et(t)),r=[...this.tokenPageChainList];r.unshift(o),r.length>4&&r.pop(),this.setTokenPageChainList(r)}this.tokenModalFromState===A.FROM?this.setFromSelectedChainId(t):this.setToSelectedChainId(t),await this.getTokenListByChainId()});s(this,"searchChainKeywords","");s(this,"setSearchChainKeywords",t=>{this.searchChainKeywords=t});s(this,"filterChains",t=>io(t,e=>{let o=Bt(as(this.searchChainKeywords));return Bt(e.chainName).includes(o)}));s(this,"dialogIndex",Ls.TOKEN_LIST);s(this,"setDialogIndex",t=>{this.dialogIndex=t});s(this,"hideTokenGuide",!!v.get(Yl));s(this,"setHideTokenGuide",()=>{this.hideTokenGuide=!0,v.set(Yl,"1")});s(this,"importToken",async(t,e)=>{let r=(await this.importUserToken(Array.isArray(t)?t:[t]))[0]||{};e&&e(r),gr(r)&&await this.fromToStore.getTokenBalanceByAccount(this.tokenModalFromState,r),this.setImportTokenInfo({}),this.setDialogIndex(Ls.TOKEN_LIST)});s(this,"reloadTokenList",async()=>{!this.tokenModalVisible||(this.searchValue!==""?await this.getSearchTokenList():await this.getTokenListByChainId())});s(this,"selectTokenHandle",async t=>{let e=this.commonStore.getChainByID(Number(t?.chainId));if(await Hl(),!e)return;let{quoteStore:o}=this.rootStore,{from:r,updateFrom:i,updateTo:n,setBalance:c,setFromBalanceRequestError:d,setToBalanceRequestError:m,to:p,computedIsExactIn:f,needCrossChainDoubleConfirm:g,setNeedCrossChainDoubleConfirm:C}=this.fromToStore,{clearReceiveAddressValue:k}=this.rootStore.receiveAddressStore;this.setCommonlyUsedChain([t?.chainId]);let P=this.tokenModalFromState===A.FROM,w=()=>{d(!1),c(A.FROM,t.balance)},G=()=>{m(!1),c(A.TO,t.balance)};if(t.selected){P?G():w(),this.fromToStore.onSwitchFromTo();return}P?w():G();let K=()=>{g||C(!0)};if(P){if(dc(t.chainId,p.chainId)&&this.commonStore.currentTab===E.BRIDGE){let z=new Zt(this.commonStore.currentTab,{}),[mt,Q]=await z.fetchCrossChainTokens({fromChainId:t.chainId,fromTokenAddress:t.tokenContractAddress}),{amount:ns}=r,Vo={...t},so;mt?(i({...Vo,amount:ns}),so=e?.dexDefaultFromToTokenShowVO?.toCrossDexMultiTokenInfoVO,n({...so})):(Vo=Q.data.fromTokenInfo,so=Q.data.toTokenInfo,i({...Vo,amount:ns}),n(so),K(),this.fromToStore.getTokenBalanceByAccount("from",Vo)),this.fromToStore.getTokenBalanceByAccount("to",so)}else if(!this.commonStore.equalsToken(t,r)){let{amount:z}=r;o.setQuoteNumber(2),i({...t,amount:z});let{toToken:mt,isChanged:Q}=this.checkFromToLegal(t,p);n(mt),Q&&(K(),this.fromToStore.getTokenBalanceByAccount("to",B(mt))),f&&this.fromToStore.advanceSetTypedValue("")}}else this.commonStore.equalsToken(t,p)||(K(),o.setQuoteNumber(0),n({...t,amount:""}),f||this.fromToStore.advanceSetTypedValue(""));k()});this.rootStore=t,this.commonStore=t.commonStore,this.swapStore=t.swapStore,this.accountStore=t.accountStore,this.fromToStore=t.fromToStore}get computedIsSearching(){return!!this.searchValue}setSearchTokenList(t){this.searchTokenList=t}setError(t){this.error=t}setLoading(t,e,o){this.loading[t][e]=o}get computedTokenList(){return this.tokenModalFromState===A.FROM?this.fromTokenList.get(this.fromSelectedChainId):this.toTokenList.get(this.toSelectedChainId)}get computedSearchTokenList(){let t={};return X(this.searchTokenList)||(t={systemList:this.extendTokenList(this.searchTokenList?.systemList,!1),thirdPartyList:this.extendTokenList(this.searchTokenList?.thirdPartyList,!1)}),t}toLowerCaseContractAddress(t){let e=[];return Array.isArray(t)&&t.forEach(o=>{e.push({...o,tokenContractAddress:this.commonStore.getTokenAddress(o)})}),e}isCancel(t){return Jt(t)}getSearchParams(){throw new Error("getSearchParams method must be implemented by subclass")}get computedFromChain(){let t=Fo(),e=jr({});return[t,e,...B(this.tokenPageChainList)]}get computedToChain(){let t=Fo();if(j(this.fromToStore.from.chainId)){let e=this.tokenPageChainList.filter(o=>o?.chainId===this.fromToStore.from.chainId);return[t,...e]}return[t]}get computedCurrentToChainId(){return this.toSelectedChainId||j(this.toSelectedChainId)?this.toSelectedChainId:j(this.fromToStore.to.chainId)?this.calcCurToChainIdIsInSupList(this.fromToStore.to.chainId)?this.fromToStore.to.chainId:this.fromToStore.from.chainId:this.computedToChain.length>1?Ct.chainId:To}reassignTokenInfo(t,e,o){if(this.commonStore.equalsToken(t,e)){let r=e?.isCollectToken;return yt({},e,{isCollectToken:r?0:1,collectTime:r?"":Date.now().toString(),isCustomToken:o?1:e?.isCustomToken})}return t}filterCollectToken(t){let e=!t.isCustomToken||t.balance;return!!(!this.computedIsCollectChain&&e||this.searchValue||t.isCollectToken)}updateTokenCollectedLocal(t){let e=(o=[],r=!1)=>o.map(i=>this.reassignTokenInfo(i,t,r)).filter(i=>this.filterCollectToken(i));if(this.searchValue){let{systemList:o,thirdPartyList:r}=this.searchTokenList;this.setSearchTokenList({systemList:e(o),thirdPartyList:e(r,!0)})}else this.updateTokenList(e)}updateTokenList(t){if(this.tokenModalFromState===A.FROM){let e=t(this.fromTokenList.get(this.fromSelectedChainId));this.fromTokenList.set(this.fromSelectedChainId,e)}else if(this.tokenModalFromState===A.TO){let e=t(this.toTokenList.get(this.toSelectedChainId));this.toTokenList.set(this.toSelectedChainId,e)}}get computedCurrentChainId(){return et(this.tokenModalFromState===A.FROM?this.fromSelectedChainId:this.toSelectedChainId)}get computedIsCollectChain(){return this.computedCurrentChainId===ht.chainId}setShowCollectCancelConfirm(t){v.set(Kl,t),this.hideCollectCancelConfirm=t}get computedIsNotSupportToChain(){let t=this.getCurrentToChainInfo();return this.tokenModalFromState===A.TO&&t&&t.disabled}get computedSelectedChainId(){return this.tokenModalFromState===A.FROM?this.fromSelectedChainId||this.fromToStore.from.chainId:this.tokenModalFromState===A.TO?this.toSelectedChainId||this.fromToStore.to.chainId:""}get computedAllChainList(){let t=this.commonStore.chainList;return this.tokenModalFromState===A.FROM?{supported:t,unsupported:[]}:this.tokenModalFromState===A.TO?this.computedToChainList:{supported:[],unsupported:[]}}get computedToChainList(){let t=this.commonStore.chainList,e=Go(B(t),{chainId:Number(this.fromToStore.to.chainId)});return{supported:e?[e]:[],unsupported:[]}}get computedIsSearchChainStatus(){return!!this.searchChainKeywords}get computedSearchedChainList(){if(!this.computedIsSearchChainStatus)return{supported:[],unsupported:[]};let{supported:t,unsupported:e}=this.computedAllChainList;return{supported:this.filterChains(t),unsupported:this.filterChains(e)}}get computedTokenGuideVisible(){return!1}};var Kr=class extends ve{constructor(e){super(e);s(this,"showChainTab",!0);s(this,"clearCacheTokenList",()=>{this.fromTokenList.clear(),this.toTokenList.clear()});s(this,"extendTokenList",(e=[],o=!0)=>X(e)?e:e?.map(r=>({...r,tokenList:this.extendTokens(r.tokenList,o)})));s(this,"generateToChainMap",()=>{let e=this.commonStore.chainList,r=Go(B(e),{chainId:Number(this.fromToStore.from.chainId)})?.bridgeSupportChainInfoList||[];return Ni([...r],"chainId")});ut(this)}get computedTokenGuideVisible(){let{tokenModalFromState:e,hideTokenGuide:o}=this;return e===A.TO&&!o}get computedSearchTokenList(){return this.extendTokenList(this.searchTokenList?.list,!1)}get computedToChainList(){let e=this.commonStore.chainList,o=[],r=[],i=this.generateToChainMap();return e.forEach(n=>{let c={...n};c.disabled=!i[n.chainId],c.disabled||o.push(c)}),{supported:o,unsupported:r}}updateTokenCollectedLocal(e){let o=(r=[],i=!1)=>{let n=[];return r?.forEach(c=>{let d=c?.tokenList.map(m=>this.reassignTokenInfo(m,e,i)).filter(m=>this.filterCollectToken(m));n.push({tokenList:d})}),n};if(this.searchValue){let{list:r}=this.searchTokenList;this.setSearchTokenList({list:o(r)})}else this.updateTokenList(o)}get computedToChain(){let e=Fo(),o=jr({});if(j(this.fromToStore.from.chainId)){let r=this.generateToChainMap(),i=[];return B(this.tokenPageChainList).forEach(n=>{n.chainId!==Number(this.fromToStore.from.chainId)&&i.push({...n,disabled:!r[n.chainId]})}),[e,o,...i]}return[e]}getSearchParams(e){let o=this.getSearchChainType(),r={inputContent:e,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,chainType:o,userWalletAddress:this.accountStore.computedSpecialWalletAddress};return this.tokenModalFromState===A.FROM&&(r={...r,fromChainId:this.fromSelectedChainId},this.needRemoveChainId(this.fromSelectedChainId)&&delete r.fromChainId),this.tokenModalFromState===A.TO&&(r={...r,fromChainId:this.fromToStore.from.chainId,fromTokenAddress:this.fromToStore.from.tokenContractAddress||"",toChainId:this.toSelectedChainId},this.needRemoveChainId(this.toSelectedChainId)&&delete r.toChainId),r}};u();l();F();var di=class{constructor(t){s(this,"sendTransactionParams",{});s(this,"waitingHandleOrderList",[]);s(this,"needIntercept",!1);s(this,"updateHistoryOrderList",t=>{let e=nt(),o=[],r=[],i=this.rootStore.recentTransactionStore;i.pendingOrders.forEach(n=>{let c=n;n.orderId===t&&(c={...n,status:Ar.PendingRedeeming}),o.push(c)}),!e&&i.history?.list?.forEach(n=>{let c=n;n.orderId===t&&(c={...n,status:Ar.PendingRedeeming}),r.push(c)}),i.setPendingOrders(o),!e&&i.setHistory({...i.history,list:r})});s(this,"sendTransactionEnhance",async({callData:t,chainId:e,redeemOrderIdPre:o,redeemOrderId:r,bizType:i},n=()=>{})=>{let c=nt(),d=`${o}:${r}`;if(!c&&this.setWaitingHandleList(d),this.needIntercept)return;let m;if(nt()){let p=this.rootStore.swapStore.extendsGas(t);m=this.sendTransactionStore.sendTransactionEnhance(e,p,this.rootStore?.walletContractStore?.walletSendParams)}else{if(!await this.rootStore.commonStore.connectAndSwitchNetwork(e))return;m=this.sendTransactionStore.sendTransactionEnhance(t)}m.then(({result:p,hash:f,nonce:g})=>{!c&&this.setWaitingHandleList(d,!0),this.sendTransactionStore.updateTxHash({orderId:r,transactionHash:c?f:p,bizType:i,nonce:g}),lc(n),this.updateHistoryOrderList(o),c||this.sendTransactionStore.getTransaction(p,e).then(C=>{_.info(N.UPDATE_NONCE,{nonce:C.nonce,tags:{orderId:r}}),this.sendTransactionStore.updateTxHash({orderId:r,transactionHash:p,nonce:C.nonce,bizType:i})}).catch(C=>{_.error(N.UPDATE_NONCE_FAIL,{error:C,transactionHash:p,tags:{orderId:r}})})}).catch(p=>{!c&&this.setWaitingHandleList(d,!0),_.error(N.REDEEM_ORDER_ERROR,{error:p,tags:{orderId:r}})})});s(this,"walletSendRedeem",()=>{this.sendTransactionEnhance(this.sendTransactionParams,()=>{b.history?.goBack()})});s(this,"facetOrderDetail",{});this.rootStore=t,this.sendTransactionStore=t.sendTransactionStore,U(this,{},{autoBind:!0})}setSendTransactionParams(t){this.sendTransactionParams=t}async launchFacetSwap(t){let e=nt(),{data:o}=this.rootStore.recentTransactionStore.detail,r=t?t.orderId:o?.orderId,i=t?t.chainId:o?.fromChainId,n=t?t.toTokenAddress:o?.toTokenAddress,c=t?t.fromTokenAddress:o?.fromTokenAddress,d={orderId:r,chainId:i,userWalletAddress:this.rootStore.accountStore.getAddressByChainId(i)};if(e&&t?.goOrderDetail){b.history?.push(`${fe}/${r}`);return}let[m,p]=await R(y.post(Ha,d));if(m){_.error(N.REDEEM_ORDER_CALL_DATA_ERROR,{error:m,tags:{orderId:r}}),Number(m?.code)===100002&&this.rootStore.recentTransactionStore.removePendingOrder(r),D.error({title:m?.msg||h("swaptrade_top_notif_data_failed")});return}let{redeemSignatureVo:f,redeemDetailInfo:g,redeemOrderId:C,bizType:k}=p?.data||{},{unsignedTx:P,...w}=f||{},G={...w,extParams:{toTokenAddress:n,crossChain:0,tokenAddress:c,amount:g.fromTokenAmount,toChainId:i,...d}},K={callData:G,chainId:i,redeemOrderIdPre:r,redeemOrderId:C,bizType:k};if(this.setSendTransactionParams(K),_.info(N.REDEEM_ORDER,{callData:G,tags:{orderId:C}}),e){this.setFacetOrderDetail({...g}),this.rootStore.walletContractStore.setTransactionPayload(G),b.history?.push({pathname:Dt,search:`needUpdate=${ir.off}&type=${kt.REDEEM}`});return}await this.sendTransactionEnhance(K)}setWaitingHandleList(t,e=!1){this.waitingHandleOrderList.find(r=>r===t)?e?(this.waitingHandleOrderList=this.waitingHandleOrderList.filter(r=>r!==t),this.needIntercept=!1):(D.warn({title:h("swaptrade_history_notification_desc_wallet_confirm")}),this.needIntercept=!0):(this.waitingHandleOrderList=[...this.waitingHandleOrderList,t],this.needIntercept=!1)}getFacetExploreUrl(t){let{data:e}=this.rootStore.recentTransactionStore.detail,o=[e?.fromChildOrderDetailVo?.exploreUrl,e?.relativeTransaction?.exploreUrl];return this.computedIsFacetTradeType&&o?.[t]||""}get computedIsFacetTradeType(){let{data:{specialOrderType:t}}=this.rootStore.recentTransactionStore.detail;return t===qc.FromIsEthChainFacetCoin}get computedShowFacetTip(){return this.rootStore.recentTransactionStore.detail.data.status===Ar.PendingCanRedeem}setFacetOrderDetail(t){this.facetOrderDetail=t}get computedFacetOrderToFromRate(){let{price:t}=this.facetOrderDetail;return t&&!zt(t)&&t!=="-1"?tt(t):""}get computedFacetOrderFromToRate(){let{price:t}=this.facetOrderDetail;return t&&!zt(t)&&t!=="-1"?tt(T.BigNumber("1").div(t).toString(10),{needBillionMillionUnit:!1}):""}get computedFacetOrderTokens(){let{fromToken:t,toToken:e,fromTokenAmount:o,toTokenAmount:r}=this.facetOrderDetail;return{fromToken:{...t,amount:o},toToken:{...e,amount:r}}}get computedFacetOrderMinimumReceived(){return this.facetOrderDetail.minimumReceived}get computedFacetTipParams(){let t=this.rootStore.recentTransactionStore.detail?.data;return{amount:tt(t?.fromChildOrderDetailVo?.toAmountOut,{needBillionMillionUnit:!1}),token:t?.fromChildOrderDetailVo?.toTokenSymbol}}},Yr=di;u();l();O();O();F();var Pe=class{constructor(t){s(this,"liquidityModelVisible",!1);s(this,"dataStatus",ot.DEFAULT);s(this,"setDataStatus",t=>{this.dataStatus=t});s(this,"rawData",[]);s(this,"LiquidityCancelRef",null);s(this,"fetchLiquidityData",async()=>{this.resetAllLiquidityData(),this.setDataStatus(ot.LOADING);let{from:t}=this.fromToStore;this.LiquidityCancelRef&&this.LiquidityCancelRef.abort(),this.LiquidityCancelRef=bt();let[e,o]=await R(y.get(Ka,{params:{chainId:t.chainId},signal:this.LiquidityCancelRef?.signal,isolate:!0}));if(e)this.setDataStatus(ot.ERROR);else{let r=I(o,"data");X(r)?this.setDataStatus(ot.NULL):(this.initAllLiquidityData(r),this.setDataStatus(ot.READY))}});s(this,"selectedListIds",[]);s(this,"setSelectedListIds",t=>{this.selectedListIds=t});s(this,"confirmIds",null);s(this,"setConfirmIds",t=>{this.confirmIds=t});s(this,"filterSelectedListIds",(t,e)=>{let o;e?o=us(this.selectedListIds,t):o=Li(this.selectedListIds,t),this.setSelectedListIds(Qt(o))});s(this,"searchLiquidityValue","");s(this,"setLiquiditySearchValue",t=>{this.searchLiquidityValue=t});this.rootStore=t,this.fromToStore=this.rootStore.fromToStore,U(this,{},{autoBind:!0})}setLiquidityModelVisible(t){this.liquidityModelVisible=t}setData(t){this.rawData=t}resetAllLiquidityData(){this.setData([]),this.setSelectedListIds([]),this.setConfirmIds(null)}initAllLiquidityData(t){this.setData(t);let e=Qo(t,"id");this.setSelectedListIds(e);let o=this.fromToStore.from.chainId;j(o)&&this.setConfirmIds(Mi({},o,e))}get computedListCheckedAll(){return this.computedSearchStatus?this.computedSearchIfAllChecked:this.selectedListIds.length===this.rawData.length}get computedCheckedAllDisabled(){return this.computedSearchStatus&&X(this.computedSearchData)}get computedLiquidityNum(){let{from:t}=this.rootStore.fromToStore,e="--",{dataStatus:o,rawData:r,confirmIds:i}=this;if(o===ot.NULL)e="0 / 0";else if(o===ot.READY){let n=I(i,t.chainId);e=`${!n||n&&n.length===0?r.length:n.length} / ${r.length}`}return e}get computedClearAll(){return X(this.selectedListIds)}checkAllBtn(){let t="",e=this.computedSearchStatus?this.computedSearchData:this.rawData,o=Qo(e,"id");this.computedListCheckedAll?t=us(this.selectedListIds,...o):t=Bi(this.selectedListIds,o),this.setSelectedListIds(Qt(t))}get computedCheckedData(){return Qo(this.rawData,e=>({...e,isChecked:!!Pi(this.selectedListIds,e.id)}))}get computedSortListData(){return yc(this.computedCheckedData)}get computedSearchStatus(){return!!this.searchLiquidityValue}get computedSearchDataIsNull(){return this.computedSearchStatus&&X(this.computedSearchData)}get computedSearchData(){return _c(this.computedCheckedData,this.searchLiquidityValue)}get computedSearchIfAllChecked(){let t=wi(this.computedSearchData,e=>e?.isChecked);return!X(this.computedSearchData)&&t}get computedShowData(){return this.searchLiquidityValue?this.computedSearchData:this.computedSortListData}get computedIds(){return I(this.rootStore.liquidityChooseStore?.confirmIds,this.rootStore.fromToStore?.from.chainId)}get computedIsCustomLiquidity(){return(this.computedIds||[]).length<this.rawData.length}get computedMonitorLiquidSelectType(){let{computedIds:t=[],rawData:e}=this;return!t.length||t.length===e?.length?"all":t.length>1?"custom_>1":t.length===1?"custom_=1":""}get computedIsSelectedAllDex(){let{computedIds:t=[],rawData:e}=this;return!t.length||t.length===e?.length}};u();l();O();F();var mi=class{constructor(t){s(this,"orderCheckContinue",async t=>{let[e,o]=await R(y.get(Ya,{params:t}));if(e)return D.error({title:h("swaptrade_history_toast_setup_error"),duration:Lt}),!1;let r=I(o,"data"),i=String(r?.checkCode);return i===Qe.SUCCESS?!0:(i===Qe.SINGLE_ERROR||i===Qe.LIMIT_SINGLE_ERROR?D.error({title:h("swaptrade_history_toast_chain_unsupported",{chain:r?.fromChainName}),duration:Lt}):i===Qe.CROSS_ERRORL||i===Qe.LIMIT_CROSS_ERRORL?D.error({title:h("swaptrade_history_toast_both_unsupported",{fromChain:r?.fromChainName,toChain:r?.toChainName}),duration:Lt}):D.error({title:h("swaptrade_history_toast_setup_error"),duration:Lt}),!1)});this.rootStore=t,U(this,{},{autoBind:!0})}},$r=mi;u();l();O();F();var{BigNumber:$l}=T,pi="safemoon_slippage",hi="safemoon_is_changed",Xl=50,fi={NeedIncreaseSlip:0,AdviseGivenSlip:1,NotAvailableGivenSlip:2,AdviseSlip:3},Oe=class{constructor(t){s(this,"isChanged",!1);s(this,"getSafemoonIsChangedLocal",()=>!!v.get(`${hi}_${this.computedSlippageTokenPair}`));s(this,"cacheSlippage",0);U(this),this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,_t(()=>this.computedSlippageTokenPair,()=>{this.setSafeMoonIsChanged(v.get(`${hi}_${this.computedSlippageTokenPair}`)),this.setCacheSlippage(v.get(`${pi}_${this.computedSlippageTokenPair}`))}),_t(()=>({slippage:this.computedPairSlippage}),()=>{this.cacheSlippage>0&&this.computedPairSlippage>this.cacheSlippage&&this.setSafeMoonIsChanged(!1),this.setCacheSlippage(v.get(`${pi}_${this.computedSlippageTokenPair}`))}),_t(()=>this.computedSlippage,e=>{this.commonStore.safemoonSlippage=e})}setSafeMoonIsChanged(t){this.isChanged=t,v.set(`${hi}_${this.computedSlippageTokenPair}`,t)}checkIsChanged(t){let e=new $l(t),o=e.gte(this.computedPairSlippage)&&e.lte(50);o&&this.setSafeMoonIsChanged(o)}setSafeMoonPairSlippage(t){!this.isAccessSlippage(t)||(this.setCacheSlippage(t),v.set(`${pi}_${this.computedSlippageTokenPair}`,t))}isAccessSlippage(t){let e=new $l(t);return this.computedPairSlippage>0&&e.gte(this.computedPairSlippage)&&e.lte(50)}get computedAutoSlippage(){return Qr(this.rootStore)}get computedSafeMoonToken(){let{from:t,to:e}=this.fromToStore;return this.checkIsSafeMoon(t)?t:this.checkIsSafeMoon(e)?e:null}get computedHoneypot(){let{from:t,to:e}=this.fromToStore;return this.checkIsHoneypot(t)?t:this.checkIsHoneypot(e)?e:null}setCacheSlippage(t){this.cacheSlippage=t}get computedPairSlippage(){return this.computedSafeMoonToken?1.1:0}get computedSlippage(){return this.cacheSlippage>this.computedPairSlippage?this.cacheSlippage:this.computedPairSlippage}get computedOverLimit(){return this.computedSlippage>50}get computedSlippageTokenPair(){let{from:t,to:e}=this.fromToStore;return`${this.checkIsSafeMoon(t)?t.tokenContractAddress:""}_${this.checkIsSafeMoon(e)?e.tokenContractAddress:""}`}get computedSlippageTips(){let t=I(this,"rootStore.quoteStore.quote.bestRoute"),e=Number(this.computedAutoSlippage),{tokenSymbol:o}=this.computedSafeMoonToken||{};return t?.isSafeMoonToken!=="1"||t?.isHoneypot==="1"?null:e===Xl?{type:fi.AdviseGivenSlip,safeMoonSlippage:e,equalLimit:!0,tip:h("swaptrade_card_errortip_autoadjust_to_50",{tokenSymbol:o,slippageTolerance:e}),tipEquation:h("swaptrade_card_errortip_autoadjust_to_50",{tokenSymbol:W(o),slippageTolerance:e}),inputWarning:h("swaptrade_adjustslip_modal_advise_givenslip")}:e>Xl?{type:fi.NotAvailableGivenSlip,overLimit:!0,safeMoonSlippage:e,tip:h("wallet_swap_adjustslip_modal_slip_notsupported",{tokenSymbol:o}),tipEquation:h("wallet_swap_adjustslip_modal_slip_notsupported",{tokenSymbol:W(o)})}:{type:fi.AdviseSlip,safeMoonSlippage:e,tip:h("swaptrade_card_errortip_autoadjust_to_less50",{slippageTolerance:e,tokenSymbol:o}),tipEquation:h("swaptrade_card_errortip_autoadjust_to_less50",{slippageTolerance:e,tokenSymbol:W(o)}),inputWarning:h("swaptrade_modal_errortip_adjust_to_suggested_range",{slippageTolerance:e})}}checkIsSafeMoon(t){return I(t,"isSafeMoonToken")===1}checkIsHoneypot(t){return I(t,"isHoneypot")===1}get computedInputVal(){let{computedIsExactIn:t,computedSwapAmount:e}=this.fromToStore;return!t&&this.computedHoneypot?"":e[A.FROM]}get computedInputFiatVal(){let{computedIsExactIn:t,computedFromLocalCostByUsd:e}=this.fromToStore;return!t&&this.computedHoneypot?"":e}get computedOutputVal(){let{computedIsExactIn:t,computedSwapAmount:e}=this.fromToStore;return t&&this.computedHoneypot?"":e[A.TO]}get computedOutputFiatVal(){let{computedIsExactIn:t,computedToLocalCostByUsd:e}=this.fromToStore;return t&&this.computedHoneypot?"":e}get computedOutputPopVal(){let{computedSwapAmount:t}=this.fromToStore;return this.computedHoneypot?"":Se(t[A.TO])}};u();l();F();var Xr=class{constructor(){s(this,"gasDropConfig",{gasDropShow:!1,gasDropSwitch:v.get(ks)===Jn.OPEN,chainName:"",chainId:"",deduction:"",gasDrop:"",tokenLogoUrl:"",tokenSymbol:""});s(this,"setGasDropInfo",t=>{this.gasDropConfig={...this.gasDropConfig,...t}});s(this,"setGasDropSwitch",t=>{this.setGasDropInfo({gasDropSwitch:t}),v.set(ks,`${Number(t)}`)});s(this,"resetGasDrop",()=>{this.setGasDropInfo({gasDropShow:!1})});U(this)}get computedGasDropSelected(){let{gasDropShow:t,gasDropSwitch:e}=this.gasDropConfig;return t&&e}};u();l();var Si=class{constructor(t){s(this,"isShowMev",!1);s(this,"setShowMev",t=>{this.isShowMev=t});s(this,"isMevUserSwitchOpen",nr.DEFAULT);s(this,"setMevUserSwitchOpen",t=>{this.isMevUserSwitchOpen=t});s(this,"mevInfo",{});s(this,"setMevInfo",t=>{this.mevInfo=t});this.rootStore=t,this.quoteStore=this.rootStore.quoteStore,this.fromToStore=this.rootStore.fromToStore,U(this,{},{autoBind:!0})}get computedIsMevOpen(){return this.isShowMev&&(this.isMevUserSwitchOpen===nr.ON||this.isMevUserSwitchOpen===nr.DEFAULT)}},zr=Si;u();l();O();F();var gi=class{constructor(t){s(this,"feeConfig",{});s(this,"setFeeConfig",t=>{if(!this.isIframe)return;if(!X(t)){this.feeConfig=t,v.session.set("feeConfig",t);return}let e=v.session.get("feeConfig"),o=ce(e,["referrerAddress","feePercent"]);X(o)?(this.feeConfig={},v.session.remove("feeConfig")):this.feeConfig=o});s(this,"widgetFeeConfig",{});s(this,"setWidgetFeeConfig",t=>{this.isWidget&&(this.widgetFeeConfig=t)});s(this,"receiveQuoteUrl",()=>this.isIframe?Sa:Ta);s(this,"aggregatorQuoteUrl",()=>Ca);s(this,"saveOrderUrl",()=>this.isIframe?ya:lr);s(this,"illegalFeePercent",t=>{let{BigNumber:e}=T,o=e(t);return!!(o.isNaN()||o.gt(aa)||o.lte(0))});s(this,"extendFeeConfig",t=>{if(this.isWidget){let o=I(this.widgetFeeConfig,[t.chainId],{});if(typeof o.referrerAddress=="string")return{...t,...o};let r=I(o,["referrerAddress",t.fromTokenAddress]),i=I(r,"account"),c=I(r,"feePercent")||o.feePercent;return i?{...t,referrerAddress:i,feePercent:c}:t}if(!this.computedHasFeeConfig)return t;let e=X(this.feeConfig)?v.session.get("feeConfig"):this.feeConfig;return{...t,...e}});U(this),this.rootStore=t,this.isIframe=!nt()&&mc()&&!ze,this.isWidget=!nt()&&pc()}get computedHasFeeConfig(){return!!this.feeConfig?.referrerAddress&&!!this.feeConfig?.feePercent&&this.isIframe}get computedFeeConfigErrorTips(){return this.computedHasFeeConfig?this.illegalFeePercent(this.feeConfig?.feePercent):!1}},Jr=gi;u();l();F();u();l();O();F();u();l();var zl=()=>{let{swapStore:a,intentSwapStore:t,swapDappStore:e,approveStore:o,fromToStore:r}=M(),{from:i,to:n}=r;return!(!n?.tokenContractAddress||!i?.tokenContractAddress||o.visibleApprove||a.isConfirmLoading||t.isConfirmLoading||e.computedSupportDappTradeByChain)};u();l();u();l();var Jl=a=>{let{fromToStore:t,quoteStore:e}=M(),{commonDexInfo:o,pathSelectionRouterList:r,singleChainSwapInfo:i}=a,{computedIsSingleChain:n}=t,c=Number(o?.code)===Nt.CROSS_CHAIN_INTERVAL,d=c?{crossMaxAmount:o?.crossMaxAmount,crossMiniAmount:o?.crossMiniAmount}:null;return e.setQuoteScope(d),{isAutoError:c||(n?!i:!r?.length)}};var Pm=({quoteStore:a,fromToStore:t})=>{a.setQuoteNumber(a.quoteNumber+1),a.quoteNumber===1&&a.checkQuoteScopeLtMin(a.quoteScope,t.from.amount)&&t.advanceSetTypedValue("")},Om=(a,{fromToStore:t,quoteStore:e})=>{let{commonDexInfo:o,pathSelectionRouterList:r,singleChainSwapInfo:i,swapType:n,intentCode:c,isSupportDappTrade:d,offlineType:m,traceData:p}=a,f={intentCode:c,offlineType:m,swapType:n,traceData:p},g=r?.map(k=>({...o,...k,...f,isSupportDappTrade:d}));return{bestRoute:t.computedIsSingleChain?{...o,...i,...f,intentInfo:a?.intentInfo||{},isSupportDappTrade:d}:e.pickBestRouterAccordingBridgeId(g)||{...o,...f,isSupportDappTrade:d},combineSelectionRouterList:g}},Nm=({bestRoute:a,combineSelectionRouterList:t,isAutoError:e},{fromToStore:o,quoteStore:r})=>{r.updateSlippageInfoFetched(a),r.setQuote({...r.quote,bestRoute:a,quoteNull:e,quoteError:null,isFetchQuoting:!1}),o.quoteUpdateFromTo(a),o.computedIsSingleChain||r.setPathSelectionRouterList(t||[])},xo=({isAutoError:a},{approveStore:t})=>{a||t.isPendingNotCheck().catch(()=>{})},Mo=({isAutoError:a},{quoteStore:t})=>{a&&(t.handleReverseQuoteErrorAndNull(),pt(()=>{t.updateQuoteStatus(t.quoteScope?2:3)}))},Dm=a=>{let{solanaPriorityFeeStore:t}=M();t&&t.setJitoData(a?.priorityFeeInfo)},Zl=a=>{let{fromToStore:t,quoteStore:e,approveStore:o}=M(),{isAutoError:r}=Jl(a);Pm({quoteStore:e,fromToStore:t});let{bestRoute:i,combineSelectionRouterList:n}=Om(a,{fromToStore:t,quoteStore:e});Nm({bestRoute:i,combineSelectionRouterList:n,isAutoError:r},{fromToStore:t,quoteStore:e,approveStore:o}),Dm(a),xo({isAutoError:r},{approveStore:o}),Mo({isAutoError:r},{quoteStore:e})};u();l();var Bo=class{constructor(t){s(this,"allTimerAndQuoteState",{[it.DEFAULT]:{isShowLoadingCpt:!1,quoteText:()=>""},[it.QUOTING]:{isShowLoadingCpt:!0,quoteText:()=>h(Zo)},[it.TIMER]:{isShowLoadingCpt:!0,quoteText:()=>h(Zo)},[it.QUOTE_IS_HONEYPOT]:{isShowLoadingCpt:!1,quoteText:()=>h(tr)},[it.QUOTE_NULL]:{isShowLoadingCpt:!0,quoteText:()=>h(tr)},[it.QUOTE_NULL_AND_SECTION]:{isShowLoadingCpt:!0,quoteText:()=>h(Zo)},[it.QUOTE_ERROR]:{isShowLoadingCpt:!1,quoteText:()=>h(tr)}});Object.assign(this,t)}isValidRange(t){if(typeof t!="string")return!1;let{from:e}=this.fromToStore,o=t.split("-");if(o.length!==2)return!1;let{BigNumber:r}=T;return r(e.amount).lt(o[0])||r(e.amount).gt(o[1])}getCurrentTimerQuoteState(){let{quoteNull:t,isFetchQuoting:e,quoteError:o,bestRoute:r}=this.quote,i=this.fromToStore?.computedIfQuote,n=o!==null;return i?n?this.allTimerAndQuoteState[it.QUOTE_ERROR]:this.rootStore.safeMoonStore.computedHoneypot?this.allTimerAndQuoteState[it.QUOTE_IS_HONEYPOT]:t?r?.msg&&(e||this.isValidRange(r.msg))?this.allTimerAndQuoteState[it.QUOTE_NULL_AND_SECTION]:this.allTimerAndQuoteState[it.QUOTE_NULL]:e?e?this.allTimerAndQuoteState[it.QUOTING]:this.allTimerAndQuoteState[it.DEFAULT]:this.allTimerAndQuoteState[it.TIMER]:this.allTimerAndQuoteState[it.DEFAULT]}};var{FACET_TOKEN_ERROR_ONE:xm,FACET_TOKEN_ERROR_TWO:Mm,FACET_TOKEN_ERROR_THREE:Bm}=Nt,Ne=class{constructor(){s(this,"dialogCloseFlag",!1);s(this,"slippageInfoFetched",!1);s(this,"setDialogCloseFlag",t=>{this.dialogCloseFlag=t});s(this,"enableQuoteAggregates",!1);s(this,"dialogShowQuotationComparison",!1);s(this,"setDialogShowQuotationComparison",t=>{this.dialogShowQuotationComparison=t});s(this,"quoteNumber",0);s(this,"setQuoteNumber",t=>{this.quoteNumber=t});s(this,"aggregateSelectId",Rt);s(this,"isDialog",!1);s(this,"setIsDialog",t=>{this.isDialog=t});s(this,"initQuote",{bestRoute:null,quoteError:null,quoteNull:!1,isFetchQuoting:!1});s(this,"isPickRouterFromWallet",!1);s(this,"setIsPickRouterFromWallet",t=>{this.isPickRouterFromWallet=t});s(this,"quoteScope",null);s(this,"setQuoteScope",t=>{this.quoteScope=t});s(this,"fetchQuoteStatus",0);s(this,"quote",{...this.initQuote});s(this,"setQuote",t=>{this.quote=t});s(this,"pathSelectionRouterList",[]);s(this,"setPathSelectionRouterList",t=>{this.pathSelectionRouterList=t});s(this,"pickRouter",{});s(this,"setPickRouter",(t,e)=>{this.pickRouter=t,e&&(this.setNoCurrentPathTipInfo({bridgeName:t?.bridge?.bridgeName}),this.updateBestRoute(t))});s(this,"showChainListModel",!1);s(this,"setShowChainListModel",t=>{this.showChainListModel=t});s(this,"noCurrentPathTipInfo",{visible:!1,bridgeName:""});s(this,"setNoCurrentPathTipInfo",t=>{this.noCurrentPathTipInfo={...this.noCurrentPathTipInfo,...t}});s(this,"currentBridgeId","");s(this,"setCurrentBridgeId",t=>{this.currentBridgeId=t});s(this,"updateBestRoute",t=>{this.setQuote({...this.quote,bestRoute:t}),this.rootStore.fromToStore?.quoteUpdateFromTo(t)});s(this,"pickBestRouterAccordingBridgeId",t=>{let{smartRouterStore:{showXRouteModal:e}}=this.rootStore;if(!t||t.length===0)return null;let o=t.find(r=>r?.bridge?.bridgeId===this.currentBridgeId);return this.currentBridgeId&&!o&&(this.setCurrentBridgeId(""),!this.showChainListModel&&e!==ur.ROUTER_SELECT&&this.setNoCurrentPathTipInfo({visible:!0})),o||t?.[0]});s(this,"quoteTimer",null);s(this,"clearQuote",()=>{this.cleanQuoteTimer(),this.setQuote(this.initQuote),this.rootStore.fromToStore?.quoteUpdateFromTo(null),this.quotePending=!1;let{computedIsCrossChain:t,computedIfQuote:e}=this.fromToStore;t?(this.setBridgeQuoteSelectStatus(0),this.setBridgeFetchStatus(e?1:0)):(this.setAggregateSelectStatus(0),this.setAggregateFetchStatus(e?1:0))});s(this,"cancelRef",null);s(this,"cleanQuoteTimer",()=>{clearTimeout(this.quoteTimer),this.quoteTimer=null,this.cancelRef&&this.cancelRef.abort()});s(this,"isClearQuote",()=>{let{currentTab:t}=this.commonStore,{computedTypedValue:e,from:o,to:r,computedIsSingleChain:i,computedIsExactIn:n}=this.fromToStore;return t===E.LIMIT_ORDER||!Vt(e)||!r?.tokenContractAddress||!o?.tokenContractAddress||!n&&!i});s(this,"getQuoteData",t=>{let e=vt();return R(Je(()=>y.get(this.getQuoteStoreUrl(),{params:e,signal:t,isolate:!0}),qt.NUM,qt.TIMER))});s(this,"handleUpdateQuote",t=>{if(t){let{data:e}=t;Zl(e)}});s(this,"fetchQuote",async({source:t}={})=>{if(!zl())return this.quoteTimer=setTimeout(()=>{this.fetchQuote().catch(()=>{})},Rs),Promise.resolve(!1);if(t===0){let{computedIsCrossChain:r}=this.fromToStore;r?(this.setBridgeQuoteSelectStatus(0),this.setBridgeFetchStatus(1),this.setBridgeSelectId(Rt)):(this.setAggregateSelectStatus(0),this.setAggregateFetchStatus(1),this.setAggregateSelectId(Rt))}if(this.isClearQuote())return this.quoteScope=null,this.clearQuote(),Promise.resolve(!1);if(this.cleanQuoteTimer(),this.rootStore.outerStore.computedFeeConfigErrorTips)return this.handleQuoteError(null),Promise.resolve(!1);this.setQuote({...this.quote,isFetchQuoting:!0}),this.cancelRef=bt();let[e,o]=await this.getQuoteData(this.cancelRef.signal);return this.quotePending=!1,!Jt(e)&&e&&this.handleQuoteError(e),this.handleUpdateQuote(o),this.setIsPickRouterFromWallet(!1),this.commonStore.setResetFromToByTabChange(!1),!Jt(e)&&!this.dialogCloseFlag&&pt(()=>{this.quoteTimer=setTimeout(()=>{this.fetchQuote().catch(()=>{})},Rs)}),Promise.resolve(!0)});s(this,"quotePending",!1);s(this,"debounceQuote",xe(this.fetchQuote,na));s(this,"fetchQuoteDebounce",async({source:t}={})=>{let{computedIsCrossChain:e,computedIfQuote:o}=this.fromToStore;this.quotePending=!0,o&&e?await this.debounceQuote({source:t}):o&&!e?this.debounceQuote({source:t}):this.clearQuote()});s(this,"handleQuoteError",t=>{this.setQuote({...this.initQuote,quoteError:t}),this.handleReverseQuoteErrorAndNull()});s(this,"getGasTokenFeeLoading",!1);s(this,"getGasTokenFeeCancelRef",null);s(this,"cancelGasTokenGeeRequest",()=>{this.getGasTokenFeeCancelRef&&(this.getGasTokenFeeCancelRef.abort(),this.getGasTokenFeeCancelRef=null)});s(this,"cacheNativeGasFee","");s(this,"setCacheNativeGasFee",t=>{this.cacheNativeGasFee=t});s(this,"fetchGasTokenFee",async()=>{let{from:t}=this.rootStore.fromToStore,{computedReserveGas:e}=this.rootStore.commonStore,{decimals:o,balance:r}=t||{},i=Di(vt(),["dexIds"]);this.getGasTokenFeeCancelRef=bt();let n=this.rootStore.fromToStore?.computedIsExactIn?fa:ga;this.getGasTokenFeeLoading=!0;let c=this.getGasTokenFeeCancelRef.signal,d=e,[m,p]=await R(y.get(n,{params:{...i,amount:nc(r,o)},signal:c}));if(this.getGasTokenFeeLoading=!1,!Jt(m)&&m)return-1;if(!m){let{data:f}=p||{},{commonDexInfo:g}=f||{};Number(g?.code)===0&&g?.estimateReserveGasTokenFee!==""&&(d=g.estimateReserveGasTokenFee)}return this.setCacheNativeGasFee(d),d})}initQuoteStatus(){this.fetchQuoteStatus=0}updateQuoteStatus(t){this.fetchQuoteStatus=t}get computedSlippage(){let{computedIsSingleChain:t,computedDefaultAutoSlippageInfo:e}=this.fromToStore,o=this.rootStore.slippageStore,r=Oo({isSingleChain:t,autoSlippageInfo:e}),i=ge.AUTO;return o&&(r=o.computedRealSlippageValue,i=o.getSlippageType()),!this.slippageInfoFetched&&i===ge.AUTO&&(i=ge.DEFAULT),{slippage:r,slippageType:i}}getQuoteStoreUrl(){return this.outerStore.receiveQuoteUrl()}handleReverseQuoteErrorAndNull(){let{updateFromAmount:t,computedIsExactIn:e,updateTo:o}=this.fromToStore;e?o({amount:""}):t({amount:""})}getQuoteError(t){let{commonDexInfo:e,pathSelectionRouterList:o,singleChainSwapInfo:r}=t,{computedIsSingleChain:i}=this.fromToStore,n=Number(e?.code)===Nt.CROSS_CHAIN_INTERVAL,c=n?{crossMaxAmount:e?.crossMaxAmount,crossMiniAmount:e?.crossMiniAmount}:null;return this.setQuoteScope(c),{isAutoError:n||(i?!r:!o?.length)}}updateSlippageInfoFetched(t){let{autoSlippage:e,autoTotalSlippage:o}=t?.autoSlippageInfo||{};(e||o)&&(this.slippageInfoFetched=!0)}checkQuoteScopeLtMin(t,e){if(!t||!e)return!1;let{crossMiniAmount:o}=this.quoteScope||{};return!!T.BigNumber(e).lt(T.BigNumber(o))}get computedCurrentTimerQuoteState(){return new Bo(this).getCurrentTimerQuoteState()}get computedRouterForSmartRouterStore(){return this.fromToStore?.computedIsSingleChain?this.quote?.bestRoute:this.pickRouter}get computedMediaForChangeSmartRouterData(){return Dc()?.media==="sm"||this.isDialog}get computedQuoteAmount(){let{computedIsExactIn:t}=this.fromToStore;return t?this.quote?.bestRoute?.fromTokenAmount:this.quote?.bestRoute?.payAmount}get computedQuoteIntervalIsEmpty(){return this.computedQuoteInterval.type===J.EMPTY}get computedQuoteInterval(){let{safeMoonStore:t,fromToStore:e,approveStore:o,swapBtnStore:r,swapDappStore:i}=this.rootStore;if(t.computedHoneypot||e.computedFormToTokenIsLeverageToken)return{type:J.EMPTY};let n=Fc.handleQuoteErrorState({quote:this.quote,honeypotToken:I(this,"rootStore.safeMoonStore.computedHoneypot",!1)})||this.accountStore.computedNonsupportChain,{from:c,computedNonsupportFacetToken:d}=this.fromToStore;if(n||d)return{type:J.EMPTY};if(i.checkShouldJumpToDapp())return{type:J.SHOULD_JUMP_DAPPS};if(this.computedNotSupportBtcAddress&&this.accountStore.isConnectedWallet)return{type:J.NOT_SUPPORT_BTC_ADDRESS_TYPE,text:this.quote.bestRoute?.errorMsg};if(this.computedIsNoOkxLiquidity)return{type:J.NOT_OKX_LIQUIDITY};if((!this.quoteScope||!e.computedIfQuote)&&this.fetchQuoteStatus!==3&&!o.computedIsCancelApproveStatus&&!this.computedPriceWarn.show&&!this.quote?.bestRoute?.errorMsg)return{type:J.EMPTY};if(this.computedCrossAccuracyLimit)return{type:J.CROSS_CHAIN_ACCURACY,text:h("swaptrade_card_tooltips_adjust_pay_token_decimal",{fromToken:c.tokenSymbol,value:this.computedCrossAccuracyLimit}),equation:h("swaptrade_card_tooltips_adjust_pay_token_decimal",{fromToken:W(c.tokenSymbol),value:this.computedCrossAccuracyLimit})};if(this.computedFacetTokenTips)return{type:J.FACET_TOKEN_SWAP_ERROR,text:this.computedFacetTokenTips};let{crossMiniAmount:p,crossMaxAmount:f}=this.quoteScope||{};if(T.BigNumber(c.amount).lt(T.BigNumber(p))){let g=tt(p,{cutPriceText:!0,isFloor:!1});return{type:J.CROSS_CHAIN_MIN,text:h("swaptrade_bridge_toast_min_amout_crosschain_swap",{value:g,symbol:c.tokenSymbol}),equation:h("swaptrade_bridge_toast_min_amout_crosschain_swap",{value:g,symbol:W(c.tokenSymbol)})}}if(T.BigNumber(c.amount).gt(T.BigNumber(f))){let g=tt(f,{cutPriceText:!0});return{type:J.CROSS_CHAIN_MAX,text:h("swaptrade_bridge_toast_max_amout_crosschain_swap",{value:g,symbol:c.tokenSymbol}),equation:h("swaptrade_bridge_toast_max_amout_crosschain_swap",{value:g,symbol:W(c.tokenSymbol)})}}return this.quote?.bestRoute?.errorMsg?{type:J.CROSS_CHAIN_MORE_TIPS,text:this.quote?.bestRoute?.errorMsg}:this.computedIsNoLiquidity?{type:J.NOT_LIQUIDITY}:this.computedCrossChainIntervalOutOfRange?{type:J.NOT_LIQUIDITY}:o.computedIsCancelApproveStatus&&!r.computedTooBalance?{type:J.CANCEL_APPROVE_TIPS}:this.computedPriceWarn.show?{type:J.PROVIDER_PRICE_WARN}:{type:J.EMPTY}}get computedNotSupportFromBtcAddressType(){let t=this.quote?.bestRoute?.code;return Number(t)===Nt.NOT_SUPPORT_FROM_BTC_ADDRESS}get computedNotSupportToBtcAddressType(){let t=this.quote?.bestRoute?.code;return Number(t)===Nt.NOT_SUPPORT_TO_BTC_ADDRESS}get computedNotSupportBtcAddress(){return this.computedNotSupportFromBtcAddressType||this.computedNotSupportToBtcAddressType}get computedCrossChainIntervalOutOfRange(){let{from:t}=this.fromToStore,{crossMiniAmount:e,crossMaxAmount:o}=this.quoteScope||{};return T.BigNumber(t.amount).lte(o)&&T.BigNumber(t.amount).gte(e)}get computedIsNoLiquidity(){return this.fetchQuoteStatus===3&&this.quote.quoteNull}get computedIsNoOkxLiquidity(){let t=this.quote?.bestRoute?.defiPlatformInfoList;return this.enableQuoteAggregates&&t&&this.aggregateFetchStatus===3?!t.some(o=>o?.defiPlatformId===Z):!1}get computedCrossAccuracyLimit(){let{crossAccuracyLimit:t,code:e}=this.quote.bestRoute||{};return Number(e)===Nt.CROSS_CHAIN_ACCURACY?t:""}get computedFacetTokenTips(){let{errorMsg:t,code:e}=this.quote.bestRoute||{};return[xm,Mm,Bm].includes(Number(e))&&t?t:""}get computedYouSaveVisible(){let{computedNowCurrencySymbol:t,currencyConversion:e,computedIsWalletEnv:o}=this.commonStore,{computedIsExactIn:r,computedIsCrossChain:i}=this.rootStore.fromToStore,{quoteError:n,quoteNull:c,bestRoute:d}=this.quote;if(!r||n||c||!d?.youSaveDTO||i)return{visible:!1};let{youSaveDTO:m,fromToken:p,toToken:f}=d,{topTenDexInfoList:g,youSaveMoney:C}=m,k=Number(C)>=.1&&g?.length>0&&!p.isHoneypot&&!f.isHoneypot,P=e(C).toString(),w=k?at(P,t,{isFloor:!1}):"",G=k?g?.[1]?.dexName:"";return o&&(!i&&this.computedTopTenDexInfoList.length>0?k=!0:k=!1),{visible:k,youSaveStr:w,dexName:G}}get computedHasYouSave(){let{computedIsCrossChain:t}=this.rootStore.fromToStore;return!!this.quote?.bestRoute?.youSaveDTO||t}get computedTopTenDexInfoList(){if(!this.rootStore.fromToStore?.computedIsExactIn||!this.computedHasYouSave)return[];let{computedNowCurrencySymbol:t,currencyConversion:e}=this.commonStore;return this.quote?.bestRoute?.youSaveDTO?.topTenDexInfoList?.map(({logoUrl:o,dexName:r,comparePercent:i,price:n,dexAmountOut:c,amountOutOfMoney:d,gasOfMoney:m,isOkxDex:p})=>{let f=e(d)?.toString(),g=e(m)?.toString();return{logoUrl:o,dexName:r,comparePercent:i,price:n,isOkxDex:p,formatPrice:tt(n),dexAmountOut:T.BigNumber(c).toString(),formatDexAmountOut:tt(c),amountOutOfMoney:f,formatAmountOutOfMoney:at(f,t,{needBillionMillionUnit:!1}),gasOfMoney:at(g,t),symbol:t||""}})??[]}get computedReferredFee(){let{bestRoute:t}=this.quote,{referredNetWorkFee:e,referredAmount:o}=t||{};if(!o||!e)return"";let{computedNowCurrencySymbol:r,currencyConversion:i}=this.commonStore,{from:n}=this.fromToStore;return h("swaptrade_modal_desc_crosschain_valuediff_variavle",{price:`${tt(o)} ${n.tokenSymbol}`,fee:`${at(i(e).toString(),r)}`})}get computedIsUsingCentralizedBridge(){let t=["8"],e=String(this.quote.bestRoute?.bridge?.bridgeId);return t.includes(e)}get computedIsNoQuote(){return this.quote.quoteError||this.quote.quoteNull||!this.quote.bestRoute||this.rootStore.safeMoonStore?.computedHoneypot||this.fromToStore.computedFormToTokenIsLeverageToken||this.rootStore.outerStore.computedFeeConfigErrorTips||!this.fromToStore.computedTypedValueIsValid}get computedSupportDappTradeByQuote(){return Number(this.quote?.bestRoute?.isSupportDappTrade)===1}setAggregateFetchStatus(t){return t}setAggregateSelectStatus(t){return t}setAggregateSelectId(t){return t}get computedIsOfflineType(){let{computedIsCrossChain:t}=this.rootStore.fromToStore;return t?Number(this?.quote?.bestRoute?.bridge?.bridgeType)===Uc.INTENT_BRIDGE:this?.quote?.bestRoute?.offlineType===Mc.YES}get computedIsFreeNetworkFee(){return this?.quote?.bestRoute?.bridge?.isFreeNetworkFee===Bc.FREE_NETWORK_FEE}get computedIsOkxProvider(){return!this?.quote?.bestRoute?.defiPlatformId||this?.quote?.bestRoute?.defiPlatformId===Z}get computedBridgeIsOkxProvider(){let{defiPlatformId:t}=this?.quote?.bestRoute?.bridge||{};return!t||t===Z}get computedPriceWarn(){let t=T.BigNumber(this?.quote?.bestRoute?.reducePercent),e=T.BigNumber(this?.quote?.bestRoute?.warnPercent);return{show:t&&t.isGreaterThan(e)}}get computedreducePercent(){return ac(this?.quote?.bestRoute?.reducePercent)}};u();l();O();var Um=a=>{let{quoteStore:t,swapStore:e}=M();!a&&t.bridgeQuoteSelectStatus!==0&&(t.setBridgeNoRouteTipStatus(e.confirmSwapVisible?2:1),t.setBridgeQuoteSelectStatus(0))},od=a=>Number(a.commonDexInfo?.code)===Nt.CROSS_CHAIN_INTERVAL,qm=a=>!a.pathSelectionRouterList?.length,Vm=a=>od(a)||qm(a),Wm=a=>{let{quoteStore:t}=M(),e=od(a)?{crossMaxAmount:a.commonDexInfo?.crossMaxAmount,crossMiniAmount:a.commonDexInfo?.crossMiniAmount}:null;t.setQuoteScope(e)},Gm=a=>{let{quoteStore:t}=M(),e=t.bridgeSelectId===Rt?a[0]:a?.find(i=>i.bridge.bridgeId===t.bridgeSelectId),o=I(a.find(i=>i.bridge.bridgeId===Z),"fromDexRouterList",[]);return Um(e),yt({},e||a[0],{fromDexRouterList:o})},Qm=({data:a})=>{let{commonDexInfo:t,singleChainSwapInfo:e,swapType:o,pathSelectionRouterList:r,intentCode:i,isSupportDappTrade:n,offlineType:c,traceData:d}=a||{},m=r?.map((C,k)=>({commonDexInfo:t,...C,isBest:k===0})),p={intentCode:i,offlineType:c,swapType:o,traceData:d},f={...e,...t,swapType:o,pathSelectionRouterList:m},g=m?.map(C=>({...t,...C,...p,isSupportDappTrade:n}));return{bestRoute:f,combineSelectionRouterList:g}},Hm=a=>{let{quoteStore:t,smartRouterStore:e}=M();if(e.showXRouteModal!==ur.XROUTER)return;let o=a.find(r=>r?.bridge?.bridgeId===t.pickRouter?.bridge?.bridgeId);o&&t.setPickRouter(o)},jm=({bestRoute:a,bridgeInfo:t,isAutoError:e,originData:o,combineSelectionRouterList:r},{fromToStore:i,quoteStore:n})=>{let c=yt({},a,t);n.updateSlippageInfoFetched(c),n.setBridgeSelectId(c?.bridge?.bridgeId),n.setQuote({...n.quote,bestRoute:c,quoteNull:e,quoteError:null,isFetchQuoting:!1}),Wm(o),e&&n.setBridgeFetchStatus(3),i.quoteUpdateFromTo(c),i.computedIsCrossChain&&(n.setPathSelectionRouterList(r||[]),Hm(r||[]))},rd=a=>{let{fromToStore:t,quoteStore:e,approveStore:o}=M(),{bestRoute:r,combineSelectionRouterList:i}=Qm({data:a}),n=Gm(r.pathSelectionRouterList),c=Vm(a);e.setQuoteNumber(e.quoteNumber+1),jm({bestRoute:r,bridgeInfo:n,isAutoError:c,originData:a,combineSelectionRouterList:i},{fromToStore:t,quoteStore:e}),xo({isAutoError:c},{approveStore:o}),Mo({isAutoError:c},{quoteStore:e})};var Zr=class extends Ne{constructor(e){super();this.isEnableBridgeQuoteSearch=!0;this.bridgeList=[];this.bridgeListPending=!0;this.bridgeQuoteSelectStatus=0;this.bridgeFetchStatus=0;this.bridgeNoRouteTipStatus=0;this.compareVisible=!1;this.dialogGroupVisibleStatus=1;this.bridgeSortType=0;this.setBridgeSelectId=e=>{this.bridgeSelectId=e};this.setBridgeQuoteSelectStatus=e=>{this.bridgeQuoteSelectStatus=e};this.setBridgeFetchStatus=e=>{this.bridgeFetchStatus=e};this.setBridgeNoRouteTipStatus=e=>{this.bridgeNoRouteTipStatus=e};this.setBridgeList=e=>{this.bridgeList=e};this.setBridgeListPending=e=>{this.bridgeListPending=e};this.setBridgeSortType=e=>{this.bridgeSortType=e};this.setCompareVisible=e=>{this.compareVisible=e};this.setDialogGroupVisibleStatus=e=>{this.dialogGroupVisibleStatus=e};this.getQuoteData=e=>{let o=kl();return this.bridgeFetchStatus===0&&this.setBridgeFetchStatus(1),R(Je(()=>y.get(this.getQuoteStoreUrl(),{params:o,signal:e,isolate:!0}).then(r=>(this.setBridgeFetchStatus(2),this.handleUpdateQuote(r),this.setQuoteNumber(this.quoteNumber+1),this.quotePending=!1,r)).catch(r=>{throw _.stuff(r),r}),qt.NUM,qt.TIMER))};this.handleUpdateQuote=e=>{if(e){let{data:o}=e;rd(o)}};this.updateBestRoute=e=>{let o={...this.quote.bestRoute,...e};this.setQuote({...this.quote,bestRoute:o}),this.rootStore.fromToStore?.quoteUpdateFromTo(o)};this.handleQuoteError=(e=null)=>{this.setQuote({...this.initQuote,quoteError:e}),this.handleReverseQuoteErrorAndNull(),this.setBridgeFetchStatus(4)};ut(this),Object.assign(this,e),this.rootStore=e}getQuoteStoreUrl(){return Ia}};u();l();O();var zm="1",Jm="2",sd={minValue:.01,maxValue:.5},id={minValue:.03,maxValue:.5},De=class{constructor(t){s(this,"slippageSetting",{autoIsSelected:!1,inputSlippage:""});s(this,"configSingle",sd);s(this,"configCross",id);s(this,"inputValue","");s(this,"inputCache","");s(this,"inputSlippageFocus",!1);s(this,"slippageNotice","");s(this,"hasSlippageError",!1);s(this,"hasSafeMoonWarning",!1);s(this,"isFrozen",!1);s(this,"frozenTooltip","");s(this,"clearNoticeAndError",()=>{this.slippageNotice="",this.hasSlippageError=!1});s(this,"setFrozenInfo",({computedSafeMoonNotSupport:t,isCrossBridgeOnly:e})=>{this.isFrozen=t||e,t?this.frozenTooltip=h("swaptrade_dialog_modal_current_notsupport"):e?this.frozenTooltip=h("swaptrade_dialog_modal_crosschain_notsupport"):this.frozenTooltip=""});s(this,"refreshInfo",()=>{let{inputSlippage:t}=this.slippageSetting;if(this.inputValue=t||"",this.computedSafeMoonTips||t!==""&&t!==void 0){let{computedSafeMoonTips:e,minSlippageShow:o,maxSlippageShow:r,computedAutoSlippage:i}=this,n=this.rootStore.fromToStore.computedIsSingleChain,{notice:c,isError:d,isWarning:m}=Hr({inputSlippageParams:this.computedSlippageValue,computedSafeMoonTips:e,minSlippageShow:o,maxSlippageShow:r,autoSlippageValue:i,isSingleChain:n});this.slippageNotice=c,this.hasSlippageError=d,this.hasSafeMoonWarning=m}});s(this,"onFocus",()=>{this.inputSlippageFocus=!0,this.hasSafeMoonWarning=!1,this.inputCache&&(this.onInput(null,this.inputCache),this.inputCache="")});s(this,"onInput",(t,e="")=>{let o=t||e;this.templeAutoSelected=!1;let{computedSafeMoonTips:r,minSlippageShow:i,maxSlippageShow:n,computedAutoSlippage:c}=this,d=this.rootStore.fromToStore.computedIsSingleChain,{notice:m,isError:p,isWarning:f}=Hr({inputSlippageParams:o,computedSafeMoonTips:r,minSlippageShow:i,maxSlippageShow:n,autoSlippageValue:c,isSingleChain:d});if(!ae(et(o))){let C=/^0{2,}/gm;o=o.replace(C,"0"),this.inputValue=o}let g=o||this.computedSafeMoonTips;this.slippageNotice=g?m:"",this.hasSlippageError=p,this.hasSafeMoonWarning=f});s(this,"onBlur",()=>{this.inputSlippageFocus=!1});s(this,"onSelectCustom",()=>{let t=this.inputValue,{computedSafeMoonTips:e,minSlippageShow:o,maxSlippageShow:r,computedAutoSlippage:i}=this,n=this.rootStore.fromToStore.computedIsSingleChain,{slippage:c,inputValue:d,notice:m,isError:p}=Hr({inputSlippageParams:t,computedSafeMoonTips:e,minSlippageShow:o,maxSlippageShow:r,autoSlippageValue:i,isSingleChain:n}),f=this.getSafeMoonStore();if(f.checkIsChanged&&f.checkIsChanged(t),e?this.inputValue=Gt(c):this.inputValue&&(this.inputValue=Gt(c),this.slippageNotice=m,this.hasSlippageError=p,this.hasSafeMoonWarning=!!e),(Number(t)===0||ae(t))&&(this.slippageNotice=""),p){this.onSelectAuto(),this.inputSlippageFocus=!1;return}xs({custom_or_auto:d?"custom":"auto"}),this.setSlippageSetting({autoIsSelected:!d,inputSlippage:d}),this.rootStore.quoteStore.fetchQuoteDebounce()});s(this,"onReset",()=>{let{inputSlippage:t}=this.slippageSetting;this.inputValue=t,this.clearNoticeAndError(),this.inputSlippageFocus=!1});this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,this.smartRouterStore=t.smartRouterStore,U(this,{},{autoBind:!0})}getSafeMoonStore(){return this.rootStore.safeMoonStore}getOrderSlippageInfo(){let{autoIsSelected:t}=this.slippageSetting,e=li(this.rootStore);return t||this.isFrozen?{autoSlippageInfo:e}:{customSlippage:String(this.computedRealSlippageValue),autoSlippageInfo:e}}get minSlippage(){let t=this.rootStore.fromToStore.computedIsSingleChain,{computedSafeMoonToken:e}=this.getSafeMoonStore();if(e){let o=T.BigNumber.max(this.configCross.minValue,this.configSingle.minValue);return o.isNaN()?.011:o.toString()}return t?this.configSingle.minValue:this.configCross.minValue}get maxSlippage(){return this.rootStore.fromToStore.computedIsSingleChain?this.configSingle.maxValue:this.configCross.maxValue}get minSlippageShow(){return T.mul(this.minSlippage,100)}get maxSlippageShow(){return T.mul(this.maxSlippage,100)}get computedAutoSlippage(){let{computedHoneypot:t}=this.getSafeMoonStore();if(t){let e=I(this,"rootStore.quoteStore.quote.bestRoute.realSlippage",0);return T.mul(e,100)}return Qr(this.rootStore)}get computedSafeMoonNotSupport(){let{computedHoneypot:t,computedSlippageTips:e}=this.getSafeMoonStore();return!!(t||e?.overLimit||e?.equalLimit)}get computedSafeMoonSlippage(){return this.getSafeMoonStore().computedSlippage}get computedSafeMoonTips(){return this.getSafeMoonStore().computedSlippageTips}get computedSafeMoonTip(){return this.getSafeMoonStore().computedSlippageTips?.tip}get computedSafeMoonPairSlippage(){return this.getSafeMoonStore().computedPairSlippage}get computedSlippageValue(){return this.getSlippageValue()}get computedRealSlippageValue(){let t=this.getSlippageValue();return Number(T.div(t,100))||0}isValidVolatilityTip(){if(Number(this.computedSlippageValue)>this.computedAutoSlippage)return!1;let t=this.getSafeMoonStore(),e=this.smartRouterStore;return t.computedSafeMoonToken===null&&!e?.isCrossBridgeOnly}get computedVolatilityTips(){if(!this.isValidVolatilityTip())return null;let{computedAutoSlippage:t}=this,e=this.rootStore?.quoteStore?.quote?.bestRoute||{},{priceFluctuationMonitorTime:o,priceFluctuationThreshold:r,fromPriceFluctuation:i,toPriceFluctuation:n,rateFluctuationThreshold:c,slippageFluctuationhold:d,rateFluctuation:m}=e,{from:p,to:f}=this.fromToStore,g=f?.tokenSymbol||"",C=p?.tokenSymbol||"",k=T.mul(d,100),P=T.mul(r,100),w=T.mul(c,100),G=Number(m),K=Number(c);if(t>k){if(G<K)return null;let z=this.slippageSetting.autoIsSelected;return{tip:h("swaptrade_settings_alert_both_exchange_tips",{payToken:C,receiveToken:g,value:w,min:o}),tipEquation:h("swaptrade_settings_alert_both_exchange_tips",{payToken:W(C),receiveToken:W(g),value:w,min:o}),swapInterceptorType:z?H.VOLATILITY_SLIPPAGE:null}}else if(t===k){let z=Math.abs(i),mt=Math.abs(n),Q=Number(r);if(z>Q&&mt>Q)return{tip:h("swaptrade_placeorder_alert_both_volatility",{payToken:C,receiveToken:g,value:P,min:o}),tipEquation:h("swaptrade_placeorder_alert_both_volatility",{payToken:W(C),receiveToken:W(g),value:P,min:o})};if(z>Q)return{tip:h("swaptrade_placeorder_alert_pay_receive_volatility",{token:C,value:P,min:o}),tipEquation:h("swaptrade_placeorder_alert_pay_receive_volatility",{token:W(C),value:P,min:o})};if(mt>Q)return{tip:h("swaptrade_placeorder_alert_pay_receive_volatility",{token:g,value:P,min:o}),tipEquation:h("swaptrade_placeorder_alert_pay_receive_volatility",{token:W(g),value:P,min:o})};if(G>=K)return{tip:h("swaptrade_settings_alert_both_exchange",{payToken:C,receiveToken:g,value:w,min:o}),tipEquation:h("swaptrade_settings_alert_both_exchange",{payToken:W(C),receiveToken:W(g),value:w,min:o})}}return null}getDefaultSetting(){let t={inputSlippage:"",autoIsSelected:!0},e=this.getSafeMoonStore();if(e.computedSafeMoonToken){let o=e.computedSlippage,r=Gt(o);e.isChanged&&r&&(t.inputSlippage=r,t.autoIsSelected=!1)}return t}getSlippageType(){return this.slippageSetting.autoIsSelected||this.isFrozen?ge.AUTO:ge.CUSTOM}getSlippageValue(t=this.slippageSetting){let{autoIsSelected:e,inputSlippage:o}=t;return e||this.isFrozen?this.computedAutoSlippage:o||this.computedAutoSlippage}setSlippageSetting(t){let e={...t},o=this.getSafeMoonStore(),{computedSafeMoonToken:r}=o;if(!r){this.slippageSetting=e;return}let i=this.getSlippageValue(e);if(i===this.getSlippageValue(this.slippageSetting)||o.isAccessSlippage(i)||!o.getSafemoonIsChangedLocal()){e.inputSlippage="",e.autoIsSelected=!0;let n=Gt(i);o.isChanged&&n&&(e.inputSlippage=n,e.autoIsSelected=!1),o.setSafeMoonPairSlippage(i),this.slippageSetting=e}}async initSlippageConfigs(){try{let{data:t}=await y.get(Ga),e=t?.find(({configId:r})=>zm===r),o=t?.find(({configId:r})=>Jm===r);e&&(this.configSingle=e),o&&(this.configCross=o)}catch{this.configSingle=sd,this.configCross=id}}initSlippageSetting(){let t=this.getDefaultSetting(),e;t?e={...t}:e={autoIsSelected:!0,inputSlippage:""},this.setSlippageSetting(e)}initReactions(){_t(()=>{let{from:t,to:e}=this.fromToStore;return{chainId:t.chainId,toChainId:e.chainId,fromTokenAddress:t.tokenContractAddress,toTokenAddress:e.tokenContractAddress}},({fromTokenAddress:t,toTokenAddress:e})=>t&&e?(this.rootStore.quoteStore.slippageInfoFetched=!1,this.clearNoticeAndError(),this.initSlippageSetting()):!1,{equals:jt.shallow}),_t(()=>{let t=this.fromToStore.from.chainId,{computedSafeMoonSlippage:e}=this;return{fromId:t,computedSafeMoonSlippage:e}},this.clearNoticeAndError,{equals:jt.shallow}),_t(()=>{let{computedSafeMoonPairSlippage:t}=this;return{computedSafeMoonPairSlippage:t}},()=>{this.initSlippageSetting()},{equals:jt.shallow}),_t(()=>{let{isCrossBridgeOnly:t}=this.smartRouterStore,{computedSafeMoonNotSupport:e}=this;return{computedSafeMoonNotSupport:e,isCrossBridgeOnly:t}},this.setFrozenInfo,{equals:jt.shallow}),_t(()=>{let{slippageSetting:t,isFrozen:e,computedSafeMoonTip:o}=this;return{slippageSetting:t,isFrozen:e,computedSafeMoonTip:o}},this.refreshInfo,{equals:jt.shallow})}onSelectAuto(t=!1){xs({custom_or_auto:"auto"}),!this.hasSlippageError&&!this.hasSafeMoonWarning&&this.inputValue?this.inputCache=this.inputValue:this.inputCache="";let e={autoIsSelected:!0,inputSlippage:""};if(this.inputValue="",this.slippageNotice="",this.hasSlippageError=!1,this.hasSafeMoonWarning=!1,!t){let o=this.getSafeMoonStore();o.computedSafeMoonToken&&o.setSafeMoonIsChanged(!1),this.setSlippageSetting(e),this.rootStore.quoteStore.fetchQuoteDebounce()}}get computedMinimumReceived(){let{quote:t,computedIsOfflineType:e}=this.rootStore.quoteStore,{receiveAmount:o,minimumReceived:r}=t?.bestRoute||{},i=this.fromToStore.to?.tokenSymbol;if(this.hasSlippageError||!Vt(o))return"--";let n=this.inputValue?T.div(this.inputValue,100):this.computedRealSlippageValue,c=e?r:T.mul(o,1-(Vt(n)?n:0));return`${tt(c,{needBillionMillionUnit:!1})} ${i}`}get computedMinimumReceivedIsOrange(){let{quote:t}=this.rootStore.quoteStore,e=this.computedMinimumReceived,o=t?.bestRoute?.receiveAmount,r=T.BigNumber(o);return!r.isZero()&&!r.isNaN()&&T.div(T.sub(r,e),r)>=.1}};u();l();O();F();var Ii=class{constructor(t){s(this,"checkCrossChainParams",()=>{let{quoteStore:t,receiveAddressStore:e}=this.rootStore,{quote:o}=t,r=this.checkCommonParams(),{receiveAddrObj:i}=e,n=I(o.bestRoute,"quoteNetWorkFeeOfMoney"),c=o?.bestRoute?.bridge?.bridgeId,d=i?.specifiedAddress;return{...r,fromSwapFeeUsd:n,bridgeId:c,receiveWalletAddress:d}});s(this,"checkCommonParams",()=>{let{accountStore:t,fromToStore:e,quoteStore:o}=this.rootStore,{from:r,to:i}=e;return{fromChainId:r.chainId,fromTokenAddress:r.tokenContractAddress,amount:o?.computedQuoteAmount,toChainId:i.chainId,toTokenAddress:i.tokenContractAddress,userWalletAddress:t.address,accountId:t.computedAccountId}});s(this,"repeatOrder",null);s(this,"checkRepeatOrder",async()=>{this.repeatOrder=null;let{fromChainId:t,...e}=this.checkCommonParams(),{quoteStore:{quote:o}}=this.rootStore,r=I(o.bestRoute,"fromSwapFeeUsd"),i={...e,chainId:t,fromSwapFeeUsd:r},[n,c]=await R(y.get(ba,{params:i}));!n&&[pe.COMMON_REPEAT,pe.BTC_REPEAT,pe.FACET_REPEAT].includes(c?.data.repeatFlag)&&pt(()=>{let{orderId:d,enoughFlag:m}=c?.data??{};this.repeatOrder={enoughFlag:m,repeatFlag:c?.data.repeatFlag,id:d}})});s(this,"checkSwapMoreInfo",null);s(this,"checkCrossChainSwap",async()=>{this.checkSwapMoreInfo=null;let t=this.checkCrossChainParams(),[e,o]=await R(y.post(La,{...t}));e||pt(()=>{this.checkSwapMoreInfo=o?.data})});U(this),this.rootStore=t}},ts=Ii;u();l();F();var Fe=class{constructor(t){s(this,"swapOnDappBtnLoading",!1);s(this,"setSwapOnDappBtnLoading",t=>{this.swapOnDappBtnLoading=t});s(this,"refreshing",!1);s(this,"setRefreshing",t=>{this.refreshing=t});s(this,"dappListContainerVisible",!1);s(this,"setDappListContainerVisible",t=>{this.dappListContainerVisible=t});s(this,"fetchDappListError",!1);s(this,"setFetchDappListError",t=>{this.fetchDappListError=t});s(this,"availableNoticeVisible",!1);s(this,"setAvailableNoticeVisible",t=>{this.availableNoticeVisible=t});s(this,"dappList",[]);s(this,"setDappList",t=>{this.dappList=t});s(this,"getFetchParam",()=>{let{from:t,to:e,computedIsSingleChain:o}=this.fromToStore||{},r={},i="";return o?(i=tc,r={chainId:t?.chainId,tokenAddress:e?.tokenContractAddress}):(i=ec,r={fromChainId:t?.chainId,fromTokenAddress:t?.tokenContractAddress,toChainId:e?.chainId,toTokenAddress:e?.tokenContractAddress}),{url:i,params:r}});s(this,"fetchDappList",async t=>{t?(this.setFetchDappListError(!1),this.setRefreshing(!0)):this.setSwapOnDappBtnLoading(!0);let{url:e,params:o}=this.getFetchParam(),[r,i]=await R(y.get(e,{params:o}));if(this.setRefreshing(!1),this.setSwapOnDappBtnLoading(!1),r){if(Number(r.code)===40008){this.setAvailableNoticeVisible(!0);return}this.setFetchDappListError(!0),this.setDappListContainerVisible(!0);return}this.setDappList(i.data),this.setDappListContainerVisible(!0)});s(this,"getSupportDetail",(t={},e=!1)=>{let o=this.chainIsSupportMarket(t),r=this.chainIsSupportDappTrade(t),i=!!this.quoteStore?.computedSupportDappTradeByQuote,n=!o&&r,c=o&&r,d=o&&!r;return{chainSupportMarket:o,chainSupportDappTrade:r,quoteSupportDappTrade:i,balance:c||d,kline:c||d,klineJumpMarket:c||d,costValue:e&&c||d,valueDifference:d,liquidity:d,disableInput:n||c,showMax:d,showAddFund:d}});s(this,"mergeCurrencyInputProps",(t,e)=>({balanceStatus:e.balance?t.balanceStatus:st.BALANCE_NOT_SHOW,costValue:e.costValue?t.costValue:"",valueDifference:e.valueDifference?t.valueDifference:{},disableInput:e.disableInput,showMax:e.showMax?t.showMax:!1,showMaxIcon:e.showMax?t.showMaxIcon:!1,showAddFund:e.showAddFund?t.showAddFund:!1}));s(this,"getCurrentFromToChainConfig",()=>{let t=this.fromToStore.from.chainId,e=this.fromToStore.to.chainId,o=this.commonStore.getChainByID(t),r=this.commonStore.getChainByID(e);return[o,r]});s(this,"chainIsSupportMarket",t=>Number(t?.isSupportMarket)===1);s(this,"chainIsSupportDappTrade",t=>Number(t?.isSupportDappTrade)===1);s(this,"bridgeSupportDappTrade",t=>Number(t?.supportLinkDapp)===1);s(this,"getSupportDappTradeByToken",()=>{let t=this.quoteStore?.computedSupportDappTradeByQuote,e=this.liquidityChooseStore?.computedIsSelectedAllDex;return this.fromToStore.computedIsSingleChain&&t&&e});s(this,"checkShouldJumpToDapp",()=>this.fromToStore.computedFormToTokenIsLeverageToken?!1:this.computedSupportDappTradeByChain?!0:this.getSupportDappTradeByToken());this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,this.quoteStore=t.quoteStore,this.liquidityChooseStore=t.liquidityChooseStore,U(this,{},{autoBind:!0})}get computedFromToSupportMarketAndDappTrade(){let[t,e]=this.getCurrentFromToChainConfig();return{from:{...this.getSupportDetail(t,!0)},to:{...this.getSupportDetail(e)}}}get computedFromToSupportMarket(){let[t,e]=this.getCurrentFromToChainConfig();return this.chainIsSupportMarket(t)&&this.chainIsSupportMarket(e)}get computedSupportDappTradeByChain(){let t=this.fromToStore.from.chainId,e=this.fromToStore.to.chainId,o=this.commonStore.getChainByID(t);if(this.fromToStore.computedIsSingleChain)return this.chainIsSupportDappTrade(o);let r=o?.bridgeSupportChainInfoList,i=Array.isArray(r)&&r.find(n=>Number(n.chainId)===Number(e));return this.bridgeSupportDappTrade(i)}};var eo=class extends Ie{constructor(){v.init({project:cr});super();s(this,"reset",()=>{this.receiveAddressStore=new Vr(this),this.outerStore=new Jr(this),this.fromToStore=new be(this),this.approveStore=new Ce(this),this.quoteStore=new Zr(this),this.tokenModalStore=new Kr(this),this.safeMoonStore=new Oe(this),this.walletContractStore=new Ur(this),this.sendTransactionStore=new Wr(this),this.intentSwapStore=new qr(this),this.swapCheckStore=new ts(this),this.swapStore=new we(this),this.swapBtnStore=new Le(this),this.mevStore=new zr(this),this.recentTransactionStore=new yr(this),this.facetStore=new Yr(this),this.liquidityChooseStore=new Pe(this),this.swapDappStore=new Fe(this),this.smartRouterStore=new Tr(this),this.slippageStore=new De(this),this.oneMoreOrderStore=new $r(this),this.gasDropStore=new Xr});this.reset()}},Uo=eo;s(Uo,"instance",null),s(Uo,"getInstance",()=>(eo.instance||(eo.instance=new eo),eo.instance));var nd=Uo;u();l();F();u();l();var es=class extends ve{constructor(t){super(t),ut(this)}getSearchParams(t){return this.singleSearchParams(t)}};u();l();O();F();u();l();O();var Zm=a=>{let{quoteStore:t,swapStore:e}=M();!a&&t.aggregateSelectStatus!==0&&(t.setAggregateNoRouteTipStatus(e.confirmSwapVisible?2:1),t.setAggregateSelectStatus(0))},tp=a=>{let{quoteStore:t}=M(),e=t.aggregateSelectId===Rt?a[0]:a.find(r=>r.defiPlatformId===t.aggregateSelectId),o=I(a.find(r=>r.defiPlatformId===Z),"dexRouterList",[]);return Zm(e),yt({},e||a[0],{dexRouterList:o})},ep=({data:a,isCompareResult:t})=>{let{commonDexInfo:e,singleChainSwapInfo:o,swapType:r,isSupportDappTrade:i,defiPlatformInfoList:n,traceData:c}=a,d=n.map((p,f)=>({...p,isBest:f===0}));return{bestRoute:{...o,...e,isSupportDappTrade:t?i:"0",swapType:r,defiPlatformInfoList:d,traceData:c}}},op=({bestRoute:a,aggregateInfo:t,isAutoError:e},{fromToStore:o,quoteStore:r})=>{let i=yt({},a,t);r.updateSlippageInfoFetched(i),r.setAggregateSelectId(i.defiPlatformId),r.setQuote({...r.quote,bestRoute:i,quoteNull:e,quoteError:null,isFetchQuoting:!1}),e&&r.setAggregateFetchStatus(4),o.quoteUpdateFromTo(i)},rp=a=>{let{solanaPriorityFeeStore:t}=M();t&&a?.jitoData&&t.setJitoData(a?.jitoData)},ad=a=>{let{fromToStore:t,quoteStore:e,approveStore:o}=M(),r=e.aggregateFetchStatus===3,{bestRoute:i}=ep({data:a,isCompareResult:r}),n=tp(i.defiPlatformInfoList),c=r&&i.defiPlatformInfoList.length===0;e.setQuoteNumber(e.quoteNumber+1),op({bestRoute:i,aggregateInfo:n,isAutoError:c},{fromToStore:t,quoteStore:e}),rp(a),xo({isAutoError:c},{approveStore:o}),Mo({isAutoError:c},{quoteStore:e})};var os=class extends Ne{constructor(e){super();this.enableQuoteAggregates=!0;this.setAggregateSelectId=e=>{this.aggregateSelectId=e};this.aggregateSelectStatus=0;this.setAggregateSelectStatus=e=>{this.aggregateSelectStatus=e};this.aggregateFetchStatus=0;this.setAggregateFetchStatus=e=>{this.aggregateFetchStatus=e};this.fetchOKXQuote=({params:e,signal:o})=>{this.aggregateFetchStatus!==3&&y.get(this.outerStore.aggregatorQuoteUrl(),{params:yt({},e,{defiPlatformIds:Z}),signal:o}).then(r=>{this.aggregateFetchStatus===1&&(this.setAggregateFetchStatus(2),this.handleUpdateQuote(r),this.setQuoteNumber(this.quoteNumber+1),this.quotePending=!1)}).catch(r=>{_.stuff(r)})};this.getQuoteData=e=>{let o=vt();return this.fetchOKXQuote({params:o,signal:e}),R(Je(()=>this.fetchAggregatesQuote({params:o,signal:e}),qt.NUM,qt.TIMER))};this.handleUpdateQuote=e=>{if(e){let{data:o}=e;ad(o)}};this.updateBestRoute=e=>{let o={...this.quote.bestRoute,...e};this.setQuote({...this.quote,bestRoute:o}),this.rootStore.fromToStore?.quoteUpdateFromTo(o)};this.aggregateNoRouteTipStatus=0;this.setAggregateNoRouteTipStatus=e=>{this.aggregateNoRouteTipStatus=e};this.handleQuoteError=(e=null)=>{this.setQuote({...this.initQuote,quoteError:e}),this.handleReverseQuoteErrorAndNull(),this.setAggregateFetchStatus(5)};this.aggregatorList=[];this.setAggregatorList=e=>{this.aggregatorList=e};this.aggregatorListPending=!0;this.setAggregatorListPending=e=>{this.aggregatorListPending=e};this.fetchAggregatorList=()=>(this.setAggregatorListPending(!0),y.get(Aa).then(e=>{this.setAggregatorList(e.data)}).catch(()=>{this.setAggregatorList([])}).finally(()=>{this.setAggregatorListPending(!1)}));this.compareVisible=!1;this.setCompareVisible=e=>{this.compareVisible=e};this.dialogGroupVisibleStatus=1;this.setDialogGroupVisibleStatus=e=>{this.dialogGroupVisibleStatus=e};ut(this),Object.assign(this,e),this.rootStore=e}fetchAggregatesQuote({params:e,signal:o}){return y.get(this.outerStore.aggregatorQuoteUrl(),{params:e,signal:o,isolate:!0}).then(r=>(this.aggregateFetchStatus===2&&this.setAggregateSelectId(Rt),this.setAggregateFetchStatus(3),r))}};u();l();u();l();var cd=a=>{if(!a)return[];let{solPrice:t,solTokenSymbol:e,solDecimals:o}=a;return xc.map(r=>({type:r,fee:a[r],usd:a[`${r}Usd`],solPrice:t,solTokenSymbol:e,solDecimals:o}))};var Ci=class{constructor(t){s(this,"visible",!1);s(this,"setVisible",t=>{this.visible=t});s(this,"feeType",Us.MARKET);s(this,"setFeeType",t=>{this.feeType=t});s(this,"customFee",null);s(this,"setCustomFee",t=>{this.customFee=t});s(this,"jitoData",null);s(this,"setJitoData",t=>{this.jitoData=t});this.rootStore=t,ut(this)}get computedPriorityFeeList(){return cd(this.jitoData)}get computedPriorityFeeAmount(){return this.jitoData?this.feeType===Us.CUSTOM?this.customFee:this.computedPriorityFeeList.find(e=>e.type===this.feeType)?.fee:null}get computedPriorityFeeOfUsd(){if(!this.jitoData)return null;let{solPrice:t}=this.jitoData;return T.mul(this.computedPriorityFeeAmount,t,{returnString:!0})}},ud=Ci;var oo=class extends Ie{constructor(){v.init({project:cr});super();s(this,"reset",()=>{this.receiveAddressStore=new Vr(this),this.outerStore=new Jr(this),this.fromToStore=new be(this),this.approveStore=new Ce(this),this.quoteStore=new os(this),this.tokenModalStore=new es(this),this.safeMoonStore=new Oe(this),this.walletContractStore=new Ur(this),this.sendTransactionStore=new Wr(this),this.intentSwapStore=new qr(this),this.swapCheckStore=new ts(this),this.swapStore=new we(this),this.swapBtnStore=new Le(this),this.solanaPriorityFeeStore=new ud(this),this.mevStore=new zr(this),this.recentTransactionStore=new yr(this),this.facetStore=new Yr(this),this.liquidityChooseStore=new Pe(this),this.swapDappStore=new Fe(this),this.smartRouterStore=new Tr(this),this.slippageStore=new De(this),this.oneMoreOrderStore=new $r(this)});this.reset()}},qo=oo;s(qo,"instance",null),s(qo,"getInstance",()=>(oo.instance||(oo.instance=new oo),oo.instance));var ld=qo;var sp=({localeData:a,...t})=>{let e=(0,dd.useLocation)(),o;return e.pathname.includes(St)?o=E.BRIDGE:e.pathname.includes(ic)?o=E.LIMIT_ORDER:e.pathname===ft&&(o=E.SWAP),rs.default.createElement(Gs,{localeData:a,isDev:!0,noRemoteData:!0},rs.default.createElement(qu,{swapRootStore:ld,bridgeRootStore:nd,initTab:o},rs.default.createElement(gl,{currentTab:o,...t})))};var md=Ot(sp);Md();Dd();Gi();Xo();zi();ue();qd();Ud();xd();u();l();var Ai=L(q());F();ue();var pd=({visible:a,onClose:t,onChange:e,walletId:o})=>Ai.default.createElement(Ws,{visible:a,onClose:t,onChange:e,coinId:Yi,walletId:o},Ai.default.createElement(Ws.Header,{title:Ut("extension_defi_top_header_title_select_address_type"),subTitle:Ut("extension_defi_popup_desc_new_address_default")}));u();l();var hd=L(q()),fd=L(Ts());O();var Sd=L(Vd());fs();Xo();ue();var ip=({walletId:a,txParams:t,onConfirm:e,onCancel:o,backable:r=!1,onBack:i,asPage:n})=>{let c=qn(a),d=Vn(Pt,c?.walletId),m=su({coinAmount:0,localType:Pt,coinId:$i,fromAddr:d,walletId:c?.walletId,txSource:$o.DAPP}),p={localType:Pt,params:{transaction:t},walletId:c?.walletId},f=(0,fd.useMemoizedFn)(async({networkFee:g})=>{let{raw_data:C,raw_data_hex:k,txID:P,visible:w}=t||{};try{let G=await Tt().signCommonMessage(d,{type:"protobuf",message:JSON.stringify({txID:P,visible:w,raw_data:C,raw_data_hex:k})},Pt),K=Sd.default.address.fromHex(I(C,"contract[0].parameter.value.contract_address",d)),z=await Zc(Pt,G);await m(G,{toAdr:K,txHash:z,serviceCharge:g}),e?.({txHash:z})}catch(G){e({error:G})}});return hd.default.createElement(vu,{backable:r,onBack:i,asPage:n,unapproved:p,onCancel:o,onConfirm:f})},gd=ip;u();l();var xt=L(q()),bd=L(un());var Ld=L(Ts());O();F();u();l();var Td=L(q());Fd();ue();var np=async(a={})=>{let{contractAddress:t,contractName:e,functionName:o,functionArgs:r}=a,{getRawTransaction:i}=await Is(),n={data:{type:Ss.CONTRACT_CALL,data:{contract:t,contractName:e,functionName:o,functionArgs:r}}};return await i(5757,n)},ap=async(a={})=>{let{recipient:t,amount:e,memo:o}=a,{getRawTransaction:r}=await Is(),i={data:{type:Ss.TRANSFER,data:{to:t,amount:e,memo:o}}};return await r(5757,i)},cp=async(a={})=>a.txType===gs.CONTRACT_CALL?np(a):a.txType===gs.STX_TRANSFER?ap(a):"",Id=async({transaction:a={},fromAddress:t,value:e})=>{let o=await cp(a);return(await Du({coinId:Xi,fromAddress:t,value:e,inputData:o}))?.gasLimit||"0"};u();l();var up=L(q());O();ue();fs();async function Cd(a,t){let e=async()=>await kr({coinId:ps,address:a},{fromAddr:a,toAddr:""}),o=async d=>{let m=I(d,"info.nonce",0),p={type:Tn.MULTI_CONTRACT_CALL,nonce:m,maxFee:0,chainId:hu.StarknetChainId.SN_MAIN,multiContractCallData:{from:a,calls:t}};return(await Tt().signTransaction(p,a,jo))?.signature},r=async d=>{let{data:m}=await Rr({coinId:ps,address:a,inputData:d});return m?.gasLimit},i=await e(),n=await o(i);return await r(n)}Bd();Gi();Xo();ue();nn();fs();u();l();var Ad=L(Hd()),yi=L(Wd());O();Xo();zi();ue();nn();async function yd(a,t){return(await Pn()).address.fromHex(I(a,"raw_data.contract[0].parameter.value.contract_address",t))}function _d(a){return I(a,"raw_data.contract[0].parameter.value.data","")}function Ed(a){let t=I(a,"raw_data.contract[0].parameter.value.call_value"),e=I(a,"raw_data.contract[0].parameter.value.amount","");return t||e}async function lp(a){let{data:t={}}=await qs({coinId:Ko,address:a},{fromAddr:a}),{info:e={}}=t;return e}async function dp(a,t){let{transaction:e,bizType:o,bizId:r=[],notReplaceBlockhash:i=!1}=a,n=null,c=()=>typeof a?.toJSON=="function"?a:a?.instruction,{recentBlockhash:d,lastValidBlockHeight:m}=await lp(t),p=c();return p?n=new Cs({feePayer:t,blockhash:d,lastValidBlockHeight:m}).add(p):e&&(i||(e instanceof Dn?e.message.recentBlockhash=d:(e.signatures=[],e.recentBlockhash=d),e.lastValidBlockHeight=m,r.forEach(f=>{let g=(0,Ad.mnemonicToSeed)(o,f),C=Fn.fromSeed(g.slice(0,32));e?.version>=0?e.sign([C]):e.partialSign(C)})),n=e),n}async function kd(a,t){let e=await dp(a,t);return e instanceof Cs?yi.default.encode(e.serialize({requireAllSignatures:!1,verifySignatures:!1})):yi.default.encode(e.serialize())}function ro(a){let t=ao({netWorkId:String(a)}),e=t?.baseChain||"",o=t?.localType||"",r=t?.coinId||3,i=t?.realChainIdHex;return{baseCoinId:r,networkType:o,chainId:i,baseChain:e}}async function _i({networkId:a,address:t,data:e,tokenAddress:o}){let r={},{baseCoinId:i}=ro(a),n={coinId:i,address:t},c={fromAddr:t,value:"0"},d={address:t,inputData:e,coinId:i,value:"0",tokenAddress:o},{data:m}=await Rr(d),{gasLimit:p}=m,{data:{info:f}}=await qs(n,c),g=f?.needExtFee||!1,C=f?.gasPrice||{},{normal:k,proposePriorityFee:P,supportEip1559:w}=C;if(!g)return r={maxFeePerGas:k,maxPriorityFeePerGas:P,gasPrice:k,gasLimit:p,supportEip1559:w,networkFee:co(k,p)},r;let G={from:t,to:o,data:e,value:Jo(0),gasPrice:Jo(k),gasLimit:Jo(p)},K=cn(G),z=await iu(K),mt=await Kc({coinId:i},{inputData:z}),Q=Yo(co(k,p),mt);return r.networkFee=Q,r.extFee=mt,r}function ne(a,t){return sn(on(a,10**t))}var mp=({code:a,data:t,error_message:e,error:o})=>{if(a!==0||!t||t.queryGasLimitErrorUseDefault||o)return{fee:0,error:e};let{gasLimit:r="0"}=t;return{...t,fee:r,error:!1}};async function Ei({walletId:a,coinId:t,fromAddr:e,tx:o}){let r=o[0],i=r?.messages||[],n=r?.network||1,c=i?.valid_until||Math.floor(Date.now()/1e3)+600,{address:d}=i[0]||{},m=await kr({coinId:t,address:e,toAddr:d,fromAddr:e}),p=m?.chainId,f=m?.info?.nonce,g=await xu({nonce:f,localType:Be,fromAddr:e,walletId:a,messages:i,network:n,validUntil:c}),C=JSON.stringify(g.stringInputParams),k=await Mu({fromAddr:e,chainId:p,coinId:t,inputData:C}),P=mp(k),w={coinId:t,coinAmount:0,inputData:C,fromAdr:e,toAdr:d,serviceCharge:P?.fee,extJson:JSON.stringify({nonce:f}),txSource:$o.DEX,accountId:a,walletType:Cn.IMPORT,transactionParams:g?.transactionParams};return{feeInfo:P,extParams:w}}var Rd=-42412,pp=-42418,hp=xe(au,500);function wd(a,t){let{baseCoinId:e}=ro(a),o=$c(t?void 0:e,void 0,t?{chainId:+a,address:t}:void 0),r=(0,xt.useRef)({coinAmount:0,coinAmountInt:0,currencyAmount:0,currencyAmountUSD:0});return Xc(o?.coinId)||r.current}async function fp({coinId:a=3},{gasInfo:t={},calldata:e}){let{networkFee:o,isNetworkFeeLoading:r,isGasLimitLoading:i}=t,n=r||i,{minGasFee:c}=nu(t),d=rn(c),m=Vs(t,"swap"),p=await hp(a,e),f=m||p;return f===!0&&(f=Ut("swaptrade_extension_cinteraction_might_error")),{fee:d,feeInt:c,maxFeeInt:o,loading:n,error:f}}async function Sp(a,{decimals:t},{calldata:e}){let{transaction:o}=e,{fee:r}=await Yc({coinId:Ko,address:a}),i;if(o){let m=eu(o);i=tu(o,m)}let{totalPriorityFee:n}=await Pu([i]),c=Yo(r,n);return{fee:ne(c,t),feeInt:c}}async function gp(a,{decimals:t},{calldata:e}){let o=await Fu({address:a,transaction:e});return{fee:ne(o,t),feeInt:o}}async function Tp(a,{decimals:t},{calldata:e}){let o=await wu({address:a,inputData:_d(e),toAddr:await yd(e,a),value:Ed(e)});return{fee:ne(o,t),feeInt:o}}async function Ip(a,{decimals:t},{calldata:e}){let o=Nu.from(e.transactionBlock);o.setSenderIfNotSet(a);let r=o?.blockData?.gasConfig?.budget||"0";return{fee:ne(r,t),feeInt:r}}async function Cp(a,{decimals:t},{calldata:e}){let o=await Id({transaction:e,fromAddress:a,value:"0"});return{fee:ne(o,t),feeInt:o}}async function Ap(a,{decimals:t},{calldata:e}){let o=await Cd(a,e);return{fee:ne(o,t),feeInt:o}}async function yp(a,{decimals:t,coinId:e,chainId:o},r,{calldata:i}){let n=await Ei({walletId:r,fromAddr:a,coinId:e,chainId:o,tx:i}),c=n.feeInfo.fee,d=n.feeInfo.error;return{fee:ne(c,t),feeInt:c,error:d}}function vd(a,t){let e=Wn(),{baseChain:o,baseCoinId:r}=ro(a),{baseCoin:i}=zc(r,!0),n=ys(o),{symbol:c}=(0,bd.useSelector)(zo),d=Qn(r)||0,[m,p]=(0,xt.useState)(0),[f,g]=(0,xt.useState)(0),[C,k]=(0,xt.useState)(0),[P,w]=(0,xt.useState)(!1),[G,K]=(0,xt.useState)(!1),z=(0,xt.useMemo)(()=>{let mt=co(m,d);return{estimatedGasFeeInt:f,maxGasFeeInt:C,decimals:i?.decimals,currencyAmount:mt,currencySymbol:c,coinSymbol:i?.symbol,loading:P,error:G}},[i.decimals,i.symbol,c,G,f,C,P,d,a,t,t?.gasInfo?.isNetworkFeeLoading,t?.gasInfo?.isGasLimitLoading]);return(0,Ld.useDeepCompareEffect)(()=>{async function mt(){let Q={fee:0,feeInt:0};w(!0),K(!1);try{o===ms?Q=await fp(i,t):o===Me?Q=await Sp(n,i,t):o===Hi?Q=await gp(n,i,t):o===ji?Q=await Ip(n,i,t):o===Pt?Q=await Tp(n,i,t):o===Ki?Q=await Cp(n,i,t):o===jo?Q=await Ap(n,i,t):o===Be&&(Q=await yp(n,i,e,t)),p(Q.fee),g(Q.feeInt),k(Q.maxFeeInt||Q.feeInt)}catch{p(0),g(0)}finally{w(!!Q.loading),K(Q.error)}}mt()},[a,t]),z}async function _p({networkId:a,tx:t,hardwareExtParams:e,checkTxBeforePublish:o,currentWallet:r}){let i=t,{baseChain:n,chainId:c,baseCoinId:d}=ro(a);if(n===Me){let{account:m}=r,p=m[Me];return i.transaction=await kd(t,p),{target:i}}if(n===ms){if(Vs(t?.gasInfo,"swap"))throw new Error(Ut("wallet_home_toast_network_error"));let p=i.value||i.amount||0,f=ro(a).baseCoinId;i={...i,...i.gasInfo};let g=await o({...i,userGasInfo:i.gasInfo,coinId:f,amount:p,baseCoinAmountUse:p}),{nonce:C,updateGasInfo:k={}}=g||{};i.nonce=C,i.maxFeePerGas=k.maxFeePerGas||i.maxFeePerGas,i.maxPriorityFeePerGas=k.maxPriorityFeePerGas||i.maxPriorityFeePerGas,i.gasPrice=k.gasPrice||i.gasPrice;let P=await Tt().getSelectedWallet(),w=await Tt().generateFormatedTxParams(a,i),{dispatch:G}=e||{};return G&&(await G(Mn({txParams:w,walletId:P})),i.result=w.result,i.walletId=P),{target:i}}if(n===Qi){let m=await Tt().getSelectedWallet(),p=await Tt().generateFormatedTxParams(a,i),f=await Bn(p,p.address,n,m);return i.result=f,i.walletId=m,{target:i}}if(n===Be){let{walletId:m,account:p}=r,f=p[Be],{extParams:g}=await Ei({walletId:m,fromAddr:f,coinId:d,chainId:c,tx:t});return{target:i,extParams:g}}return{target:i}}async function ki({networkId:a,tx:t,hardwareExtParams:e,checkTxBeforePublish:o,currentWallet:r}){if(!t)throw new Error("tx is required");let i=t;try{let{target:n,extParams:c}=await _p({networkId:a,tx:t,hardwareExtParams:e,checkTxBeforePublish:o,currentWallet:r});return i=n,await Tt().dexSignAndSubmitTransaction(a,i,c)}catch(n){throw n?.data?.originalError?(n.message=n?.data?.originalError?.error_message,n.code=Rd):n?.message===vn?(n.message=Ut("wallet_extension_swap_error_hardware_not_support"),n.code=Rd):n.code=pp,n}finally{hs()===ds&&Tt().focusLastOkPopupWithCache()}}async function Pd(a,t){let e=t;try{return typeof t=="string"&&(e=JSON.parse(t)),await Tt().dexSignTypedDataV4(a,e)}finally{hs()===ds&&Tt().focusLastOkPopupWithCache()}}var Od=a=>{let{chainId:t}=An(a),e=As(a).some(m=>Nn(m.coinId)),o=e?bn(a):As(a),r;e?r=o.find(m=>m.realChainIdHex===t)||{}:r=o[0]||{};let i=Number(e?r.netWorkId:r.chainId),n=yn(a),c=En(a);return{walletType:{isMNEMONIC:c[n].keyringIdentityType===me.MNEMONIC,isPRIVATE:c[n].keyringIdentityType===me.PRIVATE_KEY,isHARDWARE:c[n].keyringIdentityType===me.HARDWARE,isMPC:c[n].keyringIdentityType===me.MPC},chainId:i}};b.initSentry(en,tn,process.env.APP_VERSION);b.setGlobal({HARDWALLETERROR:wn,getApiHostname:Ji,getStaticHostname:Zi,LocalStore:Ri,interceptorHeaders:fn,urlConfig:Sn,FeeTypeEnum:In,netWorkIdToLocalType:new Proxy({},{get(a,t){return ao({netWorkId:String(t)})?.localType}}),localTypeToBaseCoinId:new Proxy({},{get(a,t){return ao({localType:t})?.coinId}}),isTelegramMiniApp:an()===Wi,KeyringIdentityTypeEnum:me,RegisterLocalStatusEnum:gn,hexToDecimal:On,signAndSubmitTransaction:ki,signTypedDataV4:Pd,getGasPrice:_i,checkMPCStatus:uu,hooks:{useCoin:wd,useUtxoListFn:lu,useFeeDisplay:vd,useRegisterStatus:fu,useGasReturnActivity:Jc,useSignInfo:ru,useUtxoEstimateFee:mu,useUtxoCheckBeforePublishFn:du,useUtxoSignAndPublishTransactionFn:pu},components:{EvmConfirm:Ru,TronConfirm:gd,EthereumNetworkFee:cu,SupplyGas:ou,StarknetRegister:_u,Affix:Un,InteractiveAddress:Au,NetworkFeeEnter:Cu,ViewData:Lu,SectionWrap:Iu,ModuleWrap:gu,TipMessage:yu,CoinSummary:Tu,UtxoNetworkFeePanel:bu,Mev:ku,Layout:hn,SwitchAddress:pd,Navigator:Gn,SolanaEntry:Ou}});var Ep=()=>{let a=(0,is.useHistory)(),{pathname:t}=(0,is.useLocation)(),e=(0,Mt.useSelector)(Rn);return(0,ss.useCallback)((o,r)=>{if(e&&r){a.replace(Ln);return}o()},[e,t])},ZN=()=>{let a=(0,Mt.useDispatch)(),t=(0,Mt.useSelector)(zo),e=(0,Mt.useSelector)(kn),o=(0,Mt.useSelector)(mn),r=Su(),i=(0,Mt.useSelector)(_n),n=(0,Mt.useSelector)(pn),c=(0,Mt.useSelector)(Od),d=i.map(f=>{if(xn(f.initialType)){f=bi(f);try{delete f.account[Me],delete f.account[Pt]}catch{Wo()}}return f}),m=Ep(),p=Eu();return(0,Nd.useMount)(()=>{b.updateGlobal({signAndSubmitTransaction:async(f,g,C)=>await ki({networkId:f,tx:g,hardwareExtParams:C,checkTxBeforePublish:p,currentWallet:e})})}),ss.default.createElement(md,{t:Ut,dispatch:a,onBack:m,currency:t,currentWallet:e,localeData:o,addressBookList:r,walletList:d,locale:n,walletInfo:c})};export{ZN as default};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=dex-3N52EIAB.js.map
