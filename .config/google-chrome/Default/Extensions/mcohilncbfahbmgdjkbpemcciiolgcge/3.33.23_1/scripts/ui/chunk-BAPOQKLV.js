import{a as xe,b as Ae}from"./chunk-F46AEGKF.js";import{b as ge}from"./chunk-ELKHXPPU.js";import{b as ce,g as me,i as de,l as ue,m as fe,r as pe,s as ye}from"./chunk-D6NWGDM6.js";import{a as ie}from"./chunk-ZVUQCOMJ.js";import{e as ae}from"./chunk-TSGQQ5QA.js";import{a as Te}from"./chunk-UUX3UNZW.js";import{c as _e,d as tt,e as et,g as S}from"./chunk-SIIB3XCZ.js";import{a as re,q as j}from"./chunk-UTVBVZWC.js";import{d as oe,g as se}from"./chunk-GQYTOJVD.js";import{a as le}from"./chunk-FSQDFL3V.js";import{c as ee}from"./chunk-SJRV5U24.js";import{b as $t}from"./chunk-AQH6QKNE.js";import{f as xt}from"./chunk-KP7FQOJR.js";import{b as _t}from"./chunk-C77TCOTM.js";import{h as gt,i as ne}from"./chunk-A3B5II6P.js";import{d as Tt}from"./chunk-XVPROSYE.js";import{i as Xt,m as Qt,n as te}from"./chunk-QHZHYX4V.js";import{a as Kt}from"./chunk-LXIBKSOK.js";import{a as Q}from"./chunk-DUKP4BLI.js";import{b as yt}from"./chunk-S3O4LR55.js";import{q as C}from"./chunk-FZCNSMLW.js";import{o as Jt}from"./chunk-KCWFMCND.js";import{w as Ge}from"./chunk-3TDWET6C.js";import{V as X,b as K,da as qt}from"./chunk-EBR3PGFZ.js";import{a as Ze}from"./chunk-VPGNJAK6.js";import{c as w}from"./chunk-FDCWN4NG.js";import{Dc as q,Ic as Ht,Kc as zt,Mc as Vt,Sc as J,Ua as Dt,Uc as Gt,Vc as $,Wc as Zt,X as Wt,Ya as Ut,a as kt,b as ze,qc as Z,vc as jt,yc as Rt}from"./chunk-O3CM75EN.js";import{G as Yt,b as Mt,o as vt}from"./chunk-J3CEQI22.js";import{F as Ot,pa as Ve}from"./chunk-VFHYER2K.js";import{L as G,l as P,w as f}from"./chunk-KJIO572I.js";import{a as M}from"./chunk-EAZTJZU7.js";import{f as h,m as c,o as m}from"./chunk-ZCHLW7CF.js";c();m();var t=h(M()),Oe=h(Ge()),We=h(Ze()),ot=h(Jt());Ve();G();Vt();Ut();jt();c();m();var I=h(M());G();jt();c();m();var Ie={list:"_list_shbob_1"};var qe=({coinId:e,value:n,visible:a,onToggleVisible:i,options:o,onChange:u})=>{let g=oe(e),b=p=>{let{addressType:y,address:x,canTransferAmount:E}=p;return I.default.createElement(Tt.Card,{selected:n?.address===x,onClick:()=>{i?.(),u?.(p)}},I.default.createElement(w.Box,{style:{width:"100%"}},I.default.createElement(w.FlexBox,{justify:"space-between",align:w.ALIGN.center},I.default.createElement(C.Text,{strong:!0},f(Z[y])),I.default.createElement(C.DisplayAmount,{strong:!0,mode:C.CRYPTO,decimals:g?.decimals},E)),I.default.createElement(w.FlexBox,{justify:"space-between",align:w.ALIGN.center},I.default.createElement(C.Address,{address:x,desensitize:!0,copyable:!1,size:C.SIZE.sm,type:C.TYPE.secondary}),I.default.createElement(C.Text,{type:C.TYPE.secondary,size:C.SIZE.xs},f("extension_wallet_available_coin_balance",{coin:g?.symbol})))))};return I.default.createElement(vt,{visible:a,alignBottom:!0,noTopRadius:!1,windowStyle:{width:"100%"},title:f("btcnft_gas_title_pay_gas_with"),onClose:i},I.default.createElement(Tt,{space:16,dataSource:o,renderItem:b,className:Ie.list}))},Ne=qe;c();m();ze();var he=h(M()),Je=()=>(0,he.useCallback)(({value:e,message:n,reportParams:a})=>{try{kt.captureEvent({message:n,contexts:{report:{info:JSON.stringify(a)}},exception:{values:[{type:"BIZ_ERROR_btcPayWalletAddress",value:e}]},level:"warn"})}catch(i){console.log(i)}},[]),Ce=Je;c();m();var R=h(M());Vt();Zt();Gt();function $e(e,n,a,i){let[o,u]=(0,R.useState)(a),[g,b]=(0,R.useState)([]);return(0,R.useEffect)(()=>{if(i?.chainId===void 0||i?.chainId===null)return;(async()=>{try{if(!a)return;let y=await J($.checkDustForBtcTx,{inscriptionIds:n,targetAddress:e,scene:24,chain:i.chainId,tokenStandard:Ht(i.chainId)});b(y?.data?.dustInscriptionIds||[])}finally{u(!1)}})()},[a,e,n,i]),{isDustLoading:o,dustError:g.length>0}}var be=$e;c();m();var we=h(M());G();var Ke=({isMpcWallet:e,isHardware:n,feeError:a,isSufficientGas:i,dustError:o,transferReminder:u})=>({tipMessageProps:(0,we.useMemo)(()=>e?{type:S.TIP_TYPE.COMMON_ERROR,message:f("extension_wallet_contractual_interaction_wallet_unavailable")}:n?{type:S.TIP_TYPE.COMMON_ERROR,message:f("wallet_extension_top_toast_dapp_comingsoon")}:a?{type:S.TIP_TYPE.FEE_ERROR}:i?o?{type:S.TIP_TYPE.COMMON_ERROR,message:f("wallet_info_dialog_dust_limit_individually")}:{type:Mt.TYPE.warn,message:u}:{type:qt.FEE_BALANCE_INSUFFICIENT},[a,e,n,i,o,u])}),Ee=Ke;c();m();var Fe=h(Jt());Gt();Zt();var Xe=e=>{let{loading:n,data:a}=(0,Fe.useRequest)(async()=>(await J($.batchBtcNftDetail,{inscriptionIdProtocols:Array.isArray(e)?e:[e]}))?.data?.details||[]);return[n,a||[]]},Le=Xe;c();m();var At=h(M());G();Ut();var Qe=7*1e3,to=({walletId:e,coinId:n,satBytes:a,needFilteredUtxo:i,localType:o=Wt})=>{let u=Xt(e),g=(0,At.useMemo)(()=>{let x=$t(o);return u?.addressType?.[x]||[]},[u?.walletId]),[b,p]=ue({coinId:n,walletId:e,satBytes:a,addressList:g?.map(({address:x})=>x),needFilteredUtxo:i},{pollingInterval:Qe,ready:!!i?.length&&!!a}),y=(0,At.useMemo)(()=>g.map((E,A)=>({...E,canTransferAmount:p[A]}))?.sort((E,A)=>{let st=P.sub(A.canTransferAmount,E.canTransferAmount);return Number(st)}),[p,g]);return[b,y]},Be=to;c();m();var It={"nft-transfer__extend":"_nft-transfer__extend_1bjoo_1",nftTransferExtend:"_nft-transfer__extend_1bjoo_1","nft-transfer__icon":"_nft-transfer__icon_1bjoo_4",nftTransferIcon:"_nft-transfer__icon_1bjoo_4"};var Pe={Ordinals:"Ordinals",Atomicals:"Atomicals"},Se=2,ke="NFT",Ms=({unapproved:e})=>{let n=e?.walletId,a=e?.localType,o=ee({localType:a})?.coinId;o===void 0&&(o=Dt(a));let[u,g]=se(o),b=te(n),p=e.params.transfer.from,y=e.params.transfer.to,{feeRate:x}=e.params.transfer.options||{},E=Ce(),[,A]=ie({coinId:o,address:p,chainId:u?.chainId}),st=A?.transferReminder,[Nt,H]=(0,ot.useSetState)({payWallet:!1,networkFee:!1}),[F,ht]=(0,t.useState)(x&&typeof x=="number"?{satBytes:x,level:X.CUSTOM}:{satBytes:A?.normal,level:X.STANDARD});(0,t.useEffect)(()=>{!F?.satBytes&&A?.normal&&ht({satBytes:A?.normal,level:X.STANDARD})},[A,F]);let z=e.params.transfer.data,k=Array.isArray(z)&&z.length>1,{isDustLoading:Ct,dustError:rt}=be(y,z,k,g),[,l]=Le(z),v=(0,t.useMemo)(()=>{if(!Array.isArray(l)||!l?.length)return;let[{protocol:r}]=l||[];if(r===Pe.Atomicals)return q.ARC_20},[l]),nt=(0,t.useMemo)(()=>l.map(r=>`${r.btcNftUtxoDetail?.txId}-${r.btcNftUtxoDetail?.outputIndex}`),[l]),[bt,O]=Be({localType:a,coinId:o,walletId:n,needFilteredUtxo:nt,satBytes:F?.satBytes}),[s,at]=(0,t.useState)({}),[it,{toggle:De}]=(0,ot.useBoolean)(!1);(0,t.useEffect)(()=>{let r=O?.[0];if(Ot(s)&&!!r&&r?.canTransferAmount&&at(r),O&&s.address&&s?.canTransferAmount){let d=O.find(({address:_})=>_===s?.address);d||E({value:d,reportParams:{payWallet:s,payWallets:O},message:`payWallet address get ${d}`}),d&&at(d)}},[E,s,O]);let Y=(0,t.useMemo)(()=>l.map(r=>{let{tokenId:d,protocol:_}=r,{txId:D,outputIndex:U,outputValue:He}=r?.btcNftUtxoDetail||{},St={txHash:D,nftId:r.tokenId,status:1,address:p,vout:Number(U),coinAmount:Number(He),resourceUrl:r?.resourceUrl};return _===Pe.Atomicals&&Object.assign(St,{data:[{atomicalId:d,type:ke,amount:1}]}),St}),[p,l]),wt=(0,t.useMemo)(()=>l.map(r=>{let d=r?.tokenId,{outputValue:_}=r?.btcNftUtxoDetail||{},D=Number(_);k||(D=P.lt(_,546)?546:Number(_));let U={amount:D,address:y};return v===q.ARC_20&&Object.assign(U,{data:[{atomicalId:d,type:ke,amount:1}]}),U}),[k,l,v,y]),lt=(0,t.useMemo)(()=>{if(!k){let{outputValue:r=0}=l?.[0]?.btcNftUtxoDetail||{};if(r<546)return P.sub(546,r)}return 0},[k,l]),[ct,T,V]=pe({coinId:o,protocolId:v,toAddr:y,coinAmount:lt,fromAddr:s?.address,satBytes:F?.satBytes,utxoParams:{satBytes:F?.satBytes,needFilteredUtxo:nt},canTransferAmount:s?.canTransferAmount,inputs:Y,outputs:wt},{ready:!!Y?.length}),mt=k?K.BTC_NFT_BULK_SEND:K.SEND_NFT,Et=ye({coinId:o,walletId:n,protocolId:v,coinAmount:0,toAddr:y,fromAddr:p,changeAddr:s?.address,localType:u?.localType,dustSize:v===q.ARC_20?void 0:A?.minOutput,networkFee:T,satBytes:F.satBytes,inputs:Y,outputs:wt}),dt=l.map(({tokenId:r})=>r),Ue=JSON.stringify({nftIds:dt,from:p,to:y,serviceCharge:T,gasFrom:s?.address}),Ft=ae({coinId:o,txType:mt,walletId:n,coinAmount:0,fromAddr:p,toAddr:y,networkFee:T,localType:u?.localType,extJson:Ue,txSource:Rt.NFT}),Lt=de({coinId:o,walletId:n,address:s.address,utxoType:ce.TRANSFER,satBytes:F?.satBytes,needFilteredUtxo:nt}),N=(0,Oe.useDispatch)(),B=(0,We.useHistory)(),Bt=fe({coinId:o,txType:K.SEND_NFT,protocolId:zt(u?.chainId),address:s.address}),ut=l?.length,Me=(0,t.useMemo)(()=>(l?.slice(0,it?ut:Se)).map(({resourceUrl:d,name:_})=>({title:_,icon:{src:d}})),[l,it,ut]),W=(0,t.useMemo)(()=>!(s?.canTransferAmount&&P.lt(s?.canTransferAmount,P.add(T,lt))),[T,lt,s?.canTransferAmount]),ve=Qt(n),[Ye,ft]=(0,t.useState)(!1),pt=(0,t.useCallback)(async()=>{e.id?(await N(gt(e.id)),await N(_t()),B.push(Q)):(N(xt()),W?B.goBack():B.replace(Q)),ft(!1)},[N,B,W,e.id]),{tipMessageProps:je}=Ee({isHardware:b,feeError:V,isSufficientGas:W,dustError:rt,transferReminder:st}),Pt=(0,t.useCallback)(async()=>{if(!await le({walletId:n,callback:async()=>{await N(gt(e.id))}}))return;let d=await Lt(0,T);await Bt([...Y,...d],pt),ft(!0);let _=await Et({utxoList:[],utxos:[{address:s.address,inputs:me(d)}]}),D=await re(u?.localType,_);try{e.id?(await N(ne(e.id,{coinId:o,txHash:D,signedTx:_,serviceCharge:T,gasFrom:s.address,txType:mt,nftIds:dt})),await N(_t())):(await Ft(_),N(xt()),Yt.success({title:f("wallet_transfer_notif_transaction_submit")})),B.push(Q)}catch(U){console.log(U)}finally{ft(!1)}},[pt,Bt,u?.localType,N,T,Lt,B,W,dt,s.address,Ft,Et,Y,mt,e.id]),Re=(0,t.useMemo)(()=>{let r={actionType:j.ACTION_TYPE.CANCEL,btnText:f("wallet_dapp_connection_btn_reject"),onClick:pt},d={disabled:bt||ct||V||b||!Number(T)||!l?.length||Ct||rt,actionType:j.ACTION_TYPE.CONFIRM,onClick:Pt};return W||(d={coinId:o,walletId:n,address:s?.address,actionType:j.ACTION_TYPE.FILL_UP}),[r,d]},[bt,ct,V,b,T,l?.length,Pt,W,e.id,N,B,o,n,s?.address,Ct,rt]);return t.default.createElement(w.Box,null,t.default.createElement(tt,null,t.default.createElement(_e,{space:24,title:f("wallet_extension_send_colored_send"),summaryList:Me}),ut>Se&&t.default.createElement(w.FlexBox,{justify:"center",className:It["nft-transfer__extend"],onClick:De},t.default.createElement(yt,{size:yt.SIZE.xs,className:It["nft-transfer__icon"],icon:it?"okds-arrow-chevron-up-md":"okx-wallet-plugin-add-arrow-chevrons"}))),t.default.createElement(tt,null,t.default.createElement(et,{walletId:n,address:p,title:f("extension_send_mid_text_from")}),t.default.createElement(et,{address:y,title:f("extension_send_mid_text_to")})),t.default.createElement(tt,null,t.default.createElement(Te,{coinId:o,loading:ct,estimateFailed:V,networkFee:T,onClick:()=>{H({networkFee:!0})}}),t.default.createElement(et,{copyable:!1,address:s?.address,addressType:s?.addressType,title:f("btcnft_gas_label_pay_gas_with"),tags:[f(Z[s?.addressType])],onClick:()=>{H({payWallet:!0})}},t.default.createElement(xe,{coinBalance:s.canTransferAmount,coinId:o}))),t.default.createElement(Ne,{coinId:o,value:s,options:O,visible:Nt.payWallet,onChange:at,onToggleVisible:()=>{H({payWallet:!1})}}),t.default.createElement(Kt,{offsetBottom:0,placeholder:!0,borderTop:!0},t.default.createElement(S,{coinId:o,...je}),t.default.createElement(j,{buttonGroup:Re})),t.default.createElement(ge,{coinId:o,signInfo:A,visible:Nt?.networkFee,value:F,estimatedFee:T,onChange:ht,onToggleVisible:()=>{H({networkFee:!1})}}),t.default.createElement(Ae,{visible:ve&&Ye}))};export{Ms as a};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-BAPOQKLV.js.map
