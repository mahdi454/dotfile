import{a as we,b as Ee}from"./chunk-FJKD7QEB.js";import{a as ge,b as _e}from"./chunk-F4T6Q6QK.js";import{a as pe}from"./chunk-ZRAG5WLF.js";import{a as ue}from"./chunk-3BOIX6DD.js";import{a as le}from"./chunk-4IDSMRQU.js";import"./chunk-ID2G3YUZ.js";import"./chunk-7KXE5PFN.js";import"./chunk-F7YYSTTZ.js";import{a as de}from"./chunk-SYQTAGUC.js";import"./chunk-6M2GCKDH.js";import"./chunk-EU22H7NN.js";import{a as fe}from"./chunk-KTRYKYE5.js";import{a as me}from"./chunk-V2A2AEVZ.js";import"./chunk-D6NWGDM6.js";import"./chunk-ZVUQCOMJ.js";import{a as J}from"./chunk-TSGQQ5QA.js";import{a as ie}from"./chunk-KU3DITYD.js";import"./chunk-7CWLH6ZR.js";import"./chunk-Q5HW75TA.js";import"./chunk-SYF5MRVO.js";import"./chunk-UUX3UNZW.js";import"./chunk-QCTV4R7X.js";import"./chunk-SIIB3XCZ.js";import"./chunk-GUGRL7WK.js";import"./chunk-6ZHQ2QLX.js";import{a as ce}from"./chunk-S4NIXE4H.js";import{g as se,h as ae}from"./chunk-UTVBVZWC.js";import"./chunk-GL4YYTXQ.js";import"./chunk-4MDR2IS2.js";import"./chunk-GZN3TPOZ.js";import"./chunk-ZN3567SM.js";import"./chunk-SJCGLHGC.js";import{d as q}from"./chunk-GQYTOJVD.js";import"./chunk-7HZMPY3W.js";import"./chunk-QTEBOXIQ.js";import{a as R}from"./chunk-K4WB5MMU.js";import"./chunk-FSQDFL3V.js";import"./chunk-YLJ56YQC.js";import"./chunk-YVC4CAU2.js";import"./chunk-K4MSA5MN.js";import"./chunk-4HBLPFAF.js";import"./chunk-TJW4EUGS.js";import"./chunk-SJRV5U24.js";import"./chunk-PUMQ7BEU.js";import"./chunk-4OKCKO5L.js";import"./chunk-SKK4O3IC.js";import"./chunk-L4BR2EHM.js";import"./chunk-AQH6QKNE.js";import"./chunk-6IVHTBSR.js";import{f as ne}from"./chunk-75OW6LUI.js";import"./chunk-W4IULSMQ.js";import"./chunk-UXRYSOKP.js";import"./chunk-ABSI53HE.js";import"./chunk-JJIQEHOY.js";import"./chunk-AE7B6XHD.js";import"./chunk-HC6T2TFK.js";import"./chunk-JOXGYPV7.js";import"./chunk-T37NLQBV.js";import"./chunk-U5WRMXFD.js";import"./chunk-JMTMYFWR.js";import"./chunk-RE5SSELD.js";import"./chunk-A3B5II6P.js";import"./chunk-XVPROSYE.js";import"./chunk-E2MXYP3A.js";import"./chunk-FPV6XIHQ.js";import"./chunk-MZXFJMVC.js";import"./chunk-46PSZUMN.js";import"./chunk-MYY7DCIN.js";import"./chunk-AHIMORZ4.js";import"./chunk-XZ6AHFH2.js";import"./chunk-3DEZPDXQ.js";import"./chunk-6UFIPREK.js";import"./chunk-G4OIO3Z6.js";import"./chunk-JEIYTQ5E.js";import"./chunk-TOO5SEJU.js";import"./chunk-DUWPYFAS.js";import"./chunk-CA4PB6NG.js";import"./chunk-SCXRHDUG.js";import"./chunk-5STCPPZU.js";import"./chunk-ZVXDJZSD.js";import"./chunk-56SDY6L3.js";import"./chunk-PXWV5LKL.js";import"./chunk-M5PVKGM6.js";import"./chunk-AK34CZMZ.js";import"./chunk-QHZHYX4V.js";import"./chunk-FLFVNMKM.js";import"./chunk-YJ2NGJXA.js";import"./chunk-DQ2UEFEE.js";import"./chunk-ZUBNNPBM.js";import"./chunk-2SHHGXPQ.js";import"./chunk-UK4SAM7E.js";import"./chunk-LXIBKSOK.js";import"./chunk-C53RLQYB.js";import"./chunk-72NGWMH2.js";import"./chunk-VRXSSD45.js";import"./chunk-DUKP4BLI.js";import"./chunk-S3O4LR55.js";import"./chunk-FZCNSMLW.js";import"./chunk-WANYNTD6.js";import"./chunk-QMGTBJAL.js";import{o as Le}from"./chunk-KCWFMCND.js";import{w as Ne}from"./chunk-3TDWET6C.js";import{U as oe,_ as G}from"./chunk-EBR3PGFZ.js";import"./chunk-UDGUBKMO.js";import"./chunk-VPGNJAK6.js";import{Na as re,Ra as Ge}from"./chunk-W6Q44ZHW.js";import{d as te,f as ve}from"./chunk-3HS6AHPS.js";import"./chunk-JUXPONKW.js";import"./chunk-WSUAESF2.js";import"./chunk-O2FUKKO3.js";import"./chunk-GQJVAWGG.js";import"./chunk-WO5B666G.js";import"./chunk-GCXT25LW.js";import"./chunk-TW63K7CB.js";import"./chunk-FDCWN4NG.js";import"./chunk-5YGMD6KK.js";import{Mb as Q,Oa as k,Ya as z,dc as De}from"./chunk-O3CM75EN.js";import"./chunk-ZGRAPBBU.js";import{H as j}from"./chunk-J3CEQI22.js";import{K,pa as Re}from"./chunk-VFHYER2K.js";import{L as Y,w as u}from"./chunk-KJIO572I.js";import"./chunk-HJXNXGYU.js";import"./chunk-77ECUYXV.js";import"./chunk-4BZBCAHV.js";import"./chunk-KALFZBR5.js";import"./chunk-V55FEIYE.js";import{a as v}from"./chunk-EAZTJZU7.js";import"./chunk-YTRW5WTJ.js";import"./chunk-3AN5FAZD.js";import"./chunk-CJ3MW6GG.js";import"./chunk-AKCHCVUS.js";import"./chunk-VOT7VHG3.js";import"./chunk-SYQUJKIR.js";import"./chunk-UYGNKZ5P.js";import"./chunk-KZFZROAL.js";import"./chunk-WPMHLM7C.js";import"./chunk-3MRE2BAK.js";import"./chunk-CSLLQXN7.js";import"./chunk-P7DU4NJA.js";import"./chunk-KW7JYBDS.js";import"./chunk-224G4QSH.js";import{f as h,m as f,o as l}from"./chunk-ZCHLW7CF.js";f();l();var X=h(v());f();l();var E=h(v()),ye=h(Ne());Y();ve();Ge();z();f();l();var x=h(v());Re();Y();De();var Be=({code:e,data:n,error_message:s,error:a})=>{if(e!==0||!n||n.queryGasLimitErrorUseDefault||a)return{fee:0,feeError:!0,feeErrorMsg:s};let{gasLimit:r="0"}=n;return{...n,fee:r,feeError:!1,feeErrorMsg:""}},Oe=e=>e?.feeError&&e?.feeErrorMsg?u("wallet_extension_alert_estimate_unavailable_error",{errorMsg:e.feeErrorMsg}):"",be=(e,n)=>{let s=K(e)||Q(e,n),a=K(e)||Q(e,0);return{isSufficientGas:s,isSufficientBalance:a}},We=({coinId:e,unapproved:n,paramsInfo:s})=>{let{coin:a,toAdr:r,fromAddr:t,walletId:i,messages:o,network:c,validUntil:d}=s,{chainId:I,localType:m}=a||{},p=fe(e,n.walletId)||{},{coinAmountInt:S}=p,M=J(),A=(0,x.useRef)(null),[P,T]=(0,x.useState)(!0),[g,F]=(0,x.useState)({}),[_,B]=(0,x.useState)({});(0,x.useEffect)(()=>{m&&e&&t&&i&&o&&(async()=>{try{T(!0);let w=await M({coinId:e,address:t,toAddr:r,fromAddr:t}),y=await we({nonce:w?.nonce,localType:m,fromAddr:t,walletId:i,messages:o,network:c,validUntil:d});B({signInfo:w,sequence:w?.nonce,inputData:JSON.stringify(y?.stringInputParams),transactionParams:y?.transactionParams})}catch(w){T(!1),F({feeError:!0,feeErrorMsg:w?.message||u("wallet_extension_alert_estimate_unavailable_error")})}})()},[m,e,t,i,o]),(0,x.useEffect)(()=>((()=>{let{inputData:w}=_;if(T(!0),w){let y=async()=>{let b=await Ee({fromAddr:t,chainId:I,coinId:e,inputData:w}),V=Be(b);T(!1),F(V)};(()=>{clearInterval(A.current),y(),A.current=setInterval(y,7e3)})()}})(),()=>{clearInterval(A.current)}),[_.inputData,I,t,e]);let{isSufficientGas:O,isSufficientBalance:U}=be(S,g?.fee),D=Oe(g);return{networkFeeProps:{coinId:e,loading:P,estimateFailed:g?.feeError,estimateFailedMsg:D,networkFee:g?.fee},isSufficientGas:O,isSufficientBalance:U,estimateFailed:g?.feeError,estimateFailedMsg:D,extParams:{coinId:e,coinAmount:0,inputData:_?.inputData,fromAdr:t,toAdr:r,serviceCharge:g?.fee,extJson:JSON.stringify({nonce:_?.sequence}),txSource:2,accountId:n?.walletId,walletType:2,transactionParams:_?.transactionParams},coinWithBalance:p}},Te=We;f();l();z();function qe(e){let n=q(k)||{},{address:s,walletId:a}=R(e),r=e?.params?.transaction||{},t=r?.messages||[],i=r?.network,o=r?.valid_until,{address:c}=t[0]||{};return{toAdr:c,coin:n,fromAddr:s,walletId:a,messages:t,validUntil:o,network:i}}var xe=qe;f();l();var C=h(v());var Je=({origin:e,walletId:n,localType:s})=>{let a=ie(),[r,t]=(0,C.useState)(!0),{host:i}=de({origin:e}),o=R({walletId:n,localType:s}),[c,d]=(0,C.useState)({}),I=(0,C.useCallback)(async(S,M,A)=>{let P="";try{P=JSON.stringify(A)}catch{}let{coinId:T,chainId:g}=S,F=await a({coinId:T,checkTypes:[G.KYS,G.VERIFY_GAS_LIMIT],amount:0,from:o.address,to:"",txType:3,domain:i,tokenAddress:"",inputData:M,chainId:g,additionalData:{tonSignData:P}});d(F),t(!1)},[i,a,o.address]),m=(0,C.useMemo)(()=>({loading:r,...c[G.KYS]||{}}),[r,c]),p=(0,C.useMemo)(()=>c[G.VERIFY_GAS_LIMIT]||{},[c]);return{kysRet:m,loading:r,preExecute:I,preExecuteRet:c,verifyGasLimitRet:p}},Ie=Je;f();l();var Se=h(v()),Ae=h(Le());Y();z();function Ue({transaction:e,fromAddress:n}){let{valid_until:s,network:a,from:r,messages:t}=e,[i,o]=(0,Se.useState)("");return(0,Ae.useAsyncEffect)(async()=>{if(a!==se.MAINNET)o(u("wallet_extension_error_incorrect_destination_network"));else if(s<Math.floor(Date.now()/1e3))o(u("wallet_extension_error_expired_transaction"));else if(!t||t.length===0)o(u("wallet_extension_error_invalid_transaction_parameter"));else{let{TonWallet:c}=await ne(),d=new c;for(let p=0;p<t.length;p++){let S=t[p]?.address;if(!await ce(S,k)){o(u("wallet_extension_error_incorrect_destination_network"));return}}let I=await d.convertAddress({address:n}),m=await d.convertAddress({address:r});I?.raw!==m?.raw&&o(u("wallet_extension_error_incorrect_receiving_address"))}},[s,a,r,n]),{checkParamsTipMessage:i?{message:i}:null,code:i?ae.BAD_REQUEST_ERROR:null}}var Fe=Ue;var Ve=(0,E.memo)(({unapproved:e})=>{let n=(0,ye.useDispatch)(),s=q(k)||{},a=s?.coinId||k,{walletId:r,address:t}=R(e),i=me(r),o=xe(e),[c,d]=(0,E.useState)(!1),I=J(),{networkFeeProps:m,isSufficientGas:p,estimateFailed:S,estimateFailedMsg:M,isSufficientBalance:A,extParams:P,coinWithBalance:T}=Te({coinId:a,unapproved:e,paramsInfo:o}),{id:g,origin:F,localType:_}=e,B=Ie({origin:F,walletId:r,localType:_}),{inputData:O,transactionParams:U}=P,D=(0,E.useRef)(),{preExecute:Z,kysRet:N,verifyGasLimitRet:w}=B,y=e?.params?.transaction||{};(0,E.useEffect)(()=>{s?.coinId&&!m?.loading&&!D.current&&(D.current=!0,Z(s,O,y))},[s?.coinId,m?.loading,O]);let $=ue({kysRet:N,baseCoin:s,estimateFailed:S,estimateFailedMsg:M,isSufficientGas:p,isSufficientBalance:A,verifyGasLimitRet:w,coinWithBalance:T}),{checkParamsTipMessage:b,code:V}=Fe({transaction:y,fromAddress:t}),Ce=ge({id:g,walletId:r,origin:F,localType:_,extraParams:{code:V}}),Pe=b||$,he=async()=>{d(!0),i({trade:"contract_interaction",all_confirmation:"confirm",network:_,dapp_url:F});try{let W=await I({coinId:a,address:o?.fromAddr,toAddr:o?.toAdr,fromAddr:o?.fromAddr}),ee=await te().approveDappRequest(g,{...P,transactionParams:{...U,seqno:W?.nonce},extJson:JSON.stringify({nonce:W?.nonce})});if(ee.code===10009){j.error(ee?.msg||u("wallet_extension_failure_subtitle_fail_resend")),d(!1);return}await re(n),d(!1)}catch(W){d(!1),j.error(W?.msg||u("wallet_extension_failure_subtitle_fail_resend"))}},{buttonGroup:ke,handleCancel:Me}=_e({coinId:a,unapproved:e,preExecuteRet:B,feeLoading:m?.loading||c,estimateFailed:S,isSufficientGas:p,isSufficientBalance:A,disabledConfirmBtn:!!b,onConfirm:he,onCancel:Ce,coinWithBalance:T});return le({kysRet:N,handleCancel:Me}),E.default.createElement(pe,{kysRet:N,unapproved:e,tipMessage:Pe,buttonGroup:ke,networkFee:m})}),H=Ve;var Kt=({unapproved:e})=>{switch(e.method){case oe.SEND_TRANSACTION:return X.default.createElement(H,{unapproved:e});default:return X.default.createElement(H,{unapproved:e})}};export{Kt as default};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=Ton-6OOY75AK.js.map
