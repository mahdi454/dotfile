import{a as vt}from"./chunk-Y46TU37G.js";import"./chunk-O2YW3UOK.js";import{a as Lt}from"./chunk-UH2W3T6B.js";import{b as St,n as Ct}from"./chunk-D6NWGDM6.js";import"./chunk-ZVUQCOMJ.js";import{a as gt}from"./chunk-TSGQQ5QA.js";import"./chunk-KU3DITYD.js";import"./chunk-7CWLH6ZR.js";import"./chunk-Q5HW75TA.js";import"./chunk-SYF5MRVO.js";import"./chunk-GUGRL7WK.js";import"./chunk-6ZHQ2QLX.js";import"./chunk-S4NIXE4H.js";import{a as It}from"./chunk-UTVBVZWC.js";import"./chunk-GL4YYTXQ.js";import"./chunk-4MDR2IS2.js";import"./chunk-GZN3TPOZ.js";import"./chunk-ZN3567SM.js";import"./chunk-SJCGLHGC.js";import"./chunk-GQYTOJVD.js";import"./chunk-7HZMPY3W.js";import"./chunk-QTEBOXIQ.js";import"./chunk-FSQDFL3V.js";import"./chunk-YLJ56YQC.js";import"./chunk-YVC4CAU2.js";import"./chunk-K4MSA5MN.js";import"./chunk-4HBLPFAF.js";import"./chunk-TJW4EUGS.js";import"./chunk-SJRV5U24.js";import"./chunk-PUMQ7BEU.js";import"./chunk-4OKCKO5L.js";import"./chunk-SKK4O3IC.js";import"./chunk-L4BR2EHM.js";import"./chunk-AQH6QKNE.js";import"./chunk-6IVHTBSR.js";import{a as wt,e as K}from"./chunk-75OW6LUI.js";import"./chunk-W4IULSMQ.js";import"./chunk-UXRYSOKP.js";import"./chunk-ABSI53HE.js";import"./chunk-JJIQEHOY.js";import"./chunk-JOXGYPV7.js";import"./chunk-T37NLQBV.js";import"./chunk-U5WRMXFD.js";import"./chunk-JMTMYFWR.js";import"./chunk-RE5SSELD.js";import"./chunk-A3B5II6P.js";import"./chunk-XVPROSYE.js";import"./chunk-E2MXYP3A.js";import{f as At}from"./chunk-FPV6XIHQ.js";import"./chunk-MZXFJMVC.js";import"./chunk-46PSZUMN.js";import"./chunk-MYY7DCIN.js";import"./chunk-AHIMORZ4.js";import"./chunk-3DEZPDXQ.js";import"./chunk-6UFIPREK.js";import"./chunk-G4OIO3Z6.js";import"./chunk-JEIYTQ5E.js";import"./chunk-TOO5SEJU.js";import"./chunk-DUWPYFAS.js";import"./chunk-CA4PB6NG.js";import"./chunk-SCXRHDUG.js";import"./chunk-5STCPPZU.js";import"./chunk-ZVXDJZSD.js";import"./chunk-56SDY6L3.js";import"./chunk-PXWV5LKL.js";import"./chunk-M5PVKGM6.js";import"./chunk-AK34CZMZ.js";import{i as ht,l as bt,m as Tt,s as yt}from"./chunk-QHZHYX4V.js";import"./chunk-FLFVNMKM.js";import"./chunk-YJ2NGJXA.js";import"./chunk-DQ2UEFEE.js";import"./chunk-ZUBNNPBM.js";import"./chunk-2SHHGXPQ.js";import"./chunk-UK4SAM7E.js";import"./chunk-LXIBKSOK.js";import"./chunk-C53RLQYB.js";import"./chunk-72NGWMH2.js";import"./chunk-VRXSSD45.js";import{Qa as xt}from"./chunk-DUKP4BLI.js";import"./chunk-S3O4LR55.js";import{m as mt}from"./chunk-FZCNSMLW.js";import"./chunk-WANYNTD6.js";import"./chunk-QMGTBJAL.js";import"./chunk-KCWFMCND.js";import"./chunk-3TDWET6C.js";import{b as pt}from"./chunk-EBR3PGFZ.js";import"./chunk-UDGUBKMO.js";import{a as fe}from"./chunk-VPGNJAK6.js";import"./chunk-W6Q44ZHW.js";import{d as V,f as xe}from"./chunk-3HS6AHPS.js";import"./chunk-JUXPONKW.js";import"./chunk-WSUAESF2.js";import"./chunk-O2FUKKO3.js";import"./chunk-GQJVAWGG.js";import"./chunk-WO5B666G.js";import"./chunk-GCXT25LW.js";import"./chunk-TW63K7CB.js";import{c as I}from"./chunk-FDCWN4NG.js";import"./chunk-5YGMD6KK.js";import{Gb as A,Hb as $,Mc as we,Pc as ft,Sc as O,Uc as he,Vc as E,Wc as be,X as J,Ya as me,dc as _e,yc as _t,za as L}from"./chunk-O3CM75EN.js";import"./chunk-ZGRAPBBU.js";import{G as h,q as dt,w as z}from"./chunk-J3CEQI22.js";import{m as X,pa as ce}from"./chunk-VFHYER2K.js";import{L as ue,w as i}from"./chunk-KJIO572I.js";import{b as de}from"./chunk-HJXNXGYU.js";import"./chunk-77ECUYXV.js";import"./chunk-4BZBCAHV.js";import{U as ut,c as pe,ca as v}from"./chunk-KALFZBR5.js";import"./chunk-V55FEIYE.js";import{a as R}from"./chunk-EAZTJZU7.js";import"./chunk-YTRW5WTJ.js";import"./chunk-3AN5FAZD.js";import"./chunk-CJ3MW6GG.js";import"./chunk-AKCHCVUS.js";import"./chunk-VOT7VHG3.js";import"./chunk-SYQUJKIR.js";import"./chunk-UYGNKZ5P.js";import"./chunk-KZFZROAL.js";import"./chunk-WPMHLM7C.js";import"./chunk-3MRE2BAK.js";import"./chunk-CSLLQXN7.js";import"./chunk-P7DU4NJA.js";import"./chunk-KW7JYBDS.js";import"./chunk-224G4QSH.js";import{f as y,m,n as w,o as _}from"./chunk-ZCHLW7CF.js";m();_();var tt=y(R()),U=y(fe());m();_();var W=y(R());m();_();var j=y(R());m();_();var Z={root:"_root_dowdc_1",header:"_header_dowdc_30"};function Te({children:p,hidden:N=!1}){return j.default.createElement(I.Box,{className:Z.root},j.default.createElement(Lt,{className:Z.header}),N?null:p)}var Et=Te;m();_();var e=y(R()),Pt=y(pe());ce();ue();de();xe();we();me();be();he();_e();m();_();var c={root:"_root_1teux_1",title:"_title_1teux_46","fee-select":"_fee-select_1teux_52",feeSelect:"_fee-select_1teux_52",inner:"_inner_1teux_55","add-weight":"_add-weight_1teux_55",addWeight:"_add-weight_1teux_55","add-element-weight":"_add-element-weight_1teux_55",addElementWeight:"_add-element-weight_1teux_55",placeholder:"_placeholder_1teux_55",link:"_link_1teux_76",input:"_input_1teux_84","tip-txt":"_tip-txt_1teux_87",tipTxt:"_tip-txt_1teux_87",btn:"_btn_1teux_93"};var ye=50,Nt=600,Ae=546,Bt="inputLessThan546",kt="commonall_modal_btn_claim",Q="commonall_modal_btn_done",Ft="wallet_extension_fb_btn_retry",Ie="https://www.oklink.com/fractal-bitcoin/address/",ge=["wallet_extension_fb_desc_claim_all_utxo","wallet_extension_fb_desc_claim_delay","wallet_extension_fb_desc_claim_network_fee"],Mt=[{label:"wallet_extension_fb_select_network_fee_fast",value:"max"},{label:"wallet_extension_fb_select_network_fee_average",value:"normal"},{label:"wallet_extension_fb_select_network_fee_slow",value:"min"}];function Se(){let p=ht(),N=bt(),et=yt(),[g,Wt]=(0,e.useState)(Mt[0].value),[ot,Ut]=(0,e.useState)("0"),nt=Tt(),B=(0,e.useMemo)(()=>(p?.addressType[J]||[]).map(o=>({label:o.address,value:o.address})),[p.walletId]),[b,rt]=(0,e.useState)(B[0]?.value||""),[S,x]=(0,e.useState)(!1);(0,e.useEffect)(()=>{let t=B[0]?.value;t&&(rt(t),x(!0))},[B]);let st=(0,e.useCallback)(t=>{let o=N(t),{share:n,pShare:r,mpcId:s,publicKey:a,deriveIndex:u}=o?.addressType?.bitcoin?.find(d=>d?.addressType===o?.selectedAddressType?.bitcoin)||{};return{publicKey:a,share:n,pShare:r,mpcId:s,deriveIndex:u}},[N]),Ht=(0,e.useCallback)(async(t,o)=>{let r=(await et(t))?.find(s=>s.address===o)?.privateKey;if(nt){let{getMidKey:s}=await wt(),{networks:a,private2Wif:u}=await K(),{share:d}=st(t),f=await s(Ct(d),0);return u(w.Buffer.from(f),a.bitcoin)}return r},[st,et,nt]),qt=(0,e.useCallback)(async(t,o)=>{let r=X(t,ye).map(s=>O(E.subscriptionFBRCMidAddr,s,{headers:o}));return Promise.all(r)},[]),[at,Dt]=(0,e.useState)([]),Yt=gt(),Gt=(0,e.useCallback)(async(t,o)=>{let{data:n}=await ft(E.getFBRCLossInscriptionInfo,{address:t},{headers:o});return n||[]},[]),Xt=(0,e.useCallback)(async(t,o,n)=>{let{networks:r,createInscriptionTxCtxData:s}=await K(),a=[];return t.forEach(u=>{let d={contentType:"text/plain;charset=utf-8",body:u.inscriptionJson,revealAddr:o},{commitTxAddress:f}=s(r.bitcoin,d,n);u.midAddress===f||(a.push(f),u.midAddress=f)}),a},[]),Jt=(0,e.useCallback)(async(t,o)=>{let n=t.map(({midAddress:d})=>({address:d,utxoType:St.TRANSFER})),r={coinId:L,utxoRequests:n},{data:s}=await O(E.getBTCUTXO,r,{headers:o});if(!s?.length)return[];let a=s.map((d,f)=>({...n[f],serviceCharge:0,coinAmount:d.canTransferAmount})),{data:u}=await O(E.getBTCUTXO,{coinId:L,utxoRequests:a},{headers:o});return u},[]),$t=(0,e.useCallback)(async({inscriptionInfoList:t,midAddrUtxoList:o,privateKey:n,selectedAddress:r,feeRate:s,walletId:a,serverWalletType:u})=>{let{networks:d,inscribeRefundFee:f}=await K(),l=0,k=[],q=0;for(let F=0;F<t.length;F++){let M=t[F],oe=o[F].utxoList.map(T=>({privateKey:n,txId:T.txHash,vOut:T.vout,amount:T.coinAmount,address:M.midAddress})),ne=[{contentType:"text/plain;charset=utf-8",body:M.inscriptionJson,revealAddr:r}],re={feeRate:s,inscriptionRefundFeeDataList:ne,changeAddress:r,middleAddress:M.midAddress,maxAmountOfInput:Nt},se=X(oe,Nt),D=0,Y=0;se.forEach(T=>{let ae={...re,inputs:T},P=0;T.forEach(le=>{P=A(P,le.amount)}),Y=A(Y,P);let{refundFeeTx:ie,refundFeeTxFee:G,dustChange:ct}=f(d.bitcoin,ae);if(ct&&ct<Ae)throw new Error(Bt);k.push({coinId:L,txType:pt.TRANS_IN,signedTx:ie,coinAmount:$(P,G),toAdr:r,fromAdr:M.midAddress,serviceCharge:G,accountId:a,walletType:u,txSource:_t.NORMAL}),D=A(D,G)}),l=A(l,Y),q=A(q,D)}return{claimAmount:$(l,q)||0,refundFeeTxList:k}},[]),zt=async(t,o)=>{let n=await Ht(p.walletId,t),r=await V().getRequestHeaders({walletId:p.walletId,needSign:!0,currency:"usd"}),s;try{s=(await Yt({coinId:L,address:t}))?.[o]}catch{return h.error({title:i("wallet_extension_fb_error_network_refresh"),duration:5}),{}}if(!n||!s)return{};let a=[];try{if(a=await Gt(t,r),!a.length)return{}}catch{return h.error({title:i("wallet_extension_fb_error_network_refresh"),duration:5}),{}}let u=await Xt(a,t,n);try{u.length&&await qt(u,r)}catch{return h.error({title:i("wallet_extension_fb_error_network_refresh"),duration:5}),{}}let d=[];try{let l=await Jt(a,r);if(!l.length)return{};d=l}catch{return h.error({title:i("wallet_extension_fb_error_network_refresh"),duration:5}),{}}let f;try{f=await $t({inscriptionInfoList:a,midAddrUtxoList:d,privateKey:n,selectedAddress:t,feeRate:s,walletId:p.walletId,serverWalletType:p.serverWalletType})}catch(l){let k=l.message===Bt?"wallet_extension_fb_error_dust_limit":"wallet_extension_fb_error_contact_support";return h.error({title:i(k),duration:5}),{}}return f},[C,H]=(0,e.useState)(kt),Vt=(0,e.useCallback)(async t=>{let o=t.value;o!==b&&([Q,Ft].includes(C)&&H(kt),x(!0),rt(o))},[b,C]),it=(0,e.useCallback)(async()=>{try{if(S)return;x(!0);let t=await V().getRequestHeaders({walletId:p.walletId,needSign:!0,currency:"usd"}),o=at.map(async({signedTx:n,...r})=>{let a={txHash:await It(J,n),signedTx:n,...r};return At(a,{headers:t})});await Promise.all(o),x(!1),h.success({title:i("wallet_extension_fb_notification_view_status",{link:e.default.createElement(ut,{href:`${Ie}${b}`,className:c.link},i("wallet_extension_fb_notification_view_status_icu"))}),duration:5}),H(Q)}catch{h.error({title:i("wallet_extension_fb_notification_header_fail_claim"),duration:5}),x(!1),H(Ft)}},[S,p.walletId,at,b]),lt=vt(),Zt=(0,e.useCallback)(async()=>{if(C===Q){await lt();return}it()},[C,it,lt]);(0,e.useEffect)(()=>{zt(b,g).then(({refundFeeTxList:t=[],claimAmount:o=0})=>{x(!1),Ut(o),Dt(t)}).catch(()=>{x(!1)})},[b,g]);let jt=mt(ot,{decimals:8})||0,Qt=Number(ot)===0,te=(0,e.useCallback)(({value:t})=>{t!==g&&(Wt(t),x(!0))},[g]),ee=(0,e.useMemo)(()=>Mt.map(t=>({...t,label:i(t.label)})),[]);return e.default.createElement(I.Box,{className:c.root},e.default.createElement(z,{optionItemClassName:"break-all",titleClass:c.title,title:e.default.createElement("span",{className:c.title},i("wallet_extension_fb_header_switch_wallet_type")),value:b,options:B,onChange:Vt,searchable:!1,showSelectedIcon:!0,disabled:S}),e.default.createElement(z,{className:c.feeSelect,titleClass:c.title,title:e.default.createElement("span",{className:c.title},i("wallet_extension_fb_header_network_fee")),value:g,options:ee,onChange:te,searchable:!1,showSelectedIcon:!0,disabled:S}),e.default.createElement(dt,{className:c.input,inputClassName:c.placeholder,innerClassName:(0,Pt.default)(c.inner,c.addWeight,c.addElementWeight),title:e.default.createElement("span",{className:c.title},i("wallet_extension_fb_title_amount")),disabled:!0,placeholder:i("wallet_extension_fb_input_placeholder_num_fb",{num:jt}),value:""}),ge.map(t=>e.default.createElement("div",{className:c.tipTxt},i(t))),e.default.createElement(v,{className:c.btn,category:v.CATEGORY.fill,type:v.TYPE.highlight,size:v.SIZE.xl,loading:S,block:!0,onClick:Zt,disabled:Qt,loadingText:i("commonall_modal_btn_claim")},i(C)))}var Rt=Se;m();_();var Ot={root:"_root_1et89_1"};function Ce(){return W.default.createElement(Et,null,W.default.createElement(I.Box,{className:Ot.root},W.default.createElement(Rt,null)))}var Kt=Ce;var Mo=()=>tt.default.createElement(U.Switch,null,tt.default.createElement(U.Route,{path:xt,component:Kt,exact:!0}));export{Mo as default};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=FractalBRCFetchLoss-5ITTENCE.js.map
