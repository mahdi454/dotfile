import{a as Ee}from"./chunk-I4H4MPEY.js";import{a as be}from"./chunk-W34TCTDQ.js";import{b as Te,d as xe}from"./chunk-3RXI6HAM.js";import{b as ke}from"./chunk-AXG7YOIX.js";import{a as bt}from"./chunk-7HZMPY3W.js";import{a as ct}from"./chunk-QTEBOXIQ.js";import{b as pe,c as _e,d as fe,e as ue,f as de,g as ye,l as we,m as ge,n as he,o as Pe}from"./chunk-5EKAQ7RI.js";import{a as xt,b as ne}from"./chunk-4HHM4J4U.js";import{L as me,j as X}from"./chunk-5STCPPZU.js";import{a as ce}from"./chunk-26PQCAXO.js";import{e as oe}from"./chunk-3REMR6BD.js";import{a as Qt,b as Jt,c as Xt,d as te,e as ee}from"./chunk-GPU2UKRI.js";import{a as z}from"./chunk-UA4GAS73.js";import{h as qt}from"./chunk-TUUPYEC6.js";import{a as le}from"./chunk-ZUBNNPBM.js";import{l as re,m as se,n as ae,o as ie}from"./chunk-2SHHGXPQ.js";import{a as it}from"./chunk-LXIBKSOK.js";import{b as nt,c as lt}from"./chunk-C53RLQYB.js";import{h as Y,i as H}from"./chunk-72NGWMH2.js";import{C as Gt,F as Tt,L as $t,Sa as Zt,a as K,ga as zt,x as Yt,y as Ht}from"./chunk-DUKP4BLI.js";import{q as A}from"./chunk-FZCNSMLW.js";import{o as kt}from"./chunk-KCWFMCND.js";import{ja as at,ka as Kt,w as ht}from"./chunk-3TDWET6C.js";import{a as Rt}from"./chunk-UDGUBKMO.js";import{a as Pt}from"./chunk-VPGNJAK6.js";import{ta as Ut,ya as Ke}from"./chunk-W6Q44ZHW.js";import{d as V,f as Et}from"./chunk-3HS6AHPS.js";import{g as jt}from"./chunk-TW63K7CB.js";import{c as y}from"./chunk-FDCWN4NG.js";import{Gc as Vt,Mc as Ye,ec as Q,fc as Ue,gc as st,m as St,mc as Ot,n as Lt,o as Bt,q as wt,u as rt,y as gt}from"./chunk-O3CM75EN.js";import{D as U,H as J,c as Ft,o as Wt,q as $,r as Dt}from"./chunk-J3CEQI22.js";import{F as et,pa as Re}from"./chunk-VFHYER2K.js";import{L as ot,w as a}from"./chunk-KJIO572I.js";import{T as Mt,U as vt,c as Ve,ca as m}from"./chunk-KALFZBR5.js";import{a as q}from"./chunk-EAZTJZU7.js";import{f as E,m as f,o as u}from"./chunk-ZCHLW7CF.js";f();u();var i=E(q()),ut=E(ht()),At=E(Pt()),Z=E(kt()),Be=E(Ve());ot();Et();f();u();var D=E(q()),mt=E(kt());Et();Ue();gt();f();u();var L=E(q());ot();f();u();var G={root:"_root_15akf_1",image:"_image_15akf_4",title:"_title_15akf_7",desc:"_desc_15akf_15",btns:"_btns_15akf_23","cancel-width":"_cancel-width_15akf_26",cancelWidth:"_cancel-width_15akf_26"};function It({type:o,step:r,onCancel:t,onRetry:T}){let w=jt({light:"./static/images/passkey-light-big.png",dark:"./static/images/passkey-dark-big.png"}),e={["create"]:{title:{text:"wallet_extension_biometrics_drawer_title_verification",keys:{num:1,total:2},color:"var(--okd-color-content-primary)"},desc:"wallet_extension_biometrics_drawer_desc_verification",cancel:"commonall_text_btn_cancel",onCancel:t},["verify"]:{title:{text:o==="create"?"wallet_extension_biometrics_drawer_title_verification":"wallet_extension_biometrics_drawer_title_unlock",keys:{num:2,total:2},color:"var(--okd-color-content-primary)"},desc:o==="create"?"wallet_extension_biometrics_drawer_desc_verification":"wallet_extension_biometrics_drawer_desc_unlock",cancel:"commonall_text_btn_cancel",onCancel:t},["error"]:{title:{text:"wallet_extension_biometrics_drawer_title_fail_setup",color:"var(--okd-color-semantic-negative)"},desc:"wallet_extension_biometrics_drawer_desc_fail_setup",confirm:"commonall_emptystate_text_try_again",onConfirm:T,cancel:"commonall_text_btn_cancel",onCancel:t},["init"]:null,["success"]:null}[r];return e?L.default.createElement(y.Container,{className:G.root},L.default.createElement(y.FlexBox,{className:G.image,align:y.ALIGN.center,justify:"center"},L.default.createElement(Ft,{src:w,width:120,height:120})),L.default.createElement(A.Text,{strong:700,className:G.title,style:{color:e.title.color}},a(e.title.text,e.title.keys)),L.default.createElement(A.Text,{strong:400,className:G.desc},a(e.desc)),L.default.createElement(y.FlexBox,{className:G.btns,align:y.ALIGN.center,justify:"center"},L.default.createElement(m,{block:e.confirm,category:m.CATEGORY.fill,type:m.TYPE.gray,size:m.SIZE.lg,onClick:()=>{e.onCancel()},className:oe({[G.cancelWidth]:!e.confirm})},a(e.cancel)),e.confirm?L.default.createElement(m,{block:!0,category:m.CATEGORY.fill,type:m.TYPE.highlight,size:m.SIZE.lg,onClick:()=>{e.onConfirm()}},a(e.confirm)):null)):null}function Nt(){let[o]=lt(nt.credentialId),[r,t]=(0,D.useState)("init"),[T,w]=(0,D.useState)("init"),l=(0,D.useRef)(null),e=(0,D.useRef)(p=>p),h=async p=>{try{w("create"),t("create"),e.current=p,await bt(500);let{password:C,credential:B,credentialId:b}=await Xt();if(t("verify"),!await te({credential:B,password:C})){t("error"),await p(null);return}l.current?.destroy(),t("success"),await p({password:C,credentialId:b})}catch{t("error"),await p(null)}},x=async p=>{try{w("verify"),t("verify"),e.current=p;let{password:C}=await ee(o);await V().verifyPassword(C),l.current?.destroy(),t("success"),await p(!!C)}catch{t("error"),await p(!1)}},I=()=>{t("init"),w("init"),l.current?.destroy()},N=()=>{T==="create"&&h(e.current),T==="verify"&&x(e.current)},c=async()=>{Q()!==rt&&(l.current||(l.current=Wt.action({mask:!1})),await bt(100),l.current.update({visible:!0,mask:!0,onClose:()=>{I()},children:D.default.createElement(It,{step:r,type:T,onRetry:()=>{N()},onCancel:()=>{I()}})}))};return(0,mt.useUpdateEffect)(()=>{if(r==="init"||r==="success"){l.current?.destroy();return}c()},[r]),(0,mt.useUnmount)(()=>{l.current?.destroy()}),{create:h,verify:x}}Ot();gt();f();u();var Ct=E(ht());var Ie=E(Pt());function Ne(){let o=(0,Ie.useHistory)(),r=(0,Ct.useSelector)(at),t=(0,Ct.useSelector)(Kt);r&&!t&&o.replace(K)}f();u();var d=E(q()),_t=E(kt());ot();f();u();var pt={root:"_root_cl85f_1",passwordInput:"_passwordInput_cl85f_6"};var Ce=({onBack:o,onComplete:r})=>{let w=ct().get("from")===g.HARDWARE,l=U.useForm(),[e,h]=(0,d.useState)({}),[x,{setTrue:I,setFalse:N}]=(0,_t.useBoolean)(!1),c=!e.password||!e.confirm||e.password?.length<xt||e.confirm?.length<xt||e.password!==e.confirm,p=(0,_t.useMemoizedFn)(async()=>{let{password:b,confirm:S}=e;if(!(x||c)){if(b!==S){l.setErrors({confirm:a("wallet_settings_reset_passord_errortip_input_error")});return}me(),I(),await r(S),N()}},[c,e]),C=(0,d.useCallback)(async b=>{(b?.key==="Enter"||b?.keyCode===13)&&await p()},[]),B=Ee();return(0,d.useEffect)(()=>(document.addEventListener("keydown",C),()=>{document.removeEventListener("keydown",C)}),[]),d.default.createElement(ke,{className:pt.root,title:a("wallet_signup_maintitle_set_password"),desc:a(w?"wallet_extension_signup_subtitle_set_password_hardware":"wallet_extension_subtitle_password_unlock"),onBack:o},({formClass:b,formErrorClass:S,itemClass:R})=>d.default.createElement(U,{form:l,size:$.SIZE.lg,validateTrigger:["onChange","onBlur"],className:b,errorClassName:S,onSubmit:p,onValuesChange:(O,M)=>{h(M)}},d.default.createElement(U.Item,{name:"password",style:{marginBottom:0},className:R,label:a("wallet_set_password_subtitle_password")},d.default.createElement($.Password,{autoComplete:"off",size:$.SIZE.xl,inputClassName:pt.passwordInput,placeholder:a("wallet_settings_reset_passord_placeholder_input_desc")})),d.default.createElement(U.Item,{noStyle:!0,shouldUpdate:(O,M)=>O.password!==M.password},({getFieldValue:O})=>{let M=O("password");return d.default.createElement(ne,{password:M})}),d.default.createElement(U.Item,{name:"confirm",className:R,label:a("wallet_settings_reset_passord_subtitle_password_confirmation"),style:{flex:1,marginTop:"32px"}},d.default.createElement($.Password,{autoComplete:"off",size:$.SIZE.xl,inputClassName:pt.passwordInput,placeholder:a("wallet_settings_reset_passord_placeholder_input_password_confirmation"),onChange:()=>{l.cleanErrors("confirm")}})),d.default.createElement(it.FooterActions,{usePortal:!0,affixStyle:B},d.default.createElement(U.Item,{noStyle:!0},d.default.createElement(m,{block:!0,htmlType:"submit",loading:x,disabled:c,category:m.CATEGORY.fill,type:m.TYPE.highlight,size:m.SIZE.lg},a("wallet_set_password_btn_confirm"))))))};f();u();var k={root:"_root_1ybp2_1",content:"_content_1ybp2_4",title:"_title_1ybp2_7",desc:"_desc_1ybp2_15",list:"_list_1ybp2_22",item:"_item_1ybp2_25","item-select":"_item-select_1ybp2_42",itemSelect:"_item-select_1ybp2_42","item-title":"_item-title_1ybp2_45",itemTitle:"_item-title_1ybp2_45","item-desc":"_item-desc_1ybp2_53",itemDesc:"_item-desc_1ybp2_53",link:"_link_1ybp2_60",anchor:"_anchor_1ybp2_64",icon:"_icon_1ybp2_65",forgot:"_forgot_1ybp2_78"};f();u();var Ae=E(q()),ft=E(ht()),Se=E(Pt());Re();ot();Et();Ot();gt();Ye();Ke();var Le=o=>{let r=(0,Se.useHistory)(),t=(0,ft.useDispatch)(),{seedPhrase:T,privateKey:w,mpcInfo:l,unlockHardwareWallets:e,chooseNetworkList:h,isTonMnemonic:x}=(0,ft.useSelector)(n=>({seedPhrase:pe(n),isTonMnemonic:ye(n),privateKey:_e(n),chooseNetworkList:de(n),mpcInfo:ue(n),unlockHardwareWallets:fe(n)})),{setValue:I}=xe(),{value:N}=Te();(o===g.SEED&&!T||o===g.KEY&&!w||o===g.BULK&&!N||o===g.MPC&&(!l||et(l))||o===g.HARDWARE&&(!e||et(e)))&&r.push(K);let c=n=>{let P=`${Tt}/${o}`,{keyringName:_="",walletName:v=""}=n||{},j=`${_}-${v}`;r.push({pathname:P,state:{walletName:j,anim:"1",next:K}})},p=async n=>{await t(re(n)),await t(z()),r.push({pathname:zt,search:`?type=${Vt.INITIALIZE}`,state:{hasPassword:!0}})},C=async n=>{let P=T?.trim().toLowerCase().match(/\w+/gu)?.join(" ")||"",_=await t(se(n,P,{isTonMnemonic:x}));t(we()),await t(z()),c(_)},B=async n=>{let P=await t(ae(n,h,w));t(ge()),await t(z()),c(P)},b=n=>{I(n),r.push(Zt)},S=async(n,P)=>{et(e)||(await V().setPassword(n),await t(Y(P?2:1)),await t(H(P)),await t(be(e)),await t(z()),t(he()));let _=`${Tt}/${g.HARDWARE}`;st()===Bt&&globalThis.platform.openExtensionInPopup(`${_}?anim=1`)},R=async n=>{let{cipherText:P,privateKey:_,mpcId:v,userInfo:j}=l;if(P&&_&&v){let dt=await t(ie(n,{cipherText:P,privateKey:_},{mpcId:v,userInfo:j},!0));t(Pe()),await t(z()),c(dt)}},O={[g.CREATE]:p,[g.SEED]:C,[g.KEY]:B,[g.BULK]:b,[g.HARDWARE]:S,[g.MPC]:R};return(0,Ae.useCallback)(async(n,P)=>{try{await O[o](n,P)}catch(_){let v=a("wallet_extension_toast_text_unknown_error");_.message===Ut&&(v=a("wallet_home_toast_network_error")),J.error(_.message?_.message:JSON.stringify(_))}},[o])};var g={SEED:"seed",KEY:"key",HARDWARE:"hardware",CREATE:"create",MPC:"mpc",BULK:"bulk"},Ge=()=>{let o=(0,At.useHistory)(),r=st(),t=r===St||r===wt,T=r===Lt,w=r===wt;return{openNotification:()=>{let{pathname:h,search:x}=o.location,I=x?"&":"?",N="openFromThisPage=1";globalThis.platform.openExtensionInPopup(`${h}${x}${I}${N}`,null,!w)},closeNotification:()=>{window.close()},needOpenNotification:t,isNotification:T}};function $e(){let o=(0,At.useHistory)(),r=(0,ut.useDispatch)(),{needOpenNotification:t,isNotification:T,openNotification:w,closeNotification:l}=Ge(),e=()=>{t?o.goBack():o.push(K)},[h]=lt(nt.passwordType),[x,I]=(0,i.useState)(2),N=(0,i.useMemo)(()=>Q()===rt?"telegram":"extension",[Q]);(0,Z.useMount)(async()=>{await Jt(h)||I(1)});let c=(0,ut.useSelector)(at);Ne(),(0,Z.useMount)(()=>{async function s(){await Qt(h)||(c?o.replace({pathname:$t,search:o.location.search}):o.replace({pathname:Gt,search:o.location.search}))}s()});let p=ct(),C=p.get("from")||g.CREATE,B=Le(C),b=p.get("openFromThisPage")==="1",S=s=>c?h===s:x===s,{create:R,verify:O}=Nt(),[M,{toggle:n}]=(0,Z.useToggle)(!1),[P,{toggle:_}]=(0,Z.useToggle)(!1),v=async()=>{if(t){w();return}await R(async s=>{if(s){let{password:F,credentialId:tt}=s;await B(F,tt),await r(Y(2)),await r(H(tt)),X({button_name:"biometric",platform:N})}})},j=async()=>{_()},dt=async()=>{n(),await R(async s=>{if(s){let{password:F,credentialId:tt}=s;await V().modifyPassword(F)&&(J.success(a("wallet_edit_wallet_toast_renamed_success")),await r(Y(2)),await r(H(tt)),X({button_name:"biometric",platform:N}),T&&b&&l())}})},Oe=async s=>{_(),await V().modifyPassword(s)&&(J.success(a("wallet_edit_wallet_toast_renamed_success")),await r(Y(1)),await r(H(void 0)),X({button_name:"password",platform:N}),T&&b&&l())},Me=()=>{if(!c){I(2);return}if(c&&h===2){o.goBack();return}if(t){w();return}n()},ve=async()=>{if(!c){I(1);return}if(c&&h===1){o.goBack();return}if(t){w();return}await O(s=>{s&&_()})},[Fe,yt]=(0,i.useState)(!1),We=async()=>{try{yt(!0),x===2?await v():await j()}catch{yt(!1)}finally{yt(!1)}},De=[{type:2,title:"wallet_extension_biometrics_radio_title_authentication",desc:"wallet_extension_biometrics_radio_desc_authentication",onClick:Me},{type:1,title:"wallet_extension_biometrics_radio_title_password",desc:"wallet_extension_biometrics_radio_desc_password",onClick:ve,link:c&&h===1?{url:Ht,text:"wallet_extension_biometrics_btn_change_password"}:null}];return M?i.default.createElement(ce,{onBack:n,callback:dt}):P?i.default.createElement(Ce,{onBack:_,onComplete:async s=>{c?await Oe(s):(await B(s),await r(Y(1)),await r(H(void 0)),X({button_name:"password",platform:N}))}}):i.default.createElement(y.Box,{className:k.root},i.default.createElement(le,{bordered:!1,closeable:!1,onBack:e}),i.default.createElement(y.Container,{className:k.content},i.default.createElement(A.Text,{className:k.title},a("wallet_extension_biometrics_header_title_unlock")),i.default.createElement(A.Text,{className:k.desc},a("wallet_extension_biometrics_desc_unlock")),i.default.createElement(y.Box,{className:k.list},De.map(s=>i.default.createElement(y.FlexBox,{className:(0,Be.default)(k.item,{[k.itemSelect]:S(s.type)}),direction:y.DIRECTION.horizontal,align:y.ALIGN.center,justify:"space-between",onClick:()=>{s.onClick()}},i.default.createElement(y.Box,{className:k.itemContent},i.default.createElement(A.Text,{className:k.itemTitle},a(s.title)),i.default.createElement(A.Text,{className:k.itemDesc},a(s.desc)),s.link?i.default.createElement(y.FlexBox,{className:k.link,direction:y.DIRECTION.horizontal,align:y.ALIGN.center},i.default.createElement(vt,{alt:a(s.link.text),rel:"nofollow",onClick:F=>{F.stopPropagation(),F.preventDefault(),qt(),o.push(s.link.url)},className:k.anchor},a(s.link.text)),i.default.createElement(Mt,{iconName:"okds-arrow-chevron-right-centered-md",className:k.icon})):null),S(s.type)?i.default.createElement(Dt.Circle,{checked:!0}):null))),i.default.createElement(it.FooterActions,null,c?i.default.createElement(i.default.Fragment,null,i.default.createElement(Rt,{to:Yt,className:k.forgot},i.default.createElement(A.Text,{strong:!0,size:A.SIZE.sm,type:A.TYPE.secondary},a("wallet_footer_subtitle_forgot_password")))):i.default.createElement(m,{block:!0,category:m.CATEGORY.fill,type:m.TYPE.highlight,size:m.SIZE.lg,loading:Fe,onClick:()=>{We()}},a("commonall_button_text_next")))))}export{g as a,$e as b};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-SZ3YZWWX.js.map
