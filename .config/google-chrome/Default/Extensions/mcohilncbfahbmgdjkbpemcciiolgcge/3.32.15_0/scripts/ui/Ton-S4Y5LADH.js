import{a as we,b as Ee}from"./chunk-RK4JQBZC.js";import{a as ge,b as _e}from"./chunk-X5KO5BYB.js";import{a as pe}from"./chunk-Z77JUEZJ.js";import{a as ue}from"./chunk-QHUQYXU6.js";import{a as le}from"./chunk-4MZS5WUT.js";import"./chunk-V4GLNYXT.js";import"./chunk-TK3POT64.js";import"./chunk-IHRKU3VB.js";import"./chunk-PKCAYJL7.js";import{d as de}from"./chunk-HTCS5UFP.js";import"./chunk-P4KG7HC3.js";import"./chunk-2YRNNTO4.js";import{a as fe}from"./chunk-FCM3KMN7.js";import"./chunk-GL5KZF23.js";import"./chunk-445ZV7VL.js";import{a as q}from"./chunk-YQGNRWCJ.js";import{a as ce}from"./chunk-X4Z4JMVV.js";import"./chunk-RMSE4KTO.js";import"./chunk-W7APXTAD.js";import"./chunk-ALNQKIUN.js";import"./chunk-XZFOTB6K.js";import"./chunk-ZGE3YU4L.js";import"./chunk-R5U3NPEX.js";import"./chunk-JDZSGQWQ.js";import"./chunk-XY66VBX7.js";import{a as me}from"./chunk-GZFI5G46.js";import{g as ae,h as ie}from"./chunk-UAHUXCQX.js";import"./chunk-73OZ5IYN.js";import"./chunk-BWRHBLYR.js";import"./chunk-XTOYI7P4.js";import"./chunk-KSCP4BJT.js";import"./chunk-3MIEWVTZ.js";import{d as W,f as se}from"./chunk-J2H2J7IS.js";import"./chunk-SJIEUX3S.js";import"./chunk-L7LFNDLE.js";import{a as R}from"./chunk-NEFZK4RT.js";import"./chunk-STMKIE2Z.js";import"./chunk-GUQJR5VF.js";import"./chunk-MI6YHDAD.js";import"./chunk-ZAW6Z544.js";import"./chunk-SVAMZON6.js";import"./chunk-MF4732CU.js";import"./chunk-F52H34ZH.js";import"./chunk-3RNOIYOK.js";import"./chunk-OQFQ7WFP.js";import"./chunk-YW7TPMAR.js";import"./chunk-PGKED42N.js";import"./chunk-KSAOBFIR.js";import"./chunk-OJURW5TU.js";import{f as ne}from"./chunk-PMGQLREC.js";import"./chunk-W6OF57RJ.js";import"./chunk-HRZ4SZVQ.js";import"./chunk-ECPXLKIL.js";import"./chunk-RK4XZYBE.js";import"./chunk-ORJ3QBGC.js";import"./chunk-QF25V5YC.js";import"./chunk-KWBWAA7R.js";import"./chunk-RIWLOEHK.js";import"./chunk-TRBDC433.js";import"./chunk-5KSRM7B2.js";import"./chunk-PPHSAQ52.js";import"./chunk-JUOUD4EO.js";import"./chunk-4W35J5OQ.js";import"./chunk-GPJC633M.js";import"./chunk-YC6W5MPL.js";import"./chunk-ABBYZM2I.js";import"./chunk-KNUMOXQD.js";import"./chunk-JJ3ARLVE.js";import"./chunk-ZLD5XTE5.js";import"./chunk-2VRILCVI.js";import"./chunk-IRMGOW5H.js";import"./chunk-CQ64XZTP.js";import"./chunk-UXLFUD7T.js";import"./chunk-2HEOW3XO.js";import"./chunk-DLRFA5AU.js";import"./chunk-OC3IFNJW.js";import"./chunk-UI7PAU35.js";import"./chunk-SMZ64QW3.js";import"./chunk-DQTTI4XL.js";import"./chunk-FF6KJRSH.js";import"./chunk-CQ7YBDUS.js";import"./chunk-GSYNHSX4.js";import"./chunk-Y6SGFHFT.js";import"./chunk-V4NJDTLC.js";import"./chunk-OFKAKQXT.js";import"./chunk-IQUFOLSA.js";import"./chunk-KA5XDNKC.js";import"./chunk-HXUMX2S7.js";import"./chunk-QKXA7YNE.js";import"./chunk-PAER4Z2U.js";import"./chunk-LBVWUYQX.js";import"./chunk-M2F2X65U.js";import"./chunk-ZYEEMVIP.js";import"./chunk-BOOOUD52.js";import"./chunk-TBLUUKKO.js";import"./chunk-S5DGV5WL.js";import"./chunk-AOXUSYRH.js";import"./chunk-WKBC6JL3.js";import"./chunk-3EO5SKIF.js";import"./chunk-LMIOM5QK.js";import{X as Ge}from"./chunk-VPDRXROE.js";import{w as Ne}from"./chunk-JLIPSIRU.js";import"./chunk-CIDV5VJQ.js";import"./chunk-VX55KNI4.js";import{i as oe,m as Le}from"./chunk-4TYAYDA2.js";import"./chunk-LDX3S2CG.js";import"./chunk-TS5DNQFS.js";import"./chunk-656GFN7J.js";import{X as te,ca as G,ta as re}from"./chunk-VGT27A4M.js";import{d as ee,f as ve}from"./chunk-R4G6BEPF.js";import"./chunk-S3MY46XE.js";import"./chunk-2333N6PK.js";import"./chunk-AYCAVTPT.js";import"./chunk-OG46YTNN.js";import"./chunk-RXNDJ7P3.js";import"./chunk-YM7II27E.js";import"./chunk-CYOQISC6.js";import"./chunk-TKYTZF2K.js";import"./chunk-RY27BWZR.js";import"./chunk-WIWWLEBZ.js";import{E as Y,Jb as z,X as De,yb as k}from"./chunk-YT2MPR4E.js";import"./chunk-R4ZXRZL6.js";import{H as Q}from"./chunk-LDKM7IQF.js";import{K,pa as he}from"./chunk-6O63U2D6.js";import{M as V,x as u}from"./chunk-RIOWPXBZ.js";import"./chunk-BAWLRI3I.js";import"./chunk-USKTQDCY.js";import"./chunk-B2L2MSSC.js";import"./chunk-OIIWKMG6.js";import"./chunk-OSCGYMLH.js";import"./chunk-ADWO6K2C.js";import{a as v}from"./chunk-O337TVCZ.js";import"./chunk-EJP3AYQB.js";import"./chunk-QOGOEJFG.js";import"./chunk-TZ33IXYR.js";import"./chunk-BTK364VD.js";import"./chunk-2T657SRL.js";import"./chunk-QJAZEJHH.js";import"./chunk-IMZNFJSN.js";import"./chunk-LCKQ7YKT.js";import"./chunk-WRBXETR5.js";import"./chunk-RBB7LL2V.js";import"./chunk-ZVYHIM2Y.js";import"./chunk-VBARKITZ.js";import"./chunk-NCANHNXF.js";import{f as P,m as f,o as l}from"./chunk-GLD6H5Q5.js";f();l();var H=P(v());re();f();l();var T=P(v()),ye=P(Ne());V();ve();Le();z();f();l();var x=P(v());he();V();De();var Oe=({code:e,data:s,error_message:r,error:a})=>{if(e!==0||!s||s.queryGasLimitErrorUseDefault||a)return{fee:0,feeError:!0,feeErrorMsg:r};let{gasLimit:o="0"}=s;return{...s,fee:o,feeError:!1,feeErrorMsg:""}},be=e=>e?.feeError&&e?.feeErrorMsg?u("wallet_extension_alert_estimate_unavailable_error",{errorMsg:e.feeErrorMsg}):"",Be=(e,s)=>{let r=K(e)||Y(e,s),a=K(e)||Y(e,0);return{isSufficientGas:r,isSufficientBalance:a}},We=({coinId:e,unapproved:s,paramsInfo:r})=>{let{coin:a,toAdr:o,fromAddr:t,walletId:i,messages:n,network:c,validUntil:d}=r,{chainId:I,localType:m}=a||{},{coinAmountInt:_}=se(e,r?.walletId)||{},S=q(),A=(0,x.useRef)(null),[M,w]=(0,x.useState)(!0),[p,F]=(0,x.useState)({}),[g,h]=(0,x.useState)({});(0,x.useEffect)(()=>{m&&e&&t&&i&&n&&(async()=>{try{w(!0);let E=await S({coinId:e,address:t,toAddr:o,fromAddr:t}),y=await we({nonce:E?.nonce,localType:m,fromAddr:t,walletId:i,messages:n,network:c,validUntil:d});h({signInfo:E,sequence:E?.nonce,inputData:JSON.stringify(y?.stringInputParams),transactionParams:y?.transactionParams})}catch(E){w(!1),F({feeError:!0,feeErrorMsg:E?.message||u("wallet_extension_alert_estimate_unavailable_error")})}})()},[m,e,t,i,n]),(0,x.useEffect)(()=>((()=>{let{inputData:E}=g;if(w(!0),E){let y=async()=>{let b=await Ee({fromAddr:t,chainId:I,coinId:e,inputData:E}),U=Oe(b);w(!1),F(U)};(()=>{clearInterval(A.current),y(),A.current=setInterval(y,7e3)})()}})(),()=>{clearInterval(A.current)}),[g.inputData,I,t,e]);let{isSufficientGas:O,isSufficientBalance:J}=Be(_,p?.fee),D=be(p);return{networkFeeProps:{coinId:e,loading:M,estimateFailed:p?.feeError,estimateFailedMsg:D,networkFee:p?.fee},isSufficientGas:O,isSufficientBalance:J,estimateFailed:p?.feeError,estimateFailedMsg:D,extParams:{coinId:e,coinAmount:0,inputData:g?.inputData,fromAdr:t,toAdr:o,serviceCharge:p?.fee,extJson:JSON.stringify({nonce:g?.sequence}),txSource:2,accountId:s?.walletId,walletType:2,transactionParams:g?.transactionParams}}},Te=We;f();l();z();function qe(e){let s=W(k)||{},{address:r,walletId:a}=R(e),o=e?.params?.transaction||{},t=o?.messages||[],i=o?.network,n=o?.valid_until,{address:c}=t[0]||{};return{toAdr:c,coin:s,fromAddr:r,walletId:a,messages:t,validUntil:n,network:i}}var xe=qe;f();l();var C=P(v());re();var Je=({origin:e,walletId:s,localType:r})=>{let a=ce(),[o,t]=(0,C.useState)(!0),{host:i}=de({origin:e}),n=R({walletId:s,localType:r}),[c,d]=(0,C.useState)({}),I=(0,C.useCallback)(async(S,A,M)=>{let w="";try{w=JSON.stringify(M)}catch{}let{coinId:p,chainId:F}=S,g=await a({coinId:p,checkTypes:[G.KYS,G.VERIFY_GAS_LIMIT],amount:0,from:n.address,to:"",txType:3,domain:i,tokenAddress:"",inputData:A,chainId:F,additionalData:{tonSignData:w}});d(g),t(!1)},[i,a,n.address]),m=(0,C.useMemo)(()=>({loading:o,...c[G.KYS]||{}}),[o,c]),_=(0,C.useMemo)(()=>c[G.VERIFY_GAS_LIMIT]||{},[c]);return{kysRet:m,loading:o,preExecute:I,preExecuteRet:c,verifyGasLimitRet:_}},Ie=Je;f();l();var Se=P(v()),Ae=P(Ge());V();z();function Ue({transaction:e,fromAddress:s}){let{valid_until:r,network:a,from:o,messages:t}=e,[i,n]=(0,Se.useState)("");return(0,Ae.useAsyncEffect)(async()=>{if(a!==ae.MAINNET)n(u("wallet_extension_error_incorrect_destination_network"));else if(r<Math.floor(Date.now()/1e3))n(u("wallet_extension_error_expired_transaction"));else if(!t||t.length===0)n(u("wallet_extension_error_invalid_transaction_parameter"));else{let{TonWallet:c}=await ne(),d=new c;for(let _=0;_<t.length;_++){let S=t[_]?.address;if(!await me(S,k)){n(u("wallet_extension_error_incorrect_destination_network"));return}}let I=await d.convertAddress({address:s}),m=await d.convertAddress({address:o});I?.raw!==m?.raw&&n(u("wallet_extension_error_incorrect_receiving_address"))}},[r,a,o,s]),{checkParamsTipMessage:i?{message:i}:null,code:i?ie.BAD_REQUEST_ERROR:null}}var Fe=Ue;var Ve=(0,T.memo)(({unapproved:e})=>{let s=(0,ye.useDispatch)(),r=W(k)||{},a=r?.coinId||k,{walletId:o,address:t}=R(e),i=fe(o),n=xe(e),[c,d]=(0,T.useState)(!1),I=q(),{networkFeeProps:m,isSufficientGas:_,estimateFailed:S,estimateFailedMsg:A,isSufficientBalance:M,extParams:w}=Te({coinId:a,unapproved:e,paramsInfo:n}),{id:p,origin:F,localType:g}=e,h=Ie({origin:F,walletId:o,localType:g}),{inputData:O,transactionParams:J}=w,D=(0,T.useRef)(),{preExecute:X,kysRet:N,verifyGasLimitRet:E}=h,y=e?.params?.transaction||{};(0,T.useEffect)(()=>{r?.coinId&&!m?.loading&&!D.current&&(D.current=!0,X(r,O,y))},[r?.coinId,m?.loading,O]);let Z=ue({kysRet:N,baseCoin:r,estimateFailed:S,estimateFailedMsg:A,isSufficientGas:_,isSufficientBalance:M,verifyGasLimitRet:E}),{checkParamsTipMessage:b,code:U}=Fe({transaction:y,fromAddress:t}),Ce=ge({id:p,walletId:o,origin:F,localType:g,extraParams:{code:U}}),Pe=b||Z,ke=async()=>{d(!0),i({trade:"contract_interaction",all_confirmation:"confirm",network:g,dapp_url:F});try{let B=await I({coinId:a,address:n?.fromAddr,toAddr:n?.toAdr,fromAddr:n?.fromAddr}),$=await ee().approveDappRequest(p,{...w,transactionParams:{...J,seqno:B?.nonce},extJson:JSON.stringify({nonce:B?.nonce})});if($.code===10009){Q.error($?.msg||u("wallet_extension_failure_subtitle_fail_resend")),d(!1);return}await oe(s),d(!1)}catch(B){d(!1),Q.error(B?.msg||u("wallet_extension_failure_subtitle_fail_resend"))}},{buttonGroup:Me,handleCancel:Re}=_e({coinId:a,unapproved:e,preExecuteRet:h,feeLoading:m?.loading||c,estimateFailed:S,isSufficientGas:_,isSufficientBalance:M,disabledConfirmBtn:!!b,onConfirm:ke,onCancel:Ce});return le({kysRet:N,handleCancel:Re}),T.default.createElement(pe,{kysRet:N,unapproved:e,tipMessage:Pe,buttonGroup:Me,networkFee:m})}),j=Ve;var Kt=({unapproved:e})=>{switch(e.method){case te.SEND_TRANSACTION:return H.default.createElement(j,{unapproved:e});default:return H.default.createElement(j,{unapproved:e})}};export{Kt as default};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=Ton-S4Y5LADH.js.map
