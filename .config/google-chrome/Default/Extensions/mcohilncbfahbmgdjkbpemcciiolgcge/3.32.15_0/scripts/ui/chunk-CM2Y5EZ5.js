import{a as Z}from"./chunk-DEHONQ75.js";import{a as b}from"./chunk-UKF426AK.js";import{b as K}from"./chunk-BWRHBLYR.js";import{b as w}from"./chunk-ZI4ZHHA3.js";import{J as A,K as R}from"./chunk-YC6W5MPL.js";import{a as p}from"./chunk-Y6SGFHFT.js";import{pa as T}from"./chunk-S5DGV5WL.js";import{X as J}from"./chunk-VPDRXROE.js";import{a as v}from"./chunk-VX55KNI4.js";import{p as f,ta as z}from"./chunk-VGT27A4M.js";import{Jb as O,Ta as m,Uc as L,gd as D,pb as y}from"./chunk-YT2MPR4E.js";import{o as h}from"./chunk-LDKM7IQF.js";import{K as _,pa as F}from"./chunk-6O63U2D6.js";import{M as N,x as c}from"./chunk-RIOWPXBZ.js";import{a as E}from"./chunk-O337TVCZ.js";import{f as S,m as C,o as x}from"./chunk-GLD6H5Q5.js";C();x();var k=S(v());var P=S(J());N();O();z();D();var I=S(E());F();var j=async({chainId:s,address:e,contractAddress:o})=>{let a={chainId:s,address:e,contractAddress:o};try{return await A(a)}catch{return{status:f.NONE,register:!1}}},B=async({chainId:s,contractAddress:e})=>{let o={chainId:s,contractAddress:e};try{return await R(o)}catch{return{result:!1}}},rt=()=>{let s=(0,k.useHistory)(),e=p(m),o=K();return async({coinId:t})=>{let{coin:n,baseCoin:d}=await o(t,!0);if(![String(t),String(d.coinId)].includes(String(y)))return!0;let[r,i]=await Promise.all([j({chainId:n.chainId,address:e,contractAddress:n.address}),B({chainId:n.chainId,contractAddress:n.address})]);if(!i.result){let l=h.warn({title:c("wallet_send_modaltitle_crypto_not_supported"),text:c("wallet_dialog_modal_crypto_notavailable"),confirmText:c("wallet_send_modal_notsupported_okbtn"),alignBottom:!1,onConfirm:()=>{l.destroy()}});return!1}let g=r.status===f.NONE||r.status===f.TIMEOUT||r.status===f.ERROR;if(!r.register&&g){let l=h.warn({title:c("wallet_dialog_modal_not_registered"),text:c("wallet_dialog_modal_register_before_using"),confirmText:c("wallet_dialog_modal_registerbtn"),cancelText:c("wallet_dialog_modal_backbtn"),alignBottom:!1,onConfirm:()=>{l.destroy(),s.push(T)},onCancel:()=>{l.destroy()}});return!1}return!0}};function st(){let s=Z(),e=p(m),[o,a]=(0,I.useState)(!1),[t,n]=(0,I.useState)(null);return(0,P.useMount)(()=>{(async()=>{a(!0);let u={coinId:y,address:e},r={fromAddr:e,toAddr:e,value:"0"};try{let i=await s("ChangePubKey",u,r);n(i)}finally{a(!1)}})()}),{loading:o,feeResult:t}}function ot(){let s=b(),e=p(m),o=async t=>{let{fee:n,feeCoin:d,info:u}=t||{},{accountId:r,nonce:i}=u||{},g={type:"changePubkey",accountId:_(r)?null:parseInt(r,10),nonce:_(i)?null:parseInt(i,10),from:e,fees:n,tokenId:parseInt(d?.tokenId,10)};return{signedTx:await w(g,e,m),feeResult:t}},a=async({signedTx:t,feeResult:n})=>{if(t?.code)return{error:t};let{tx:d}=t||{},{txHash:u,...r}=d||{},i={txSource:L.DAPP,signedTx:JSON.stringify({tx:r}),fromAdr:e,serviceCharge:t?.tx?.fee,coinAmount:"0",coinId:y,txHash:u,extJson:JSON.stringify({type:"ChangePubKey",serviceChargeCoinId:n?.feeCoin?.coinId})};return await s(i)};return async t=>{let n=await o(t);return a(n)}}export{rt as a,st as b,ot as c};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-CM2Y5EZ5.js.map
