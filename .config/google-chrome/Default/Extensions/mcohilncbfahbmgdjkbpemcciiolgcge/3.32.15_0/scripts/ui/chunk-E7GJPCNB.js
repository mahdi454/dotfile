import{a as at}from"./chunk-D7AZLJO7.js";import{a as it}from"./chunk-MTNNJLNN.js";import{a as tt,b as nt,c as rt}from"./chunk-QHUQYXU6.js";import{a as Qe}from"./chunk-4MZS5WUT.js";import{a as st}from"./chunk-YMNU7XNS.js";import{a as $e,d as et}from"./chunk-V4GLNYXT.js";import{d as ot}from"./chunk-HTCS5UFP.js";import{a as re}from"./chunk-FCM3KMN7.js";import{a as ct}from"./chunk-FJWSNGLB.js";import{e as Je}from"./chunk-YQGNRWCJ.js";import{a as je}from"./chunk-X4Z4JMVV.js";import{e as He,g as Xe,h as Ze}from"./chunk-RMSE4KTO.js";import{i as H,j as he,k as X,l as qe,m as ve,n as Ke,q as ne}from"./chunk-UAHUXCQX.js";import{d as D,f as oe}from"./chunk-J2H2J7IS.js";import{b as se}from"./chunk-QYIKLURE.js";import{i as Oe}from"./chunk-PMGQLREC.js";import{T as ge,V as Be,_ as be,aa as Se,t as ye,u as Me,v as te}from"./chunk-HRZ4SZVQ.js";import{h as We,i as Ye}from"./chunk-JUOUD4EO.js";import{b as Ue,p as Ve}from"./chunk-YC6W5MPL.js";import{a as ze}from"./chunk-2HEOW3XO.js";import{i as De}from"./chunk-IQUFOLSA.js";import{e as Ge}from"./chunk-HXUMX2S7.js";import{w as Q}from"./chunk-JLIPSIRU.js";import{i as ee,m as ke}from"./chunk-4TYAYDA2.js";import{G as R,ca as U,ta as $}from"./chunk-VGT27A4M.js";import{d as Ee,f as Dt}from"./chunk-R4G6BEPF.js";import{a as Le,b as zt}from"./chunk-CYOQISC6.js";import{C as de,D as Ce,F as _e,Jb as Pe,La as J,X as Te,ga as K,va as xe,w as we,y as q}from"./chunk-YT2MPR4E.js";import{b as Re}from"./chunk-LDKM7IQF.js";import{K as Y,a as Ae,f as Fe,pa as j}from"./chunk-6O63U2D6.js";import{M as fe,l as Ie,x as W}from"./chunk-RIOWPXBZ.js";import{a as B}from"./chunk-O337TVCZ.js";import{b as Ut}from"./chunk-ZRLPUW3Z.js";import{f as F,m as c,o as u}from"./chunk-GLD6H5Q5.js";c();u();var Ne=F(B());c();u();var lt=F(B());c();u();var ut=F(Q());c();u();Dt();function ae(t){return async()=>await Ee().handleTxBySigner(t)}Pe();function Vt({walletId:t,method:r,message:n,onConfirm:o}){let e=(0,ut.useDispatch)();return async()=>{let i=await e(ae({walletId:t,localType:J,method:r,params:{message:n}})),{publicKey:m,signature:a}=i||{},l=ve(qe(m),a);return o(l)}}var mt=Vt;var pt=t=>{let{walletId:r,method:n,params:o,source:e,onConfirm:s,onCancel:i}=t,m=typeof o?.message=="string"?o?.message:new TextDecoder().decode(o?.message),a=at({unapproved:t}),l=mt({walletId:r,method:n,message:m,onConfirm:s}),g,f,d;return e!=="dapp"&&(g=l,f=!0,d=i),lt.default.createElement(st,{message:m,unapproved:t,tipMessage:a,onConfirm:g,onConfirmReplace:f,onCancel:d})};c();u();var kt=F(B());c();u();var V=F(B());j();fe();xe();c();u();var gt=F(B());j();c();u();var P=F(B());Te();c();u();var ft=F(Ut());zt();Te();async function dt(t){let{SolWallet:r}=await Oe(),n=new r,o=[];try{let e=(t||[]).filter(Boolean);e.length>0&&(o=await n.deserializeMessages({data:e}))}catch{}return(o||[]).reduce(({totalPriorityFee:e,priorityFees:s},i,m)=>{let{deserialized:a,computeUnitLimit:l,computeUnitPrice:g}=i||{};if(a){let f=Ke(l,g);e=q(e,f),s[m]=f}else s[m]="0";return{totalPriorityFee:e,priorityFees:s}},{totalPriorityFee:"0",priorityFees:[]})}var Wt="SetComputeUnitLimit",Yt="SetComputeUnitPrice";function Ct(t,r,n){if(de(r||0,0)||de(n||0,0)||t.some(m=>{try{let a=be.decodeInstructionType(m);return a===Wt||a===Yt}catch{return!1}}))return t;let e=[...t],s=Se.setComputeUnitPrice({microLamports:r});e.unshift(s);let i=Se.setComputeUnitLimit({units:n});return e.unshift(i),e}async function qt(t,r,n){let o=new Be(Le.requestSolanaMethodUrlToFullnode);o._rpcRequest=Ve;let e=await Promise.all((t.message?.addressTableLookups||[]).map(a=>o.getAccountInfo(a.accountKey).then(l=>new ge({key:a.accountKey,state:ge.deserialize(l.data)})))),s=Me.decompile(t.message,{addressLookupTableAccounts:e});s.instructions=Ct(s.instructions,r,n);let i=new te(s.compileToV0Message(e)),m=X(i);return H(i,m)}async function Tt(t,r,n){return new Promise(o=>{try{let e=ft.base.fromBase58(t);try{e=ye.from(e)}catch{e=te.deserialize(e)}if(e.signatures&&e.signatures.length>1){o(t);return}if(e instanceof ye){e.instructions=Ct(e.instructions,r,n);let s=X(e);o(H(e,s))}else e instanceof te?qt(e,r,n).then(o).catch(()=>{o(t)}):o(t)}catch{o(t)}})}function vt({coinId:t,transactions:r,address:n,replace:o,disabled:e,unitLimits:s,signInfo:i}){let[m,a]=(0,P.useState)(0),[l,g]=(0,P.useState)(null),[f,d]=(0,P.useState)([]),[C,p]=(0,P.useState)("0"),[S,h]=(0,P.useState)([]),[L,T]=(0,P.useState)(!1),N=l?.fee||"0",[w,E]=(0,P.useState)(r),_=ct(),O=D(t),{disabledSignInfo:I=!1,disabledPreExecute:G=!1}=e||{},A=M=>{a(M?y=>y+1:y=>y-1)};return(0,P.useEffect)(()=>{s&&d(s)},[s]),(0,P.useEffect)(()=>{i&&g(i)},[i]),(0,P.useEffect)(()=>{(async function(){if(!(I||!t)){A(!0);try{let{data:y={}}=await Ue({coinId:t,address:n}),{info:k={}}=y;g(k),T(!1)}catch{T(!0)}finally{A(!1)}}})()},[n,t,I]),(0,P.useEffect)(()=>{(async function(){if(!(G||!t)&&!(!o||!O?.chainId)){A(!0);try{let y=await _({coinId:t,from:n,chainId:O.chainId,simulateTransactionParamList:r.map(({serializedMessage:k})=>({transaction:k,sigVerify:!1,replaceRecentBlockhash:!0}))});d(y.unitLimits),T(!1)}catch{T(!0)}finally{A(!1)}}})()},[...r,o,n,O?.chainId,G,t]),(0,P.useEffect)(()=>{(async function(){if(!(o&&(!l||!f?.length))){A(!0);try{let y=r;o&&(y=await Promise.all(y.map(async(z,Z)=>{let{serializedMessage:ue,...me}=z,le=await Tt(ue,l.computeUnitPrice,f[Z]);return{...me,serializedMessage:le}})));let{totalPriorityFee:k,priorityFees:ce}=await dt(y.map(({serializedMessage:z})=>z));p(k),E(y),h(ce)}finally{A(!1)}}})()},[...r,o,l,f]),{loading:m>0,baseFee:N,totalPriorityFee:C,priorityFees:S,totalFee:q(we(N,r.length),C),signInfo:l,estimateFailed:L,replacedTransactions:w}}var yt=vt;$();Te();var Kt=({fromAddress:t,coinId:r,preExecuteResult:n,walletId:o,transactions:e,addPriorityFee:s})=>{let{loading:i,preExecuteRet:m}=n,a=m?.[U.TX_ANALYZE]||{},l=(a.simulateTransactionResultList||[]).find(I=>Y(I?.unitGasLimit)||_e(I?.unitGasLimit,"0")),g=(0,gt.useMemo)(()=>(a.simulateTransactionResultList||[]).map(I=>I?.unitGasLimit),[a.simulateTransactionResultList]),{loading:f,totalFee:d,baseFee:C,priorityFees:p,estimateFailed:S,signInfo:h,replacedTransactions:L}=yt({coinId:r,transactions:e||[],address:t,replace:s,unitLimits:g,disabled:{disabledPreExecute:!0}}),T=h?.solRent||"0",N=S||!i&&!!l,w=oe(r,o)?.coinAmountInt,E=Y(w)||Ce(w,d)||i,_=Y(w)||Ce(w,q(d,T))||i;return{loading:f,networkFeeProps:{loading:f,networkFee:d,estimateFailed:N,coinId:r},isSufficientGas:E,baseFee:C,priorityFees:p,networkFee:d,estimateFailed:N,estimateFailedMsg:l?.msg,isSufficientBalance:_,selfRent:T,replacedTransactions:L}},St=Kt;c();u();var ie=F(B());j();fe();function Ht({txId:t,fromAddress:r,coinId:n,walletId:o,feeLoading:e,estimateFailed:s,preExecuteRet:i,chainConfirmDisabled:m=!1,isSufficientGas:a,isSufficientBalance:l,priorityFees:g,baseFee:f,networkFee:d,replacedTransactions:C,onConfirm:p,onCancel:S,transactions:h}){let L=Je({walletId:o}),T=oe(n,o)?.coinAmountInt,{loading:N=!1,verifyGasLimitRet:w={}}=i,E=!a||!l||Xe(w),_=Y(T)||e||s||N||Ze(w)||m,O={onClick:S,actionType:ne.ACTION_TYPE.CANCEL,btnText:W("wallet_dapp_connection_btn_reject")},I=(0,ie.useMemo)(()=>({disabled:_,onClick:async()=>{p({serviceCharge:d,replacedTransactions:C,serializedTransactions:h})},actionType:ne.ACTION_TYPE.CONFIRM}),[_,p,C,f,g,n,r,d,L]),G=(0,ie.useMemo)(()=>({actionType:ne.ACTION_TYPE.FILL_UP,txId:t,coinId:n,walletId:o,address:r}),[r,n,t,a,o]),A=(0,ie.useMemo)(()=>_?I:E?G:I,[_,I,G,E]);return{buttonGroup:[O,A],handleCancel:S}}var ht=Ht;c();u();var b=F(B());j();fe();$();function Xt({coinId:t,fromAddress:r,domain:n,transactions:o=[]}){let e=D(t)||{},s=je(),[i,m]=(0,b.useState)(!1),[a,l]=(0,b.useState)({}),g=(0,b.useCallback)(async C=>{try{m(!0);let p=await s({checkTypes:[U.TX_ANALYZE,U.KYS],from:r,chainId:C.chainId,domain:n,coinId:C.coinId,bizLine:6,simulateTransactionParamList:o.map(S=>({transaction:S.serializedMessage,sigVerify:!1,replaceRecentBlockhash:!0}))});l(p)}catch(p){console.log(p)}finally{m(!1)}},[r,n,o.length,s]),f=(0,b.useMemo)(()=>{let C=a?.[U.TX_ANALYZE]||{},p=C.simulateTransactionResultList,S=p?.length;if(Ae(p)&&S>0){if(S===1)return p[0];let h={};if(p.every(T=>!T.result)){h.result=!1,h.msg=W("wallet_extension_transaction_text_thirdparty_contract_failed");let T=p.some(N=>N.addFundsFlag);h.addFundsFlag=T,h.resultCode=T?He:""}else h.result=!0,h.msg="",h.addFundsFlag=!1,h.resultCode="";return h}return C},[a]),d=(0,b.useMemo)(()=>({loading:i,...a?.[U.KYS]||{}}),[i,a]);return(0,b.useEffect)(()=>{e.coinId&&g(e)},[g,e.coinId]),{loading:i,kysRet:d,verifyGasLimitRet:f,preExecuteRet:a}}var Nt=Xt;function Zt({txId:t,coinId:r,walletId:n,transactions:o=[],dappInfo:e={},showDappInfo:s=!0,addPriorityFee:i=!0,showSwitchNetwork:m=!0,onConfirm:a,onCancel:l,onAddressCopy:g=Fe,onNetworkChange:f,slot:d={}}){let C=se(K),p=r||C?.coinId,S=D(p)||{},h=S.localType,L=De(n),T=ze(h,n),N=(0,V.useMemo)(()=>o.map(v=>{try{if(v.serializedMessage)return v;let pe=X(v);return{instanceType:pe,serializedMessage:H(v,pe),needToReplaceRecentBlockhash:!v.recentBlockhash}}catch{return null}}).filter(Boolean),[o.length]),w=Nt({coinId:p,fromAddress:T,domain:e?.host,transactions:N}),{verifyGasLimitRet:E,kysRet:_}=w,{baseFee:O,priorityFees:I,networkFee:G,isSufficientGas:A,networkFeeProps:M,estimateFailed:y,estimateFailedMsg:k,loading:ce,isSufficientBalance:z,selfRent:Z,replacedTransactions:ue}=St({fromAddress:T,coinId:p,preExecuteResult:w,walletId:n,transactions:N,addPriorityFee:i}),me=(0,V.useCallback)(()=>!z&&A?{type:Re.TYPE.warn,message:W("walletextension_toast_text_reserve_rent_exempt",{number:Ie.div(Z,10**S?.decimals)})}:null,[A,z,Z,S?.decimals]),le=$e({initialType:L.initialType}),Mt=et({verifyGasLimitRet:E}),Bt=tt({baseCoin:S,estimateFailed:y,isSufficientGas:A,verifyGasLimitRet:E,estimateFailedMsg:k,kysRet:_},{pre:[le,Mt],post:[me]}),{handleCancel:bt,buttonGroup:Gt}=ht({txId:t,fromAddress:T,coinId:p,transactions:N,walletId:n,feeLoading:ce,estimateFailed:y,preExecuteRet:w,chainConfirmDisabled:Ge(L.initialType),isSufficientGas:A,isSufficientBalance:z,baseFee:O,priorityFees:I,networkFee:G,replacedTransactions:ue,onConfirm:a,onCancel:l});return Qe({kysRet:_,handleCancel:bt,coinId:p}),V.default.createElement(nt,{slot:{...d,top:d.top||m&&V.default.createElement(it,{providerType:K,chainName:S?.chainName,onNetworkChange:f})},kysRet:_,dappInfo:e,showDappInfo:s,walletId:n,fromAddress:T,tipMessage:Bt,buttonGroup:Gt,networkFee:M,onAddressCopy:g})}var It=Zt;c();u();var At=F(B()),Ft=F(Q());ke();function jt({walletId:t,localType:r,id:n,origin:o}){let e=(0,Ft.useDispatch)(),s=re(t);return(0,At.useCallback)(async()=>{s({trade:"contract_interaction",all_confirmation:"cancel",network:r,dapp_url:o}),await e(We(n)),await ee(e)},[s,n,r,o])}var wt=jt;c();u();var _t=F(B()),xt=F(Q());ke();function Jt({coinId:t,id:r,walletId:n,localType:o,origin:e}){let s=(0,xt.useDispatch)(),i=re(n);return(0,_t.useCallback)(async({replacedTransactions:m,serviceCharge:a})=>{let l={coinId:t,replacedTransactions:m,serviceCharge:a};i({page_type:"contract_interaction",all_confirmation:"confirm",network:o,dapp_url:e}),await s(Ye(r,l)),await ee(s)},[i,o,e])}var Pt=Jt;c();u();xe();function Qt(t){let n=se(K)?.coinId,{coinId:o,showSwitchNetwork:e=!0}=t?.params?.extParams||{};return{coinId:o||n,showSwitchNetwork:e}}var Rt=Qt;c();u();var Et=F(Q());$();Pe();function $t({coinId:t,walletId:r,method:n,okxArgs:o,onConfirm:e}){let s=(0,Et.useDispatch)();return async({replacedTransactions:i,serviceCharge:m,serializedTransactions:a})=>{let f=await s(ae({walletId:r,localType:J,method:n,params:{message:a,okxArgs:o},extraParams:{coinId:t,replacedTransactions:i,serviceCharge:m}})),d;if(n===R.SIGN_ALL_TRANSACTIONS)d=(f.signedTransactionResults||[]).map(({serializedTransaction:C,type:p})=>he(C,p));else if(n===R.SIGN_TRANSACTION){let{instanceType:C}=a[0]||{};d=he(f.serializedTransaction,C)}else n===R.SIGN_AND_SEND_TRANSACTION&&(d=f);return e(d)}}var Lt=$t;var Ot=t=>{let{id:r,coinId:n,method:o,params:e,walletId:s,origin:i,source:m,dappInfo:a,showDappInfo:l=!0,addPriorityFee:g=!0,showSwitchNetwork:f,onConfirm:d,onCancel:C,onAddressCopy:p,okxArgs:S}=t,{coinId:h,showSwitchNetwork:L}=Rt(t),T=ot(t),N=n||h,E=(D(N)||{}).localType,_=e?.message||[],O=Pt({coinId:N,id:r,walletId:s,localType:E,origin:i}),I=wt({walletId:s,localType:E,id:r,origin:i}),G=rt({walletId:s}),A=Lt({coinId:N,walletId:s,method:o,okxArgs:S,onConfirm:d}),M,y,k;return m==="dapp"?(M=O,y=I,k=G):(M=A,y=C,k=p),kt.default.createElement(It,{coinId:N,showSwitchNetwork:typeof f=="boolean"?f:L,txId:r,walletId:s,transactions:_,dappInfo:a||T,showDappInfo:l,addPriorityFee:g,onConfirm:M,onCancel:y,onAddressCopy:k})};$();function eo(t){switch(t.method){case R.SIGN_TRANSACTION:case R.RPC_SIGN_TRANSACTION:case R.SIGN_AND_SEND_TRANSACTION:case R.RPC_SIGN_AND_SEND_TRANSACTION:case R.SIGN_ALL_TRANSACTIONS:case R.RPC_SIGN_ALL_TRANSACTIONS:return Ne.default.createElement(Ot,{...t});case R.SIGN_MESSAGE:case R.RPC_SIGN_MESSAGE:return Ne.default.createElement(pt,{...t});default:return""}}var fr=eo;export{dt as a,fr as b};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-E7GJPCNB.js.map
