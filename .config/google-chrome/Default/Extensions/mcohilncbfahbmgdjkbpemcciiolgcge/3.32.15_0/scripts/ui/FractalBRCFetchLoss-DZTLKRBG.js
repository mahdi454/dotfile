import{a as vt}from"./chunk-BAISQ3N2.js";import"./chunk-O2YW3UOK.js";import{a as Lt}from"./chunk-BUZ3YKBY.js";import{b as St,n as Ct}from"./chunk-GL5KZF23.js";import"./chunk-445ZV7VL.js";import{a as gt}from"./chunk-YQGNRWCJ.js";import"./chunk-X4Z4JMVV.js";import"./chunk-RMSE4KTO.js";import"./chunk-W7APXTAD.js";import"./chunk-ALNQKIUN.js";import"./chunk-JDZSGQWQ.js";import"./chunk-XY66VBX7.js";import"./chunk-GZFI5G46.js";import{a as It}from"./chunk-UAHUXCQX.js";import"./chunk-73OZ5IYN.js";import"./chunk-BWRHBLYR.js";import"./chunk-XTOYI7P4.js";import"./chunk-KSCP4BJT.js";import"./chunk-3MIEWVTZ.js";import"./chunk-J2H2J7IS.js";import"./chunk-SJIEUX3S.js";import"./chunk-L7LFNDLE.js";import"./chunk-STMKIE2Z.js";import"./chunk-GUQJR5VF.js";import"./chunk-MI6YHDAD.js";import"./chunk-ZAW6Z544.js";import"./chunk-SVAMZON6.js";import"./chunk-MF4732CU.js";import"./chunk-F52H34ZH.js";import"./chunk-3RNOIYOK.js";import"./chunk-OQFQ7WFP.js";import"./chunk-YW7TPMAR.js";import"./chunk-PGKED42N.js";import"./chunk-KSAOBFIR.js";import"./chunk-OJURW5TU.js";import{a as wt,e as K}from"./chunk-PMGQLREC.js";import"./chunk-W6OF57RJ.js";import"./chunk-HRZ4SZVQ.js";import"./chunk-ECPXLKIL.js";import"./chunk-RK4XZYBE.js";import"./chunk-KWBWAA7R.js";import"./chunk-RIWLOEHK.js";import"./chunk-TRBDC433.js";import"./chunk-5KSRM7B2.js";import"./chunk-PPHSAQ52.js";import"./chunk-JUOUD4EO.js";import"./chunk-4W35J5OQ.js";import"./chunk-GPJC633M.js";import{f as At}from"./chunk-YC6W5MPL.js";import"./chunk-ABBYZM2I.js";import"./chunk-KNUMOXQD.js";import"./chunk-JJ3ARLVE.js";import"./chunk-ZLD5XTE5.js";import"./chunk-CQ64XZTP.js";import"./chunk-UXLFUD7T.js";import"./chunk-2HEOW3XO.js";import"./chunk-DLRFA5AU.js";import"./chunk-OC3IFNJW.js";import"./chunk-UI7PAU35.js";import"./chunk-SMZ64QW3.js";import"./chunk-DQTTI4XL.js";import"./chunk-FF6KJRSH.js";import"./chunk-CQ7YBDUS.js";import"./chunk-GSYNHSX4.js";import"./chunk-Y6SGFHFT.js";import"./chunk-V4NJDTLC.js";import"./chunk-OFKAKQXT.js";import{i as ht,l as bt,m as Tt,s as yt}from"./chunk-IQUFOLSA.js";import"./chunk-KA5XDNKC.js";import"./chunk-HXUMX2S7.js";import"./chunk-QKXA7YNE.js";import"./chunk-PAER4Z2U.js";import"./chunk-LBVWUYQX.js";import"./chunk-M2F2X65U.js";import"./chunk-ZYEEMVIP.js";import"./chunk-BOOOUD52.js";import"./chunk-TBLUUKKO.js";import{Qa as xt}from"./chunk-S5DGV5WL.js";import"./chunk-AOXUSYRH.js";import{m as mt}from"./chunk-WKBC6JL3.js";import"./chunk-3EO5SKIF.js";import"./chunk-LMIOM5QK.js";import"./chunk-VPDRXROE.js";import"./chunk-JLIPSIRU.js";import"./chunk-CIDV5VJQ.js";import{a as fe}from"./chunk-VX55KNI4.js";import"./chunk-4TYAYDA2.js";import"./chunk-LDX3S2CG.js";import"./chunk-TS5DNQFS.js";import"./chunk-656GFN7J.js";import{b as _t,k as we}from"./chunk-VGT27A4M.js";import{d as V,f as xe}from"./chunk-R4G6BEPF.js";import"./chunk-S3MY46XE.js";import"./chunk-2333N6PK.js";import"./chunk-AYCAVTPT.js";import"./chunk-OG46YTNN.js";import{c as I}from"./chunk-RXNDJ7P3.js";import"./chunk-YM7II27E.js";import{a as E,b as be}from"./chunk-CYOQISC6.js";import{c as pt,f as O,h as Te}from"./chunk-TKYTZF2K.js";import"./chunk-RY27BWZR.js";import"./chunk-WIWWLEBZ.js";import{Ha as $,Jb as _e,Uc as ft,X as de,gd as he,jb as L,y as A,z as J}from"./chunk-YT2MPR4E.js";import"./chunk-R4ZXRZL6.js";import{G as h,q as dt,w as z}from"./chunk-LDKM7IQF.js";import{m as X,pa as ue}from"./chunk-6O63U2D6.js";import{M as ce,x as i}from"./chunk-RIOWPXBZ.js";import"./chunk-BAWLRI3I.js";import{b as me}from"./chunk-USKTQDCY.js";import"./chunk-B2L2MSSC.js";import"./chunk-OIIWKMG6.js";import{U as ut,c as pe,ca as v}from"./chunk-OSCGYMLH.js";import"./chunk-ADWO6K2C.js";import{a as R}from"./chunk-O337TVCZ.js";import"./chunk-EJP3AYQB.js";import"./chunk-QOGOEJFG.js";import"./chunk-TZ33IXYR.js";import"./chunk-BTK364VD.js";import"./chunk-2T657SRL.js";import"./chunk-QJAZEJHH.js";import"./chunk-IMZNFJSN.js";import"./chunk-LCKQ7YKT.js";import"./chunk-WRBXETR5.js";import"./chunk-RBB7LL2V.js";import"./chunk-ZVYHIM2Y.js";import"./chunk-VBARKITZ.js";import"./chunk-NCANHNXF.js";import{f as y,m,n as w,o as _}from"./chunk-GLD6H5Q5.js";m();_();var tt=y(R()),U=y(fe());m();_();var W=y(R());m();_();var j=y(R());m();_();var Z={root:"_root_dowdc_1",header:"_header_dowdc_30"};function ye({children:p,hidden:N=!1}){return j.default.createElement(I.Box,{className:Z.root},j.default.createElement(Lt,{className:Z.header}),N?null:p)}var Et=ye;m();_();var e=y(R()),Pt=y(pe());ue();ce();me();xe();he();we();_e();be();Te();de();m();_();var c={root:"_root_1teux_1",title:"_title_1teux_46","fee-select":"_fee-select_1teux_52",feeSelect:"_fee-select_1teux_52",inner:"_inner_1teux_55","add-weight":"_add-weight_1teux_55",addWeight:"_add-weight_1teux_55","add-element-weight":"_add-element-weight_1teux_55",addElementWeight:"_add-element-weight_1teux_55",placeholder:"_placeholder_1teux_55",link:"_link_1teux_76",input:"_input_1teux_84","tip-txt":"_tip-txt_1teux_87",tipTxt:"_tip-txt_1teux_87",btn:"_btn_1teux_93"};var Ae=50,Nt=600,Ie=546,Bt="inputLessThan546",kt="commonall_modal_btn_claim",Q="commonall_modal_btn_done",Ft="wallet_extension_fb_btn_retry",ge="https://www.oklink.com/fractal-bitcoin/address/",Se=["wallet_extension_fb_desc_claim_all_utxo","wallet_extension_fb_desc_claim_delay","wallet_extension_fb_desc_claim_network_fee"],Mt=[{label:"wallet_extension_fb_select_network_fee_fast",value:"max"},{label:"wallet_extension_fb_select_network_fee_average",value:"normal"},{label:"wallet_extension_fb_select_network_fee_slow",value:"min"}];function Ce(){let p=ht(),N=bt(),et=yt(),[g,Wt]=(0,e.useState)(Mt[0].value),[ot,Ut]=(0,e.useState)("0"),nt=Tt(),B=(0,e.useMemo)(()=>(p?.addressType[$]||[]).map(o=>({label:o.address,value:o.address})),[p.walletId]),[b,rt]=(0,e.useState)(B[0]?.value||""),[S,x]=(0,e.useState)(!1);(0,e.useEffect)(()=>{let t=B[0]?.value;t&&(rt(t),x(!0))},[B]);let st=(0,e.useCallback)(t=>{let o=N(t),{share:n,pShare:r,mpcId:s,publicKey:a,deriveIndex:u}=o?.addressType?.bitcoin?.find(d=>d?.addressType===o?.selectedAddressType?.bitcoin)||{};return{publicKey:a,share:n,pShare:r,mpcId:s,deriveIndex:u}},[N]),Ht=(0,e.useCallback)(async(t,o)=>{let r=(await et(t))?.find(s=>s.address===o)?.privateKey;if(nt){let{getMidKey:s}=await wt(),{networks:a,private2Wif:u}=await K(),{share:d}=st(t),f=await s(Ct(d),0);return u(w.Buffer.from(f),a.bitcoin)}return r},[st,et,nt]),qt=(0,e.useCallback)(async(t,o)=>{let r=X(t,Ae).map(s=>O(E.subscriptionFBRCMidAddr,s,{headers:o}));return Promise.all(r)},[]),[at,Dt]=(0,e.useState)([]),Yt=gt(),Gt=(0,e.useCallback)(async(t,o)=>{let{data:n}=await pt(E.getFBRCLossInscriptionInfo,{address:t},{headers:o});return n||[]},[]),Xt=(0,e.useCallback)(async(t,o,n)=>{let{networks:r,createInscriptionTxCtxData:s}=await K(),a=[];return t.forEach(u=>{let d={contentType:"text/plain;charset=utf-8",body:u.inscriptionJson,revealAddr:o},{commitTxAddress:f}=s(r.bitcoin,d,n);u.midAddress===f||(a.push(f),u.midAddress=f)}),a},[]),Jt=(0,e.useCallback)(async(t,o)=>{let n=t.map(({midAddress:d})=>({address:d,utxoType:St.TRANSFER})),r={coinId:L,utxoRequests:n},{data:s}=await O(E.getBTCUTXO,r,{headers:o});if(!s?.length)return[];let a=s.map((d,f)=>({...n[f],serviceCharge:0,coinAmount:d.canTransferAmount})),{data:u}=await O(E.getBTCUTXO,{coinId:L,utxoRequests:a},{headers:o});return u},[]),$t=(0,e.useCallback)(async({inscriptionInfoList:t,midAddrUtxoList:o,privateKey:n,selectedAddress:r,feeRate:s,walletId:a,serverWalletType:u})=>{let{networks:d,inscribeRefundFee:f}=await K(),l=0,k=[],q=0;for(let F=0;F<t.length;F++){let M=t[F],oe=o[F].utxoList.map(T=>({privateKey:n,txId:T.txHash,vOut:T.vout,amount:T.coinAmount,address:M.midAddress})),ne=[{contentType:"text/plain;charset=utf-8",body:M.inscriptionJson,revealAddr:r}],re={feeRate:s,inscriptionRefundFeeDataList:ne,changeAddress:r,middleAddress:M.midAddress,maxAmountOfInput:Nt},se=X(oe,Nt),D=0,Y=0;se.forEach(T=>{let ae={...re,inputs:T},P=0;T.forEach(le=>{P=A(P,le.amount)}),Y=A(Y,P);let{refundFeeTx:ie,refundFeeTxFee:G,dustChange:ct}=f(d.bitcoin,ae);if(ct&&ct<Ie)throw new Error(Bt);k.push({coinId:L,txType:_t.TRANS_IN,signedTx:ie,coinAmount:J(P,G),toAdr:r,fromAdr:M.midAddress,serviceCharge:G,accountId:a,walletType:u,txSource:ft.NORMAL}),D=A(D,G)}),l=A(l,Y),q=A(q,D)}return{claimAmount:J(l,q)||0,refundFeeTxList:k}},[]),zt=async(t,o)=>{let n=await Ht(p.walletId,t),r=await V().getRequestHeaders({walletId:p.walletId,needSign:!0,currency:"usd"}),s;try{s=(await Yt({coinId:L,address:t}))?.[o]}catch{return h.error({title:i("wallet_extension_fb_error_network_refresh"),duration:5}),{}}if(!n||!s)return{};let a=[];try{if(a=await Gt(t,r),!a.length)return{}}catch{return h.error({title:i("wallet_extension_fb_error_network_refresh"),duration:5}),{}}let u=await Xt(a,t,n);try{u.length&&await qt(u,r)}catch{return h.error({title:i("wallet_extension_fb_error_network_refresh"),duration:5}),{}}let d=[];try{let l=await Jt(a,r);if(!l.length)return{};d=l}catch{return h.error({title:i("wallet_extension_fb_error_network_refresh"),duration:5}),{}}let f;try{f=await $t({inscriptionInfoList:a,midAddrUtxoList:d,privateKey:n,selectedAddress:t,feeRate:s,walletId:p.walletId,serverWalletType:p.serverWalletType})}catch(l){let k=l.message===Bt?"wallet_extension_fb_error_dust_limit":"wallet_extension_fb_error_contact_support";return h.error({title:i(k),duration:5}),{}}return f},[C,H]=(0,e.useState)(kt),Vt=(0,e.useCallback)(async t=>{let o=t.value;o!==b&&([Q,Ft].includes(C)&&H(kt),x(!0),rt(o))},[b,C]),it=(0,e.useCallback)(async()=>{try{if(S)return;x(!0);let t=await V().getRequestHeaders({walletId:p.walletId,needSign:!0,currency:"usd"}),o=at.map(async({signedTx:n,...r})=>{let a={txHash:await It($,n),signedTx:n,...r};return At(a,{headers:t})});await Promise.all(o),x(!1),h.success({title:i("wallet_extension_fb_notification_view_status",{link:e.default.createElement(ut,{href:`${ge}${b}`,className:c.link},i("wallet_extension_fb_notification_view_status_icu"))}),duration:5}),H(Q)}catch{h.error({title:i("wallet_extension_fb_notification_header_fail_claim"),duration:5}),x(!1),H(Ft)}},[S,p.walletId,at,b]),lt=vt(),Zt=(0,e.useCallback)(async()=>{if(C===Q){await lt();return}it()},[C,it,lt]);(0,e.useEffect)(()=>{zt(b,g).then(({refundFeeTxList:t=[],claimAmount:o=0})=>{x(!1),Ut(o),Dt(t)}).catch(()=>{x(!1)})},[b,g]);let jt=mt(ot,{decimals:8})||0,Qt=Number(ot)===0,te=(0,e.useCallback)(({value:t})=>{t!==g&&(Wt(t),x(!0))},[g]),ee=(0,e.useMemo)(()=>Mt.map(t=>({...t,label:i(t.label)})),[]);return e.default.createElement(I.Box,{className:c.root},e.default.createElement(z,{optionItemClassName:"break-all",titleClass:c.title,title:e.default.createElement("span",{className:c.title},i("wallet_extension_fb_header_switch_wallet_type")),value:b,options:B,onChange:Vt,searchable:!1,showSelectedIcon:!0,disabled:S}),e.default.createElement(z,{className:c.feeSelect,titleClass:c.title,title:e.default.createElement("span",{className:c.title},i("wallet_extension_fb_header_network_fee")),value:g,options:ee,onChange:te,searchable:!1,showSelectedIcon:!0,disabled:S}),e.default.createElement(dt,{className:c.input,inputClassName:c.placeholder,innerClassName:(0,Pt.default)(c.inner,c.addWeight,c.addElementWeight),title:e.default.createElement("span",{className:c.title},i("wallet_extension_fb_title_amount")),disabled:!0,placeholder:i("wallet_extension_fb_input_placeholder_num_fb",{num:jt}),value:""}),Se.map(t=>e.default.createElement("div",{className:c.tipTxt},i(t))),e.default.createElement(v,{className:c.btn,category:v.CATEGORY.fill,type:v.TYPE.highlight,size:v.SIZE.xl,loading:S,block:!0,onClick:Zt,disabled:Qt,loadingText:i("commonall_modal_btn_claim")},i(C)))}var Rt=Ce;m();_();var Ot={root:"_root_1et89_1"};function Le(){return W.default.createElement(Et,null,W.default.createElement(I.Box,{className:Ot.root},W.default.createElement(Rt,null)))}var Kt=Le;var Po=()=>tt.default.createElement(U.Switch,null,tt.default.createElement(U.Route,{path:xt,component:Kt,exact:!0}));export{Po as default};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=FractalBRCFetchLoss-DZTLKRBG.js.map
