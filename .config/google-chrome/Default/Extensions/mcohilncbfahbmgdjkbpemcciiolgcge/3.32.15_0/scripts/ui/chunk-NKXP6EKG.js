import{a as Ae,b as Ie}from"./chunk-VBFVRBFM.js";import{b as xe}from"./chunk-PYDL4HCD.js";import{b as me,g as de,i as ue,l as fe,m as pe,r as ye,s as _e}from"./chunk-GL5KZF23.js";import{a as le}from"./chunk-445ZV7VL.js";import{e as ie}from"./chunk-YQGNRWCJ.js";import{a as ge}from"./chunk-XZFOTB6K.js";import{c as Te,d as tt,e as et,g as S}from"./chunk-R5U3NPEX.js";import{a as ne,q as j}from"./chunk-UAHUXCQX.js";import{d as se,g as re}from"./chunk-J2H2J7IS.js";import{a as ce}from"./chunk-STMKIE2Z.js";import{c as oe}from"./chunk-F52H34ZH.js";import{b as Kt}from"./chunk-KSAOBFIR.js";import{f as xt}from"./chunk-OEIE6KE4.js";import{b as _t}from"./chunk-ONV3ODOM.js";import{h as gt,i as ae}from"./chunk-JUOUD4EO.js";import{d as Tt}from"./chunk-4W35J5OQ.js";import{i as Qt,m as te,n as ee}from"./chunk-IQUFOLSA.js";import{a as Xt}from"./chunk-M2F2X65U.js";import{a as Q}from"./chunk-S5DGV5WL.js";import{b as yt}from"./chunk-AOXUSYRH.js";import{q as C}from"./chunk-WKBC6JL3.js";import{X as $t}from"./chunk-VPDRXROE.js";import{w as Ze}from"./chunk-JLIPSIRU.js";import{a as qe}from"./chunk-VX55KNI4.js";import{Z as q,b as Z,ha as jt,ta as Rt}from"./chunk-VGT27A4M.js";import{c as w}from"./chunk-RXNDJ7P3.js";import{a as K,b as qt}from"./chunk-CYOQISC6.js";import{f as X,h as Jt}from"./chunk-TKYTZF2K.js";import{Eb as Dt,Ha as Wt,Jb as Ut,Mc as J,Rc as Ht,Uc as zt,Zc as $,a as kt,b as Ve,cd as Vt,ed as Gt,gd as Zt}from"./chunk-YT2MPR4E.js";import{G as Yt,b as Mt,o as vt}from"./chunk-LDKM7IQF.js";import{F as Ot,pa as Ge}from"./chunk-6O63U2D6.js";import{M as G,l as P,x as f}from"./chunk-RIOWPXBZ.js";import{a as M}from"./chunk-O337TVCZ.js";import{f as h,m as c,o as m}from"./chunk-GLD6H5Q5.js";c();m();var t=h(M()),We=h(Ze()),De=h(qe()),ot=h($t());Ge();G();Zt();Rt();Ut();Ht();c();m();var I=h(M());G();Ht();c();m();var Ne={list:"_list_shbob_1"};var Je=({coinId:e,value:n,visible:a,onToggleVisible:i,options:o,onChange:u})=>{let g=se(e),b=p=>{let{addressType:y,address:x,canTransferAmount:E}=p;return I.default.createElement(Tt.Card,{selected:n?.address===x,onClick:()=>{i?.(),u?.(p)}},I.default.createElement(w.Box,{style:{width:"100%"}},I.default.createElement(w.FlexBox,{justify:"space-between",align:w.ALIGN.center},I.default.createElement(C.Text,{strong:!0},f(J[y])),I.default.createElement(C.DisplayAmount,{strong:!0,mode:C.CRYPTO,decimals:g?.decimals},E)),I.default.createElement(w.FlexBox,{justify:"space-between",align:w.ALIGN.center},I.default.createElement(C.Address,{address:x,desensitize:!0,copyable:!1,size:C.SIZE.sm,type:C.TYPE.secondary}),I.default.createElement(C.Text,{type:C.TYPE.secondary,size:C.SIZE.xs},f("extension_wallet_available_coin_balance",{coin:g?.symbol})))))};return I.default.createElement(vt,{visible:a,alignBottom:!0,noTopRadius:!1,windowStyle:{width:"100%"},title:f("btcnft_gas_title_pay_gas_with"),onClose:i},I.default.createElement(Tt,{space:16,dataSource:o,renderItem:b,className:Ne.list}))},he=Je;c();m();Ve();var Ce=h(M()),$e=()=>(0,Ce.useCallback)(({value:e,message:n,reportParams:a})=>{try{kt.captureEvent({message:n,contexts:{report:{info:JSON.stringify(a)}},exception:{values:[{type:"BIZ_ERROR_btcPayWalletAddress",value:e}]},level:"warn"})}catch(i){console.log(i)}},[]),be=$e;c();m();var R=h(M());Zt();qt();Jt();function Ke(e,n,a,i){let[o,u]=(0,R.useState)(a),[g,b]=(0,R.useState)([]);return(0,R.useEffect)(()=>{if(i?.chainId===void 0||i?.chainId===null)return;(async()=>{try{if(!a)return;let y=await X(K.checkDustForBtcTx,{inscriptionIds:n,targetAddress:e,scene:24,chain:i.chainId,tokenStandard:Vt(i.chainId)});b(y?.data?.dustInscriptionIds||[])}finally{u(!1)}})()},[a,e,n,i]),{isDustLoading:o,dustError:g.length>0}}var we=Ke;c();m();var Ee=h(M());G();Rt();var Xe=({isMpcWallet:e,isHardware:n,feeError:a,isSufficientGas:i,dustError:o,transferReminder:u})=>({tipMessageProps:(0,Ee.useMemo)(()=>e?{type:S.TIP_TYPE.COMMON_ERROR,message:f("extension_wallet_contractual_interaction_wallet_unavailable")}:n?{type:S.TIP_TYPE.COMMON_ERROR,message:f("wallet_extension_top_toast_dapp_comingsoon")}:a?{type:S.TIP_TYPE.FEE_ERROR}:i?o?{type:S.TIP_TYPE.COMMON_ERROR,message:f("wallet_info_dialog_dust_limit_individually")}:{type:Mt.TYPE.warn,message:u}:{type:jt.FEE_BALANCE_INSUFFICIENT},[a,e,n,i,o,u])}),Fe=Xe;c();m();var Le=h($t());Jt();qt();var Qe=e=>{let{loading:n,data:a}=(0,Le.useRequest)(async()=>(await X(K.batchBtcNftDetail,{inscriptionIdProtocols:Array.isArray(e)?e:[e]}))?.data?.details||[]);return[n,a||[]]},Be=Qe;c();m();var At=h(M());G();Ut();var to=7*1e3,eo=({walletId:e,coinId:n,satBytes:a,needFilteredUtxo:i,localType:o=Wt})=>{let u=Qt(e),g=(0,At.useMemo)(()=>{let x=Kt(o);return u?.addressType?.[x]||[]},[u?.walletId]),[b,p]=fe({coinId:n,walletId:e,satBytes:a,addressList:g?.map(({address:x})=>x),needFilteredUtxo:i},{pollingInterval:to,ready:!!i?.length&&!!a}),y=(0,At.useMemo)(()=>g.map((E,A)=>({...E,canTransferAmount:p[A]}))?.sort((E,A)=>{let st=P.sub(A.canTransferAmount,E.canTransferAmount);return Number(st)}),[p,g]);return[b,y]},Pe=eo;c();m();var It={"nft-transfer__extend":"_nft-transfer__extend_1bjoo_1",nftTransferExtend:"_nft-transfer__extend_1bjoo_1","nft-transfer__icon":"_nft-transfer__icon_1bjoo_4",nftTransferIcon:"_nft-transfer__icon_1bjoo_4"};var Se={Ordinals:"Ordinals",Atomicals:"Atomicals"},ke=2,Oe="NFT",vs=({unapproved:e})=>{let n=e?.walletId,a=e?.localType,o=oe({localType:a})?.coinId;o===void 0&&(o=Dt(a));let[u,g]=re(o),b=ee(n),p=e.params.transfer.from,y=e.params.transfer.to,{feeRate:x}=e.params.transfer.options||{},E=be(),[,A]=le({coinId:o,address:p,chainId:u?.chainId}),st=A?.transferReminder,[Nt,H]=(0,ot.useSetState)({payWallet:!1,networkFee:!1}),[F,ht]=(0,t.useState)(x&&typeof x=="number"?{satBytes:x,level:q.CUSTOM}:{satBytes:A?.normal,level:q.STANDARD});(0,t.useEffect)(()=>{!F?.satBytes&&A?.normal&&ht({satBytes:A?.normal,level:q.STANDARD})},[A,F]);let z=e.params.transfer.data,k=Array.isArray(z)&&z.length>1,{isDustLoading:Ct,dustError:rt}=we(y,z,k,g),[,l]=Be(z),v=(0,t.useMemo)(()=>{if(!Array.isArray(l)||!l?.length)return;let[{protocol:r}]=l||[];if(r===Se.Atomicals)return $.ARC_20},[l]),nt=(0,t.useMemo)(()=>l.map(r=>`${r.btcNftUtxoDetail?.txId}-${r.btcNftUtxoDetail?.outputIndex}`),[l]),[bt,O]=Pe({localType:a,coinId:o,walletId:n,needFilteredUtxo:nt,satBytes:F?.satBytes}),[s,at]=(0,t.useState)({}),[it,{toggle:Ue}]=(0,ot.useBoolean)(!1);(0,t.useEffect)(()=>{let r=O?.[0];if(Ot(s)&&!!r&&r?.canTransferAmount&&at(r),O&&s.address&&s?.canTransferAmount){let d=O.find(({address:_})=>_===s?.address);d||E({value:d,reportParams:{payWallet:s,payWallets:O},message:`payWallet address get ${d}`}),d&&at(d)}},[E,s,O]);let Y=(0,t.useMemo)(()=>l.map(r=>{let{tokenId:d,protocol:_}=r,{txId:D,outputIndex:U,outputValue:ze}=r?.btcNftUtxoDetail||{},St={txHash:D,nftId:r.tokenId,status:1,address:p,vout:Number(U),coinAmount:Number(ze),resourceUrl:r?.resourceUrl};return _===Se.Atomicals&&Object.assign(St,{data:[{atomicalId:d,type:Oe,amount:1}]}),St}),[p,l]),wt=(0,t.useMemo)(()=>l.map(r=>{let d=r?.tokenId,{outputValue:_}=r?.btcNftUtxoDetail||{},D=Number(_);k||(D=P.lt(_,546)?546:Number(_));let U={amount:D,address:y};return v===$.ARC_20&&Object.assign(U,{data:[{atomicalId:d,type:Oe,amount:1}]}),U}),[k,l,v,y]),lt=(0,t.useMemo)(()=>{if(!k){let{outputValue:r=0}=l?.[0]?.btcNftUtxoDetail||{};if(r<546)return P.sub(546,r)}return 0},[k,l]),[ct,T,V]=ye({coinId:o,protocolId:v,toAddr:y,coinAmount:lt,fromAddr:s?.address,satBytes:F?.satBytes,utxoParams:{satBytes:F?.satBytes,needFilteredUtxo:nt},canTransferAmount:s?.canTransferAmount,inputs:Y,outputs:wt},{ready:!!Y?.length}),mt=k?Z.BTC_NFT_BULK_SEND:Z.SEND_NFT,Et=_e({coinId:o,walletId:n,protocolId:v,coinAmount:0,toAddr:y,fromAddr:p,changeAddr:s?.address,localType:u?.localType,dustSize:v===$.ARC_20?void 0:A?.minOutput,networkFee:T,satBytes:F.satBytes,inputs:Y,outputs:wt}),dt=l.map(({tokenId:r})=>r),Me=JSON.stringify({nftIds:dt,from:p,to:y,serviceCharge:T,gasFrom:s?.address}),Ft=ie({coinId:o,txType:mt,walletId:n,coinAmount:0,fromAddr:p,toAddr:y,networkFee:T,localType:u?.localType,extJson:Me,txSource:zt.NFT}),Lt=ue({coinId:o,walletId:n,address:s.address,utxoType:me.TRANSFER,satBytes:F?.satBytes,needFilteredUtxo:nt}),N=(0,We.useDispatch)(),B=(0,De.useHistory)(),Bt=pe({coinId:o,txType:Z.SEND_NFT,protocolId:Gt(u?.chainId),address:s.address}),ut=l?.length,ve=(0,t.useMemo)(()=>(l?.slice(0,it?ut:ke)).map(({resourceUrl:d,name:_})=>({title:_,icon:{src:d}})),[l,it,ut]),W=(0,t.useMemo)(()=>!(s?.canTransferAmount&&P.lt(s?.canTransferAmount,P.add(T,lt))),[T,lt,s?.canTransferAmount]),Ye=te(n),[je,ft]=(0,t.useState)(!1),pt=(0,t.useCallback)(async()=>{e.id?(await N(gt(e.id)),await N(_t()),B.push(Q)):(N(xt()),W?B.goBack():B.replace(Q)),ft(!1)},[N,B,W,e.id]),{tipMessageProps:Re}=Fe({isHardware:b,feeError:V,isSufficientGas:W,dustError:rt,transferReminder:st}),Pt=(0,t.useCallback)(async()=>{if(!await ce({walletId:n,callback:async()=>{await N(gt(e.id))}}))return;let d=await Lt(0,T);await Bt([...Y,...d],pt),ft(!0);let _=await Et({utxoList:[],utxos:[{address:s.address,inputs:de(d)}]}),D=await ne(u?.localType,_);try{e.id?(await N(ae(e.id,{coinId:o,txHash:D,signedTx:_,serviceCharge:T,gasFrom:s.address,txType:mt,nftIds:dt})),await N(_t())):(await Ft(_),N(xt()),Yt.success({title:f("wallet_transfer_notif_transaction_submit")})),B.push(Q)}catch(U){console.log(U)}finally{ft(!1)}},[pt,Bt,u?.localType,N,T,Lt,B,W,dt,s.address,Ft,Et,Y,mt,e.id]),He=(0,t.useMemo)(()=>{let r={actionType:j.ACTION_TYPE.CANCEL,btnText:f("wallet_dapp_connection_btn_reject"),onClick:pt},d={disabled:bt||ct||V||b||!Number(T)||!l?.length||Ct||rt,actionType:j.ACTION_TYPE.CONFIRM,onClick:Pt};return W||(d={coinId:o,walletId:n,address:s?.address,actionType:j.ACTION_TYPE.FILL_UP}),[r,d]},[bt,ct,V,b,T,l?.length,Pt,W,e.id,N,B,o,n,s?.address,Ct,rt]);return t.default.createElement(w.Box,null,t.default.createElement(tt,null,t.default.createElement(Te,{space:24,title:f("wallet_extension_send_colored_send"),summaryList:ve}),ut>ke&&t.default.createElement(w.FlexBox,{justify:"center",className:It["nft-transfer__extend"],onClick:Ue},t.default.createElement(yt,{size:yt.SIZE.xs,className:It["nft-transfer__icon"],icon:it?"okds-arrow-chevron-up-md":"okx-wallet-plugin-add-arrow-chevrons"}))),t.default.createElement(tt,null,t.default.createElement(et,{walletId:n,address:p,title:f("extension_send_mid_text_from")}),t.default.createElement(et,{address:y,title:f("extension_send_mid_text_to")})),t.default.createElement(tt,null,t.default.createElement(ge,{coinId:o,loading:ct,estimateFailed:V,networkFee:T,onClick:()=>{H({networkFee:!0})}}),t.default.createElement(et,{copyable:!1,address:s?.address,addressType:s?.addressType,title:f("btcnft_gas_label_pay_gas_with"),tags:[f(J[s?.addressType])],onClick:()=>{H({payWallet:!0})}},t.default.createElement(Ae,{coinBalance:s.canTransferAmount,coinId:o}))),t.default.createElement(he,{coinId:o,value:s,options:O,visible:Nt.payWallet,onChange:at,onToggleVisible:()=>{H({payWallet:!1})}}),t.default.createElement(Xt,{offsetBottom:0,placeholder:!0,borderTop:!0},t.default.createElement(S,{coinId:o,...Re}),t.default.createElement(j,{buttonGroup:He})),t.default.createElement(xe,{coinId:o,signInfo:A,visible:Nt?.networkFee,value:F,estimatedFee:T,onChange:ht,onToggleVisible:()=>{H({networkFee:!1})}}),t.default.createElement(Ie,{visible:Ye&&je}))};export{vs as a};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-NKXP6EKG.js.map
