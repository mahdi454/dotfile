import{a as ot}from"./chunk-445ZV7VL.js";import{d as Ie,e as we}from"./chunk-YQGNRWCJ.js";import{a as oe}from"./chunk-W7APXTAD.js";import{b as rt}from"./chunk-ALNQKIUN.js";import{Y as Re}from"./chunk-JDZSGQWQ.js";import{d as K,g as Pe,i as nt}from"./chunk-J2H2J7IS.js";import{b as _e}from"./chunk-KSAOBFIR.js";import{a as te,e as le}from"./chunk-PMGQLREC.js";import{F as tt}from"./chunk-YC6W5MPL.js";import{h as ne,l as Ee,m as be,s as pe}from"./chunk-IQUFOLSA.js";import{b as z}from"./chunk-AOXUSYRH.js";import{a as Se,l as $e,m as ze,q as D}from"./chunk-WKBC6JL3.js";import{X as me}from"./chunk-VPDRXROE.js";import{U as Qe,sa as et,w as bt}from"./chunk-JLIPSIRU.js";import{W as Ae,Y as It,b as Ue,ta as wt}from"./chunk-VGT27A4M.js";import{d as V,f as Pt}from"./chunk-R4G6BEPF.js";import{c as w}from"./chunk-RXNDJ7P3.js";import{a as Q,b as Rt}from"./chunk-CYOQISC6.js";import{f as ee,h as Bt}from"./chunk-TKYTZF2K.js";import{F as Ge,Ha as Z,Jb as At,Kc as Et,X as Fe,Zc as x,gd as ue,ib as Ve,w as Xe,x as Ye,y as He,zc as je}from"./chunk-YT2MPR4E.js";import{H as Ze,b as Ne,o as ce,r as Je}from"./chunk-LDKM7IQF.js";import{Y as We,f as Ke,pa as St}from"./chunk-6O63U2D6.js";import{M as he,l as Y,x as C}from"./chunk-RIOWPXBZ.js";import{b as Ut}from"./chunk-USKTQDCY.js";import{c as qe,ca as $}from"./chunk-OSCGYMLH.js";import{a as ie}from"./chunk-O337TVCZ.js";import{f as v,m as E,n as k,o as b}from"./chunk-GLD6H5Q5.js";E();b();var N=v(ie()),Tt=v(bt()),R=v(me());St();he();Pt();ue();wt();Ut();It();Et();At();Rt();Bt();Fe();E();b();var M=v(ie()),Te=v(me());E();b();Fe();function Dt(e,t,r,o,n=4){return(0,Te.useMemoizedFn)(async(s,m)=>{let i=0;for(let a=0;a<n;a++){let c=await e(s,void 0,{tempFeeRate:Number(m.expectedFeeRate)});if(!c.length)return[];i=c.reduce((l,p)=>l+p.coinAmount,0);let u=await t({inputs:c,outputs:[{address:r,amount:o}],dustSize:i});if(i-(u+Number(m.increaseFee))>o)return[!0,!1,c,u];if(i>o&&a===n-1)return u=i-o,[!1,!0,c,u]}return[]})}function st(e){let[t,r]=(0,M.useState)({}),[o,n]=(0,M.useState)(0),[s,m]=(0,M.useState)([]),[i,a]=(0,M.useState)(void 0),{mainCoinId:c,address:u,btcSpeedUpInfo:_,txHash:l}=e,p=c,f=K(p),d=(0,M.useMemo)(()=>_?.cpfpSpeedUpUtxo?.map(A=>`${A.txHash}-${A.vout}`),[_]),[,T]=ot({coinId:p,address:u,chainId:f?.chainId},{pollingInterval:20*1e3}),g=T?.minOutput||0,S=xe({coinId:p,fromAddr:u,output:[{to:u,value:g}],satBytes:t?.expectedFeeRate}),y=fe({coinId:p,address:u,utxoType:j.ACCELERATE_BTC_TX_UTXO,speedUpNeedUtxo:d}),{cancel:h}=(0,Te.useRequest)(async()=>{let A=await tt({address:u,coinId:p,txHash:l});r(A);let B=await y(0,void 0,{tempFeeRate:t.expectedFeeRate});m(B),a(void 0)},{pollingInterval:20*1e3,onError:A=>{a(A),h()}});(0,M.useEffect)(()=>{if(t?.expectedFeeRate&&s.length){let A=s.reduce((B,L)=>B+L.coinAmount,0);S({inputs:s,outputs:[{address:u,amount:g}],satBytes:t.expectedFeeRate,dustSize:A}).then(B=>{let L=He(B,Number(t.increaseFee),g);n(L)}).catch(B=>{throw B})}},[u,g,t,s,t?.expectedFeeRate]);let I=Dt(y,S,u,g);return[o,t,g,I,i]}E();b();var P=v(ie()),_t=v(me()),pt=v(qe());he();ue();E();b();var F=v(ie()),ut=v(me()),ge=v(qe());he();ue();Fe();E();b();var U={"retina-border-basic":"_retina-border-basic_gm6nn_1",retinaBorderBasic:"_retina-border-basic_gm6nn_1",root:"_root_gm6nn_29",subTitle:"_subTitle_gm6nn_32",utxo:"_utxo_gm6nn_37",coin:"_coin_gm6nn_45",coinDetail:"_coinDetail_gm6nn_81",coinSymbol:"_coinSymbol_gm6nn_87",nftImage:"_nftImage_gm6nn_93",coinAmount:"_coinAmount_gm6nn_96",coinValue:"_coinValue_gm6nn_101",assetList:"_assetList_gm6nn_109",unresolvedTip:"_unresolvedTip_gm6nn_109",list:"_list_gm6nn_116",paddingTop:"_paddingTop_gm6nn_119",asset:"_asset_gm6nn_109",assetDetail:"_assetDetail_gm6nn_129",assetValue:"_assetValue_gm6nn_130",foldSwitch:"_foldSwitch_gm6nn_144",fold:"_fold_gm6nn_144"};var q=e=>[x.ARC_NFT,x.BRC_NFT,x.FRACTAL_ORDINAL,x.DRC_NFT,x.SRC_NFT].includes(e),mt=e=>q(e?.protocolId)?`${e.collectionName||""} ${e.inscriptionNumber||e.nftId||""}`:ze(e.tokenAmount||"",{symbol:e.tokenSymbol||""}),lt=({asset:e,selectedCurrency:t,className:r})=>F.default.createElement(D.Text,{ellipsis:{tooltip:!0},className:r},Ge(e.usdAmount,0)?C("extension_defi_card_text_unknown_value"):$e(Y.mul(e.usdAmount,t.usdToThisRate),{symbol:t.symbol,useApproximate:!1})),Kt=({assetList:e,assetUnknown:t,selectedCurrency:r})=>{let o=e.length>3,[n,{toggle:s}]=(0,ut.useBoolean)(o),m=n?e.slice(0,3):e,i=!!t?.length;return F.default.createElement(w.Box,{className:U.assetList},i&&F.default.createElement(D.Text,{className:U.unresolvedTip},C("extension_defi_mid_alert_utxo_not_decode",{asset:t.join(C("extension_wallet_text_punctuation_mark"))})),m?.length?F.default.createElement(w.Box,{className:(0,ge.default)(U.list,{[U.paddingTop]:!i})},m.map(a=>F.default.createElement(w.Box,{className:U.asset},F.default.createElement(D.Text,{ellipsis:{tooltip:!0},className:U.assetDetail},mt(a)),F.default.createElement(lt,{asset:a,className:U.assetValue,selectedCurrency:r})))):null,!!o&&F.default.createElement(w.Box,{align:w.ALIGN.center,className:(0,ge.default)(U.foldSwitch,{[U.fold]:n}),onClick:s},F.default.createElement(w.Box,null,C(n?"extension_defi_card_textbtn_view_all":"extension_defi_card_textbtn_view_less")),F.default.createElement(z,{className:"okx-wallet-plugin-add-arrow-chevrons"})))},Wt=({title:e,utxoList:t,selectedCurrency:r})=>F.default.createElement(w.Box,{className:U.root},F.default.createElement(D.Text,{className:U.subTitle},e),t.map(o=>{let{mainAsset:n,protocolAssetList:s,assetUnknown:m}=o;return F.default.createElement(w.Box,{className:U.utxo},F.default.createElement(w.Box,{className:U.coin},F.default.createElement(w.Box,{className:U.coinDetail},F.default.createElement(z,{className:(0,ge.default)(U.coinSymbol,{[U.nftImage]:q(n.protocolId)}),radius:!1,size:q(n.protocolId)?Se.sm:Se.xs,src:n.image,text:n.tokenSymbol}),F.default.createElement(D.Text,{ellipsis:{tooltip:!0},className:U.coinAmount},mt(n))),F.default.createElement(lt,{className:U.coinValue,asset:n,selectedCurrency:r})),F.default.createElement(Kt,{assetList:s,assetUnknown:m,selectedCurrency:r}))})),Le=Wt;E();b();var O={"retina-border-basic":"_retina-border-basic_5grf2_1",retinaBorderBasic:"_retina-border-basic_5grf2_1",root:"_root_5grf2_29",header:"_header_5grf2_35",back:"_back_5grf2_42",main:"_main_5grf2_45",title:"_title_5grf2_51",text:"_text_5grf2_87",checkBox:"_checkBox_5grf2_92",footerWrap:"_footerWrap_5grf2_95",tipMessage:"_tipMessage_5grf2_131",submitButton:"_submitButton_5grf2_135"};var Xt=({conflictAssetUtxo:e,unlockFeeUtxo:t,selectedCurrency:r,protocolId:o,onConfirm:n,onCancel:s,coin:m,psbtTitle:i=""})=>{let[a,c]=(0,P.useState)(!1),u=(0,P.useRef)(),[_,l]=(0,P.useState)(!1);return(0,_t.useMount)(()=>{l(rt(u.current,"vertical"))}),P.default.createElement(w.Box,{className:O.root},P.default.createElement(w.Box,{className:O.header},P.default.createElement(z,{className:(0,pt.default)(O.back,"okds-arrow-chevron-left-centered-md"),onClick:s})),P.default.createElement(w.Box,{ref:u,className:O.main},P.default.createElement(w.Box,{className:O.title},P.default.createElement(D.Text,{className:O.text},C("extension_defi_top_title_confirm_use_utxo"))),!!e.length&&P.default.createElement(Le,{title:q(o)?C("extension_defi_top_subtitle_utxo_lose_all_assets_nft"):C("extension_defi_top_subtitle_utxo_lose_all_assets",{token:m.symbol}),utxoList:e,selectedCurrency:r}),!!t.length&&P.default.createElement(Le,{title:i||([x.ARC_20,x.RUNES,x.BRC_20,x.FRACTAL_BRC20,x.RUNEMAIN,x.FRACTAL_RUNES].includes(o)||q(o)?C("extension_defi_mid_subtitle_utxo_cover_fee_icu",{chainName:m?.chainName}):C("extension_defi_top_subtitle_use_utxo_lose_assets",{chainName:m?.chainName})),utxoList:t,selectedCurrency:r}),P.default.createElement(Je,{className:O.checkBox,onChange:p=>{let f=p?.target?.checked;c(f)},checked:a},C("extension_defi_bot_checkbox_label_confirm_use_utxo"))),P.default.createElement(w.Box,{className:O.footerWrap},!a&&P.default.createElement(Ne,{desc:C(_?"extension_defi_bot_tips_slide_check_box":"extension_defi_bot_tips_confirm_check_box"),type:Ne.TYPE.info,closable:!1,className:O.tipMessage}),P.default.createElement($,{block:!0,className:O.submitButton,disabled:!a,category:$.CATEGORY.fill,size:$.SIZE.lg,type:$.TYPE.highlight,onClick:n},C("extension_defi_bot_btn_continue"))))},dt=Xt;E();b();ue();E();b();var j={TRANSFER:1,TRANSFER_NFT:2,COMPLETE:3,BRC20_CONVERTIBLE:4,NFT_REMOVAL:5,PSBT_DUMMY_OCCUPIED:6,EXPEND_ABLE:7,EXPEND_UNABLE:8,INSCRIPTION:9,BRC20S_CONVERTIBLE:4,NEW_INSCRIPTION:11,SPLIT_UTXO:13,INSCRIPTION_USE_NFT_UTXO:14,ACCELERATE_BTC_TX_UTXO:15},H={CAL_FEE:1,CONFIRM:2},W=546,X={INSCRIBE:1,PSBT:2,PSBT_MPC_UNSIGNED_LIST:21,PSBT_MPC_SIGNED_LIST:22,PSBT_MPC_UNSIGNED_BUY:23,PSBT_MPC_SIGNED_BUY:24,PSBT_MPC_UNSIGNED:25,PSBT_KEY_SCRIPT_PATH:3,PSBT_KEY_SCRIPT_PATH_BATCH:4,SRC20:101,RUNES:102,RUNEMAIN:103,ARC20:114,CAT20:115},J={TRANSFER:1,PSBT:2,ACCELERATE:3};var Yt={BRC20:1,SRC20:101},ve=e=>{if(e===x.SRC_20)return X.SRC20;if(e===x.ARC_20)return X.ARC20;if(e===x.RUNES)return X.RUNES;if(e===x.RUNEMAIN||e===x.FRACTAL_RUNES)return X.RUNEMAIN;if(e===x.CAT_20)return X.CAT20},Ht=({data:e,nftLocaltionVOs:t},r)=>Array.isArray(e)&&e?.length?{data:e}:!r||!t?.[0]?.nftId||!Array.isArray(t)?{}:r===x.ARC_20?{data:t.map(({nftId:o,tokenType:n,value:s})=>({atomicalId:o,type:n,amount:s}))}:r===x.RUNES?{data:t.map(({nftId:o,value:n})=>({id:o,amount:n}))}:r===x.RUNEMAIN||r===x.FRACTAL_RUNES?{data:t.map(({nftId:o,value:n})=>({id:o,amount:n}))}:{},re=(e,t={},r)=>Array.isArray(e)?e.map(({txHash:o,vout:n,coinAmount:s,rawTransaction:m,...i})=>({vOut:n,amount:s,txId:o,rawTransaction:m,...Ht(i,r),...t})):[],ft=(e={},t,r)=>{let o=r===Yt.BRC20?"text/plain;charset=utf-8":"stamp:",n=e?.revealAddr,s=e?.contentType;return s||(s=o),n||(n=t),{...e,revealAddr:n,contentType:s}},xt=({type:e,toAddr:t,fromAddr:r,satBytes:o,utxoList:n,privateKey:s,inscriptionData:m,inscriptionDataList:i,revealOutValue:a=W})=>({type:e,revealOutValue:a,changeAddress:r,commitFeeRate:o,revealFeeRate:o,commitTxPrevOutputList:re(n,{privateKey:s,address:r}),inscriptionData:ft(m,t||r,e),inscriptionDataList:i?.length?i.map(c=>ft(c,t||r,e)):void 0}),Gt=({changeAddr:e,toAddr:t,satBytes:r,utxoList:o=[],coinAmount:n,inputs:s,outputs:m,...i})=>({address:e,feePerB:r,inputs:re([...s||[],...o]),outputs:m||[{address:t,amount:n}],...i}),Vt=({changeAddr:e,toAddr:t,satBytes:r,utxoList:o=[],coinAmount:n,inputs:s,outputs:m,protocolId:i,fromAddr:a,...c})=>{let u={feePerB:r,address:e,inputs:re([...s||[],...o],{address:a||e},i),outputs:m||[{address:t,amount:n}],...c};return i===x.RUNES&&Object.assign(u,{runeData:{etching:null,burn:!1}}),(i===x.RUNEMAIN||i===x.FRACTAL_RUNES)&&Object.assign(u,{runeData:{etching:null,burn:!1,useDefaultOutput:!1,defaultOutput:0}}),i===x.CAT_20&&Object.assign(u,{feeRate:r,changeAddress:e,toAddress:t,tokenAmount:n,verifyScript:!0}),u},jt=e=>[x.SRC_20,x.ARC_20,x.RUNES,x.RUNEMAIN,x.FRACTAL_RUNES,x.CAT_20].includes(e),de=({toAddr:e,changeAddr:t,satBytes:r,utxoList:o=[],coinAmount:n,inputs:s,outputs:m,protocolId:i,...a})=>jt(i)?Vt({toAddr:e,changeAddr:t,satBytes:r,utxoList:o,coinAmount:n,inputs:s,outputs:m,protocolId:i,...a}):Gt({toAddr:e,changeAddr:t,satBytes:r,utxoList:o,coinAmount:n,inputs:s,outputs:m,...a});var fe=e=>{let{coinId:t,address:r,walletId:o,utxoType:n,satBytes:s,utxoRequests:m=[],...i}=e,a=K(t),c=a?.baseCoinId||a?.coinId;return(0,R.useMemoizedFn)(async(u,_,l={})=>{let p=await V().getRequestHeaders({walletId:o,needSign:!0,currency:"usd"}),f={coinId:c,utxoRequests:[{address:r,coinAmount:u,serviceCharge:_,utxoType:n||j.TRANSFER,...i,...l},...m]};try{let{data:d}=await ee(Q?.getBTCUTXO,f,{headers:p}),{utxoList:T}=d?.[0]||{};return T}catch(d){return Promise.reject(d)}},[c,r,o,n,i])},qt=[],at=(e,t)=>{let{ready:r=!0,refreshDeps:o=[],...n}=t||{},{coinAmount:s="0",networkFee:m="0",...i}=e||{},a=fe(i),c={debounceWait:500,ready:r&&i?.address&&i?.walletId,refreshDeps:[s,m,a,...o],...n},{error:u,loading:_,data:l}=(0,R.useRequest)(async()=>await a(s,m),c);return[_,l||qt,u]},Be=()=>(0,R.useMemoizedFn)(async({coinId:e,baseCoinId:t,satBytes:r,addressList:o,walletId:n,utxoType:s,...m})=>{let i=await V().getRequestHeaders({walletId:n,needSign:!0,currency:"usd"}),a=Array.isArray(o)?o:[o],c={coinId:t,utxoRequests:a.map(u=>({address:u,coinAmount:0,serviceCharge:0,utxoType:s||j.TRANSFER,...m}))};try{let{data:u}=await ee(Q?.getBTCUTXO,c,{headers:i});return a.map(_=>{let{canTransferAmount:l}=u.find(p=>p.address===_);return l})}catch(u){return Promise.reject(u)}}),Lt=(e={},t)=>{let{address:r,coinId:o,...n}=e,{ready:s=!0,...m}=t||{},i=Be(),a=K(o),{loading:c,data:u,error:_}=(0,R.useRequest)(async()=>{try{return(await i({addressList:[r],baseCoinId:a.baseCoinId||o,coinId:o,...n}))?.[0]||"0"}catch{return"0"}},{ready:!!r&&s&&a?.baseCoinId!==void 0,...m});return[c,u,_]},vt=(e={},t)=>{let{addressList:r,coinId:o,...n}=e,{ready:s=!0,...m}=t||{},i=Be(),a=K(o),{loading:c,data:u,error:_}=(0,R.useRequest)(async()=>await i({addressList:r,baseCoinId:a.baseCoinId||o,coinId:o,...n}),{ready:Array.isArray(r)&&r?.length&&s&&a?.baseCoinId!==void 0,...m});return[c,u||[],_]},Jt=0,it=()=>(0,R.useMemoizedFn)((e,t)=>(e||[]).some(o=>o.status===Jt)?new Promise((o,n)=>{let s=ce.warn({alignBottom:!1,title:C("extension_wallet_transaction_title_low_tradingfee"),text:C("extension_wallet_transaction_subtitle_low_tradingfee"),confirmText:C("wallet_extension_address_popup_btn_continue"),cancelText:C("wallet_extension_btn_general_cancel"),onCancel:()=>{s.destroy(),n(),t?.()},onConfirm:()=>{s.destroy(),o()}})}):Promise.resolve(),[]),Zt=(e,t)=>{let[,r]=Pe(t);return(0,R.useMemoizedFn)(async o=>{if(r?.coinId!==Ve)return Promise.resolve();let{data:n}=await ee(Q.checkWalletCommonPending,{address:e,coinId:t});return n?new Promise((s,m)=>{let i=ce.warn({alignBottom:!1,title:C("extension_defi_mid_title_reminder"),text:C("extension_defi_mid_subtitle_reminder_submit"),confirmText:C("extension_defi_mid_btn_cancel"),onConfirm:()=>{i.destroy(),m(),o?.()},cancelText:C("extension_defi_mid_btn_continue_submit"),onCancel:()=>{i.destroy(),s()}})}):Promise.resolve()})},$t=({address:e,coinId:t,protocolId:r,txType:o=Ue.TRANS_OUT,doubleConfirmSource:n=J.TRANSFER})=>{let[s,m]=Pe(t,{withPrice:!0});s=s||{},m=m||{};let i=(0,Tt.useSelector)(et),{currencyId:a}=i,c=nt({currencyId:a});return(0,R.useMemoizedFn)(async u=>{let _={};return u.forEach(({txHash:l,resourceUrl:p})=>{_[l]=p}),new Promise((l,p)=>{(async()=>{try{let{data:{conflictAssetUtxo:f,unlockFeeUtxo:d}}=await ee(Q.doubleCheckUtxo,{utxoList:u.map(y=>{let h=We(y,["vout","nftId","txHash","status","coinAmount"]);return n!==J.PSBT?h.unlockUtxo=y?.utxoStatusType===1:h.unlockUtxo=!0,h}),address:e,txType:o,coinId:t});if(!f?.length&&!d?.length){l();return}let T=f?.map(y=>{let[h,...I]=y.protocolAssetList;return h.image=_[y.txHash]||s.image,{...y,mainAsset:h,protocolAssetList:I}})||[],g=d?.map(y=>{let h=Ye(y.coinAmount,Y.pow(10,m.decimals||0));return y.mainAsset={tokenSymbol:m.symbol,tokenAmount:h,usdAmount:Xe(h,m.usdPrice||0),image:m.image},y})||[],S=ce.action({windowStyle:{width:"100%",height:"100%",maxHeight:"none"},alignBottom:!0,hideCloseBtn:!0,noContentPadding:!0,children:N.default.createElement(dt,{coin:s,selectedCurrency:i,coinToCurrencyFn:c,protocolId:r,conflictAssetUtxo:T,unlockFeeUtxo:g,txType:o,onConfirm:()=>{l(),S.destroy()},onCancel:()=>{p(new Error(Re)),S.destroy()},psbtTitle:n=J.PSBT?C("extension_defi_top_toast_all_spent"):""})})}catch(f){console.log(f),Ze.error(C("extension_defi_toast_textarea_create_order_fail")),p(new Error(Re))}})()})})},kt=({address:e,coinId:t,currencyId:r,txType:o=Ue.TRANS_OUT,protocolId:n,doubleConfirmSource:s=J.TRANSFER})=>{let m=$t({address:e,coinId:t,protocolId:n,txType:o,currencyId:r,doubleConfirmSource:s}),i=Zt(e,t),a=it();return(0,R.useMemoizedFn)(async(c,u=Ke)=>{try{return s===J.TRANSFER&&(await i(u),await a(c,u)),await m(c),Promise.resolve()}catch(_){return Promise.reject(_)}})};function gt(e){return JSON.stringify({ecdsaShare2:Qe(e)})}async function yt(e,t,{share:r,pShare:o,mpcId:n,deriveIndex:s}){let{networks:m}=await le(),i=oe(),a=await i.exec("inscribeForMPCUnsigned",[t,m.bitcoin]),{commitTx:c,signHashList:u}=a;t.commitTx=c;let _={currency:0,baseChain:Z,share:r,pShare:o,mpcId:n,signHashList:u,deriveIndex:s},l=await V().mpcSignTransaction(e,Z,_),p=JSON.parse(l).signatures;t.signatureList=p;let f=await i.exec("inscribeForMPCSigned",[t,m.bitcoin]);return delete f.signHashList,f}var Do=e=>{let t=be(),r=pe(),o=Ee(),n=(0,N.useCallback)((a,c,u="text/plain;charset=utf-8")=>{let _=[];return a.forEach(l=>{let p={...l};p.contentType||(p.contentType=u),p.revealAddr||(p.revealAddr=c),_.push(p)}),_},[]),s=(0,N.useCallback)(async a=>{let c=o(a),u=await V().getMpcShare(a,Z),{share:_,pShare:l}=u??{},{mpcId:p,publicKey:f,deriveIndex:d}=c?.addressType?.bitcoin?.find(T=>T?.addressType===c?.selectedAddressType?.bitcoin)||{};return{publicKey:f,share:_,pShare:l,mpcId:p,deriveIndex:d}},[]),m=(0,N.useCallback)(async(a,c)=>{let _=(await r(a))?.find(l=>l.address===c)?.privateKey;if(t){let{getRandomPrivateKey:l,getMidKey:p}=await te(),{networks:f,private2Wif:d}=await le();if(e===H.CAL_FEE)return await l(0);if(e===H.CONFIRM){let{share:T}=await s(a),g=await p(gt(T),0);return d(k.Buffer.from(g),f.bitcoin)}}return _},[]);return(0,N.useCallback)(async({walletId:a,address:c,tx:u={},privateKey:_})=>{let l=_;l||(l=await m(a,c));let{publicKey:p}=await s(a),f=oe(),{commitTxPrevOutputList:d,commitFeeRate:T,revealFeeRate:g,inscriptionData:S,inscriptionDataList:y,revealOutValue:h=546,changeAddress:I=c,toAddr:A}=u,L={commitTxPrevOutputList:d.map(G=>({...G,privateKey:l,publicKey:p,address:c})),commitFeeRate:T,revealFeeRate:g||T,inscriptionData:S,inscriptionDataList:n(y,A||c),revealOutValue:h,changeAddress:I,type:1};if(e===H.CONFIRM&&t){let G=await s(a);return await yt(a,L,G)}return await f.exec("signTransaction",[0,{data:L}])},[m,s,n,t,e])},Ko=e=>{let t=be(),r=pe(),o=Ee(),n=(0,N.useCallback)(async i=>{let a=await V().getMpcShare(i,Z),c=o(i),{share:u,pShare:_}=a??{},{mpcId:l,publicKey:p,deriveIndex:f}=c?.addressType?.bitcoin?.find(d=>d?.addressType===c?.selectedAddressType?.bitcoin)||{};return{publicKey:p,share:u,pShare:_,mpcId:l,deriveIndex:f}},[]),s=(0,N.useCallback)(async(i,a)=>{let u=(await r(i))?.find(_=>_.address===a)?.privateKey;if(t){let{getRandomPrivateKey:_,getMidKey:l}=await te(),{networks:p,private2Wif:f}=await le();if(e===H.CAL_FEE)return await _(0);if(e===H.CONFIRM){let{share:d}=await n(i),T=await l(gt(d),0);return f(k.Buffer.from(T),p.bitcoin)}}return u},[]);return(0,N.useCallback)(async({walletId:i,address:a,tx:c={},privateKey:u,mintType:_=Ae.parallel})=>{let l=u;l||(l=await s(i,a));let{publicKey:p}=await n(i),f=oe(),{input:d,outValue:T,inscriptions:g}=c,S=d.map(B=>({...B,privateKey:l,publicKey:p,address:a})),y={type:X.RUNEMAIN,inputs:S,outputs:[{address:a,amount:T,data:g[0]}],runeData:{etching:null,useDefaultOutput:!1,defaultOutput:0,burn:!1,mint:!0,mintNum:g.length,serialMint:_===Ae.serial},...c},{estimateFee:h}=await te(),I=await h(0,{data:y});if(g.length===1&&(I=[I]),e===H.CONFIRM&&t){let B=await n(i),L=await yt(i,y,B);return{commitTx:L[0],revealTxs:L.slice(1),commitAddrs:[],commitTxFee:I[0],revealTxFees:I.slice(1)}}let A=await f.exec("signTransaction",[0,{data:y,privateKey:l}]);return g.length===1&&(A=[A]),{commitTx:A[0],revealTxs:A.slice(1),commitAddrs:[],commitTxFee:I[0],revealTxFees:I.slice(1)}},[s,n,t,e])},Ct=({type:e,toAddr:t,fromAddr:r,walletId:o,satBytes:n,inscriptionData:s,inscriptionDataList:m,revealOutValue:i=790})=>{let a=ne(),c=o||a,u=pe();return(0,N.useCallback)(async({utxoList:_})=>{let p=(await u(c)).find(({address:d})=>d===r)?.privateKey,f=xt({type:e,toAddr:t,satBytes:n,fromAddr:r,utxoList:_,privateKey:p,revealOutValue:i,inscriptionData:s,inscriptionDataList:m});try{return await oe().exec("signTransaction",[0,{data:f}])}catch{throw Error("sign error")}},[u,c,e,t,n,r,i,s,m])},zt=({type:e,toAddr:t,fromAddr:r,walletId:o,satBytes:n,inscriptionData:s,inscriptionDataList:m,revealOutValue:i=W,onlyCommitTxFee:a})=>{let c=Ct({type:e,toAddr:t,fromAddr:r,walletId:o,satBytes:n,revealOutValue:i,inscriptionData:s,inscriptionDataList:m});return(0,N.useCallback)(async({utxoList:u,..._})=>{let{commitTxFee:l,revealTxFees:p=[]}=await c({utxoList:u,..._});return a?l:{commitTxFee:l,totalRevealTxFee:(p||[]).reduce((f,d)=>Y.add(f,d),0)}},[a,c])},Qt=({type:e,coinId:t,fromAddr:r,toAddr:o,satBytes:n,coinAmount:s,protocolId:m})=>{let a=K(t)?.baseCoinId||t;return(0,N.useCallback)(async({utxoList:c,...u})=>{if(!Number(n))return Promise.reject();let{estimateFee:_}=await te(),l=de({type:e,toAddr:o,utxoList:c,satBytes:n,coinAmount:s,protocolId:m,changeAddr:r,...u}),f=je({coinId:+a})?.coinType;try{return await _(f,{data:l,privateKey:""})}catch(d){return Promise.reject(d)}},[a,s,r,m,n,o,e])},xe=({coinId:e,fromAddr:t,toAddr:r,satBytes:o,coinAmount:n,protocolId:s,revealOutValue:m,inscriptionData:i,inscriptionDataList:a,...c})=>{let u=ve(s),_=Qt({coinId:e,satBytes:o,fromAddr:t,toAddr:r,coinAmount:n,protocolId:s,type:u,...c}),l=zt({coinId:e,toAddr:r,fromAddr:t,satBytes:o,coinAmount:n,protocolId:s,revealOutValue:m,inscriptionData:i,inscriptionDataList:a,type:u,onlyCommitTxFee:!0,...c});return s===x.SRC_20?l:_},Ot=(e,t)=>{let{coinId:r,walletId:o,toAddr:n,fromAddr:s,satBytes:m,networkFee:i,coinAmount:a,canTransferAmount:c,utxoParams:u={},inscriptionData:_,protocolId:l,inscriptionDataList:p,revealOutValue:f=W,inputs:d,...T}=e,g=K(r),S=g?.baseCoinId===0,y=l||g?.protocolId,{ready:h=!0,refreshDeps:I}=t||{},[A,{setTrue:B,setFalse:L}]=(0,R.useBoolean)(!1),[ke,G]=(0,N.useState)(),Oe=ne(),ht=o||Oe,[ye,Ft]=(0,N.useState)(i),Me=xe({coinId:r,fromAddr:s,toAddr:n,satBytes:m,coinAmount:a,protocolId:y,revealOutValue:f,inscriptionData:_,inscriptionDataList:p}),De={coinAmount:a,networkFee:ye||"0"};S&&c&&Y.gt(Y.add(a,ye),c)&&(De={coinAmount:c,networkFee:0});let[Nt,se]=at({coinId:r,address:s,walletId:ht,...De,...u},{refreshDeps:I,ready:S&&!!c&&h||!S&&h}),Ce=(0,N.useMemo)(()=>[...d||[],...se||[]],[d,se]);return(0,R.useDeepCompareEffect)(()=>{!Array.isArray(Ce)||!Ce?.length||(B(),Me({utxoList:Ce,...T}).then(ae=>{G(!1),Ft(ae),t?.onSuccess?.(ae,se)}).catch(ae=>{G(!0),t?.onError?.(ae)}).finally(()=>{L()}))},[se,T,Me]),[A||Nt,ye,ke]},en=({type:e,coinId:t,toAddr:r,walletId:o,fromAddr:n,changeAddr:s,satBytes:m,localType:i,coinAmount:a,networkFee:c,protocolId:u,dustSize:_=W,...l})=>{let p=ne(),f=o||p,d=_e(i),T=Ie({fromAddr:n,localType:d,walletId:f});return(0,N.useCallback)(async({utxoList:g,...S})=>{let y=de({toAddr:r,satBytes:m,type:e,changeAddr:s||n,dustSize:_,coinAmount:a,utxoList:g,protocolId:u,...l,...S});return await T({params:y,...S})},[s,a,_,n,u,l,m,T,r,e])},ct=({coinId:e,toAddr:t,walletId:r,protocolId:o,fromAddr:n,changeAddr:s,satBytes:m,localType:i,coinAmount:a,networkFee:c,inscriptionData:u,inscriptionDataList:_,dustSize:l=W,...p})=>{let f=_e(i),d=ve(o),T=en({coinId:e,toAddr:t,walletId:r,fromAddr:n,changeAddr:s,satBytes:m,localType:f,coinAmount:a,networkFee:c,dustSize:l,protocolId:o,type:d,...p}),g=Ct({toAddr:t,fromAddr:n,walletId:r,satBytes:m,protocolId:o,inscriptionData:u,inscriptionDataList:_,type:d,...p});return o===x.SRC_20?g:T},Mt=({coinId:e,toAddr:t,txType:r,fromAddr:o,satBytes:n,walletId:s,localType:m,networkFee:i,coinAmount:a,protocolId:c,dustSize:u=W,extraPublishParams:_={},...l})=>{let p=ne(),f=s||p,d=_e(m),T=ct({coinId:e,toAddr:t,walletId:s,fromAddr:o,satBytes:n,localType:d,coinAmount:a,networkFee:i,dustSize:u,protocolId:c,...l}),g=we({coinId:e,txType:r,coinAmount:a,fromAddr:o,toAddr:t,localType:d,networkFee:i,walletId:f,extJson:JSON.stringify({protocolId:c}),..._});return(0,N.useCallback)(async({utxoList:S,...y})=>{let h=await T({utxoList:S,...y}),I=h;return c===x.SRC_20&&(I=h?.commitTx),await g(I)},[c,g,T])};export{st as a,j as b,H as c,W as d,J as e,Ht as f,re as g,jt as h,fe as i,at as j,Lt as k,vt as l,kt as m,gt as n,Do as o,Ko as p,xe as q,Ot as r,ct as s,Mt as t};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-GL5KZF23.js.map
