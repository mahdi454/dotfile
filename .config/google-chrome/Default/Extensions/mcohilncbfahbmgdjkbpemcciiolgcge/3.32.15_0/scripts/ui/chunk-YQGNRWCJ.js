import{a as q}from"./chunk-UAHUXCQX.js";import{d as $}from"./chunk-MI6YHDAD.js";import{a as Y,b as Z,c as x,d as I}from"./chunk-SVAMZON6.js";import{b as U}from"./chunk-KWBWAA7R.js";import{d as G}from"./chunk-TRBDC433.js";import{b as z}from"./chunk-YC6W5MPL.js";import{a as D}from"./chunk-SMZ64QW3.js";import{h as H,i as C,m as j}from"./chunk-IQUFOLSA.js";import{T as b,_ as k}from"./chunk-S5DGV5WL.js";import{X as ut}from"./chunk-VPDRXROE.js";import{a as st}from"./chunk-VX55KNI4.js";import{A as R,D as at}from"./chunk-VGT27A4M.js";import{d as f,f as F}from"./chunk-R4G6BEPF.js";import{u as B}from"./chunk-AYCAVTPT.js";import{a as O,b as it}from"./chunk-CYOQISC6.js";import{f as N,h as lt}from"./chunk-TKYTZF2K.js";import{Uc as M,a as v,b as et,gd as ct}from"./chunk-YT2MPR4E.js";import{o as L}from"./chunk-LDKM7IQF.js";import{j as W,pa as nt}from"./chunk-6O63U2D6.js";import{M as ot,x as a}from"./chunk-RIOWPXBZ.js";import{ca as y}from"./chunk-OSCGYMLH.js";import{a as rt}from"./chunk-O337TVCZ.js";import{f as A,m as h,o as E}from"./chunk-GLD6H5Q5.js";h();E();var m=A(rt()),Q=A(st()),T=A(ut());ot();et();F();ct();at();it();lt();h();E();F();nt();var V=async r=>{try{return await f().getMpcIdByWalletId(r)}catch{return null}},J=async r=>{try{return await f().accountCheck(r)}catch{return!1}},K=async r=>{try{let{data:t}=await $([{mpcId:r}]);return{mpcStatus:W(t,"[0].mpcStatus"),accountStatus:W(t,"[0].accountStatus")}}catch{return{mpcStatus:I.ESCAPE,accountStatus:x.FROZEN}}};var mt=()=>(0,T.useMemoizedFn)(async r=>{let{coinId:t,address:e,chainId:n,...l}=r||{};if(!e||!t)return{};try{let o={coinId:t,address:e},{data:c}=await z(o,{chainId:n,...l}),{info:u,...i}=c||{};return{...i,...u||{}}}catch(o){return Promise.reject(o)}},[]),Zt=()=>(0,T.useMemoizedFn)(async r=>{try{let e=await(await fetch(r)).json();return e&&e?.custom_payload&&e?.state_init&&e?.jetton_wallet?{customPayload:e?.custom_payload,stateInit:e?.state_init,fromJettonAccount:e?.jetton_wallet}:{}}catch(t){return console.log("error:",t),{}}},[]),pt=7e3,qt=({coinId:r,address:t,chainId:e,...n},l={})=>{let o=mt(),[c,u]=(0,m.useState)({}),{ready:i=!0,pollingInterval:s,..._}=l||{},p={ready:!!r&&!!t&&!!i,pollingInterval:s||pt,..._};return(0,T.useRequest)(async()=>await o({coinId:r,address:t,chainId:e,...n}),{...p,onSuccess:w=>{u(w),p?.onSuccess?.(w)}}),c};var dt=({fromAddr:r,localType:t})=>(0,m.useCallback)(({params:e,isSignError:n})=>{v.captureEvent({message:`signTxError: ${r}`,contexts:{report:{info:JSON.stringify({params:e,isSignError:n,localType:t})}},exception:{values:[{type:"BIZ_ERROR_signTxError",value:r}]},level:"error"})},[r,t]),$t=({fromAddr:r,localType:t,walletId:e})=>{let n=C(e),l=dt({fromAddr:r,localType:t});return(0,m.useCallback)(async({params:o={},fromAddr:c,needCapture:u=!1,...i})=>{try{let s=c||r;return U(n?.initialType)?await G({walletInfo:n,txParams:o,baseChain:t}):await f().signTransaction(o,s,t,e,i)}catch(s){throw u&&l({params:o,isSignError:s?.message===R}),s?.message===B?s:new Error(R)}},[r,t,n,e])},Vt=({coinId:r,txType:t,walletId:e,coinAmount:n,fromAddr:l,toAddr:o,localType:c,networkFee:u,extJson:i,...s})=>{let _=C(e),p=_?.walletId;return(0,m.useCallback)(async(w,d={})=>{let g=d?.walletId||p,S=d?.txHash||await q(c,w),P={coinId:r,txHash:S,txType:t,extJson:i,signedTx:w,coinAmount:n,toAdr:o,fromAdr:l,serviceCharge:u,accountId:g,walletType:_?.serverWalletType,txSource:M.NORMAL,...s,...d},X=await f().getRequestHeaders({needSign:!0,currency:"usd",walletId:g}),{data:tt}=await N(O.postTx,P,{headers:X});return tt},[c,r,t,i,n,o,l,u,p,_?.serverWalletType,s])},Jt=({walletId:r,...t})=>{let e=C(r),n=e?.walletId;return(0,m.useCallback)(async(l,o={})=>{let c=o?.walletId||n,u=l.map(_=>({..._,accountId:c,walletType:e?.serverWalletType,txSource:M.NORMAL,...t,...o})),i=await f().getRequestHeaders({needSign:!0,currency:"usd",walletId:c}),{data:s}=await N(O.postBatchTxV2,{txList:u},{headers:i});return s},[n,e?.serverWalletType,t])},Kt=(r,t)=>{let e=(0,m.useRef)(),n=(0,Q.useHistory)(),l=H(),o=r||l,c=j(o),u=D();return(0,m.useCallback)(async()=>{if(!c)return Promise.resolve();let i=await V(o);if(!i)return Promise.resolve();let s=await J(i),{mpcStatus:_,accountStatus:p}=await K(i);if(p===x.NORMAL&&_!==I.ESCAPE&&s)return Promise.resolve();let d={},g=()=>{t?.(),n.replace(k),e.current?.destroy()},S=window.location.pathname.includes(b);return s?p===x.DELETE?d={title:a("extension_wallet_error_toast_modatitle_deleteacct"),text:a("extension_wallet_error_toast_modaldesc_deleteacct"),confirmText:a("extension_wallet_error_toast_btn_switch_wallet"),onConfirm:g}:p===x.FROZEN?d={title:a("extension_wallet_error_toast_title_freeze_account"),text:a("extension_wallet_error_toast_text_freeze_desc"),confirmText:a("extension_wallet_error_toast_btn_switch_wallet"),onConfirm:g}:_===I.ESCAPE&&(d={title:a("extension_wallet_error_toast_modaltitle_wallet_escaped"),text:a("extension_wallet_error_toast_modaldesc_wallet_escapeddesc"),confirmText:a("extension_wallet_error_toast_btn_switch_wallet"),onConfirm:g}):d={text:a("extension_wallet_error_toast_text_verify_again1"),title:a("extension_wallet_error_toast_title_verify_again"),confirmText:a("extension_wallet_error_toast_btn_verification"),onConfirm:async()=>{t?.(),e.current?.destroy();let P=a("wallet_common_okx_link");await f().setMpcAction(Y.VERIFY,o),globalThis.open(u?.mpcLogin||`https://${P}${Z}`),window.close()},cancelText:S?void 0:a("extension_wallet_error_toast_btn_switch_wallet"),cancelBtnProps:S?void 0:{category:y.CATEGORY.outline,size:y.SIZE.lg},onCancel:S?void 0:g},e.current=L.prompt({visible:!0,hideCloseBtn:!0,infoType:L.Prompt.INFO_TYPE.warn,alignBottom:!1,maskClosable:!1,confirmBtnProps:{type:y.TYPE.highlight,size:y.SIZE.lg},...d}),Promise.reject()},[n,c,o,t])};export{mt as a,Zt as b,qt as c,$t as d,Vt as e,Jt as f,Kt as g};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-YQGNRWCJ.js.map
